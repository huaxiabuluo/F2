"use strict";(self.webpackChunk_antv_f2_site=self.webpackChunk_antv_f2_site||[]).push([[1731],{1966:function(e,t,n){n.d(t,{Th:function(){return ks}});var r=n(34944),i=n.n(r),a=n(78643),o=n(54091),s=n(85545),l=n(62228),u=n(67538),c=n(96103),h=n(55332),d=n(38471),f=n(26186),p=n(47156),v=n(17517),g=n(88244),m=n(52810),y=n(38516),E=n(98773),_=n(43665),T=n(55072),R=n(79364),S=n(12873),A=n(24753),x=n(91508),C=n(53982),M=n(99107),N=n(57002),k=n(60241),b=n(31973),P=n(20773),O=n(50315),I=n(53894),D=n(76622),L=n(86703),B=n(70148),w=n(90176),F=n(17020),U=n(45327),G=n(21254),Z=n(57387),V=n(60286),X=n(67505);function W(e,t,n,r){var i=e-n,a=t-r;return Math.sqrt(i*i+a*a)}function H(e,t){var n=Math.min.apply(Math,(0,c.Z)(e)),r=Math.min.apply(Math,(0,c.Z)(t));return{x:n,y:r,width:Math.max.apply(Math,(0,c.Z)(e))-n,height:Math.max.apply(Math,(0,c.Z)(t))-r}}function Y(e,t,n,r,i,a){return n*Math.cos(i)*Math.cos(a)-r*Math.sin(i)*Math.sin(a)+e}function z(e,t,n,r,i,a){return n*Math.sin(i)*Math.cos(a)+r*Math.cos(i)*Math.sin(a)+t}function K(e,t,n,r,i,a,o){for(var s=function(e,t,n){return Math.atan(-t/e*Math.tan(n))}(n,r,i),l=1/0,u=-1/0,c=[a,o],h=2*-Math.PI;h<=2*Math.PI;h+=Math.PI){var d=s+h;a<o?a<d&&d<o&&c.push(d):o<d&&d<a&&c.push(d)}for(var f=0;f<c.length;f++){var p=Y(e,0,n,r,i,c[f]);p<l&&(l=p),p>u&&(u=p)}for(var v=function(e,t,n){return Math.atan(t/(e*Math.tan(n)))}(n,r,i),g=1/0,m=-1/0,y=[a,o],E=2*-Math.PI;E<=2*Math.PI;E+=Math.PI){var _=v+E;a<o?a<_&&_<o&&y.push(_):o<_&&_<a&&y.push(_)}for(var T=0;T<y.length;T++){var R=z(0,t,n,r,i,y[T]);R<g&&(g=R),R>m&&(m=R)}return{x:l,y:g,width:u-l,height:m-g}}function j(e,t,n,r,i,a){var o=-1,s=1/0,l=[n,r],u=20;a&&a>200&&(u=a/10);for(var h=1/u,d=h/10,f=0;f<=u;f++){var p=f*h,v=[i.apply(void 0,(0,c.Z)(e.concat([p]))),i.apply(void 0,(0,c.Z)(t.concat([p])))],g=W(l[0],l[1],v[0],v[1]);g<s&&(o=p,s=g)}if(0===o)return{x:e[0],y:t[0]};if(1===o){var m=e.length;return{x:e[m-1],y:t[m-1]}}s=1/0;for(var y=0;y<32&&!(d<1e-4);y++){var E=o-d,_=o+d,T=[i.apply(void 0,(0,c.Z)(e.concat([E]))),i.apply(void 0,(0,c.Z)(t.concat([E])))],R=W(l[0],l[1],T[0],T[1]);if(E>=0&&R<s)o=E,s=R;else{var S=[i.apply(void 0,(0,c.Z)(e.concat([_]))),i.apply(void 0,(0,c.Z)(t.concat([_])))],A=W(l[0],l[1],S[0],S[1]);_<=1&&A<s?(o=_,s=A):d*=.5}}return{x:i.apply(void 0,(0,c.Z)(e.concat([o]))),y:i.apply(void 0,(0,c.Z)(t.concat([o])))}}function q(e,t,n,r){return W(e,t,n,r)}function Q(e,t,n,r,i){return{x:(1-i)*e+i*n,y:(1-i)*t+i*r}}function $(e,t,n,r,i,a){var o=[n-e,r-t];if(y.exactEquals(o,[0,0]))return Math.sqrt((i-e)*(i-e)+(a-t)*(a-t));var s=[-o[1],o[0]];y.normalize(s,s);var l=[i-e,a-t];return Math.abs(y.dot(l,s))}function J(e,t,n,r,i){var a=1-i;return a*a*a*e+3*t*i*a*a+3*n*i*i*a+r*i*i*i}function ee(e,t,n,r){var i,a,o,s=-3*e+9*t-9*n+3*r,l=6*e-12*t+6*n,u=3*t-3*e,c=[];if((0,M.Z)(s,0))(0,M.Z)(l,0)||(i=-u/l)>=0&&i<=1&&c.push(i);else{var h=l*l-4*s*u;(0,M.Z)(h,0)?c.push(-l/(2*s)):h>0&&(a=(-l-(o=Math.sqrt(h)))/(2*s),(i=(-l+o)/(2*s))>=0&&i<=1&&c.push(i),a>=0&&a<=1&&c.push(a))}return c}function te(e,t,n,r,i,a,o,s){for(var l=[e,o],u=[t,s],c=ee(e,n,i,o),h=ee(t,r,a,s),d=0;d<c.length;d++)l.push(J(e,n,i,o,c[d]));for(var f=0;f<h.length;f++)u.push(J(t,r,a,s,h[f]));return H(l,u)}function ne(e,t,n,r,i,a,o,s,l,u,c){var h=function(e,t,n,r,i,a,o,s,l,u,c){return j([e,n,i,o],[t,r,a,s],l,u,J,c)}(e,t,n,r,i,a,o,s,l,u,c);return W(h.x,h.y,l,u)}function re(e){if(e.length<2)return 0;for(var t=0,n=0;n<e.length-1;n++){var r=e[n],i=e[n+1];t+=W(r[0],r[1],i[0],i[1])}return t}function ie(e,t,n,r){var i=1-r;return i*i*e+2*r*i*t+r*r*n}function ae(e,t,n){var r=e+n-2*t;if((0,M.Z)(r,0))return[.5];var i=(e-t)/r;return i<=1&&i>=0?[i]:[]}function oe(e,t,n,r,i,a){var o=ae(e,n,i)[0],s=ae(t,r,a)[0],l=[e,i],u=[t,a];return void 0!==o&&l.push(ie(e,n,i,o)),void 0!==s&&u.push(ie(t,r,a,s)),H(l,u)}function se(e,t,n,r,i,a,o,s){var l=function(e,t,n,r,i,a,o,s){return j([e,n,i],[t,r,a],o,s,ie)}(e,t,n,r,i,a,o,s);return W(l.x,l.y,o,s)}var le=n(24395),ue=n(76895),ce=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self&&self,{exports:{}});ce.exports=function(){function e(e,n,i,a,o){t(e,n,i||0,a||e.length-1,o||r)}function t(e,r,i,a,o){for(;a>i;){if(a-i>600){var s=a-i+1,l=r-i+1,u=Math.log(s),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);t(e,r,Math.max(i,Math.floor(r-l*c/s+h)),Math.min(a,Math.floor(r+(s-l)*c/s+h)),o)}var d=e[r],f=i,p=a;for(n(e,i,r),o(e[a],d)>0&&n(e,i,a);f<p;){for(n(e,f,p),f++,p--;o(e[f],d)<0;)f++;for(;o(e[p],d)>0;)p--}0===o(e[i],d)?n(e,i,p):n(e,++p,a),p<=r&&(i=p+1),r<=p&&(a=p-1)}}function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t){return e<t?-1:e>t?1:0}var i=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function o(e,t){s(e,0,e.children.length,t,e)}function s(e,t,n,r,i){i||(i=m(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var a=t;a<n;a++){var o=e.children[a];l(i,e.leaf?r(o):o)}return i}function l(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function u(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function p(e,t){var n=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,i-n)*Math.max(0,a-r)}function v(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(t,n,r,i,a){for(var o=[n,r];o.length;)if(!((r=o.pop())-(n=o.pop())<=i)){var s=n+Math.ceil((r-n)/i/2)*i;e(t,s,n,r,a),o.push(n,s,s,r)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(e){var t=this.data,n=[];if(!g(e,t))return n;for(var r=this.toBBox,i=[];t;){for(var a=0;a<t.children.length;a++){var o=t.children[a],s=t.leaf?r(o):o;g(e,s)&&(t.leaf?n.push(o):v(e,s)?this._all(o,n):i.push(o))}t=i.pop()}return n},i.prototype.collides=function(e){var t=this.data;if(!g(e,t))return!1;for(var n=[];t;){for(var r=0;r<t.children.length;r++){var i=t.children[r],a=t.leaf?this.toBBox(i):i;if(g(e,a)){if(t.leaf||v(e,a))return!0;n.push(i)}}t=n.pop()}return!1},i.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},i.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},i.prototype.clear=function(){return this.data=m([]),this},i.prototype.remove=function(e,t){if(!e)return this;for(var n,r,i,o=this.data,s=this.toBBox(e),l=[],u=[];o||l.length;){if(o||(o=l.pop(),r=l[l.length-1],n=u.pop(),i=!0),o.leaf){var c=a(e,o.children,t);if(-1!==c)return o.children.splice(c,1),l.push(o),this._condense(l),this}i||o.leaf||!v(o,s)?r?(n++,o=r.children[n],i=!1):o=null:(l.push(o),u.push(n),n=0,r=o,o=o.children[0])}return this},i.prototype.toBBox=function(e){return e},i.prototype.compareMinX=function(e,t){return e.minX-t.minX},i.prototype.compareMinY=function(e,t){return e.minY-t.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(e){return this.data=e,this},i.prototype._all=function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},i.prototype._build=function(e,t,n,r){var i,a=n-t+1,s=this._maxEntries;if(a<=s)return o(i=m(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,r-1))),(i=m([])).leaf=!1,i.height=r;var l=Math.ceil(a/s),u=l*Math.ceil(Math.sqrt(s));y(e,t,n,u,this.compareMinX);for(var c=t;c<=n;c+=u){var h=Math.min(c+u-1,n);y(e,c,h,l,this.compareMinY);for(var d=c;d<=h;d+=l){var f=Math.min(d+l-1,h);i.children.push(this._build(e,d,f,r-1))}}return o(i,this.toBBox),i},i.prototype._chooseSubtree=function(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){for(var i=1/0,a=1/0,o=void 0,s=0;s<t.children.length;s++){var l=t.children[s],u=h(l),c=f(e,l)-u;c<a?(a=c,i=u<i?u:i,o=l):c===a&&u<i&&(i=u,o=l)}t=o||t.children[0]}return t},i.prototype._insert=function(e,t,n){var r=n?e:this.toBBox(e),i=[],a=this._chooseSubtree(r,this.data,t,i);for(a.children.push(e),l(a,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)},i.prototype._split=function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var a=this._chooseSplitIndex(n,i,r),s=m(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,o(n,this.toBBox),o(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(n,s)},i.prototype._splitRoot=function(e,t){this.data=m([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(e,t,n){for(var r,i=1/0,a=1/0,o=t;o<=n-t;o++){var l=s(e,0,o,this.toBBox),u=s(e,o,n,this.toBBox),c=p(l,u),d=h(l)+h(u);c<i?(i=c,r=o,a=d<a?d:a):c===i&&d<a&&(a=d,r=o)}return r||n-t},i.prototype._chooseSplitAxis=function(e,t,n){var r=e.leaf?this.compareMinX:u,i=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},i.prototype._allDistMargin=function(e,t,n,r){e.children.sort(r);for(var i=this.toBBox,a=s(e,0,t,i),o=s(e,n-t,n,i),u=d(a)+d(o),c=t;c<n-t;c++){var h=e.children[c];l(a,e.leaf?i(h):h),u+=d(a)}for(var f=n-t-1;f>=t;f--){var p=e.children[f];l(o,e.leaf?i(p):p),u+=d(o)}return u},i.prototype._adjustParentBBoxes=function(e,t,n){for(var r=n;r>=0;r--)l(t[r],e)},i.prototype._condense=function(e){for(var t=e.length-1,n=void 0;t>=0;t--)0===e[t].children.length?t>0?(n=e[t-1].children).splice(n.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},i}();var he=function(e){return e.GROUP="g",e.FRAGMENT="fragment",e.CIRCLE="circle",e.ELLIPSE="ellipse",e.IMAGE="image",e.RECT="rect",e.LINE="line",e.POLYLINE="polyline",e.POLYGON="polygon",e.TEXT="text",e.PATH="path",e.HTML="html",e.MESH="mesh",e}({}),de=function(e){return e[e.ZERO=0]="ZERO",e[e.NEGATIVE_ONE=1]="NEGATIVE_ONE",e}({}),fe=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.plugins=[]}),[{key:"addRenderingPlugin",value:function(e){this.plugins.push(e),this.context.renderingPlugins.push(e)}},{key:"removeAllRenderingPlugins",value:function(){var e=this;this.plugins.forEach((function(t){var n=e.context.renderingPlugins.indexOf(t);n>=0&&e.context.renderingPlugins.splice(n,1)}))}}])}(),pe=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.clipSpaceNearZ=de.NEGATIVE_ONE,this.plugins=[],this.config=(0,u.Z)({enableDirtyCheck:!0,enableCulling:!1,enableAutoRendering:!0,enableDirtyRectangleRendering:!0,enableDirtyRectangleRenderingDebug:!1,enableSizeAttenuation:!0,enableRenderingOptimization:!1},t)}),[{key:"registerPlugin",value:function(e){-1===this.plugins.findIndex((function(t){return t===e}))&&this.plugins.push(e)}},{key:"unregisterPlugin",value:function(e){var t=this.plugins.findIndex((function(t){return t===e}));t>-1&&this.plugins.splice(t,1)}},{key:"getPlugins",value:function(){return this.plugins}},{key:"getPlugin",value:function(e){return this.plugins.find((function(t){return t.name===e}))}},{key:"getConfig",value:function(){return this.config}},{key:"setConfig",value:function(e){Object.assign(this.config,e)}}])}(),ve=f.add,ge=f.copy,me=f.max,ye=f.min,Ee=f.scale,_e=f.sub,Te=function(){function e(){(0,o.Z)(this,e),this.center=[0,0,0],this.halfExtents=[0,0,0],this.min=[0,0,0],this.max=[0,0,0]}return(0,a.Z)(e,[{key:"update",value:function(e,t){ge(this.center,e),ge(this.halfExtents,t),_e(this.min,this.center,this.halfExtents),ve(this.max,this.center,this.halfExtents)}},{key:"setMinMax",value:function(e,t){ve(this.center,t,e),Ee(this.center,this.center,.5),_e(this.halfExtents,t,e),Ee(this.halfExtents,this.halfExtents,.5),ge(this.min,e),ge(this.max,t)}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"add",value:function(t){if(!e.isEmpty(t))if(e.isEmpty(this))this.setMinMax(t.getMin(),t.getMax());else{var n=this.center,r=n[0],i=n[1],a=n[2],o=this.halfExtents,s=o[0],l=o[1],u=o[2],c=r-s,h=r+s,d=i-l,f=i+l,p=a-u,v=a+u,g=t.center,m=g[0],y=g[1],E=g[2],_=t.halfExtents,T=_[0],R=_[1],S=_[2],A=m-T,x=m+T,C=y-R,M=y+R,N=E-S,k=E+S;A<c&&(c=A),x>h&&(h=x),C<d&&(d=C),M>f&&(f=M),N<p&&(p=N),k>v&&(v=k),n[0]=.5*(c+h),n[1]=.5*(d+f),n[2]=.5*(p+v),o[0]=.5*(h-c),o[1]=.5*(f-d),o[2]=.5*(v-p),this.min[0]=c,this.min[1]=d,this.min[2]=p,this.max[0]=h,this.max[1]=f,this.max[2]=v}}},{key:"setFromTransformedAABB",value:function(e,t){var n=this.center,r=this.halfExtents,i=e.center,a=e.halfExtents,o=t[0],s=t[4],l=t[8],u=t[1],c=t[5],h=t[9],d=t[2],f=t[6],p=t[10],v=Math.abs(o),g=Math.abs(s),m=Math.abs(l),y=Math.abs(u),E=Math.abs(c),_=Math.abs(h),T=Math.abs(d),R=Math.abs(f),S=Math.abs(p);n[0]=t[12]+o*i[0]+s*i[1]+l*i[2],n[1]=t[13]+u*i[0]+c*i[1]+h*i[2],n[2]=t[14]+d*i[0]+f*i[1]+p*i[2],r[0]=v*a[0]+g*a[1]+m*a[2],r[1]=y*a[0]+E*a[1]+_*a[2],r[2]=T*a[0]+R*a[1]+S*a[2],_e(this.min,n,r),ve(this.max,n,r)}},{key:"intersects",value:function(e){var t=this.getMax(),n=this.getMin(),r=e.getMax(),i=e.getMin();return n[0]<=r[0]&&t[0]>=i[0]&&n[1]<=r[1]&&t[1]>=i[1]&&n[2]<=r[2]&&t[2]>=i[2]}},{key:"intersection",value:function(t){if(!this.intersects(t))return null;var n=new e,r=me([0,0,0],this.getMin(),t.getMin()),i=ye([0,0,0],this.getMax(),t.getMax());return n.setMinMax(r,i),n}},{key:"getNegativeFarPoint",value:function(e){return 273===e.pnVertexFlag?ge([0,0,0],this.min):272===e.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:257===e.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:256===e.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:17===e.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:16===e.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:1===e.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:[this.max[0],this.max[1],this.max[2]]}},{key:"getPositiveFarPoint",value:function(e){return 273===e.pnVertexFlag?ge([0,0,0],this.max):272===e.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:257===e.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:256===e.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:17===e.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:16===e.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:1===e.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:[this.min[0],this.min[1],this.min[2]]}}],[{key:"isEmpty",value:function(e){return!e||0===e.halfExtents[0]&&0===e.halfExtents[1]&&0===e.halfExtents[2]}}])}(),Re=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.distance=t||0,this.normal=n||f.fromValues(0,1,0),this.updatePNVertexFlag()}),[{key:"updatePNVertexFlag",value:function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)}},{key:"distanceToPoint",value:function(e){return f.dot(e,this.normal)-this.distance}},{key:"normalize",value:function(){var e=1/f.len(this.normal);f.scale(this.normal,this.normal,e),this.distance*=e}},{key:"intersectsLine",value:function(e,t,n){var r=this.distanceToPoint(e),i=r/(r-this.distanceToPoint(t)),a=i>=0&&i<=1;return a&&n&&f.lerp(n,e,t,i),a}}])}(),Se=function(){return(0,a.Z)((function e(t){if((0,o.Z)(this,e),this.planes=[],t)this.planes=t;else for(var n=0;n<6;n++)this.planes.push(new Re)}),[{key:"extractFromVPMatrix",value:function(e){var t=(0,h.Z)(e,16),n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],p=t[10],v=t[11],g=t[12],m=t[13],y=t[14],E=t[15];f.set(this.planes[0].normal,a-n,u-o,v-c),this.planes[0].distance=E-g,f.set(this.planes[1].normal,a+n,u+o,v+c),this.planes[1].distance=E+g,f.set(this.planes[2].normal,a+r,u+s,v+d),this.planes[2].distance=E+m,f.set(this.planes[3].normal,a-r,u-s,v-d),this.planes[3].distance=E-m,f.set(this.planes[4].normal,a-i,u-l,v-p),this.planes[4].distance=E-y,f.set(this.planes[5].normal,a+i,u+l,v+p),this.planes[5].distance=E+y,this.planes.forEach((function(e){e.normalize(),e.updatePNVertexFlag()}))}}])}(),Ae=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,o.Z)(this,e),this.x=0,this.y=0,this.x=t,this.y=n}return(0,a.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"copyFrom",value:function(e){this.x=e.x,this.y=e.y}}])}(),xe=function(){function e(t,n,r,i){(0,o.Z)(this,e),this.x=t,this.y=n,this.width=r,this.height=i,this.left=t,this.right=t+r,this.top=n,this.bottom=n+i}return(0,a.Z)(e,[{key:"toJSON",value:function(){}}],[{key:"fromRect",value:function(t){return new e(t.x,t.y,t.width,t.height)}},{key:"applyTransform",value:function(t,n){var r=p.fromValues(t.x,t.y,0,1),i=p.fromValues(t.x+t.width,t.y,0,1),a=p.fromValues(t.x,t.y+t.height,0,1),o=p.fromValues(t.x+t.width,t.y+t.height,0,1),s=p.create(),l=p.create(),u=p.create(),c=p.create();p.transformMat4(s,r,n),p.transformMat4(l,i,n),p.transformMat4(u,a,n),p.transformMat4(c,o,n);var h=Math.min(s[0],l[0],u[0],c[0]),d=Math.min(s[1],l[1],u[1],c[1]),f=Math.max(s[0],l[0],u[0],c[0]),v=Math.max(s[1],l[1],u[1],c[1]);return e.fromRect({x:h,y:d,width:f-h,height:v-d})}}])}(),Ce="Method not implemented.";function Me(e){return void 0===e?0:e>360||e<-360?e%360:e}var Ne=f.create();function ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Array.isArray(e)&&3===e.length?r?f.clone(e):f.copy(Ne,e):(0,E.Z)(e)?r?f.fromValues(e,t,n):f.set(Ne,e,t,n):r?f.fromValues(e[0],e[1]||t,e[2]||n):f.set(Ne,e[0],e[1]||t,e[2]||n)}var be=Math.PI/180;function Pe(e){return e*be}var Oe=180/Math.PI;function Ie(e){return e*Oe}var De=Math.PI/2;function Le(e,t){return 16===t.length?function(e,t){var n,r,i=v.getScaling(f.create(),t),a=(0,h.Z)(i,3),o=a[0],s=a[1],l=a[2],u=Math.asin(-t[2]/o);return u<De?u>-De?(n=Math.atan2(t[6]/s,t[10]/l),r=Math.atan2(t[1]/o,t[0]/o)):(r=0,n=-Math.atan2(t[4]/s,t[5]/s)):(r=0,n=Math.atan2(t[4]/s,t[5]/s)),e[0]=n,e[1]=u,e[2]=r,e}(e,t):function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=r*r,s=i*i,l=a*a,u=n*n+o+s+l,c=n*a-r*i;return c>.499995*u?(e[0]=De,e[1]=2*Math.atan2(r,n),e[2]=0):c<-.499995*u?(e[0]=-De,e[1]=2*Math.atan2(r,n),e[2]=0):(e[0]=Math.asin(2*(n*i-a*r)),e[1]=Math.atan2(2*(n*a+r*i),1-2*(s+l)),e[2]=Math.atan2(2*(n*r+i*a),1-2*(o+s))),e}(e,t)}function Be(e){var t=e[0],n=e[1],r=e[3],i=e[4],a=Math.sqrt(t*t+n*n),o=Math.sqrt(r*r+i*i);if(t*i-n*r<0&&(t<i?a=-a:o=-o),a){var s=1/a;t*=s,n*=s}if(o){var l=1/o;r*=l,i*=l}var u=Ie(Math.atan2(n,t));return[e[6],e[7],a,o,u]}var we=v.create(),Fe=v.create(),Ue=p.create(),Ge=[f.create(),f.create(),f.create()],Ze=f.create();function Ve(e,t,n,r,i){e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i}var Xe=function(e){return e[e.ORBITING=0]="ORBITING",e[e.EXPLORING=1]="EXPLORING",e[e.TRACKING=2]="TRACKING",e}({}),We=function(e){return e[e.DEFAULT=0]="DEFAULT",e[e.ROTATIONAL=1]="ROTATIONAL",e[e.TRANSLATIONAL=2]="TRANSLATIONAL",e[e.CINEMATIC=3]="CINEMATIC",e}({}),He=function(e){return e[e.ORTHOGRAPHIC=0]="ORTHOGRAPHIC",e[e.PERSPECTIVE=1]="PERSPECTIVE",e}({}),Ye="updated",ze=2e-4,Ke=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.clipSpaceNearZ=de.NEGATIVE_ONE,this.eventEmitter=new d.Z,this.matrix=v.create(),this.right=f.fromValues(1,0,0),this.up=f.fromValues(0,1,0),this.forward=f.fromValues(0,0,1),this.position=f.fromValues(0,0,1),this.focalPoint=f.fromValues(0,0,0),this.distanceVector=f.fromValues(0,0,-1),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.zoom=1,this.rotateWorld=!1,this.fov=30,this.near=.1,this.far=1e3,this.aspect=1,this.projectionMatrix=v.create(),this.projectionMatrixInverse=v.create(),this.jitteredProjectionMatrix=void 0,this.enableUpdate=!0,this.type=Xe.EXPLORING,this.trackingMode=We.DEFAULT,this.projectionMode=He.PERSPECTIVE,this.frustum=new Se,this.orthoMatrix=v.create()}),[{key:"isOrtho",value:function(){return this.projectionMode===He.ORTHOGRAPHIC}},{key:"getProjectionMode",value:function(){return this.projectionMode}},{key:"getPerspective",value:function(){return this.jitteredProjectionMatrix||this.projectionMatrix}},{key:"getPerspectiveInverse",value:function(){return this.projectionMatrixInverse}},{key:"getFrustum",value:function(){return this.frustum}},{key:"getPosition",value:function(){return this.position}},{key:"getFocalPoint",value:function(){return this.focalPoint}},{key:"getDollyingStep",value:function(){return this.dollyingStep}},{key:"getNear",value:function(){return this.near}},{key:"getFar",value:function(){return this.far}},{key:"getZoom",value:function(){return this.zoom}},{key:"getOrthoMatrix",value:function(){return this.orthoMatrix}},{key:"getView",value:function(){return this.view}},{key:"setEnableUpdate",value:function(e){this.enableUpdate=e}},{key:"setType",value:function(e,t){return this.type=e,this.type===Xe.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===Xe.TRACKING&&void 0!==t&&this.setTrackingMode(t),this}},{key:"setProjectionMode",value:function(e){return this.projectionMode=e,this}},{key:"setTrackingMode",value:function(e){if(this.type!==Xe.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=e,this}},{key:"setWorldRotation",value:function(e){return this.rotateWorld=e,this._getAngles(),this}},{key:"getViewTransform",value:function(){return v.invert(v.create(),this.matrix)}},{key:"getWorldTransform",value:function(){return this.matrix}},{key:"jitterProjectionMatrix",value:function(e,t){var n=v.fromTranslation(v.create(),[e,t,0]);this.jitteredProjectionMatrix=v.multiply(v.create(),n,this.projectionMatrix)}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0}},{key:"setMatrix",value:function(e){return this.matrix=e,this._update(),this}},{key:"setProjectionMatrix",value:function(e){this.projectionMatrix=e}},{key:"setFov",value:function(e){return this.setPerspective(this.near,this.far,e,this.aspect),this}},{key:"setAspect",value:function(e){return this.setPerspective(this.near,this.far,this.fov,e),this}},{key:"setNear",value:function(e){return this.projectionMode===He.PERSPECTIVE?this.setPerspective(e,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,e,this.far),this}},{key:"setFar",value:function(e){return this.projectionMode===He.PERSPECTIVE?this.setPerspective(this.near,e,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,e),this}},{key:"setViewOffset",value:function(e,t,n,r,i,a){return this.aspect=e/t,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.projectionMode===He.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"clearViewOffset",value:function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===He.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"setZoom",value:function(e){return this.zoom=e,this.projectionMode===He.ORTHOGRAPHIC?this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far):this.projectionMode===He.PERSPECTIVE&&this.setPerspective(this.near,this.far,this.fov,this.aspect),this}},{key:"setZoomByViewportPoint",value:function(e,t){var n=this.canvas.viewport2Canvas({x:t[0],y:t[1]}),r=n.x,i=n.y,a=this.roll;this.rotate(0,0,-a),this.setPosition(r,i),this.setFocalPoint(r,i),this.setZoom(e),this.rotate(0,0,a);var o=this.canvas.viewport2Canvas({x:t[0],y:t[1]}),s=o.x,l=o.y,u=f.fromValues(s-r,l-i,0),c=f.dot(u,this.right)/f.length(this.right),d=f.dot(u,this.up)/f.length(this.up),p=this.getPosition(),v=(0,h.Z)(p,2),g=v[0],m=v[1],y=this.getFocalPoint(),E=(0,h.Z)(y,2),_=E[0],T=E[1];return this.setPosition(g-c,m-d),this.setFocalPoint(_-c,T-d),this}},{key:"setPerspective",value:function(e,t,n,r){var i;this.projectionMode=He.PERSPECTIVE,this.fov=n,this.near=e,this.far=t,this.aspect=r;var a=this.near*Math.tan(Pe(.5*this.fov))/this.zoom,o=2*a,s=this.aspect*o,l=-.5*s;if(null!==(i=this.view)&&void 0!==i&&i.enabled){var u=this.view.fullWidth,c=this.view.fullHeight;l+=this.view.offsetX*s/u,a-=this.view.offsetY*o/c,s*=this.view.width/u,o*=this.view.height/c}return function(e,t,n,r,i,a,o){var s,l,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=2*a,h=n-t,d=r-i,f=c/h,p=c/d,v=(n+t)/h,g=(r+i)/d,m=o-a,y=o*a;u?(s=-o/m,l=-y/m):(s=-(o+a)/m,l=-2*y/m),e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=v,e[9]=g,e[10]=s,e[11]=-1,e[12]=0,e[13]=0,e[14]=l,e[15]=0}(this.projectionMatrix,l,l+s,a-o,a,e,this.far,this.clipSpaceNearZ===de.ZERO),v.invert(this.projectionMatrixInverse,this.projectionMatrix),this.triggerUpdate(),this}},{key:"setOrthographic",value:function(e,t,n,r,i,a){var o;this.projectionMode=He.ORTHOGRAPHIC,this.rright=t,this.left=e,this.top=n,this.bottom=r,this.near=i,this.far=a;var s=(this.rright-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),u=(this.rright+this.left)/2,c=(this.top+this.bottom)/2,h=u-s,d=u+s,f=c+l,p=c-l;if(null!==(o=this.view)&&void 0!==o&&o.enabled){var g=(this.rright-this.left)/this.view.fullWidth/this.zoom,m=(this.top-this.bottom)/this.view.fullHeight/this.zoom;d=(h+=g*this.view.offsetX)+g*this.view.width,p=(f-=m*this.view.offsetY)-m*this.view.height}return this.clipSpaceNearZ===de.NEGATIVE_ONE?v.ortho(this.projectionMatrix,h,d,f,p,i,a):v.orthoZO(this.projectionMatrix,h,d,f,p,i,a),v.invert(this.projectionMatrixInverse,this.projectionMatrix),this._getOrthoMatrix(),this.triggerUpdate(),this}},{key:"setPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.position[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.position[2],r=ke(e,t,n);return this._setPosition(r),this.setFocalPoint(this.focalPoint),this.triggerUpdate(),this}},{key:"setFocalPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.focalPoint[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.focalPoint[2],r=f.fromValues(0,1,0);if(this.focalPoint=ke(e,t,n),this.trackingMode===We.CINEMATIC){var i=f.subtract(f.create(),this.focalPoint,this.position);e=i[0],t=i[1],n=i[2];var a=f.length(i),o=Ie(Math.asin(t/a)),s=90+Ie(Math.atan2(n,e)),l=v.create();v.rotateY(l,l,Pe(s)),v.rotateX(l,l,Pe(o)),r=f.transformMat4(f.create(),[0,1,0],l)}return v.invert(this.matrix,v.lookAt(v.create(),this.position,this.focalPoint,r)),this._getAxes(),this._getDistance(),this._getAngles(),this.triggerUpdate(),this}},{key:"getDistance",value:function(){return this.distance}},{key:"getDistanceVector",value:function(){return this.distanceVector}},{key:"setDistance",value:function(e){if(this.distance===e||e<0)return this;this.distance=e,this.distance<ze&&(this.distance=ze),this.dollyingStep=this.distance/100;var t=f.create();e=this.distance;var n=this.forward,r=this.focalPoint;return t[0]=e*n[0]+r[0],t[1]=e*n[1]+r[1],t[2]=e*n[2]+r[2],this._setPosition(t),this.triggerUpdate(),this}},{key:"setMaxDistance",value:function(e){return this.maxDistance=e,this}},{key:"setMinDistance",value:function(e){return this.minDistance=e,this}},{key:"setAzimuth",value:function(e){return this.azimuth=Me(e),this.computeMatrix(),this._getAxes(),this.type===Xe.ORBITING||this.type===Xe.EXPLORING?this._getPosition():this.type===Xe.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(e){return this.elevation=Me(e),this.computeMatrix(),this._getAxes(),this.type===Xe.ORBITING||this.type===Xe.EXPLORING?this._getPosition():this.type===Xe.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getElevation",value:function(){return this.elevation}},{key:"setRoll",value:function(e){return this.roll=Me(e),this.computeMatrix(),this._getAxes(),this.type===Xe.ORBITING||this.type===Xe.EXPLORING?this._getPosition():this.type===Xe.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getRoll",value:function(){return this.roll}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles(),this._getOrthoMatrix(),this.triggerUpdate()}},{key:"computeMatrix",value:function(){var e=m.setAxisAngle(m.create(),[0,0,1],Pe(this.roll));v.identity(this.matrix);var t=m.setAxisAngle(m.create(),[1,0,0],Pe((this.rotateWorld&&this.type!==Xe.TRACKING||this.type===Xe.TRACKING?1:-1)*this.elevation)),n=m.setAxisAngle(m.create(),[0,1,0],Pe((this.rotateWorld&&this.type!==Xe.TRACKING||this.type===Xe.TRACKING?1:-1)*this.azimuth)),r=m.multiply(m.create(),n,t);r=m.multiply(m.create(),r,e);var i=v.fromQuat(v.create(),r);this.type===Xe.ORBITING||this.type===Xe.EXPLORING?(v.translate(this.matrix,this.matrix,this.focalPoint),v.multiply(this.matrix,this.matrix,i),v.translate(this.matrix,this.matrix,[0,0,this.distance])):this.type===Xe.TRACKING&&(v.translate(this.matrix,this.matrix,this.position),v.multiply(this.matrix,this.matrix,i))}},{key:"_setPosition",value:function(e,t,n){this.position=ke(e,t,n);var r=this.matrix;r[12]=this.position[0],r[13]=this.position[1],r[14]=this.position[2],r[15]=1,this._getOrthoMatrix()}},{key:"_getAxes",value:function(){f.copy(this.right,ke(p.transformMat4(p.create(),[1,0,0,0],this.matrix))),f.copy(this.up,ke(p.transformMat4(p.create(),[0,1,0,0],this.matrix))),f.copy(this.forward,ke(p.transformMat4(p.create(),[0,0,1,0],this.matrix))),f.normalize(this.right,this.right),f.normalize(this.up,this.up),f.normalize(this.forward,this.forward)}},{key:"_getAngles",value:function(){var e=this.distanceVector[0],t=this.distanceVector[1],n=this.distanceVector[2],r=f.length(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===Xe.TRACKING||this.rotateWorld?(this.elevation=Ie(Math.asin(t/r)),this.azimuth=Ie(Math.atan2(-e,-n))):(this.elevation=-Ie(Math.asin(t/r)),this.azimuth=-Ie(Math.atan2(-e,-n)))}},{key:"_getPosition",value:function(){f.copy(this.position,ke(p.transformMat4(p.create(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){f.transformMat3(this.distanceVector,[0,0,-this.distance],g.fromMat4(g.create(),this.matrix)),f.add(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=f.subtract(f.create(),this.focalPoint,this.position),this.distance=f.length(this.distanceVector),this.dollyingStep=this.distance/100}},{key:"_getOrthoMatrix",value:function(){if(this.projectionMode===He.ORTHOGRAPHIC){var e=this.position,t=m.setAxisAngle(m.create(),[0,0,1],-this.roll*Math.PI/180);v.fromRotationTranslationScaleOrigin(this.orthoMatrix,t,f.fromValues((this.rright-this.left)/2-e[0],(this.top-this.bottom)/2-e[1],0),f.fromValues(this.zoom,this.zoom,1),e)}}},{key:"triggerUpdate",value:function(){if(this.enableUpdate){var e=this.getViewTransform(),t=v.multiply(v.create(),this.getPerspective(),e);this.getFrustum().extractFromVPMatrix(t),this.eventEmitter.emit(Ye)}}},{key:"rotate",value:function(e,t,n){throw new Error(Ce)}},{key:"pan",value:function(e,t){throw new Error(Ce)}},{key:"dolly",value:function(e){throw new Error(Ce)}},{key:"createLandmark",value:function(e,t){throw new Error(Ce)}},{key:"gotoLandmark",value:function(e,t){throw new Error(Ce)}},{key:"cancelLandmarkAnimation",value:function(){throw new Error(Ce)}}])}(),je=function(e){return e[e.Standard=0]="Standard",e}({}),qe=function(e){return e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED",e[e.Z_INDEX_CHANGED=2]="Z_INDEX_CHANGED",e}({}),Qe=f.create(),$e=v.create(),Je=m.create();function et(e){if(e.localDirtyFlag){if(0!==e.localSkew[0]||0!==e.localSkew[1]){v.fromRotationTranslationScaleOrigin(e.localTransform,e.localRotation,e.localPosition,f.fromValues(1,1,1),e.origin),0===e.localSkew[0]&&0===e.localSkew[1]||(v.identity($e),$e[4]=Math.tan(e.localSkew[0]),$e[1]=Math.tan(e.localSkew[1]),v.multiply(e.localTransform,e.localTransform,$e));var t=v.fromRotationTranslationScaleOrigin($e,m.set(Je,0,0,0,1),f.set(Qe,1,1,1),e.localScale,e.origin);v.multiply(e.localTransform,e.localTransform,t)}else{var n=e.localTransform,r=e.localPosition,i=e.localRotation,a=e.localScale,o=e.origin,s=0!==r[0]||0!==r[1]||0!==r[2],l=1!==i[3]||0!==i[0]||0!==i[1]||0!==i[2],u=1!==a[0]||1!==a[1]||1!==a[2],c=0!==o[0]||0!==o[1]||0!==o[2];l||u||c?v.fromRotationTranslationScaleOrigin(n,i,r,a,o):s?v.fromTranslation(n,r):v.identity(n)}e.localDirtyFlag=!1}}var tt={absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new xe(0,0,0,0)},nt=function(e){return e.COORDINATE="<coordinate>",e.COLOR="<color>",e.PAINT="<paint>",e.NUMBER="<number>",e.ANGLE="<angle>",e.OPACITY_VALUE="<opacity-value>",e.SHADOW_BLUR="<shadow-blur>",e.LENGTH="<length>",e.PERCENTAGE="<percentage>",e.LENGTH_PERCENTAGE="<length> | <percentage>",e.LENGTH_PERCENTAGE_12="[<length> | <percentage>]{1,2}",e.LENGTH_PERCENTAGE_14="[<length> | <percentage>]{1,4}",e.LIST_OF_POINTS="<list-of-points>",e.PATH="<path>",e.FILTER="<filter>",e.Z_INDEX="<z-index>",e.OFFSET_DISTANCE="<offset-distance>",e.DEFINED_PATH="<defined-path>",e.MARKER="<marker>",e.TRANSFORM="<transform>",e.TRANSFORM_ORIGIN="<transform-origin>",e.TEXT="<text>",e.TEXT_TRANSFORM="<text-transform>",e}({});function rt(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function it(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function at(){}var ot=.7,st=1/ot,lt="\\s*([+-]?\\d+)\\s*",ut="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ct="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ht=/^#([0-9a-f]{3,8})$/,dt=new RegExp("^rgb\\(".concat(lt,",").concat(lt,",").concat(lt,"\\)$")),ft=new RegExp("^rgb\\(".concat(ct,",").concat(ct,",").concat(ct,"\\)$")),pt=new RegExp("^rgba\\(".concat(lt,",").concat(lt,",").concat(lt,",").concat(ut,"\\)$")),vt=new RegExp("^rgba\\(".concat(ct,",").concat(ct,",").concat(ct,",").concat(ut,"\\)$")),gt=new RegExp("^hsl\\(".concat(ut,",").concat(ct,",").concat(ct,"\\)$")),mt=new RegExp("^hsla\\(".concat(ut,",").concat(ct,",").concat(ct,",").concat(ut,"\\)$")),yt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Et(){return this.rgb().formatHex()}function _t(){return this.rgb().formatRgb()}function Tt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=ht.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Rt(t):3===n?new xt(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?St(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?St(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=dt.exec(e))?new xt(t[1],t[2],t[3],1):(t=ft.exec(e))?new xt(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=pt.exec(e))?St(t[1],t[2],t[3],t[4]):(t=vt.exec(e))?St(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=gt.exec(e))?Pt(t[1],t[2]/100,t[3]/100,1):(t=mt.exec(e))?Pt(t[1],t[2]/100,t[3]/100,t[4]):yt.hasOwnProperty(e)?Rt(yt[e]):"transparent"===e?new xt(NaN,NaN,NaN,0):null}function Rt(e){return new xt(e>>16&255,e>>8&255,255&e,1)}function St(e,t,n,r){return r<=0&&(e=t=n=NaN),new xt(e,t,n,r)}function At(e){return e instanceof at||(e=Tt(e)),e?new xt((e=e.rgb()).r,e.g,e.b,e.opacity):new xt}function xt(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Ct(){return"#".concat(bt(this.r)).concat(bt(this.g)).concat(bt(this.b))}function Mt(){var e=Nt(this.opacity);return"".concat(1===e?"rgb(":"rgba(").concat(kt(this.r),", ").concat(kt(this.g),", ").concat(kt(this.b)).concat(1===e?")":", ".concat(e,")"))}function Nt(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function kt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function bt(e){return((e=kt(e))<16?"0":"")+e.toString(16)}function Pt(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new It(e,t,n,r)}function Ot(e){if(e instanceof It)return new It(e.h,e.s,e.l,e.opacity);if(e instanceof at||(e=Tt(e)),!e)return new It;if(e instanceof It)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new It(o,s,l,e.opacity)}function It(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Dt(e){return(e=(e||0)%360)<0?e+360:e}function Lt(e){return Math.max(0,Math.min(1,e||0))}function Bt(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function wt(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];var o=t?t.apply(this,i):i[0],s=n.cache;if(s.has(o))return s.get(o);var l=e.apply(this,i);return n.cache=s.set(o,l)||s,l};return n.cache=new(wt.Cache||Map),wt.cacheList.push(n.cache),n}rt(at,Tt,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Et,formatHex:Et,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Ot(this).formatHsl()},formatRgb:_t,toString:_t}),rt(xt,(function(e,t,n,r){return 1===arguments.length?At(e):new xt(e,t,n,null==r?1:r)}),it(at,{brighter:function(e){return e=null==e?st:Math.pow(st,e),new xt(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?ot:Math.pow(ot,e),new xt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},clamp:function(){return new xt(kt(this.r),kt(this.g),kt(this.b),Nt(this.opacity))},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ct,formatHex:Ct,formatHex8:function(){return"#".concat(bt(this.r)).concat(bt(this.g)).concat(bt(this.b)).concat(bt(255*(isNaN(this.opacity)?1:this.opacity)))},formatRgb:Mt,toString:Mt})),rt(It,(function(e,t,n,r){return 1===arguments.length?Ot(e):new It(e,t,n,null==r?1:r)}),it(at,{brighter:function(e){return e=null==e?st:Math.pow(st,e),new It(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?ot:Math.pow(ot,e),new It(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new xt(Bt(e>=240?e-240:e+120,i,r),Bt(e,i,r),Bt(e<120?e+240:e-120,i,r),this.opacity)},clamp:function(){return new It(Dt(this.h),Lt(this.s),Lt(this.l),Nt(this.opacity))},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=Nt(this.opacity);return"".concat(1===e?"hsl(":"hsla(").concat(Dt(this.h),", ").concat(100*Lt(this.s),"%, ").concat(100*Lt(this.l),"%").concat(1===e?")":", ".concat(e,")"))}})),wt.Cache=Map,wt.cacheList=[],wt.clearCache=function(){wt.cacheList.forEach((function(e){return e.clear()}))};var Ft=function(e){return e[e.kUnknown=0]="kUnknown",e[e.kNumber=1]="kNumber",e[e.kPercentage=2]="kPercentage",e[e.kEms=3]="kEms",e[e.kPixels=4]="kPixels",e[e.kRems=5]="kRems",e[e.kDegrees=6]="kDegrees",e[e.kRadians=7]="kRadians",e[e.kGradians=8]="kGradians",e[e.kTurns=9]="kTurns",e[e.kMilliseconds=10]="kMilliseconds",e[e.kSeconds=11]="kSeconds",e[e.kInteger=12]="kInteger",e}({}),Ut=function(e){return e[e.kUNumber=0]="kUNumber",e[e.kUPercent=1]="kUPercent",e[e.kULength=2]="kULength",e[e.kUAngle=3]="kUAngle",e[e.kUTime=4]="kUTime",e[e.kUOther=5]="kUOther",e}({}),Gt=function(e){return e[e.kYes=0]="kYes",e[e.kNo=1]="kNo",e}({}),Zt=function(e){return e[e.kYes=0]="kYes",e[e.kNo=1]="kNo",e}({}),Vt=[{name:"em",unit_type:Ft.kEms},{name:"px",unit_type:Ft.kPixels},{name:"deg",unit_type:Ft.kDegrees},{name:"rad",unit_type:Ft.kRadians},{name:"grad",unit_type:Ft.kGradians},{name:"ms",unit_type:Ft.kMilliseconds},{name:"s",unit_type:Ft.kSeconds},{name:"rem",unit_type:Ft.kRems},{name:"turn",unit_type:Ft.kTurns}],Xt=function(e){return e[e.kUnknownType=0]="kUnknownType",e[e.kUnparsedType=1]="kUnparsedType",e[e.kKeywordType=2]="kKeywordType",e[e.kUnitType=3]="kUnitType",e[e.kSumType=4]="kSumType",e[e.kProductType=5]="kProductType",e[e.kNegateType=6]="kNegateType",e[e.kInvertType=7]="kInvertType",e[e.kMinType=8]="kMinType",e[e.kMaxType=9]="kMaxType",e[e.kClampType=10]="kClampType",e[e.kTransformType=11]="kTransformType",e[e.kPositionType=12]="kPositionType",e[e.kURLImageType=13]="kURLImageType",e[e.kColorType=14]="kColorType",e[e.kUnsupportedColorType=15]="kUnsupportedColorType",e}({}),Wt=function(e){return e?"number"===e?Ft.kNumber:"percent"===e||"%"===e?Ft.kPercentage:function(e){return Vt.find((function(t){return t.name===e})).unit_type}(e):Ft.kUnknown},Ht=function(e){var t=1;switch(e){case Ft.kPixels:case Ft.kDegrees:case Ft.kSeconds:break;case Ft.kMilliseconds:t=.001;break;case Ft.kRadians:t=180/Math.PI;break;case Ft.kGradians:t=.9;break;case Ft.kTurns:t=360}return t},Yt=function(e){switch(e){case Ft.kNumber:case Ft.kInteger:return"";case Ft.kPercentage:return"%";case Ft.kEms:return"em";case Ft.kRems:return"rem";case Ft.kPixels:return"px";case Ft.kDegrees:return"deg";case Ft.kRadians:return"rad";case Ft.kGradians:return"grad";case Ft.kMilliseconds:return"ms";case Ft.kSeconds:return"s";case Ft.kTurns:return"turn"}return""},zt=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"toString",value:function(){return this.buildCSSText(Gt.kNo,Zt.kNo,"")}},{key:"isNumericValue",value:function(){return this.getType()>=Xt.kUnitType&&this.getType()<=Xt.kClampType}}],[{key:"isAngle",value:function(e){return e===Ft.kDegrees||e===Ft.kRadians||e===Ft.kGradians||e===Ft.kTurns}},{key:"isLength",value:function(e){return e>=Ft.kEms&&e<Ft.kDegrees}},{key:"isRelativeUnit",value:function(e){return e===Ft.kPercentage||e===Ft.kEms||e===Ft.kRems}},{key:"isTime",value:function(e){return e===Ft.kSeconds||e===Ft.kMilliseconds}}])}(),Kt=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).colorSpace=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getType",value:function(){return Xt.kColorType}},{key:"to",value:function(e){return this}}])}(zt),jt=function(e){return e[e.Constant=0]="Constant",e[e.LinearGradient=1]="LinearGradient",e[e.RadialGradient=2]="RadialGradient",e}({}),qt=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t)).type=e,r.value=n,r}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.type,this.value)}},{key:"buildCSSText",value:function(e,t,n){return n}},{key:"getType",value:function(){return Xt.kColorType}}])}(zt),Qt=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).value=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.value)}},{key:"getType",value:function(){return Xt.kKeywordType}},{key:"buildCSSText",value:function(e,t,n){return n+this.value}}])}(zt),$t=function(e){return function(e){switch(e){case Ut.kUNumber:return Ft.kNumber;case Ut.kULength:return Ft.kPixels;case Ut.kUPercent:return Ft.kPercentage;case Ut.kUTime:return Ft.kSeconds;case Ut.kUAngle:return Ft.kDegrees;default:return Ft.kUnknown}}(function(e){switch(e){case Ft.kNumber:case Ft.kInteger:return Ut.kUNumber;case Ft.kPercentage:return Ut.kUPercent;case Ft.kPixels:return Ut.kULength;case Ft.kMilliseconds:case Ft.kSeconds:return Ut.kUTime;case Ft.kDegrees:case Ft.kRadians:case Ft.kGradians:case Ft.kTurns:return Ut.kUAngle;default:return Ut.kUOther}}(e))},Jt=function(e){function t(e){var n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ft.kNumber;return(0,o.Z)(this,t),n=(0,s.Z)(this,t),r="string"==typeof i?Wt(i):i,n.unit=r,n.value=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.value,this.unit)}},{key:"equals",value:function(e){var t=e;return this.value===t.value&&this.unit===t.unit}},{key:"getType",value:function(){return Xt.kUnitType}},{key:"convertTo",value:function(e){if(this.unit===e)return new t(this.value,this.unit);var n=$t(this.unit);if(n!==$t(e)||n===Ft.kUnknown)return null;var r=Ht(this.unit)/Ht(e);return new t(this.value*r,e)}},{key:"buildCSSText",value:function(e,t,n){var r;switch(this.unit){case Ft.kUnknown:break;case Ft.kInteger:r=Number(this.value).toFixed(0);break;case Ft.kNumber:case Ft.kPercentage:case Ft.kEms:case Ft.kRems:case Ft.kPixels:case Ft.kDegrees:case Ft.kRadians:case Ft.kGradians:case Ft.kMilliseconds:case Ft.kSeconds:case Ft.kTurns:var i=this.value,a=Yt(this.unit);if(i<-999999||i>999999){var o=Yt(this.unit);r=!Number.isFinite(i)||Number.isNaN(i)?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(Number.isFinite(e)?"NaN":e>0?"infinity":"-infinity")+t}(i,o):i+(o||"")}else r="".concat(i).concat(a)}return n+=r}}])}(zt),en=new Jt(0,"px");new Jt(1,"px");var tn=new Jt(0,"deg"),nn=function(e){function t(e,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,o.Z)(this,t),(i=(0,s.Z)(this,t,["rgb"])).r=e,i.g=n,i.b=r,i.alpha=a,i.isNone=l,i}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.r,this.g,this.b,this.alpha)}},{key:"buildCSSText",value:function(e,t,n){return"".concat(n,"rgba(").concat(this.r,",").concat(this.g,",").concat(this.b,",").concat(this.alpha,")")}}])}(Kt),rn=new Qt("unset"),an={"":rn,unset:rn,initial:new Qt("initial"),inherit:new Qt("inherit")},on=new nn(0,0,0,0,!0),sn=new nn(0,0,0,0),ln=wt((function(e,t,n,r){return new nn(e,t,n,r)}),(function(e,t,n,r){return"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(r,")")})),un=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ft.kNumber;return new Jt(e,t)};function cn(e){var t=e.type,n=e.value;return"hex"===t?"#".concat(n):"literal"===t?n:"rgb"===t?"rgb(".concat(n.join(","),")"):"rgba(".concat(n.join(","),")")}new Jt(50,"%");var hn=function(){var e=/^(linear\-gradient)/i,t=/^(repeating\-linear\-gradient)/i,n=/^(radial\-gradient)/i,r=/^(repeating\-radial\-gradient)/i,i=/^(conic\-gradient)/i,a=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,o=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,s=/^(left|center|right|top|bottom)/i,l=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,u=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,c=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,h=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,d=/^\(/,f=/^\)/,p=/^,/,v=/^\#([0-9a-fA-F]+)/,g=/^([a-zA-Z]+)/,m=/^rgb/i,y=/^rgba/i,E=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/,_="";function T(e){throw new Error("".concat(_,": ").concat(e))}function R(){var e=O(S);return _.length>0&&T("Invalid input not EOF"),e}function S(){return A("linear-gradient",e,C)||A("repeating-linear-gradient",t,C)||A("radial-gradient",n,M)||A("repeating-radial-gradient",r,M)||A("conic-gradient",i,M)}function A(e,t,n){return x(t,(function(t){var r=n();return r&&(F(p)||T("Missing comma before color stops")),{type:e,orientation:r,colorStops:O(I)}}))}function x(e,t){var n=F(e);if(n){F(d)||T("Missing (");var r=t(n);return F(f)||T("Missing )"),r}}function C(){return w("directional",a,1)||w("angular",h,1)}function M(){var e,t,n=N();return n&&((e=[]).push(n),t=_,F(p)&&((n=N())?e.push(n):_=t)),e}function N(){var e=function(){var e=w("shape",/^(circle)/i,0);e&&(e.style=B()||k());return e}()||function(){var e=w("shape",/^(ellipse)/i,0);e&&(e.style=L()||k());return e}();if(e)e.at=b();else{var t=k();if(t){e=t;var n=b();n&&(e.at=n)}else{var r=P();r&&(e={type:"default-radial",at:r})}}return e}function k(){return w("extent-keyword",o,1)}function b(){if(w("position",/^at/,0)){var e=P();return e||T("Missing positioning value"),e}}function P(){var e={x:L(),y:L()};if(e.x||e.y)return{type:"position",value:e}}function O(e){var t=e(),n=[];if(t)for(n.push(t);F(p);)(t=e())?n.push(t):T("One extra comma");return n}function I(){var e=w("hex",v,1)||x(y,(function(){return{type:"rgba",value:O(D)}}))||x(m,(function(){return{type:"rgb",value:O(D)}}))||w("literal",g,0);return e||T("Expected color definition"),e.length=L(),e}function D(){return F(E)[1]}function L(){return w("%",u,1)||w("position-keyword",s,1)||B()}function B(){return w("px",l,1)||w("em",c,1)}function w(e,t,n){var r=F(t);if(r)return{type:e,value:r[n]}}function F(e){var t=/^[\n\r\t\s]+/.exec(_);t&&U(t[0].length);var n=e.exec(_);return n&&U(n[0].length),n}function U(e){_=_.substring(e)}return function(e){return _=e,R()}}();var dn=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,fn=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,pn=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,vn=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;var gn={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},mn=wt((function(e){var t;return t="angular"===e.type?Number(e.value):gn[e.value]||0,un(t,"deg")})),yn=wt((function(e){var t=50,n=50,r="%",i="%";if("position"===(null==e?void 0:e.type)){var a=e.value,o=a.x,s=a.y;"position-keyword"===(null==o?void 0:o.type)&&("left"===o.value?t=0:"center"===o.value?t=50:"right"===o.value?t=100:"top"===o.value?n=0:"bottom"===o.value&&(n=100)),"position-keyword"===(null==s?void 0:s.type)&&("left"===s.value?t=0:"center"===s.value?n=50:"right"===s.value?t=100:"top"===s.value?n=0:"bottom"===s.value&&(n=100)),"px"!==(null==o?void 0:o.type)&&"%"!==(null==o?void 0:o.type)&&"em"!==(null==o?void 0:o.type)||(r=null==o?void 0:o.type,t=Number(o.value)),"px"!==(null==s?void 0:s.type)&&"%"!==(null==s?void 0:s.type)&&"em"!==(null==s?void 0:s.type)||(i=null==s?void 0:s.type,n=Number(s.value))}return{cx:un(t,r),cy:un(n,i)}})),En=wt((function(e){if(e.indexOf("linear")>-1||e.indexOf("radial")>-1)return hn(e).map((function(e){var t=e.type,n=e.orientation,r=e.colorStops;!function(e){var t,n,r=e.length;e[r-1].length=null!==(t=e[r-1].length)&&void 0!==t?t:{type:"%",value:"100"},r>1&&(e[0].length=null!==(n=e[0].length)&&void 0!==n?n:{type:"%",value:"0"});for(var i=0,a=Number(e[0].length.value),o=1;o<r;o++){var s,l=null===(s=e[o].length)||void 0===s?void 0:s.value;if(!(0,T.Z)(l)&&!(0,T.Z)(a)){for(var u=1;u<o-i;u++)e[i+u].length={type:"%",value:"".concat(a+(Number(l)-a)*u/(o-i))};i=o,a=Number(l)}}}(r);var i,a=r.map((function(e){return{offset:un(Number(e.length.value),"%"),color:cn(e)}}));if("linear-gradient"===t)return new qt(jt.LinearGradient,{angle:n?mn(n):tn,steps:a});if("radial-gradient"===t&&(n||(n=[{type:"shape",value:"circle"}]),"shape"===n[0].type&&"circle"===n[0].value)){var o,s=yn(n[0].at),l=s.cx,u=s.cy;if(n[0].style){var c=n[0].style,h=c.type,d=c.value;"extent-keyword"===h?(an[i=d]||(an[i]=new Qt(i)),o=an[i]):o=un(d,h)}return new qt(jt.RadialGradient,{cx:l,cy:u,size:o,steps:a})}}));var t=e[0];if("("===e[1]||"("===e[2])if("l"===t){var n=dn.exec(e);if(n){var r,i=(null===(r=n[2].match(vn))||void 0===r?void 0:r.map((function(e){return e.split(":")})))||[];return[new qt(jt.LinearGradient,{angle:un(parseFloat(n[1]),"deg"),steps:i.map((function(e){var t=(0,h.Z)(e,2),n=t[0],r=t[1];return{offset:un(100*Number(n),"%"),color:r}}))})]}}else if("r"===t){var a=function(e){var t=fn.exec(e);if(t){var n,r=(null===(n=t[4].match(vn))||void 0===n?void 0:n.map((function(e){return e.split(":")})))||[];return{cx:un(50,"%"),cy:un(50,"%"),steps:r.map((function(e){var t=(0,h.Z)(e,2),n=t[0],r=t[1];return{offset:un(100*Number(n),"%"),color:r}}))}}return null}(e);if(a){if(!(0,R.Z)(a))return[new qt(jt.RadialGradient,a)];e=a}}else if("p"===t)return function(e){var t=pn.exec(e);if(t){var n=t[1],r=t[2];switch(n){case"a":n="repeat";break;case"x":n="repeat-x";break;case"y":n="repeat-y";break;default:n="no-repeat"}return{image:r,repetition:n}}return null}(e)}));function _n(e){return e&&!!e.image}function Tn(e){return e&&!(0,T.Z)(e.r)&&!(0,T.Z)(e.g)&&!(0,T.Z)(e.b)}var Rn=wt((function(e){if(_n(e))return(0,u.Z)({repetition:"repeat"},e);if((0,T.Z)(e)&&(e=""),"transparent"===e)return sn;if("currentColor"===e)e="black";else if("none"===e)return on;var t=En(e);if(t)return t;var n=Tt(e),r=[0,0,0,0];return null!==n&&(r[0]=n.r||0,r[1]=n.g||0,r[2]=n.b||0,r[3]=n.opacity),ln.apply(void 0,r)}));function Sn(e,t){if(Tn(e)&&Tn(t))return[[Number(e.r),Number(e.g),Number(e.b),Number(e.alpha)],[Number(t.r),Number(t.g),Number(t.b),Number(t.alpha)],function(e){var t=e.slice();if(t[3])for(var n=0;n<3;n++)t[n]=Math.round((0,S.Z)(t[n],0,255));return t[3]=(0,S.Z)(t[3],0,1),"rgba(".concat(t.join(","),")")}]}function An(e,t){if((0,T.Z)(t))return un(0,"px");if(t="".concat(t).trim().toLowerCase(),isFinite(Number(t))){if("px".search(e)>=0)return un(Number(t),"px");if("deg".search(e)>=0)return un(Number(t),"deg")}var n=[];t=t.replace(e,(function(e){return n.push(e),"U".concat(e)}));var r="U(".concat(e.source,")");return n.map((function(e){return un(Number(t.replace(new RegExp("U".concat(e),"g"),"").replace(new RegExp(r,"g"),"*0")),e)}))[0]}var xn=function(e){return An(new RegExp("px","g"),e)},Cn=wt(xn);wt((function(e){return An(new RegExp("%","g"),e)}));var Mn=function(e){return(0,E.Z)(e)||isFinite(Number(e))?un(Number(e)||0,"px"):An(new RegExp("px|%|em|rem","g"),e)},Nn=wt(Mn),kn=function(e){return An(new RegExp("deg|rad|grad|turn","g"),e)},bn=wt(kn);function Pn(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a="",o=e.value||0,s=t.value||0,l=$t(e.unit),u=e.convertTo(l),c=t.convertTo(l);return u&&c?(o=u.value,s=c.value,a=Yt(e.unit)):(Jt.isLength(e.unit)||Jt.isLength(t.unit))&&(o=Dn(e,i,n),s=Dn(t,i,n),a="px"),[o,s,function(e){return r&&(e=Math.max(e,0)),e+a}]}function On(e){var t=0;return e.unit===Ft.kDegrees?t=e.value:e.unit===Ft.kRadians?t=Ie(Number(e.value)):e.unit===Ft.kTurns?t=360*Number(e.value):e.value&&(t=e.value),t}function In(e,t){var n;return Array.isArray(e)?n=e.map((function(e){return Number(e)})):(0,R.Z)(e)?n=e.split(" ").map((function(e){return Number(e)})):(0,E.Z)(e)&&(n=[e]),2===t?1===n.length?[n[0],n[0]]:[n[0],n[1]]:4===t?1===n.length?[n[0],n[0],n[0],n[0]]:2===n.length?[n[0],n[1],n[0],n[1]]:3===n.length?[n[0],n[1],n[2],n[1]]:[n[0],n[1],n[2],n[3]]:"even"===t&&n.length%2==1?[].concat((0,c.Z)(n),(0,c.Z)(n)):n}function Dn(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.unit===Ft.kPixels)return Number(e.value);if(e.unit===Ft.kPercentage&&n){var i=n.nodeName===he.GROUP?n.getLocalBounds():n.getGeometryBounds();return(r?i.min[t]:0)+e.value/100*i.halfExtents[t]*2}return 0}var Ln=function(e){return An(/deg|rad|grad|turn|px|%/g,e)},Bn=["blur","brightness","drop-shadow","contrast","grayscale","sepia","saturate","hue-rotate","invert"];function wn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("none"===(e=e.toLowerCase().trim()))return[];for(var t,n=/\s*([\w-]+)\(([^)]*)\)/g,r=[],i=0;t=n.exec(e);){if(t.index!==i)return[];if(i=t.index+t[0].length,Bn.indexOf(t[1])>-1&&r.push({name:t[1],params:t[2].split(" ").map((function(e){return Ln(e)||Rn(e)}))}),n.lastIndex===e.length)return r}return[]}function Fn(e){return e.toString()}var Un=function(e){return"number"==typeof e?un(e):/^\s*[-+]?(\d*\.)?\d+\s*$/.test(e)?un(Number(e)):un(0)},Gn=wt(Un);function Zn(e,t){return[e,t,Fn]}function Vn(e,t){return function(n,r){return[n,r,function(n){return Fn((0,S.Z)(n,e,t))}]}}function Xn(e,t){if(e.length===t.length)return[e,t,function(e){return e}]}function Wn(e){return 0===e.parsedStyle.d.totalLength&&(e.parsedStyle.d.totalLength=(0,A.D)(e.parsedStyle.d.absolutePath)),e.parsedStyle.d.totalLength}function Hn(e){return 0===e.parsedStyle.points.totalLength&&(e.parsedStyle.points.totalLength=re(e.parsedStyle.points.points)),e.parsedStyle.points.totalLength}function Yn(e,t){return e[0]===t[0]&&e[1]===t[1]}function zn(e,t){var n=e.prePoint,r=e.currentPoint,i=e.nextPoint,a=Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2),o=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2),s=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2),l=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!l||0===Math.sin(l)||(0,M.Z)(l,0))return{xExtra:0,yExtra:0};var u=Math.abs(Math.atan2(i[1]-r[1],i[0]-r[0])),c=Math.abs(Math.atan2(i[0]-r[0],i[1]-r[1]));return u=u>Math.PI/2?Math.PI-u:u,c=c>Math.PI/2?Math.PI-c:c,{xExtra:Math.cos(l/2-u)*(t/2*(1/Math.sin(l/2)))-t/2||0,yExtra:Math.cos(c-l/2)*(t/2*(1/Math.sin(l/2)))-t/2||0}}function Kn(e,t){return[t[0]+(t[0]-e[0]),t[1]+(t[1]-e[1])]}wt((function(e){return(0,R.Z)(e)?e.split(" ").map(Gn):e.map(Gn)}));var jn=function(e,t){var n=e.x*t.x+e.y*t.y,r=Math.sqrt((Math.pow(e.x,2)+Math.pow(e.y,2))*(Math.pow(t.x,2)+Math.pow(t.y,2)));return(e.x*t.y-e.y*t.x<0?-1:1)*Math.acos(n/r)},qn=function(e,t,n,r,i,a,o,s){t=Math.abs(t),n=Math.abs(n);var l=Pe(r=(0,N.Z)(r,360));if(e.x===o.x&&e.y===o.y)return{x:e.x,y:e.y,ellipticalArcAngle:0};if(0===t||0===n)return{x:0,y:0,ellipticalArcAngle:0};var u=(e.x-o.x)/2,c=(e.y-o.y)/2,h={x:Math.cos(l)*u+Math.sin(l)*c,y:-Math.sin(l)*u+Math.cos(l)*c},d=Math.pow(h.x,2)/Math.pow(t,2)+Math.pow(h.y,2)/Math.pow(n,2);d>1&&(t*=Math.sqrt(d),n*=Math.sqrt(d));var f=(Math.pow(t,2)*Math.pow(n,2)-Math.pow(t,2)*Math.pow(h.y,2)-Math.pow(n,2)*Math.pow(h.x,2))/(Math.pow(t,2)*Math.pow(h.y,2)+Math.pow(n,2)*Math.pow(h.x,2));f=f<0?0:f;var p=(i!==a?1:-1)*Math.sqrt(f),v=p*(t*h.y/n),g=p*(-n*h.x/t),m={x:Math.cos(l)*v-Math.sin(l)*g+(e.x+o.x)/2,y:Math.sin(l)*v+Math.cos(l)*g+(e.y+o.y)/2},y={x:(h.x-v)/t,y:(h.y-g)/n},E=jn({x:1,y:0},y),_=jn(y,{x:(-h.x-v)/t,y:(-h.y-g)/n});!a&&_>0?_-=2*Math.PI:a&&_<0&&(_+=2*Math.PI);var T=E+(_%=2*Math.PI)*s,R=t*Math.cos(T),S=n*Math.sin(T);return{x:Math.cos(l)*R-Math.sin(l)*S+m.x,y:Math.sin(l)*R+Math.cos(l)*S+m.y,ellipticalArcStartAngle:E,ellipticalArcEndAngle:E+_,ellipticalArcAngle:T,ellipticalArcCenter:m,resultantRx:t,resultantRy:n}};function Qn(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.arcParams,i=r.rx,a=void 0===i?0:i,o=r.ry,s=void 0===o?0:o,l=r.xRotation,u=r.arcFlag,c=r.sweepFlag,h=qn({x:e.prePoint[0],y:e.prePoint[1]},a,s,l,!!u,!!c,{x:e.currentPoint[0],y:e.currentPoint[1]},t),d=qn({x:e.prePoint[0],y:e.prePoint[1]},a,s,l,!!u,!!c,{x:e.currentPoint[0],y:e.currentPoint[1]},n?t+.005:t-.005),f=d.x-h.x,p=d.y-h.y,v=Math.sqrt(f*f+p*p);return{x:-f/v,y:-p/v}}function $n(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Jn(e,t){return $n(e)*$n(t)?(e[0]*t[0]+e[1]*t[1])/($n(e)*$n(t)):1}function er(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(Jn(e,t))}function tr(e,t){var n=t[1],r=t[2],i=(0,N.Z)(Pe(t[3]),2*Math.PI),a=t[4],o=t[5],s=e[0],l=e[1],u=t[6],c=t[7],h=Math.cos(i)*(s-u)/2+Math.sin(i)*(l-c)/2,d=-1*Math.sin(i)*(s-u)/2+Math.cos(i)*(l-c)/2,f=h*h/(n*n)+d*d/(r*r);f>1&&(n*=Math.sqrt(f),r*=Math.sqrt(f));var p=n*n*(d*d)+r*r*(h*h),v=p?Math.sqrt((n*n*(r*r)-p)/p):1;a===o&&(v*=-1),isNaN(v)&&(v=0);var g=r?v*n*d/r:0,m=n?v*-r*h/n:0,y=(s+u)/2+Math.cos(i)*g-Math.sin(i)*m,E=(l+c)/2+Math.sin(i)*g+Math.cos(i)*m,_=[(h-g)/n,(d-m)/r],T=[(-1*h-g)/n,(-1*d-m)/r],R=er([1,0],_),S=er(_,T);return Jn(_,T)<=-1&&(S=Math.PI),Jn(_,T)>=1&&(S=0),0===o&&S>0&&(S-=2*Math.PI),1===o&&S<0&&(S+=2*Math.PI),{cx:y,cy:E,rx:Yn(e,[u,c])?0:n,ry:Yn(e,[u,c])?0:r,startAngle:R,endAngle:R+S,xRotation:i,arcFlag:a,sweepFlag:o}}var nr=function(e){if(""===e||Array.isArray(e)&&0===e.length)return{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:{x:0,y:0,width:0,height:0}};var t;try{t=(0,k.A)(e)}catch(n){t=(0,k.A)(""),console.error("[g]: Invalid SVG Path definition: ".concat(e))}!function(e){for(var t=0;t<e.length;t++){var n=e[t-1],r=e[t];if("M"===r[0]&&n){var i=n[0],a=[r[1],r[2]],o=void 0;"L"===i||"M"===i?o=[n[1],n[2]]:"C"!==i&&"A"!==i&&"Q"!==i||(o=[n[n.length-2],n[n.length-1]]),o&&Yn(a,o)&&(e.splice(t,1),t--)}}}(t);var n=function(e){for(var t=!1,n=e.length,r=0;r<n;r++){var i=e[r][0];if("C"===i||"A"===i||"Q"===i){t=!0;break}}return t}(t),r=function(e){for(var t=[],n=[],r=[],i=0;i<e.length;i++){var a=e[i],o=a[0];"M"===o?(r.length&&(n.push(r),r=[]),r.push([a[1],a[2]])):"Z"===o?r.length&&(t.push(r),r=[]):r.push([a[1],a[2]])}return r.length>0&&n.push(r),{polygons:t,polylines:n}}(t),i=r.polygons,a=r.polylines,o=function(e){for(var t=[],n=null,r=null,i=null,a=0,o=e.length,s=0;s<o;s++){var l=e[s];r=e[s+1];var u=l[0],c={command:u,prePoint:n,params:l,startTangent:null,endTangent:null,currentPoint:null,nextPoint:null,arcParams:null,box:null,cubicParams:null};switch(u){case"M":i=[l[1],l[2]],a=s;break;case"A":var h=tr(n,l);c.arcParams=h}if("Z"===u)n=i,r=e[a+1];else{var d=l.length;n=[l[d-2],l[d-1]]}r&&"Z"===r[0]&&(r=e[a],t[a]&&(t[a].prePoint=n)),c.currentPoint=n,t[a]&&Yn(n,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var f=r?[r[r.length-2],r[r.length-1]]:null;c.nextPoint=f;var p=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[p[0]-n[0],p[1]-n[1]],c.endTangent=[n[0]-p[0],n[1]-p[1]];else if("Q"===u){var v=[l[1],l[2]];c.startTangent=[p[0]-v[0],p[1]-v[1]],c.endTangent=[n[0]-v[0],n[1]-v[1]]}else if("T"===u){var g=t[s-1],m=Kn(g.currentPoint,p);"Q"===g.command?(c.command="Q",c.startTangent=[p[0]-m[0],p[1]-m[1]],c.endTangent=[n[0]-m[0],n[1]-m[1]]):(c.command="TL",c.startTangent=[p[0]-n[0],p[1]-n[1]],c.endTangent=[n[0]-p[0],n[1]-p[1]])}else if("C"===u){var y=[l[1],l[2]],E=[l[3],l[4]];c.startTangent=[p[0]-y[0],p[1]-y[1]],c.endTangent=[n[0]-E[0],n[1]-E[1]],0===c.startTangent[0]&&0===c.startTangent[1]&&(c.startTangent=[y[0]-E[0],y[1]-E[1]]),0===c.endTangent[0]&&0===c.endTangent[1]&&(c.endTangent=[E[0]-y[0],E[1]-y[1]])}else if("S"===u){var _=t[s-1],T=Kn(_.currentPoint,p),R=[l[1],l[2]];"C"===_.command?(c.command="C",c.startTangent=[p[0]-T[0],p[1]-T[1]],c.endTangent=[n[0]-R[0],n[1]-R[1]]):(c.command="SQ",c.startTangent=[p[0]-R[0],p[1]-R[1]],c.endTangent=[n[0]-R[0],n[1]-R[1]])}else if("A"===u){var S=Qn(c,0),A=S.x,x=S.y,C=Qn(c,1,!1),M=C.x,N=C.y;c.startTangent=[A,x],c.endTangent=[M,N]}t.push(c)}return t}(t),s=function(e,t){for(var n=[],r=[],i=[],a=0;a<e.length;a++){var o=e[a],s=o.currentPoint,l=o.params,u=o.prePoint,c=void 0;switch(o.command){case"Q":c=oe(u[0],u[1],l[1],l[2],l[3],l[4]);break;case"C":c=te(u[0],u[1],l[1],l[2],l[3],l[4],l[5],l[6]);break;case"A":var h=o.arcParams;c=K(h.cx,h.cy,h.rx,h.ry,h.xRotation,h.startAngle,h.endAngle);break;default:n.push(s[0]),r.push(s[1])}c&&(o.box=c,n.push(c.x,c.x+c.width),r.push(c.y,c.y+c.height)),t&&("L"===o.command||"M"===o.command)&&o.prePoint&&o.nextPoint&&i.push(o)}n=n.filter((function(e){return!Number.isNaN(e)&&e!==1/0&&e!==-1/0})),r=r.filter((function(e){return!Number.isNaN(e)&&e!==1/0&&e!==-1/0}));var d=(0,x.Z)(n),f=(0,x.Z)(r),p=(0,C.Z)(n),v=(0,C.Z)(r);if(0===i.length)return{x:d,y:f,width:p-d,height:v-f};for(var g=0;g<i.length;g++){var m=i[g],y=m.currentPoint;y[0]===d?d-=zn(m,t).xExtra:y[0]===p&&(p+=zn(m,t).xExtra),y[1]===f?f-=zn(m,t).yExtra:y[1]===v&&(v+=zn(m,t).yExtra)}return{x:d,y:f,width:p-d,height:v-f}}(o,0),l=s.x,u=s.y,c=s.width,h=s.height;return{absolutePath:t,hasArc:n,segments:o,polygons:i,polylines:a,totalLength:0,rect:{x:Number.isFinite(l)?l:0,y:Number.isFinite(u)?u:0,width:Number.isFinite(c)?c:0,height:Number.isFinite(h)?h:0}}},rr=wt(nr);function ir(e){return(0,R.Z)(e)?rr(e):nr(e)}function ar(e,t,n){var r=e.curve,i=t.curve;r&&0!==r.length||(r=(0,b.Y)(e.absolutePath,!1),e.curve=r),i&&0!==i.length||(i=(0,b.Y)(t.absolutePath,!1),t.curve=i);var a=[r,i];r.length!==i.length&&(a=(0,P.x)(r,i));var o=(0,O.b)(a[0])!==(0,O.b)(a[1])?(0,I.G)(a[0]):(0,D.U)(a[0]);return[o,(0,L.g)(a[1],o),function(e){return e}]}function or(e,t){return{points:(0,R.Z)(e)?e.split(" ").map((function(e){var t=e.split(","),n=(0,h.Z)(t,2),r=n[0],i=n[1];return[Number(r),Number(i)]})):e,totalLength:0,segments:[]}}function sr(e,t){return[e.points,t.points,function(e){return e}]}var lr=null,ur=/\s*(\w+)\(([^)]*)\)/g;function cr(e){return function(t){var n=0;return e.map((function(e){return e===lr?t[n++]:e}))}}function hr(e){return e}var dr={matrix:["NNNNNN",[lr,lr,0,0,lr,lr,0,0,0,0,1,0,lr,lr,0,1],hr],matrix3d:["NNNNNNNNNNNNNNNN",hr],rotate:["A"],rotateX:["A"],rotateY:["A"],rotateZ:["A"],rotate3d:["NNNA"],perspective:["L"],scale:["Nn",cr([lr,lr,new Jt(1)]),hr],scaleX:["N",cr([lr,new Jt(1),new Jt(1)]),cr([lr,new Jt(1)])],scaleY:["N",cr([new Jt(1),lr,new Jt(1)]),cr([new Jt(1),lr])],scaleZ:["N",cr([new Jt(1),new Jt(1),lr])],scale3d:["NNN",hr],skew:["Aa",null,hr],skewX:["A",null,cr([lr,tn])],skewY:["A",null,cr([tn,lr])],translate:["Tt",cr([lr,lr,en]),hr],translateX:["T",cr([lr,en,en]),cr([lr,en])],translateY:["T",cr([en,lr,en]),cr([en,lr])],translateZ:["L",cr([en,en,lr])],translate3d:["TTL",hr]};function fr(e){for(var t=[],n=e.length,r=0;r<n;r++){var i=e[r],a=i[0],o=i.slice(1);if("translate"===a||"skew"===a?1===o.length&&o.push(0):"scale"===a&&1===o.length&&o.push(o[0]),!dr[a])return[];var s=o.map((function(e){return un(e)}));t.push({t:a,d:s})}return t}function pr(e){if(Array.isArray(e))return fr(e);if("none"===(e=(e||"none").trim()))return[];var t,n=[],r=0;for(ur.lastIndex=0;t=ur.exec(e);){if(t.index!==r)return[];r=t.index+t[0].length;var i=t[1],a=dr[i];if(!a)return[];var o=t[2].split(","),s=a[0];if(s.length<o.length)return[];for(var l=[],u=0;u<s.length;u++){var c=o[u],h=s[u],d=void 0;if(void 0===(d=c?{A:function(e){return"0"===e.trim()?tn:bn(e)},N:Gn,T:Nn,L:Cn}[h.toUpperCase()](c):{a:tn,n:l[0],t:en}[h]))return[];l.push(d)}if(n.push({t:i,d:l}),ur.lastIndex===e.length)return n}return[]}function vr(e){if(Array.isArray(e))return fr(e);if("none"===(e=(e||"none").trim()))return[];var t,n=[],r=0;for(ur.lastIndex=0;t=ur.exec(e);){if(t.index!==r)return[];r=t.index+t[0].length;var i=t[1],a=dr[i];if(!a)return[];var o=t[2].split(","),s=a[0];if(s.length<o.length)return[];for(var l=[],u=0;u<s.length;u++){var c=o[u],h=s[u],d=void 0;if(void 0===(d=c?{A:function(e){return"0"===e.trim()?tn:kn(e)},N:Un,T:Mn,L:xn}[h.toUpperCase()](c):{a:tn,n:l[0],t:en}[h]))return[];l.push(d)}if(n.push({t:i,d:l}),ur.lastIndex===e.length)return n}return[]}function gr(e){var t,n,r,i;switch(e.t){case"rotateX":return i=Pe(On(e.d[0])),[1,0,0,0,0,Math.cos(i),Math.sin(i),0,0,-Math.sin(i),Math.cos(i),0,0,0,0,1];case"rotateY":return i=Pe(On(e.d[0])),[Math.cos(i),0,-Math.sin(i),0,0,1,0,0,Math.sin(i),0,Math.cos(i),0,0,0,0,1];case"rotate":case"rotateZ":return i=Pe(On(e.d[0])),[Math.cos(i),Math.sin(i),0,0,-Math.sin(i),Math.cos(i),0,0,0,0,1,0,0,0,0,1];case"rotate3d":t=e.d[0].value,n=e.d[1].value,r=e.d[2].value,i=Pe(On(e.d[3]));var a=t*t+n*n+r*r;if(0===a)t=1,n=0,r=0;else if(1!==a){var o=Math.sqrt(a);t/=o,n/=o,r/=o}var s=Math.sin(i/2),l=s*Math.cos(i/2),u=s*s;return[1-2*(n*n+r*r)*u,2*(t*n*u+r*l),2*(t*r*u-n*l),0,2*(t*n*u-r*l),1-2*(t*t+r*r)*u,2*(n*r*u+t*l),0,2*(t*r*u+n*l),2*(n*r*u-t*l),1-2*(t*t+n*n)*u,0,0,0,0,1];case"scale":return[e.d[0].value,0,0,0,0,e.d[1].value,0,0,0,0,1,0,0,0,0,1];case"scaleX":return[e.d[0].value,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"scaleY":return[1,0,0,0,0,e.d[0].value,0,0,0,0,1,0,0,0,0,1];case"scaleZ":return[1,0,0,0,0,1,0,0,0,0,e.d[0].value,0,0,0,0,1];case"scale3d":return[e.d[0].value,0,0,0,0,e.d[1].value,0,0,0,0,e.d[2].value,0,0,0,0,1];case"skew":var c=Pe(On(e.d[0])),h=Pe(On(e.d[1]));return[1,Math.tan(h),0,0,Math.tan(c),1,0,0,0,0,1,0,0,0,0,1];case"skewX":return i=Pe(On(e.d[0])),[1,0,0,0,Math.tan(i),1,0,0,0,0,1,0,0,0,0,1];case"skewY":return i=Pe(On(e.d[0])),[1,Math.tan(i),0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"translate":return[1,0,0,0,0,1,0,0,0,0,1,0,t=Dn(e.d[0],0,null)||0,n=Dn(e.d[1],0,null)||0,0,1];case"translateX":return[1,0,0,0,0,1,0,0,0,0,1,0,t=Dn(e.d[0],0,null)||0,0,0,1];case"translateY":return[1,0,0,0,0,1,0,0,0,0,1,0,0,n=Dn(e.d[0],0,null)||0,0,1];case"translateZ":return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,r=Dn(e.d[0],0,null)||0,1];case"translate3d":return[1,0,0,0,0,1,0,0,0,0,1,0,t=Dn(e.d[0],0,null)||0,n=Dn(e.d[1],0,null)||0,r=Dn(e.d[2],0,null)||0,1];case"perspective":var d=Dn(e.d[0],0,null)||0;return[1,0,0,0,0,1,0,0,0,0,1,d?-1/d:0,0,0,0,1];case"matrix":return[e.d[0].value,e.d[1].value,0,0,e.d[2].value,e.d[3].value,0,0,0,0,1,0,e.d[4].value,e.d[5].value,0,1];case"matrix3d":return e.d.map((function(e){return e.value}))}}function mr(e,t){return[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],e[0]*t[4]+e[4]*t[5]+e[8]*t[6]+e[12]*t[7],e[1]*t[4]+e[5]*t[5]+e[9]*t[6]+e[13]*t[7],e[2]*t[4]+e[6]*t[5]+e[10]*t[6]+e[14]*t[7],e[3]*t[4]+e[7]*t[5]+e[11]*t[6]+e[15]*t[7],e[0]*t[8]+e[4]*t[9]+e[8]*t[10]+e[12]*t[11],e[1]*t[8]+e[5]*t[9]+e[9]*t[10]+e[13]*t[11],e[2]*t[8]+e[6]*t[9]+e[10]*t[10]+e[14]*t[11],e[3]*t[8]+e[7]*t[9]+e[11]*t[10]+e[15]*t[11],e[0]*t[12]+e[4]*t[13]+e[8]*t[14]+e[12]*t[15],e[1]*t[12]+e[5]*t[13]+e[9]*t[14]+e[13]*t[15],e[2]*t[12]+e[6]*t[13]+e[10]*t[14]+e[14]*t[15],e[3]*t[12]+e[7]*t[13]+e[11]*t[14]+e[15]*t[15]]}function yr(e){var t=[0,0,0],n=[1,1,1],r=[0,0,0],i=[0,0,0,1],a=[0,0,0,1];return function(e,t,n,r,i,a){if(!function(e,t){var n=t[15];if(0===n)return!1;for(var r=1/n,i=0;i<16;i++)e[i]=t[i]*r;return!0}(we,e))return!1;if(v.copy(Fe,we),Fe[3]=0,Fe[7]=0,Fe[11]=0,Fe[15]=1,Math.abs(v.determinant(Fe))<1e-8)return!1;var o,s,l=we[3],u=we[7],c=we[11],h=we[12],d=we[13],g=we[14],m=we[15];if(0!==l||0!==u||0!==c){if(Ue[0]=l,Ue[1]=u,Ue[2]=c,Ue[3]=m,!v.invert(Fe,Fe))return!1;v.transpose(Fe,Fe),p.transformMat4(i,Ue,Fe)}else i[0]=i[1]=i[2]=0,i[3]=1;if(t[0]=h,t[1]=d,t[2]=g,s=we,(o=Ge)[0][0]=s[0],o[0][1]=s[1],o[0][2]=s[2],o[1][0]=s[4],o[1][1]=s[5],o[1][2]=s[6],o[2][0]=s[8],o[2][1]=s[9],o[2][2]=s[10],n[0]=f.length(Ge[0]),f.normalize(Ge[0],Ge[0]),r[0]=f.dot(Ge[0],Ge[1]),Ve(Ge[1],Ge[1],Ge[0],1,-r[0]),n[1]=f.length(Ge[1]),f.normalize(Ge[1],Ge[1]),r[0]/=n[1],r[1]=f.dot(Ge[0],Ge[2]),Ve(Ge[2],Ge[2],Ge[0],1,-r[1]),r[2]=f.dot(Ge[1],Ge[2]),Ve(Ge[2],Ge[2],Ge[1],1,-r[2]),n[2]=f.length(Ge[2]),f.normalize(Ge[2],Ge[2]),r[1]/=n[2],r[2]/=n[2],f.cross(Ze,Ge[1],Ge[2]),f.dot(Ge[0],Ze)<0)for(var y=0;y<3;y++)n[y]*=-1,Ge[y][0]*=-1,Ge[y][1]*=-1,Ge[y][2]*=-1;a[0]=.5*Math.sqrt(Math.max(1+Ge[0][0]-Ge[1][1]-Ge[2][2],0)),a[1]=.5*Math.sqrt(Math.max(1-Ge[0][0]+Ge[1][1]-Ge[2][2],0)),a[2]=.5*Math.sqrt(Math.max(1-Ge[0][0]-Ge[1][1]+Ge[2][2],0)),a[3]=.5*Math.sqrt(Math.max(1+Ge[0][0]+Ge[1][1]+Ge[2][2],0)),Ge[2][1]>Ge[1][2]&&(a[0]=-a[0]),Ge[0][2]>Ge[2][0]&&(a[1]=-a[1]),Ge[1][0]>Ge[0][1]&&(a[2]=-a[2])}(function(e){return 0===e.length?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:e.map(gr).reduce(mr)}(e),t,n,r,i,a),[[t,n,r,a,i]]}var Er=function(){function e(e,t){for(var n=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],r=0;r<4;r++)for(var i=0;i<4;i++)for(var a=0;a<4;a++)n[r][i]+=t[r][a]*e[a][i];return n}return function(t,n,r,i,a){for(var o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],s=0;s<4;s++)o[s][3]=a[s];for(var l=0;l<3;l++)for(var u=0;u<3;u++)o[3][l]+=t[u]*o[u][l];var c=i[0],h=i[1],d=i[2],f=i[3],p=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];p[0][0]=1-2*(h*h+d*d),p[0][1]=2*(c*h-d*f),p[0][2]=2*(c*d+h*f),p[1][0]=2*(c*h+d*f),p[1][1]=1-2*(c*c+d*d),p[1][2]=2*(h*d-c*f),p[2][0]=2*(c*d-h*f),p[2][1]=2*(h*d+c*f),p[2][2]=1-2*(c*c+h*h),o=e(o,p);var v,g=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];r[2]&&(g[2][1]=r[2],o=e(o,g)),r[1]&&(g[2][1]=0,g[2][0]=r[0],o=e(o,g)),r[0]&&(g[2][0]=0,g[1][0]=r[0],o=e(o,g));for(var m=0;m<3;m++)for(var y=0;y<3;y++)o[m][y]*=n[m];return 0===(v=o)[0][2]&&0===v[0][3]&&0===v[1][2]&&0===v[1][3]&&0===v[2][0]&&0===v[2][1]&&1===v[2][2]&&0===v[2][3]&&0===v[3][2]&&1===v[3][3]?[o[0][0],o[0][1],o[1][0],o[1][1],o[3][0],o[3][1]]:o[0].concat(o[1],o[2],o[3])}}();function _r(e){return e.toFixed(6).replace(".000000","")}function Tr(e,t){var n,r;return e.decompositionPair!==t&&(e.decompositionPair=t,n=yr(e)),t.decompositionPair!==e&&(t.decompositionPair=e,r=yr(t)),null===n[0]||null===r[0]?[[!1],[!0],function(n){return n?t[0].d:e[0].d}]:(n[0].push(0),r[0].push(1),[n,r,function(e){var t=function(e,t,n){var r=function(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}(e,t);r=(0,S.Z)(r,-1,1);var i=[];if(1===r)i=e;else for(var a=Math.acos(r),o=1*Math.sin(n*a)/Math.sqrt(1-r*r),s=0;s<4;s++)i.push(e[s]*(Math.cos(n*a)-r*o)+t[s]*o);return i}(n[0][3],r[0][3],e[5]);return Er(e[0],e[1],e[2],t,e[4]).map(_r).join(",")}])}function Rr(e){return e.replace(/[XY]/,"")}function Sr(e){return e.replace(/(X|Y|Z|3d)?$/,"3d")}function Ar(e,t,n){var r=!1;if(!e.length||!t.length){e.length||(r=!0,e=t,t=[]);for(var i=function(){var n=e[a],r=n.t,i=n.d,o="scale"===r.substring(0,5)?1:0;t.push({t:r,d:i.map((function(e){return"number"==typeof e?un(o):un(o,e.unit)}))})},a=0;a<e.length;a++)i()}var o,s,l=[],u=[],c=[];if(e.length!==t.length){var h=Tr(e,t);l=[h[0]],u=[h[1]],c=[["matrix",[h[2]]]]}else for(var d=0;d<e.length;d++){var f=e[d].t,p=t[d].t,v=e[d].d,g=t[d].d,m=dr[f],y=dr[p],E=void 0;if(s=p,"perspective"===(o=f)&&"perspective"===s||!("matrix"!==o&&"matrix3d"!==o||"matrix"!==s&&"matrix3d"!==s)){var _=Tr([e[d]],[t[d]]);l.push(_[0]),u.push(_[1]),c.push(["matrix",[_[2]]])}else{if(f===p)E=f;else if(m[2]&&y[2]&&Rr(f)===Rr(p))E=Rr(f),v=m[2](v),g=y[2](g);else{if(!m[1]||!y[1]||Sr(f)!==Sr(p)){var T=Tr(e,t);l=[T[0]],u=[T[1]],c=[["matrix",[T[2]]]];break}E=Sr(f),v=m[1](v),g=y[1](g)}for(var R=[],S=[],A=[],x=0;x<v.length;x++){var C=Pn(v[x],g[x],n,!1,x);R[x]=C[0],S[x]=C[1],A.push(C[2])}l.push(R),u.push(S),c.push([E,A])}}if(r){var M=l;l=u,u=M}return[l,u,function(e){return e.map((function(e,t){var n=e.map((function(e,n){return c[t][1][n](e)})).join(",");return"matrix"===c[t][0]&&16===n.split(",").length&&(c[t][0]="matrix3d"),"matrix3d"===c[t][0]&&6===n.split(",").length&&(c[t][0]="matrix"),"".concat(c[t][0],"(").concat(n,")")})).join(" ")}]}var xr=wt((function(e){if((0,R.Z)(e)){if("text-anchor"===e)return[un(0,"px"),un(0,"px")];var t=e.split(" ");return 1===t.length&&("top"===t[0]||"bottom"===t[0]?(t[1]=t[0],t[0]="center"):t[1]="center"),2!==t.length?null:[Nn(Cr(t[0])),Nn(Cr(t[1]))]}return[un(e[0]||0,"px"),un(e[1]||0,"px")]}));function Cr(e){return"center"===e?"50%":"left"===e||"top"===e?"0%":"right"===e||"bottom"===e?"100%":e}var Mr=[{n:"display",k:["none"]},{n:"opacity",int:!0,inh:!0,d:"1",syntax:nt.OPACITY_VALUE},{n:"fillOpacity",int:!0,inh:!0,d:"1",syntax:nt.OPACITY_VALUE},{n:"strokeOpacity",int:!0,inh:!0,d:"1",syntax:nt.OPACITY_VALUE},{n:"fill",int:!0,k:["none"],d:"none",syntax:nt.PAINT},{n:"fillRule",k:["nonzero","evenodd"],d:"nonzero"},{n:"stroke",int:!0,k:["none"],d:"none",syntax:nt.PAINT,l:!0},{n:"shadowType",k:["inner","outer","both"],d:"outer",l:!0},{n:"shadowColor",int:!0,syntax:nt.COLOR},{n:"shadowOffsetX",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"shadowOffsetY",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"shadowBlur",int:!0,l:!0,d:"0",syntax:nt.SHADOW_BLUR},{n:"lineWidth",int:!0,inh:!0,d:"1",l:!0,a:["strokeWidth"],syntax:nt.LENGTH_PERCENTAGE},{n:"increasedLineWidthForHitTesting",inh:!0,d:"0",l:!0,syntax:nt.LENGTH_PERCENTAGE},{n:"lineJoin",inh:!0,l:!0,a:["strokeLinejoin"],k:["miter","bevel","round"],d:"miter"},{n:"lineCap",inh:!0,l:!0,a:["strokeLinecap"],k:["butt","round","square"],d:"butt"},{n:"lineDash",int:!0,inh:!0,k:["none"],a:["strokeDasharray"],syntax:nt.LENGTH_PERCENTAGE_12},{n:"lineDashOffset",int:!0,inh:!0,d:"0",a:["strokeDashoffset"],syntax:nt.LENGTH_PERCENTAGE},{n:"offsetPath",syntax:nt.DEFINED_PATH},{n:"offsetDistance",int:!0,syntax:nt.OFFSET_DISTANCE},{n:"dx",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"dy",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"zIndex",ind:!0,int:!0,d:"0",k:["auto"],syntax:nt.Z_INDEX},{n:"visibility",k:["visible","hidden"],ind:!0,inh:!0,int:!0,d:"visible"},{n:"pointerEvents",inh:!0,k:["none","auto","stroke","fill","painted","visible","visiblestroke","visiblefill","visiblepainted","all"],d:"auto"},{n:"filter",ind:!0,l:!0,k:["none"],d:"none",syntax:nt.FILTER},{n:"clipPath",syntax:nt.DEFINED_PATH},{n:"textPath",syntax:nt.DEFINED_PATH},{n:"textPathSide",k:["left","right"],d:"left"},{n:"textPathStartOffset",l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"transform",p:100,int:!0,k:["none"],d:"none",syntax:nt.TRANSFORM},{n:"transformOrigin",p:100,d:"0 0",l:!0,syntax:nt.TRANSFORM_ORIGIN},{n:"cx",int:!0,l:!0,d:"0",syntax:nt.COORDINATE},{n:"cy",int:!0,l:!0,d:"0",syntax:nt.COORDINATE},{n:"cz",int:!0,l:!0,d:"0",syntax:nt.COORDINATE},{n:"r",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"rx",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"ry",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"x",int:!0,l:!0,d:"0",syntax:nt.COORDINATE},{n:"y",int:!0,l:!0,d:"0",syntax:nt.COORDINATE},{n:"z",int:!0,l:!0,d:"0",syntax:nt.COORDINATE},{n:"width",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"height",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:nt.LENGTH_PERCENTAGE},{n:"radius",int:!0,l:!0,d:"0",syntax:nt.LENGTH_PERCENTAGE_14},{n:"x1",int:!0,l:!0,syntax:nt.COORDINATE},{n:"y1",int:!0,l:!0,syntax:nt.COORDINATE},{n:"z1",int:!0,l:!0,syntax:nt.COORDINATE},{n:"x2",int:!0,l:!0,syntax:nt.COORDINATE},{n:"y2",int:!0,l:!0,syntax:nt.COORDINATE},{n:"z2",int:!0,l:!0,syntax:nt.COORDINATE},{n:"d",int:!0,l:!0,d:"",syntax:nt.PATH,p:50},{n:"points",int:!0,l:!0,syntax:nt.LIST_OF_POINTS,p:50},{n:"text",l:!0,d:"",syntax:nt.TEXT,p:50},{n:"textTransform",l:!0,inh:!0,k:["capitalize","uppercase","lowercase","none"],d:"none",syntax:nt.TEXT_TRANSFORM,p:51},{n:"font",l:!0},{n:"fontSize",int:!0,inh:!0,d:"16px",l:!0,syntax:nt.LENGTH_PERCENTAGE},{n:"fontFamily",l:!0,inh:!0,d:"sans-serif"},{n:"fontStyle",l:!0,inh:!0,k:["normal","italic","oblique"],d:"normal"},{n:"fontWeight",l:!0,inh:!0,k:["normal","bold","bolder","lighter"],d:"normal"},{n:"fontVariant",l:!0,inh:!0,k:["normal","small-caps"],d:"normal"},{n:"lineHeight",l:!0,syntax:nt.LENGTH,int:!0,d:"0"},{n:"letterSpacing",l:!0,syntax:nt.LENGTH,int:!0,d:"0"},{n:"miterLimit",l:!0,syntax:nt.NUMBER,d:function(e){return e===he.PATH||e===he.POLYGON||e===he.POLYLINE?"4":"10"}},{n:"wordWrap",l:!0},{n:"wordWrapWidth",l:!0},{n:"maxLines",l:!0},{n:"textOverflow",l:!0,d:"clip"},{n:"leading",l:!0},{n:"textBaseline",l:!0,inh:!0,k:["top","hanging","middle","alphabetic","ideographic","bottom"],d:"alphabetic"},{n:"textAlign",l:!0,inh:!0,k:["start","center","middle","end","left","right"],d:"start"},{n:"markerStart",syntax:nt.MARKER},{n:"markerEnd",syntax:nt.MARKER},{n:"markerMid",syntax:nt.MARKER},{n:"markerStartOffset",syntax:nt.LENGTH,l:!0,int:!0,d:"0"},{n:"markerEndOffset",syntax:nt.LENGTH,l:!0,int:!0,d:"0"}],Nr=new Set(Mr.filter((function(e){return!!e.l})).map((function(e){return e.n}))),kr={},br=function(){return(0,a.Z)((function e(t){var n=this;(0,o.Z)(this,e),this.runtime=t,Mr.forEach((function(e){n.registerMetadata(e)}))}),[{key:"registerMetadata",value:function(e){[e.n].concat((0,c.Z)(e.a||[])).forEach((function(t){kr[t]=e}))}},{key:"getPropertySyntax",value:function(e){return this.runtime.CSSPropertySyntaxFactory[e]}},{key:"processProperties",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{skipUpdateAttribute:!1,skipParse:!1,forceUpdateGeometry:!1,usedAttributes:[],memoize:!0};Object.assign(e.attributes,t);var r=e.parsedStyle.clipPath,i=e.parsedStyle.offsetPath;Pr(e,t);var a=!!n.forceUpdateGeometry;if(!a)for(var o in t)if(Nr.has(o)){a=!0;break}var s=Or(e);s.has("fill")&&t.fill&&(e.parsedStyle.fill=Rn(t.fill)),s.has("stroke")&&t.stroke&&(e.parsedStyle.stroke=Rn(t.stroke)),s.has("shadowColor")&&t.shadowColor&&(e.parsedStyle.shadowColor=Rn(t.shadowColor)),s.has("filter")&&t.filter&&(e.parsedStyle.filter=wn(t.filter)),s.has("radius")&&!(0,T.Z)(t.radius)&&(e.parsedStyle.radius=In(t.radius,4)),s.has("lineDash")&&!(0,T.Z)(t.lineDash)&&(e.parsedStyle.lineDash=In(t.lineDash,"even")),s.has("points")&&t.points&&(e.parsedStyle.points=or(t.points)),s.has("d")&&""===t.d&&(e.parsedStyle.d=(0,u.Z)({},tt)),s.has("d")&&t.d&&(e.parsedStyle.d=ir(t.d)),s.has("textTransform")&&t.textTransform&&this.runtime.CSSPropertySyntaxFactory[nt.TEXT_TRANSFORM].calculator(null,null,{value:t.textTransform},e,null),s.has("clipPath")&&!(0,B.Z)(t.clipPath)&&this.runtime.CSSPropertySyntaxFactory[nt.DEFINED_PATH].calculator("clipPath",r,t.clipPath,e,this.runtime),s.has("offsetPath")&&t.offsetPath&&this.runtime.CSSPropertySyntaxFactory[nt.DEFINED_PATH].calculator("offsetPath",i,t.offsetPath,e,this.runtime),s.has("transform")&&t.transform&&(e.parsedStyle.transform=pr(t.transform)),s.has("transformOrigin")&&t.transformOrigin&&(e.parsedStyle.transformOrigin=xr(t.transformOrigin)),s.has("markerStart")&&t.markerStart&&(e.parsedStyle.markerStart=this.runtime.CSSPropertySyntaxFactory[nt.MARKER].calculator(null,t.markerStart,t.markerStart,null,null)),s.has("markerEnd")&&t.markerEnd&&(e.parsedStyle.markerEnd=this.runtime.CSSPropertySyntaxFactory[nt.MARKER].calculator(null,t.markerEnd,t.markerEnd,null,null)),s.has("markerMid")&&t.markerMid&&(e.parsedStyle.markerMid=this.runtime.CSSPropertySyntaxFactory[nt.MARKER].calculator("",t.markerMid,t.markerMid,null,null)),s.has("zIndex")&&!(0,T.Z)(t.zIndex)&&this.runtime.CSSPropertySyntaxFactory[nt.Z_INDEX].postProcessor(e),s.has("offsetDistance")&&!(0,T.Z)(t.offsetDistance)&&this.runtime.CSSPropertySyntaxFactory[nt.OFFSET_DISTANCE].postProcessor(e),s.has("transform")&&t.transform&&this.runtime.CSSPropertySyntaxFactory[nt.TRANSFORM].postProcessor(e),s.has("transformOrigin")&&t.transformOrigin&&this.runtime.CSSPropertySyntaxFactory[nt.TRANSFORM_ORIGIN].postProcessor(e),a&&(e.geometry.dirty=!0,e.dirty(!0,!0),n.forceUpdateGeometry||this.runtime.sceneGraphService.dirtyToRoot(e))}},{key:"updateGeometry",value:function(e){var t=e.nodeName,n=this.runtime.geometryUpdaterFactory[t];if(n){var r=e.geometry;r.contentBounds||(r.contentBounds=new Te),r.renderBounds||(r.renderBounds=new Te);var i=e.parsedStyle,a=n.update(i,e),o=a.cx,s=void 0===o?0:o,l=a.cy,u=void 0===l?0:l,c=a.cz,h=void 0===c?0:c,d=a.hwidth,p=void 0===d?0:d,v=a.hheight,g=void 0===v?0:v,m=a.hdepth,y=void 0===m?0:m,E=[Math.abs(p),Math.abs(g),y],_=i.stroke,T=i.lineWidth,R=void 0===T?1:T,S=i.increasedLineWidthForHitTesting,A=void 0===S?0:S,x=i.shadowType,C=void 0===x?"outer":x,M=i.shadowColor,N=i.filter,k=void 0===N?[]:N,b=i.transformOrigin,P=[s,u,h];r.contentBounds.update(P,E);var O=t===he.POLYLINE||t===he.POLYGON||t===he.PATH?Math.SQRT2:.5;if(_&&!_.isNone){var I=((R||0)+(A||0))*O;E[0]+=I,E[1]+=I}if(r.renderBounds.update(P,E),M&&C&&"inner"!==C){var D=r.renderBounds,L=D.min,B=D.max,w=i.shadowBlur||0,F=i.shadowOffsetX||0,U=i.shadowOffsetY||0,G=L[0]-w+F,Z=B[0]+w+F,V=L[1]-w+U,X=B[1]+w+U;L[0]=Math.min(L[0],G),B[0]=Math.max(B[0],Z),L[1]=Math.min(L[1],V),B[1]=Math.max(B[1],X),r.renderBounds.setMinMax(L,B)}k.forEach((function(e){var t=e.name,n=e.params;if("blur"===t){var i=n[0].value;r.renderBounds.update(r.renderBounds.center,f.add(r.renderBounds.halfExtents,r.renderBounds.halfExtents,[i,i,0]))}else if("drop-shadow"===t){var a=n[0].value,o=n[1].value,s=n[2].value,l=r.renderBounds,u=l.min,c=l.max,h=u[0]-s+a,d=c[0]+s+a,p=u[1]-s+o,v=c[1]+s+o;u[0]=Math.min(u[0],h),c[0]=Math.max(c[0],d),u[1]=Math.min(u[1],p),c[1]=Math.max(c[1],v),r.renderBounds.setMinMax(u,c)}})),e.geometry.dirty=!1;var W=g<0,H=(p<0?-1:1)*(b?Dn(b[0],0,e,!0):0),Y=(W?-1:1)*(b?Dn(b[1],1,e,!0):0);(H||Y)&&e.setOrigin(H,Y)}}},{key:"updateSizeAttenuation",value:function(e,t){e.style.isSizeAttenuation?(e.style.rawLineWidth||(e.style.rawLineWidth=e.style.lineWidth),e.style.lineWidth=(e.style.rawLineWidth||1)/t,e.nodeName===he.CIRCLE&&(e.style.rawR||(e.style.rawR=e.style.r),e.style.r=(e.style.rawR||1)/t)):(e.style.rawLineWidth&&(e.style.lineWidth=e.style.rawLineWidth,delete e.style.rawLineWidth),e.nodeName===he.CIRCLE&&e.style.rawR&&(e.style.r=e.style.rawR,delete e.style.rawR))}}])}();function Pr(e,t){var n=Or(e);for(var r in t)n.has(r)&&(e.parsedStyle[r]=t[r])}function Or(e){return e.constructor.PARSED_STYLE_LIST}var Ir=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Zn}),[{key:"calculator",value:function(e,t,n,r){return On(n)}}])}(),Dr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r,i){return n instanceof Qt&&(n=null),i.sceneGraphService.updateDisplayObjectDependency(e,t,n,r),"clipPath"===e&&r.forEach((function(e){0===e.childNodes.length&&i.sceneGraphService.dirtyToRoot(e)})),n}}])}(),Lr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=Rn,this.mixer=Sn}),[{key:"calculator",value:function(e,t,n,r){return n instanceof Qt?"none"===n.value?on:sn:n}}])}(),Br=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n){return n instanceof Qt?[]:n}}])}();function wr(e){var t=e.parsedStyle.fontSize;return(0,T.Z)(t)?null:t}var Fr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Zn}),[{key:"calculator",value:function(e,t,n,r,i){if((0,E.Z)(n))return n;if(!Jt.isRelativeUnit(n.unit))return n.value;if(n.unit===Ft.kPercentage)return 0;if(n.unit===Ft.kEms){if(r.parentNode){var a=wr(r.parentNode);if(a)return a*=n.value}return 0}if(n.unit===Ft.kRems){var o;if(null!=r&&null!==(o=r.ownerDocument)&&void 0!==o&&o.documentElement){var s=wr(r.ownerDocument.documentElement);if(s)return s*=n.value}return 0}}}])}(),Ur=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Xn}),[{key:"calculator",value:function(e,t,n){return n.map((function(e){return e.value}))}}])}(),Gr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Xn}),[{key:"calculator",value:function(e,t,n){return n.map((function(e){return e.value}))}}])}(),Zr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){var i;n instanceof Qt&&(n=null);var a=null===(i=n)||void 0===i?void 0:i.cloneNode(!0);return a&&(a.style.isMarker=!0),a}}])}(),Vr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Zn}),[{key:"calculator",value:function(e,t,n){return n.value}}])}(),Xr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Vn(0,1)}),[{key:"calculator",value:function(e,t,n){return n.value}},{key:"postProcessor",value:function(e){var t=e.parsedStyle,n=t.offsetPath,r=t.offsetDistance;if(n){var i=n.nodeName;if(i===he.LINE||i===he.PATH||i===he.POLYLINE){var a=n.getPoint(r);a&&e.setLocalPosition(a.x,a.y)}}}}])}(),Wr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Vn(0,1)}),[{key:"calculator",value:function(e,t,n){return n.value}}])}(),Hr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=ir,this.mixer=ar}),[{key:"calculator",value:function(e,t,n){return n instanceof Qt&&"unset"===n.value?{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new xe(0,0,0,0)}:n}}])}(),Yr=(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=sr})),zr=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).mixer=Vn(0,1/0),e}return(0,l.Z)(t,e),(0,a.Z)(t)}(Fr),Kr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){return n instanceof Qt?"unset"===n.value?"":n.value:"".concat(n)}},{key:"postProcessor",value:function(e){e.nodeValue="".concat(e.parsedStyle.text)||""}}])}(),jr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){var i=r.getAttribute("text");if(i){var a=i;"capitalize"===n.value?a=i.charAt(0).toUpperCase()+i.slice(1):"lowercase"===n.value?a=i.toLowerCase():"uppercase"===n.value&&(a=i.toUpperCase()),r.parsedStyle.text=a}return n.value}}])}();new WeakMap;"undefined"!=typeof window&&window.document;function qr(e){var t=e;do{var n;if(null===(n=t.parsedStyle)||void 0===n?void 0:n.clipPath)return t;t=t.parentElement}while(null!==t);return null}var Qr={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},$r="object"===("undefined"==typeof performance?"undefined":i()(performance))&&performance.now?performance:Date;function Jr(e){return e.nodeName===he.FRAGMENT||e.getRootNode().nodeName===he.FRAGMENT}function ei(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=!1,i=!1,a=!!t&&!t.isNone,o=!!n&&!n.isNone;return"visiblepainted"===e||"painted"===e||"auto"===e?(r=a,i=o):"visiblefill"===e||"fill"===e?r=!0:"visiblestroke"===e||"stroke"===e?i=!0:"visible"!==e&&"all"!==e||(r=!0,i=!0),[r,i]}var ti=1,ni="object"===("undefined"==typeof self?"undefined":i()(self))&&self.self===self?self:"object"===(void 0===n.g?"undefined":i()(n.g))&&n.g.global===n.g?n.g:{},ri=Date.now(),ii={},ai=Date.now(),oi=function(e){if("function"!=typeof e)throw new TypeError("".concat(e," is not a function"));var t=Date.now(),n=t-ai,r=n>16?0:16-n,i=ti++;return ii[i]=e,Object.keys(ii).length>1||setTimeout((function(){ai=t;var e=ii;ii={},Object.keys(e).forEach((function(t){return e[t](ni.performance&&"function"==typeof ni.performance.now?ni.performance.now():Date.now()-ri)}))}),r),i},si=function(e){delete ii[e]},li=function(e){return"string"!=typeof e?oi:""===e?ni.requestAnimationFrame:ni["".concat(e,"RequestAnimationFrame")]},ui=function(e,t){for(var n=0;void 0!==e[n];){if(t(e[n]))return e[n];n+=1}}(["","webkit","moz","ms","o"],(function(e){return!!li(e)})),ci=li(ui),hi=function(e){return"string"!=typeof e?si:""===e?ni.cancelAnimationFrame:ni["".concat(e,"CancelAnimationFrame")]||ni["".concat(e,"CancelRequestAnimationFrame")]}(ui);ni.requestAnimationFrame=ci,ni.cancelAnimationFrame=hi;var di=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],fi=/([\"\'])[^\'\"]+\1/;function pi(e){var t=e.fontSize,n=void 0===t?16:t,r=e.fontFamily,i=void 0===r?"sans-serif":r,a=e.fontStyle,o=void 0===a?"normal":a,s=e.fontVariant,l=void 0===s?"normal":s,u=e.fontWeight;return{fontSize:n,fontFamily:i,fontStyle:o,fontVariant:l,fontWeight:void 0===u?"normal":u}}var vi=wt((function(e){for(var t=pi(e),n=t.fontSize,r=t.fontFamily,i=t.fontStyle,a=t.fontVariant,o=t.fontWeight,s=(0,E.Z)(n)&&"".concat(n,"px")||"16px",l=r.split(","),u=l.length-1;u>=0;u--){var c=l[u].trim();!fi.test(c)&&di.indexOf(c)<0&&(c='"'.concat(c,'"')),l[u]=c}return"".concat(i," ").concat(a," ").concat(o," ").concat(s," ").concat(l.join(","))}),(function(e){var t=pi(e),n=t.fontSize,r=t.fontFamily,i=t.fontStyle,a=t.fontVariant,o=t.fontWeight;return"".concat(i,"_").concat(a,"_").concat(o,"_").concat(n,"_").concat(r)})),gi=function(e){return Math.max(e,1e-6)};function mi(e,t,n){return v.identity(e),e[4]=Math.tan(t),e[1]=Math.tan(n),e}var yi=v.create(),Ei=v.create(),_i={scale:function(e){v.fromScaling(yi,[e[0].value,e[1].value,1].map((function(e){return gi(e)})))},scaleX:function(e){v.fromScaling(yi,[e[0].value,1,1].map((function(e){return gi(e)})))},scaleY:function(e){v.fromScaling(yi,[1,e[0].value,1].map((function(e){return gi(e)})))},scaleZ:function(e){v.fromScaling(yi,[1,1,e[0].value].map((function(e){return gi(e)})))},scale3d:function(e){v.fromScaling(yi,[e[0].value,e[1].value,e[2].value].map((function(e){return gi(e)})))},translate:function(e){v.fromTranslation(yi,[e[0].value,e[1].value,0])},translateX:function(e){v.fromTranslation(yi,[e[0].value,0,0])},translateY:function(e){v.fromTranslation(yi,[0,e[0].value,0])},translateZ:function(e){v.fromTranslation(yi,[0,0,e[0].value])},translate3d:function(e){v.fromTranslation(yi,[e[0].value,e[1].value,e[2].value])},rotate:function(e){v.fromZRotation(yi,Pe(On(e[0])))},rotateX:function(e){v.fromXRotation(yi,Pe(On(e[0])))},rotateY:function(e){v.fromYRotation(yi,Pe(On(e[0])))},rotateZ:function(e){v.fromZRotation(yi,Pe(On(e[0])))},rotate3d:function(e){v.fromRotation(yi,Pe(On(e[3])),[e[0].value,e[1].value,e[2].value])},skew:function(e){mi(yi,Pe(e[0].value),Pe(e[1].value))},skewX:function(e){mi(yi,Pe(e[0].value),0)},skewY:function(e){mi(yi,0,Pe(e[0].value))},matrix:function(e){v.set(yi,e[0].value,e[1].value,0,0,e[2].value,e[3].value,0,0,0,0,1,0,e[4].value,e[5].value,0,1)},matrix3d:function(e){v.set.apply(v,[yi].concat((0,c.Z)(e.map((function(e){return e.value})))))}},Ti=f.fromValues(1,1,1),Ri=f.create(),Si={translate:function(e,t){Aa.sceneGraphService.setLocalScale(e,Ti,!1),Aa.sceneGraphService.setLocalEulerAngles(e,Ri,void 0,void 0,!1),Aa.sceneGraphService.setLocalPosition(e,[t[0].value,t[1].value,0],!1),Aa.sceneGraphService.dirtyLocalTransform(e,e.transformable)}};function Ai(e,t){if(e.length){if(1===e.length&&Si[e[0].t])return void Si[e[0].t](t,e[0].d);for(var n=v.identity(Ei),r=0;r<e.length;r++){var i=e[r],a=i.t,o=i.d,s=_i[a];s&&(s(o),v.mul(n,n,yi))}t.setLocalTransform(n)}else t.resetLocalTransform();return t.getLocalTransform()}var xi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=vr,this.mixer=Ar}),[{key:"calculator",value:function(e,t,n,r){return n instanceof Qt?[]:n}},{key:"postProcessor",value:function(e){Ai(e.parsedStyle.transform,e)}}])}(),Ci=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"postProcessor",value:function(e){var t=e.parsedStyle.transformOrigin;t[0].unit===Ft.kPixels&&t[1].unit===Ft.kPixels?e.setOrigin(t[0].value,t[1].value):e.getGeometryBounds()}}])}(),Mi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){return n.value}},{key:"postProcessor",value:function(e){if(e.parentNode){var t=e.parentNode,n=t.renderable,r=t.sortable;n&&t.dirty(),r&&(r.dirty=!0,r.dirtyReason=qe.Z_INDEX_CHANGED)}}}])}(),Ni=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.cx,r=void 0===n?0:n,i=e.cy,a=void 0===i?0:i,o=e.r,s=void 0===o?0:o;return{cx:r,cy:a,hwidth:s,hheight:s}}}])}(),ki=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.cx,r=void 0===n?0:n,i=e.cy,a=void 0===i?0:i,o=e.rx,s=void 0===o?0:o,l=e.ry;return{cx:r,cy:a,hwidth:s,hheight:void 0===l?0:l}}}])}(),bi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){var t=e.x1,n=e.y1,r=e.x2,i=e.y2,a=Math.min(t,r),o=Math.max(t,r),s=Math.min(n,i),l=(o-a)/2,u=(Math.max(n,i)-s)/2;return{cx:a+l,cy:s+u,hwidth:l,hheight:u}}}])}(),Pi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){var t=e.d.rect,n=t.x,r=t.y,i=t.width/2,a=t.height/2;return{cx:n+i,cy:r+a,hwidth:i,hheight:a}}}])}(),Oi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){if(e.points&&(0,w.Z)(e.points.points)){var t=e.points.points,n=Math.min.apply(Math,(0,c.Z)(t.map((function(e){return e[0]})))),r=Math.max.apply(Math,(0,c.Z)(t.map((function(e){return e[0]})))),i=Math.min.apply(Math,(0,c.Z)(t.map((function(e){return e[1]})))),a=(r-n)/2,o=(Math.max.apply(Math,(0,c.Z)(t.map((function(e){return e[1]}))))-i)/2;return{cx:n+a,cy:i+o,hwidth:a,hheight:o}}return{cx:0,cy:0,hwidth:0,hheight:0}}}])}(),Ii=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.x,r=void 0===n?0:n,i=e.y,a=void 0===i?0:i,o=e.src,s=e.width,l=void 0===s?0:s,u=e.height,c=l,h=void 0===u?0:u;return o&&!(0,R.Z)(o)&&(c||(c=o.width,e.width=c),h||(h=o.height,e.height=h)),{cx:r+c/2,cy:a+h/2,hwidth:c/2,hheight:h/2}}}])}(),Di=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.globalRuntime=t}),[{key:"isReadyToMeasure",value:function(e,t){return e.text}},{key:"update",value:function(e,t){var n,r=e.text,i=e.textAlign,a=void 0===i?"start":i,o=e.lineWidth,s=void 0===o?1:o,l=e.textBaseline,u=void 0===l?"alphabetic":l,c=e.dx,h=void 0===c?0:c,d=e.dy,f=void 0===d?0:d,p=e.x,v=void 0===p?0:p,g=e.y,m=void 0===g?0:g;if(!this.isReadyToMeasure(e,t))return e.metrics={font:"",width:0,height:0,lines:[],lineWidths:[],lineHeight:0,maxLineWidth:0,fontProperties:{ascent:0,descent:0,fontSize:0},lineMetrics:[]},{hwidth:0,hheight:0,cx:0,cy:0};var y=((null==t||null===(n=t.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n?void 0:n.getConfig())||{}).offscreenCanvas,E=this.globalRuntime.textService.measureText(r,e,y);e.metrics=E;var _=E.width/2,T=E.height/2,R=v+_;"center"===a||"middle"===a?R+=s/2-_:"right"!==a&&"end"!==a||(R+=s-2*_);var S=m-T;return"middle"===u?S+=T:"top"===u||"hanging"===u?S+=2*T:"alphabetic"===u||"bottom"!==u&&"ideographic"!==u||(S+=0),h&&(R+=h),f&&(S+=f),{cx:R,cy:S,hwidth:_,hheight:T}}}])}(),Li=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){return{cx:0,cy:0,hwidth:0,hheight:0}}}])}(),Bi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.x,r=void 0===n?0:n,i=e.y,a=void 0===i?0:i,o=e.width,s=void 0===o?0:o,l=e.height,u=void 0===l?0:l;return{cx:r+s/2,cy:a+u/2,hwidth:s/2,hheight:u/2}}}])}();var wi=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.eventPhase=e.prototype.NONE,this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.defaultPrevented=!1,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ae,this.page=new Ae,this.canvas=new Ae,this.viewport=new Ae,this.composed=!1,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}),[{key:"name",get:function(){return this.type}},{key:"layerX",get:function(){return this.layer.x}},{key:"layerY",get:function(){return this.layer.y}},{key:"pageX",get:function(){return this.page.x}},{key:"pageY",get:function(){return this.page.y}},{key:"x",get:function(){return this.canvas.x}},{key:"y",get:function(){return this.canvas.y}},{key:"canvasX",get:function(){return this.canvas.x}},{key:"canvasY",get:function(){return this.canvas.y}},{key:"viewportX",get:function(){return this.viewport.x}},{key:"viewportY",get:function(){return this.viewport.y}},{key:"composedPath",value:function(){return!this.manager||this.path&&this.path[0]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}},{key:"propagationPath",get:function(){return this.composedPath()}},{key:"preventDefault",value:function(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}},{key:"stopImmediatePropagation",value:function(){this.propagationImmediatelyStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"initEvent",value:function(){}},{key:"initUIEvent",value:function(){}},{key:"clone",value:function(){throw new Error(Ce)}}])}(),Fi=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).client=new Ae,e.movement=new Ae,e.offset=new Ae,e.global=new Ae,e.screen=new Ae,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clientX",get:function(){return this.client.x}},{key:"clientY",get:function(){return this.client.y}},{key:"movementX",get:function(){return this.movement.x}},{key:"movementY",get:function(){return this.movement.y}},{key:"offsetX",get:function(){return this.offset.x}},{key:"offsetY",get:function(){return this.offset.y}},{key:"globalX",get:function(){return this.global.x}},{key:"globalY",get:function(){return this.global.y}},{key:"screenX",get:function(){return this.screen.x}},{key:"screenY",get:function(){return this.screen.y}},{key:"getModifierState",value:function(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}},{key:"initMouseEvent",value:function(){throw new Error(Ce)}}])}(wi),Ui=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).width=0,e.height=0,e.isPrimary=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getCoalescedEvents",value:function(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}},{key:"getPredictedEvents",value:function(){throw new Error("getPredictedEvents is not supported!")}},{key:"clone",value:function(){return this.manager.clonePointerEvent(this)}}])}(Fi),Gi=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return this.manager.cloneWheelEvent(this)}}])}(Fi),Zi=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t,[null])).type=e,r.detail=n,Object.assign(r,n),r}return(0,l.Z)(t,e),(0,a.Z)(t)}(wi),Vi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.emitter=new d.Z}),[{key:"on",value:function(e,t,n){return this.addEventListener(e,t,n),this}},{key:"addEventListener",value:function(e,t,n){var r=!1,i=!1;if((0,F.Z)(n))r=n;else if(n){var a=n.capture;r=void 0!==a&&a;var o=n.once;i=void 0!==o&&o}r&&(e+="capture"),t=(0,U.Z)(t)?t:t.handleEvent;var s=(0,U.Z)(t)?void 0:t;return i?this.emitter.once(e,t,s):this.emitter.on(e,t,s),this}},{key:"off",value:function(e,t,n){return e?this.removeEventListener(e,t,n):this.removeAllEventListeners(),this}},{key:"removeAllEventListeners",value:function(){var e;null===(e=this.emitter)||void 0===e||e.removeAllListeners()}},{key:"removeEventListener",value:function(e,t,n){var r;if(!this.emitter)return this;((0,F.Z)(n)?n:null==n?void 0:n.capture)&&(e+="capture"),t=(0,U.Z)(t)?t:null===(r=t)||void 0===r?void 0:r.handleEvent;var i=(0,U.Z)(t)?void 0:t;return this.emitter.off(e,t,i),this}},{key:"emit",value:function(e,t){this.dispatchEvent(new Zi(e,t))}},{key:"dispatchEventToSelf",value:function(e){e.target||(e.target=this),e.currentTarget=this,this.emitter.emit(e.type,e)}},{key:"dispatchEvent",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(r)return this.dispatchEventToSelf(e),!0;if(this.document)t=this;else if(this.defaultView)t=this.defaultView;else{var i;t=null===(i=this.ownerDocument)||void 0===i?void 0:i.defaultView}if(t){if(e.manager=t.getEventService(),!e.manager)return!1;e.defaultPrevented=!1,e.path?e.path.length=0:e.page=[],n||(e.target=this),e.manager.dispatchEvent(e,e.type,n)}else this.dispatchEventToSelf(e);return!e.defaultPrevented}}])}(),Xi=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).shadow=!1,e.ownerDocument=null,e.isConnected=!1,e.baseURI="",e.childNodes=[],e.nodeType=0,e.nodeName="",e.nodeValue=null,e.parentNode=null,e.destroyed=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"textContent",get:function(){var e="";this.nodeName===he.TEXT&&(e+=this.style.text);var t,n=(0,le.Z)(this.childNodes);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.nodeName===he.TEXT?e+=r.nodeValue:e+=r.textContent}}catch(e){n.e(e)}finally{n.f()}return e},set:function(e){var t=this;this.childNodes.slice().forEach((function(e){t.removeChild(e)})),this.nodeName===he.TEXT&&(this.style.text="".concat(e))}},{key:"getRootNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.parentNode?this.parentNode.getRootNode(e):e.composed&&this.host?this.host.getRootNode(e):this}},{key:"hasChildNodes",value:function(){return this.childNodes.length>0}},{key:"isDefaultNamespace",value:function(e){throw new Error(Ce)}},{key:"lookupNamespaceURI",value:function(e){throw new Error(Ce)}},{key:"lookupPrefix",value:function(e){throw new Error(Ce)}},{key:"normalize",value:function(){throw new Error(Ce)}},{key:"isEqualNode",value:function(e){return this===e}},{key:"isSameNode",value:function(e){return this.isEqualNode(e)}},{key:"parent",get:function(){return this.parentNode}},{key:"parentElement",get:function(){return null}},{key:"nextSibling",get:function(){return null}},{key:"previousSibling",get:function(){return null}},{key:"firstChild",get:function(){return this.childNodes.length>0?this.childNodes[0]:null}},{key:"lastChild",get:function(){return this.childNodes.length>0?this.childNodes[this.childNodes.length-1]:null}},{key:"compareDocumentPosition",value:function(e){if(e===this)return 0;for(var n=e,r=this,i=[n],a=[r];null!==(o=n.parentNode)&&void 0!==o?o:r.parentNode;){var o;n=n.parentNode?(i.push(n.parentNode),n.parentNode):n,r=r.parentNode?(a.push(r.parentNode),r.parentNode):r}if(n!==r)return t.DOCUMENT_POSITION_DISCONNECTED|t.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC|t.DOCUMENT_POSITION_PRECEDING;var s=i.length>a.length?i:a,l=s===i?a:i;if(s[s.length-l.length]===l[0])return s===i?t.DOCUMENT_POSITION_CONTAINED_BY|t.DOCUMENT_POSITION_FOLLOWING:t.DOCUMENT_POSITION_CONTAINS|t.DOCUMENT_POSITION_PRECEDING;for(var u=s.length-l.length,c=l.length-1;c>=0;c--){var h=l[c],d=s[u+c];if(d!==h){var f=h.parentNode.childNodes;return f.indexOf(h)<f.indexOf(d)?l===i?t.DOCUMENT_POSITION_PRECEDING:t.DOCUMENT_POSITION_FOLLOWING:s===i?t.DOCUMENT_POSITION_PRECEDING:t.DOCUMENT_POSITION_FOLLOWING}}return t.DOCUMENT_POSITION_FOLLOWING}},{key:"contain",value:function(e){return this.contains(e)}},{key:"contains",value:function(e){for(var t=e;t&&this!==t;)t=t.parentNode;return!!t}},{key:"getAncestor",value:function(e){for(var t=this;e>0&&t;)t=t.parentNode,e--;return t}},{key:"forEach",value:function(e){for(var t=[this];t.length>0;){var n=t.pop();if(!1===e(n))break;for(var r=n.childNodes.length-1;r>=0;r--)t.push(n.childNodes[r])}}}],[{key:"isNode",value:function(e){return!!e.childNodes}}])}(Vi);Xi.DOCUMENT_POSITION_DISCONNECTED=1,Xi.DOCUMENT_POSITION_PRECEDING=2,Xi.DOCUMENT_POSITION_FOLLOWING=4,Xi.DOCUMENT_POSITION_CONTAINS=8,Xi.DOCUMENT_POSITION_CONTAINED_BY=16,Xi.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32;var Wi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"getOrCreateCanvas",value:function(e,t){if(this.canvas)return this.canvas;if(e||Aa.offscreenCanvas)this.canvas=e||Aa.offscreenCanvas,this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t));else try{this.canvas=new window.OffscreenCanvas(0,0),this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t)),this.context&&this.context.measureText||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"))}catch(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t))}return this.canvas.width=10,this.canvas.height=10,this.canvas}},{key:"getOrCreateContext",value:function(e,t){return this.context||this.getOrCreateCanvas(e,t),this.context}}],[{key:"createCanvas",value:function(){try{return new window.OffscreenCanvas(0,0)}catch(e){}try{return document.createElement("canvas")}catch(e){}return null}}])}(),Hi=/\[\s*(.*)=(.*)\s*\]/,Yi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"selectOne",value:function(e,t){var n=this;if(e.startsWith("."))return t.find((function(t){return((null==t?void 0:t.classList)||[]).indexOf(n.getIdOrClassname(e))>-1}));if(e.startsWith("#"))return t.find((function(t){return t.id===n.getIdOrClassname(e)}));if(e.startsWith("[")){var r=this.getAttribute(e),i=r.name,a=r.value;return i?t.find((function(e){return t!==e&&("name"===i?e.name===a:n.attributeToString(e,i)===a)})):null}return t.find((function(n){return t!==n&&n.nodeName===e}))}},{key:"selectAll",value:function(e,t){var n=this;if(e.startsWith("."))return t.findAll((function(r){return t!==r&&((null==r?void 0:r.classList)||[]).indexOf(n.getIdOrClassname(e))>-1}));if(e.startsWith("#"))return t.findAll((function(r){return t!==r&&r.id===n.getIdOrClassname(e)}));if(e.startsWith("[")){var r=this.getAttribute(e),i=r.name,a=r.value;return i?t.findAll((function(e){return t!==e&&("name"===i?e.name===a:n.attributeToString(e,i)===a)})):[]}return t.findAll((function(n){return t!==n&&n.nodeName===e}))}},{key:"is",value:function(e,t){if(e.startsWith("."))return t.className===this.getIdOrClassname(e);if(e.startsWith("#"))return t.id===this.getIdOrClassname(e);if(e.startsWith("[")){var n=this.getAttribute(e),r=n.name,i=n.value;return"name"===r?t.name===i:this.attributeToString(t,r)===i}return t.nodeName===e}},{key:"getIdOrClassname",value:function(e){return e.substring(1)}},{key:"getAttribute",value:function(e){var t=e.match(Hi),n="",r="";return t&&t.length>2&&(n=t[1].replace(/"/g,""),r=t[2].replace(/"/g,"")),{name:n,value:r}}},{key:"attributeToString",value:function(e,t){if(!e.getAttribute)return"";var n=e.getAttribute(t);return(0,T.Z)(n)?"":n.toString?n.toString():""}}])}(),zi=function(e){return e.ATTR_MODIFIED="DOMAttrModified",e.INSERTED="DOMNodeInserted",e.MOUNTED="DOMNodeInsertedIntoDocument",e.REMOVED="removed",e.UNMOUNTED="DOMNodeRemovedFromDocument",e.REPARENT="reparent",e.DESTROY="destroy",e.BOUNDS_CHANGED="bounds-changed",e.CULLED="culled",e}({}),Ki=function(e){function t(e,n,r,i,a,l,u,c){var h;return(0,o.Z)(this,t),(h=(0,s.Z)(this,t,[null])).relatedNode=n,h.prevValue=r,h.newValue=i,h.attrName=a,h.attrChange=l,h.prevParsedValue=u,h.newParsedValue=c,h.type=e,h}return(0,l.Z)(t,e),(0,a.Z)(t)}(wi);Ki.ADDITION=2,Ki.MODIFICATION=1,Ki.REMOVAL=3;var ji,qi,Qi,$i=new Ki(zi.REPARENT,null,"","","",0,"",""),Ji=y.create(),ea=f.create(),ta=f.fromValues(1,1,1),na=v.create(),ra=y.create(),ia=f.create(),aa=v.create(),oa=m.create(),sa=f.create(),la=m.create(),ua=f.create(),ca=f.create(),ha=f.create(),da=v.create(),fa=m.create(),pa=m.create(),va=m.create(),ga={affectChildren:!0},ma=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.pendingEvents=new Map,this.boundsChangedEvent=new Zi(zi.BOUNDS_CHANGED),this.displayObjectDependencyMap=new WeakMap,this.runtime=t}),[{key:"matches",value:function(e,t){return this.runtime.sceneGraphSelector.is(e,t)}},{key:"querySelector",value:function(e,t){return this.runtime.sceneGraphSelector.selectOne(e,t)}},{key:"querySelectorAll",value:function(e,t){return this.runtime.sceneGraphSelector.selectAll(e,t)}},{key:"attach",value:function(e,t,n){var r,i=!1;e.parentNode&&(i=e.parentNode!==t,this.detach(e));var a=e.nodeName===he.FRAGMENT,o=Jr(t);e.parentNode=t;var s=a?e.childNodes:[e];(0,E.Z)(n)?s.forEach((function(e){t.childNodes.splice(n,0,e),e.parentNode=t})):s.forEach((function(e){t.childNodes.push(e),e.parentNode=t}));var l=t.sortable;if((null!=l&&null!==(r=l.sorted)&&void 0!==r&&r.length||l.dirty||e.parsedStyle.zIndex)&&(-1===l.dirtyChildren.indexOf(e)&&l.dirtyChildren.push(e),l.dirty=!0,l.dirtyReason=qe.ADDED),!o){if(a)this.dirtifyFragment(e);else{var u=e.transformable;u&&this.dirtyWorldTransform(e,u)}if(i){var c,h=!0===(null===(c=t.ownerDocument)||void 0===c||null===(c=c.defaultView)||void 0===c||null===(c=c.getConfig())||void 0===c||null===(c=c.future)||void 0===c?void 0:c.experimentalCancelEventPropagation);e.dispatchEvent($i,h,h)}}}},{key:"detach",value:function(e){var t,n;if(e.parentNode){var r=e.transformable,i=e.parentNode.sortable;(null!=i&&null!==(t=i.sorted)&&void 0!==t&&t.length||null!==(n=e.style)&&void 0!==n&&n.zIndex)&&(-1===i.dirtyChildren.indexOf(e)&&i.dirtyChildren.push(e),i.dirty=!0,i.dirtyReason=qe.REMOVED);var a=e.parentNode.childNodes.indexOf(e);a>-1&&e.parentNode.childNodes.splice(a,1),r&&this.dirtyWorldTransform(e,r),e.parentNode=null}}},{key:"getLocalPosition",value:function(e){return e.transformable.localPosition}},{key:"getLocalRotation",value:function(e){return e.transformable.localRotation}},{key:"getLocalScale",value:function(e){return e.transformable.localScale}},{key:"getLocalSkew",value:function(e){return e.transformable.localSkew}},{key:"getLocalTransform",value:function(e){var t=e.transformable;return et(t),t.localTransform}},{key:"setLocalPosition",value:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.transformable;ca[0]=t[0],ca[1]=t[1],ca[2]=null!==(n=t[2])&&void 0!==n?n:0,f.equals(i.localPosition,ca)||(f.copy(i.localPosition,ca),r&&this.dirtyLocalTransform(e,i))}},{key:"translateLocal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;f.equals(t,ea)||(f.transformQuat(t,t,i.localRotation),f.add(i.localPosition,i.localPosition,t),this.dirtyLocalTransform(e,i))}},{key:"setLocalRotation",value:function(e,t,n,r,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];"number"==typeof t&&(t=m.set(oa,t,n,r,i));var o=e.transformable;m.copy(o.localRotation,t),a&&this.dirtyLocalTransform(e,o)}},{key:"rotateLocal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;m.fromEuler(pa,t[0],t[1],t[2]),m.mul(i.localRotation,i.localRotation,pa),this.dirtyLocalTransform(e,i)}},{key:"setLocalScale",value:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.transformable;f.set(ia,t[0],t[1],null!==(n=t[2])&&void 0!==n?n:i.localScale[2]),f.equals(ia,i.localScale)||(f.copy(i.localScale,ia),r&&this.dirtyLocalTransform(e,i))}},{key:"scaleLocal",value:function(e,t){var n,r=e.transformable;f.multiply(r.localScale,r.localScale,f.set(ia,t[0],t[1],null!==(n=t[2])&&void 0!==n?n:1)),this.dirtyLocalTransform(e,r)}},{key:"setLocalSkew",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];"number"==typeof t&&(t=y.set(ra,t,n));var i=e.transformable;y.copy(i.localSkew,t),r&&this.dirtyLocalTransform(e,i)}},{key:"setLocalEulerAngles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];"number"==typeof t&&(t=f.fromValues(t,n,r));var a=e.transformable;m.fromEuler(a.localRotation,t[0],t[1],t[2]),i&&this.dirtyLocalTransform(e,a)}},{key:"setLocalTransform",value:function(e,t){var n=v.getTranslation(sa,t),r=v.getRotation(la,t),i=v.getScaling(ua,t);this.setLocalScale(e,i,!1),this.setLocalPosition(e,n,!1),this.setLocalRotation(e,r,void 0,void 0,void 0,!1),this.dirtyLocalTransform(e,e.transformable)}},{key:"resetLocalTransform",value:function(e){this.setLocalScale(e,ta,!1),this.setLocalPosition(e,ea,!1),this.setLocalEulerAngles(e,ea,void 0,void 0,!1),this.setLocalSkew(e,Ji,void 0,!1),this.dirtyLocalTransform(e,e.transformable)}},{key:"getPosition",value:function(e){var t=e.transformable;return v.getTranslation(t.position,this.getWorldTransform(e,t))}},{key:"getRotation",value:function(e){var t=e.transformable;return v.getRotation(t.rotation,this.getWorldTransform(e,t))}},{key:"getScale",value:function(e){var t=e.transformable;return v.getScaling(t.scaling,this.getWorldTransform(e,t))}},{key:"getOrigin",value:function(e){return e.getGeometryBounds(),e.transformable.origin}},{key:"getWorldTransform",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transformable;return t.localDirtyFlag||t.dirtyFlag?(e.parentNode&&e.parentNode.transformable&&this.getWorldTransform(e.parentNode),this.internalUpdateTransform(e),t.worldTransform):t.worldTransform}},{key:"setPosition",value:function(e,t){var n,r=e.transformable;if(ha[0]=t[0],ha[1]=t[1],ha[2]=null!==(n=t[2])&&void 0!==n?n:0,!f.equals(this.getPosition(e),ha)){if(f.copy(r.position,ha),null!==e.parentNode&&e.parentNode.transformable){var i=e.parentNode.transformable;v.copy(da,i.worldTransform),v.invert(da,da),f.transformMat4(r.localPosition,ha,da)}else f.copy(r.localPosition,ha);this.dirtyLocalTransform(e,r)}}},{key:"translate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.set(ia,t,n,r)),f.equals(t,ea)||(f.add(ia,this.getPosition(e),t),this.setPosition(e,ia))}},{key:"setRotation",value:function(e,t,n,r,i){var a=e.transformable;if("number"==typeof t&&(t=m.fromValues(t,n,r,i)),null!==e.parentNode&&e.parentNode.transformable){var o=this.getRotation(e.parentNode);m.copy(oa,o),m.invert(oa,oa),m.multiply(a.localRotation,oa,t),m.normalize(a.localRotation,a.localRotation),this.dirtyLocalTransform(e,a)}else this.setLocalRotation(e,t)}},{key:"rotate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;if(null!==e.parentNode&&e.parentNode.transformable){var a=oa;m.fromEuler(a,t[0],t[1],t[2]);var o=this.getRotation(e),s=this.getRotation(e.parentNode);m.copy(va,s),m.invert(va,va),m.multiply(a,va,a),m.multiply(i.localRotation,a,o),m.normalize(i.localRotation,i.localRotation),this.dirtyLocalTransform(e,i)}else this.rotateLocal(e,t)}},{key:"setOrigin",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=[t,n,r]);var i=e.transformable;if(t[0]!==i.origin[0]||t[1]!==i.origin[1]||t[2]!==i.origin[2]){var a=i.origin;a[0]=t[0],a[1]=t[1],a[2]=t[2]||0,this.dirtyLocalTransform(e,i)}}},{key:"setEulerAngles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;if(null!==e.parentNode&&e.parentNode.transformable){m.fromEuler(i.localRotation,t[0],t[1],t[2]);var a=this.getRotation(e.parentNode);m.copy(fa,m.invert(oa,a)),m.mul(i.localRotation,i.localRotation,fa),this.dirtyLocalTransform(e,i)}else this.setLocalEulerAngles(e,t)}},{key:"getTransformedGeometryBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.getGeometryBounds(e,t);if(!Te.isEmpty(r)){var i=n||new Te;return i.setFromTransformedAABB(r,this.getWorldTransform(e)),i}return null}},{key:"getGeometryBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e,r=n.geometry;r.dirty&&Aa.styleValueRegistry.updateGeometry(e);var i=t?r.renderBounds:r.contentBounds||null;return i||new Te}},{key:"getBounds",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e,i=r.renderable;if(!i.boundsDirty&&!n&&i.bounds)return i.bounds;if(!i.renderBoundsDirty&&n&&i.renderBounds)return i.renderBounds;var a=n?i.renderBounds:i.bounds,o=this.getTransformedGeometryBounds(e,n,a),s=e.childNodes;if(s.forEach((function(e){var r=t.getBounds(e,n);r&&(o?o.add(r):(o=a||new Te).update(r.center,r.halfExtents))})),o||(o=new Te),n){var l=qr(e);if(l){var u=l.parsedStyle.clipPath.getBounds(n);o?u&&(o=u.intersection(o)):o.update(u.center,u.halfExtents)}}return n?(i.renderBounds=o,i.renderBoundsDirty=!1):(i.bounds=o,i.boundsDirty=!1),o}},{key:"getLocalBounds",value:function(e){if(e.parentNode){var t=na;e.parentNode.transformable&&(t=v.invert(aa,this.getWorldTransform(e.parentNode)));var n=this.getBounds(e);if(!Te.isEmpty(n)){var r=new Te;return r.setFromTransformedAABB(n,t),r}}return this.getBounds(e)}},{key:"getBoundingClientRect",value:function(e){var t,n,r=this.getGeometryBounds(e);Te.isEmpty(r)||(n=new Te).setFromTransformedAABB(r,this.getWorldTransform(e));var i=null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t?void 0:t.getContextService().getBoundingClientRect();if(n){var a=n.getMin(),o=(0,h.Z)(a,2),s=o[0],l=o[1],u=n.getMax(),c=(0,h.Z)(u,2),d=c[0],f=c[1];return new xe(s+((null==i?void 0:i.left)||0),l+((null==i?void 0:i.top)||0),d-s,f-l)}return new xe((null==i?void 0:i.left)||0,(null==i?void 0:i.top)||0,0,0)}},{key:"internalUpdateTransform",value:function(e){var t,n=null===(t=e.parentNode)||void 0===t?void 0:t.transformable;et(e.transformable),function(e,t){e.dirtyFlag&&(t?v.multiply(e.worldTransform,t.worldTransform,e.localTransform):v.copy(e.worldTransform,e.localTransform),e.dirtyFlag=!1)}(e.transformable,n)}},{key:"internalUpdateElement",value:function(e,t){var n,r,i,a,o,s,l=!0===(null===(n=e.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n||null===(n=n.getConfig())||void 0===n||null===(n=n.future)||void 0===n?void 0:n.experimentalAttributeUpdateOptimization),u=t[t.length-1],c=(null==u?void 0:u.transformDirty)||(null===(r=e.transformable)||void 0===r?void 0:r.localDirtyFlag);e.transformable&&((o=e.transformable).dirtyFlag||(o.dirtyFlag=c));(this.internalUpdateTransform(e),c)&&(null===(s=e.dirty)||void 0===s||s.call(e,!0,!0));var h=(null===(i=e.renderable)||void 0===i?void 0:i.boundsDirty)||(null===(a=e.renderable)||void 0===a?void 0:a.renderBoundsDirty);if((c||h)&&!1===(null==u?void 0:u.shapeUpdated)&&l)for(var d=t.length-1;d>=0;){var f,p,v=t[d];if(v.shapeUpdated)break;null===(f=(p=v.node).dirty)||void 0===f||f.call(p,!0,!0),v.shapeUpdated=!0,d-=1}return c}},{key:"syncHierarchy",value:function(e){for(var t,n,r=[e],i=e.parentNode?[{node:e.parentNode,transformDirty:(null===(t=e.parentNode.transformable)||void 0===t?void 0:t.localDirtyFlag)||(null===(n=e.parentNode.transformable)||void 0===n?void 0:n.dirtyFlag),shapeUpdated:!1}]:[];r.length>0;){for(var a=r.pop(),o=i[i.length-1];i.length>0&&a.parentNode!==o.node;)o=i.pop();var s=this.internalUpdateElement(a,i);if(a.childNodes.length>0){for(var l=a.childNodes.length-1;l>=0;l--)r.push(a.childNodes[l]);i.push({node:a,transformDirty:s,shapeUpdated:!1})}}}},{key:"dirtyLocalTransform",value:function(e,t){Jr(e)||t.localDirtyFlag||(t.localDirtyFlag=!0,t.dirtyFlag||this.dirtyWorldTransform(e,t))}},{key:"dirtyWorldTransform",value:function(e,t){this.dirtifyWorldInternal(e,t),this.dirtyToRoot(e,!0)}},{key:"dirtifyWorldInternal",value:function(e,t){var n,r=this,i=!0===(null===(n=e.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n||null===(n=n.getConfig())||void 0===n||null===(n=n.future)||void 0===n?void 0:n.experimentalAttributeUpdateOptimization);t.dirtyFlag||(t.dirtyFlag=!0,e.dirty(!0,!0),i||e.childNodes.forEach((function(e){var t=e.transformable;r.dirtifyWorldInternal(e,t)})))}},{key:"dirtyToRoot",value:function(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e,i=!0===(null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig())||void 0===t||null===(t=t.future)||void 0===t?void 0:t.experimentalAttributeUpdateOptimization);r;){var a,o;if(null===(a=(o=r).dirty)||void 0===a||a.call(o,!0,!0),i)break;r=r.parentNode}n&&e.forEach((function(e){var t;null===(t=e.dirty)||void 0===t||t.call(e,!0,!0)})),this.informDependentDisplayObjects(e),this.pendingEvents.set(e,n)}},{key:"dirtifyFragment",value:function(e){var t,n,r=e.transformable;r&&(r.dirtyFlag=!0,r.localDirtyFlag=!0),null===(t=(n=e).dirty)||void 0===t||t.call(n,!0,!0);for(var i=e.childNodes.length,a=0;a<i;a++)this.dirtifyFragment(e.childNodes[a]);e.nodeName===he.FRAGMENT&&this.pendingEvents.set(e,!1)}},{key:"triggerPendingEvents",value:function(){var e,t,n=this,r=new Set,i=function(t,i){if(t.isConnected&&!r.has(t)&&t.nodeName!==he.FRAGMENT){if(n.boundsChangedEvent.detail=i,n.boundsChangedEvent.target=t,t.isMutationObserved)t.dispatchEvent(n.boundsChangedEvent);else{var a;if(void 0===e)e=!0===(null===(a=t.ownerDocument.defaultView)||void 0===a||null===(a=a.getConfig())||void 0===a||null===(a=a.future)||void 0===a?void 0:a.experimentalCancelEventPropagation);t.ownerDocument.defaultView.dispatchEvent(n.boundsChangedEvent,!0,e)}r.add(t)}};this.pendingEvents.forEach((function(e,n){if(n.nodeName!==he.FRAGMENT){var r;if(void 0===t)t=!0===(null===(r=n.ownerDocument)||void 0===r||null===(r=r.defaultView)||void 0===r||null===(r=r.getConfig())||void 0===r||null===(r=r.future)||void 0===r?void 0:r.experimentalAttributeUpdateOptimization);ga.affectChildren=e,t?i(n,ga):e?n.forEach((function(e){i(e,ga)})):i(n,ga)}})),r.clear(),this.clearPendingEvents()}},{key:"clearPendingEvents",value:function(){this.pendingEvents.clear()}},{key:"updateDisplayObjectDependency",value:function(e,t,n,r){if(t&&t!==n){var i=this.displayObjectDependencyMap.get(t);if(i&&i[e]){var a=i[e].indexOf(r);i[e].splice(a,1)}}if(n){var o=this.displayObjectDependencyMap.get(n);o||(this.displayObjectDependencyMap.set(n,{}),o=this.displayObjectDependencyMap.get(n)),o[e]||(o[e]=[]),o[e].push(r)}}},{key:"informDependentDisplayObjects",value:function(e){var t,n=this,r=this.displayObjectDependencyMap.get(e);if(r){var i=null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig())||void 0===t||null===(t=t.future)||void 0===t?void 0:t.experimentalCancelEventPropagation;Object.keys(r).forEach((function(e){r[e].forEach((function(t){n.dirtyToRoot(t,!0),t.dispatchEvent(new Ki(zi.ATTR_MODIFIED,t,n,n,e,Ki.MODIFICATION,n,n),i,i),t.isCustomElement&&t.isConnected&&t.attributeChangedCallback&&t.attributeChangedCallback(e,n,n)}))}))}}}])}(),ya=function(){return(0,a.Z)((function e(t){if((0,o.Z)(this,e),t<=0)throw new Error("LRU capacity must be a positive number.");this.capacity=t,this.cache=new Map}),[{key:"get",value:function(e){if(this.cache.has(e)){var t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}}},{key:"put",value:function(e,t){if(this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,t),this.cache.size>this.capacity){var n=this.cache.keys().next().value;this.cache.delete(n)}}},{key:"len",value:function(){return this.cache.size}},{key:"clear",value:function(){this.cache.clear()}}])}(),Ea={MetricsString:"|q",BaselineSymbol:"M",BaselineMultiplier:1.4,HeightMultiplier:2,Newlines:[10,13],BreakingSpaces:[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]},_a=/[a-zA-Z0-9\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u00ff!"#$%&'()*+,-./:;]/,Ta=new RegExp("".concat(/[!%),.:;?\]}'""]/.source,"|").concat(/[!),.:;?\]}'""]/.source,"|").concat(/[)\]'"?!:;,.]/.source,"|").concat(/[!%),.:;?\]}'"]/.source)),Ra=new RegExp("".concat(/[$('"]/.source,"|").concat(/[([{'"]/.source,"|").concat(/[(['"...]/.source,"|").concat(/[$([{'"#]/.source)),Sa=function(){return(0,a.Z)((function e(t){var n=this;(0,o.Z)(this,e),this.fontMetricsCache={},this.shouldBreakByKinsokuShorui=function(e,t){return!n.isBreakingSpace(t)&&!(!e||!Ra.exec(t)&&!Ta.exec(e))},this.trimByKinsokuShorui=function(e){var t=(0,c.Z)(e),n=t[t.length-2];if(!n)return e;var r=n[n.length-1];return t[t.length-2]=n.slice(0,-1),t[t.length-1]=r+t[t.length-1],t},this.runtime=t,this.charWidthCache=new ya(100)}),[{key:"measureFont",value:function(e,t){if(this.fontMetricsCache[e])return this.fontMetricsCache[e];var n={ascent:0,descent:0,fontSize:0},r=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(t),i=this.runtime.offscreenCanvasCreator.getOrCreateContext(t,{willReadFrequently:!0});i.font=e;var a=Ea.MetricsString+Ea.BaselineSymbol,o=Math.ceil(i.measureText(a).width),s=Math.ceil(i.measureText(Ea.BaselineSymbol).width),l=Ea.HeightMultiplier*s;s=s*Ea.BaselineMultiplier|0,r.width=o,r.height=l,i.fillStyle="#f00",i.fillRect(0,0,o,l),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(a,0,s);var u=i.getImageData(0,0,o||1,l||1).data,c=u.length,h=4*o,d=0,f=0,p=!1;for(d=0;d<s;++d){for(var v=0;v<h;v+=4)if(255!==u[f+v]){p=!0;break}if(p)break;f+=h}for(n.ascent=s-d,f=c-h,p=!1,d=l;d>s;--d){for(var g=0;g<h;g+=4)if(255!==u[f+g]){p=!0;break}if(p)break;f-=h}return n.descent=d-s,n.fontSize=n.ascent+n.descent,this.fontMetricsCache[e]=n,n}},{key:"measureText",value:function(e,t,n){var r=t.fontSize,i=void 0===r?16:r,a=t.wordWrap,o=void 0!==a&&a,s=t.lineHeight,l=t.lineWidth,u=void 0===l?1:l,c=t.textBaseline,h=void 0===c?"alphabetic":c,d=t.textAlign,f=void 0===d?"start":d,p=t.letterSpacing,v=void 0===p?0:p,g=t.textPath;t.textPathSide,t.textPathStartOffset;var m=t.leading,y=void 0===m?0:m,E=vi(t),_=this.measureFont(E,n);0===_.fontSize&&(_.fontSize=i,_.ascent=i);var T=this.runtime.offscreenCanvasCreator.getOrCreateContext(n);T.font=E,t.isOverflowing=!1;var R=(o?this.wordWrap(e,t,n):e).split(/(?:\r\n|\r|\n)/),S=new Array(R.length),A=0;if(!g){for(var x=0;x<R.length;x++){var C=T.measureText(R[x]).width+(R[x].length-1)*v;S[x]=C,A=Math.max(A,C)}var M=A+u,N=s||_.fontSize+u,k=Math.max(N,_.fontSize+u)+(R.length-1)*(N+y),b=0;return"middle"===h?b=-k/2:"bottom"===h||"alphabetic"===h||"ideographic"===h?b=-k:"top"!==h&&"hanging"!==h||(b=0),{font:E,width:M,height:k,lines:R,lineWidths:S,lineHeight:N+=y,maxLineWidth:A,fontProperties:_,lineMetrics:S.map((function(e,t){var n=0;return"center"===f||"middle"===f?n-=e/2:"right"!==f&&"end"!==f||(n-=e),new xe(n-u/2,b+t*N,e+u,N)}))}}g.getTotalLength();for(var P=0;P<R.length;P++)T.measureText(R[P]).width,R[P].length}},{key:"wordWrap",value:function(e,t,n){var r=this,i=Array.from(e);if(0===i.length)return"";var a=this,o=t.wordWrapWidth,s=void 0===o?0:o,l=t.letterSpacing,u=void 0===l?0:l,c=t.maxLines,h=void 0===c?1/0:c,d=t.textOverflow,f=this.runtime.offscreenCanvasCreator.getOrCreateContext(n),p=s+u,v="";"ellipsis"===d?v="...":d&&"clip"!==d&&(v=d);var g=[""],m=0,y=0,E=-1,_=vi(t),T=this.charWidthCache.get(_);T||(T=new ya(500),this.charWidthCache.put(_,T));var R=function(e){return r.getFromCache(e,u,T,f)},S=R(v);function A(e,t,n,r){for(;R(e)<r&&t<i.length-1&&!a.isNewline(i[t+1]);)e+=i[t+=1];for(;R(e)>r&&t>=n;)t-=1,e=e.slice(0,-1);return{lineTxt:e,txtLastCharIndex:t}}function x(e,t){if(!(S<=0||S>p))if(g[e]){var n=A(g[e],t,E+1,p-S);g[e]=n.lineTxt+v}else g[e]=v}for(var C=0;C<i.length;C++){var M=i[C],N=i[C-1],k=i[C+1],b=R(M);if(this.isNewline(M)){if(m+1>=h){C<i.length-1&&x(m,C-1),t.isOverflowing=!0;break}E=C-1,y=0,g[m+=1]=""}else{if(b>p){x(m,C-1),t.isOverflowing=!0;break}if(y>0&&y+b>p){var P=A(g[m],C-1,E+1,p);if(P.txtLastCharIndex!==C-1){if(g[m]=P.lineTxt,P.txtLastCharIndex===i.length-1)break;C=P.txtLastCharIndex+1,M=i[C],N=i[C-1],k=i[C+1],b=R(M)}if(m+1>=h){x(m,C-1),t.isOverflowing=!0;break}if(E=C-1,y=0,g[m+=1]="",this.isBreakingSpace(M))continue;this.canBreakInLastChar(M)||(g=this.trimToBreakable(g),y=this.sumTextWidthByCache(g[m]||"",R)),this.shouldBreakByKinsokuShorui(M,k)&&(g=this.trimByKinsokuShorui(g),y+=R(N||""))}y+=b,g[m]+=M}}return g.join("\n")}},{key:"isBreakingSpace",value:function(e){return"string"==typeof e&&Ea.BreakingSpaces.indexOf(e.charCodeAt(0))>=0}},{key:"isNewline",value:function(e){return"string"==typeof e&&Ea.Newlines.indexOf(e.charCodeAt(0))>=0}},{key:"trimToBreakable",value:function(e){var t=(0,c.Z)(e),n=t[t.length-2],r=this.findBreakableIndex(n);if(-1===r||!n)return t;var i=n.slice(r,r+1),a=r+1,o=r+(this.isBreakingSpace(i)?0:1);return t[t.length-1]+=n.slice(a,n.length),t[t.length-2]=n.slice(0,o),t}},{key:"canBreakInLastChar",value:function(e){return!e||!_a.test(e)}},{key:"sumTextWidthByCache",value:function(e,t){return e.split("").reduce((function(e,n){return e+t(n)}),0)}},{key:"findBreakableIndex",value:function(e){for(var t=e.length-1;t>=0;t--)if(!_a.test(e[t]))return t;return-1}},{key:"getFromCache",value:function(e,t,n,r){var i=n.get(e);if("number"!=typeof i){var a=e.length*t;i=r.measureText(e).width+a,n.put(e,i)}return i}},{key:"clearCache",value:function(){this.fontMetricsCache={},this.charWidthCache.clear()}}])}(),Aa={},xa=(qi=new Ii,Qi=new Oi,ji={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(ji,he.FRAGMENT,null),he.CIRCLE,new Ni),he.ELLIPSE,new ki),he.RECT,qi),he.IMAGE,qi),he.GROUP,new Li),he.LINE,new bi),he.TEXT,new Di(Aa)),he.POLYLINE,Qi),he.POLYGON,Qi),(0,V.Z)((0,V.Z)((0,V.Z)(ji,he.PATH,new Pi),he.HTML,new Bi),he.MESH,null)),Ca=function(e){var t=new Lr,n=new Fr;return e={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,nt.PERCENTAGE,null),nt.NUMBER,new Vr),nt.ANGLE,new Ir),nt.DEFINED_PATH,new Dr),nt.PAINT,t),nt.COLOR,t),nt.FILTER,new Br),nt.LENGTH,n),nt.LENGTH_PERCENTAGE,n),nt.LENGTH_PERCENTAGE_12,new Ur),(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,nt.LENGTH_PERCENTAGE_14,new Gr),nt.COORDINATE,new Fr),nt.OFFSET_DISTANCE,new Xr),nt.OPACITY_VALUE,new Wr),nt.PATH,new Hr),nt.LIST_OF_POINTS,new Yr),nt.SHADOW_BLUR,new zr),nt.TEXT,new Kr),nt.TEXT_TRANSFORM,new jr),nt.TRANSFORM,new xi),(0,V.Z)((0,V.Z)((0,V.Z)(e,nt.TRANSFORM_ORIGIN,new Ci),nt.Z_INDEX,new Mi),nt.MARKER,new Zr)}();Aa.CameraContribution=Ke,Aa.AnimationTimeline=null,Aa.EasingFunction=null,Aa.offscreenCanvasCreator=new Wi,Aa.sceneGraphSelector=new Yi,Aa.sceneGraphService=new ma(Aa),Aa.textService=new Sa(Aa),Aa.geometryUpdaterFactory=xa,Aa.CSSPropertySyntaxFactory=Ca,Aa.styleValueRegistry=new br(Aa),Aa.layoutRegistry=null,Aa.globalThis="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},Aa.enableStyleSyntax=!0,Aa.enableSizeAttenuation=!1;var Ma=0;var Na=new Ki(zi.INSERTED,null,"","","",0,"",""),ka=new Ki(zi.REMOVED,null,"","","",0,"",""),ba=new Zi(zi.DESTROY),Pa=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).entity=Ma++,e.transformable={dirtyFlag:!1,localDirtyFlag:!1,localPosition:[0,0,0],localRotation:[0,0,0,1],localScale:[1,1,1],localTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],localSkew:[0,0],position:[0,0,0],rotation:[0,0,0,1],scaling:[1,1,1],worldTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],origin:[0,0,0]},e.renderable={bounds:void 0,boundsDirty:!0,renderBounds:void 0,renderBoundsDirty:!0,dirtyRenderBounds:void 0,dirty:!1},e.geometry={contentBounds:void 0,renderBounds:void 0,dirty:!0},e.cullable={strategy:je.Standard,visibilityPlaneMask:-1,visible:!0,enable:!0},e.sortable={dirty:!1,sorted:void 0,renderOrder:0,dirtyChildren:[],dirtyReason:void 0},e.rBushNode={aabb:void 0},e.namespaceURI="g",e.scrollLeft=0,e.scrollTop=0,e.clientTop=0,e.clientLeft=0,e.style={},e.computedStyle={},e.parsedStyle={},e.attributes={},e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"dirty",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.renderable.dirty=e,t&&(this.renderable.boundsDirty=e,this.renderable.renderBoundsDirty=e)}},{key:"className",get:function(){return this.getAttribute("class")||""},set:function(e){this.setAttribute("class",e)}},{key:"classList",get:function(){return this.className.split(" ").filter((function(e){return""!==e}))}},{key:"tagName",get:function(){return this.nodeName}},{key:"children",get:function(){return this.childNodes}},{key:"childElementCount",get:function(){return this.childNodes.length}},{key:"firstElementChild",get:function(){return this.firstChild}},{key:"lastElementChild",get:function(){return this.lastChild}},{key:"parentElement",get:function(){return this.parentNode}},{key:"nextSibling",get:function(){if(this.parentNode){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e+1]||null}return null}},{key:"previousSibling",get:function(){if(this.parentNode){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e-1]||null}return null}},{key:"cloneNode",value:function(e){throw new Error(Ce)}},{key:"appendChild",value:function(e,t){var n;if(e.destroyed)throw new Error("Cannot append a destroyed element.");return Aa.sceneGraphService.attach(e,this,t),null!==(n=this.ownerDocument)&&void 0!==n&&n.defaultView&&(Jr(this)||e.nodeName!==he.FRAGMENT?this.ownerDocument.defaultView.mountChildren(e):this.ownerDocument.defaultView.mountFragment(e)),this.isMutationObserved&&(Na.relatedNode=this,e.dispatchEvent(Na)),e}},{key:"insertBefore",value:function(e,t){if(t){e.parentElement&&e.parentElement.removeChild(e);var n=this.childNodes.indexOf(t);-1===n?this.appendChild(e):this.appendChild(e,n)}else this.appendChild(e);return e}},{key:"replaceChild",value:function(e,t){var n=this.childNodes.indexOf(t);return this.removeChild(t),this.appendChild(e,n),t}},{key:"removeChild",value:function(e){var t,n,r=!0===(null===(t=this.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig().future)||void 0===t?void 0:t.experimentalCancelEventPropagation);return ka.relatedNode=this,e.dispatchEvent(ka,r,r),null!==(n=e.ownerDocument)&&void 0!==n&&n.defaultView&&e.ownerDocument.defaultView.unmountChildren(e),Aa.sceneGraphService.detach(e),e}},{key:"removeChildren",value:function(){for(var e=this.childNodes.length-1;e>=0;e--){var t=this.childNodes[e];this.removeChild(t)}}},{key:"destroyChildren",value:function(){for(var e=this.childNodes.length-1;e>=0;e--){var t=this.childNodes[e];t.childNodes.length>0&&t.destroyChildren(),t.destroy()}}},{key:"matches",value:function(e){return Aa.sceneGraphService.matches(e,this)}},{key:"getElementById",value:function(e){return Aa.sceneGraphService.querySelector("#".concat(e),this)}},{key:"getElementsByName",value:function(e){return Aa.sceneGraphService.querySelectorAll('[name="'.concat(e,'"]'),this)}},{key:"getElementsByClassName",value:function(e){return Aa.sceneGraphService.querySelectorAll(".".concat(e),this)}},{key:"getElementsByTagName",value:function(e){return Aa.sceneGraphService.querySelectorAll(e,this)}},{key:"querySelector",value:function(e){return Aa.sceneGraphService.querySelector(e,this)}},{key:"querySelectorAll",value:function(e){return Aa.sceneGraphService.querySelectorAll(e,this)}},{key:"closest",value:function(e){var t=this;do{if(Aa.sceneGraphService.matches(e,t))return t;t=t.parentElement}while(null!==t);return null}},{key:"find",value:function(e){var t=this,n=null;return this.forEach((function(r){return r===t||!e(r)||(n=r,!1)})),n}},{key:"findAll",value:function(e){var t=this,n=[];return this.forEach((function(r){r!==t&&e(r)&&n.push(r)})),n}},{key:"after",value:function(){var e=this;if(this.parentNode){for(var t=this.parentNode.childNodes.indexOf(this),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r.forEach((function(n,r){var i;return null===(i=e.parentNode)||void 0===i?void 0:i.appendChild(n,t+r+1)}))}}},{key:"before",value:function(){if(this.parentNode){for(var e,t=this.parentNode.childNodes.indexOf(this),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=r[0],o=r.slice(1);this.parentNode.appendChild(a,t),(e=a).after.apply(e,(0,c.Z)(o))}}},{key:"replaceWith",value:function(){this.after.apply(this,arguments),this.remove()}},{key:"append",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){return e.appendChild(t)}))}},{key:"prepend",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t,n){return e.appendChild(t,n)}))}},{key:"replaceChildren",value:function(){for(;this.childNodes.length&&this.firstChild;)this.removeChild(this.firstChild);this.append.apply(this,arguments)}},{key:"remove",value:function(){return this.parentNode?this.parentNode.removeChild(this):this}},{key:"destroy",value:function(){var e,t=!0===(null===(e=this.ownerDocument)||void 0===e||null===(e=e.defaultView)||void 0===e||null===(e=e.getConfig().future)||void 0===e?void 0:e.experimentalCancelEventPropagation);this.destroyChildren(),this.dispatchEvent(ba,t,t),this.remove(),this.emitter.removeAllListeners(),this.destroyed=!0}},{key:"getGeometryBounds",value:function(){return Aa.sceneGraphService.getGeometryBounds(this)}},{key:"getRenderBounds",value:function(){return Aa.sceneGraphService.getBounds(this,!0)}},{key:"getBounds",value:function(){return Aa.sceneGraphService.getBounds(this)}},{key:"getLocalBounds",value:function(){return Aa.sceneGraphService.getLocalBounds(this)}},{key:"getBoundingClientRect",value:function(){return Aa.sceneGraphService.getBoundingClientRect(this)}},{key:"getClientRects",value:function(){return[this.getBoundingClientRect()]}},{key:"computedStyleMap",value:function(){return new Map(Object.entries(this.computedStyle))}},{key:"getAttributeNames",value:function(){return Object.keys(this.attributes)}},{key:"getAttribute",value:function(e){if("symbol"!==i()(e)){var t=this.attributes[e];return t}}},{key:"hasAttribute",value:function(e){return this.getAttributeNames().includes(e)}},{key:"hasAttributes",value:function(){return!!this.getAttributeNames().length}},{key:"removeAttribute",value:function(e){this.setAttribute(e,null),delete this.attributes[e]}},{key:"setAttribute",value:function(e,t,n,r){this.attributes[e]=t}},{key:"getAttributeNS",value:function(e,t){throw new Error(Ce)}},{key:"getAttributeNode",value:function(e){throw new Error(Ce)}},{key:"getAttributeNodeNS",value:function(e,t){throw new Error(Ce)}},{key:"hasAttributeNS",value:function(e,t){throw new Error(Ce)}},{key:"removeAttributeNS",value:function(e,t){throw new Error(Ce)}},{key:"removeAttributeNode",value:function(e){throw new Error(Ce)}},{key:"setAttributeNS",value:function(e,t,n){throw new Error(Ce)}},{key:"setAttributeNode",value:function(e){throw new Error(Ce)}},{key:"setAttributeNodeNS",value:function(e){throw new Error(Ce)}},{key:"toggleAttribute",value:function(e,t){throw new Error(Ce)}}])}(Xi);function Oa(e){return!(null==e||!e.nodeName)}var Ia=Aa.globalThis.Proxy?Aa.globalThis.Proxy:function(){},Da=new Ki(zi.ATTR_MODIFIED,null,null,null,null,Ki.MODIFICATION,null,null),La=f.create(),Ba=m.create(),wa=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).isCustomElement=!1,n.isMutationObserved=!1,n.activeAnimations=[],n.config=e,n.id=e.id||"",n.name=e.name||"",(e.className||e.class)&&(n.className=e.className||e.class),n.nodeName=e.type||he.GROUP,e.initialParsedStyle&&Object.assign(n.parsedStyle,e.initialParsedStyle),n.initAttributes(e.style),Aa.enableStyleSyntax&&(n.style=new Ia({setProperty:function(e,t){n.setAttribute(e,t)},getPropertyValue:function(e){return n.getAttribute(e)},removeProperty:function(e){n.removeAttribute(e)},item:function(){return""}},{get:function(e,t){return void 0!==e[t]?e[t]:n.getAttribute(t)},set:function(e,t,r){return n.setAttribute(t,r),!0}})),n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"destroy",value:function(){(0,X.Z)(t,"destroy",this,3)([]),this.getAnimations().forEach((function(e){e.cancel()}))}},{key:"cloneNode",value:function(e,t){var n=(0,u.Z)({},this.attributes);for(var r in n){var i=n[r];Oa(i)&&"clipPath"!==r&&"offsetPath"!==r&&"textPath"!==r&&(n[r]=i.cloneNode(e)),t&&(n[r]=t(r,i))}var a=new this.constructor((0,u.Z)((0,u.Z)({},this.config),{},{style:n}));return a.setLocalTransform(this.getLocalTransform()),e&&this.children.forEach((function(t){if(!t.style.isMarker){var n=t.cloneNode(e);a.appendChild(n)}})),a}},{key:"initAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={forceUpdateGeometry:!0};Aa.styleValueRegistry.processProperties(this,e,t),this.dirty()}},{key:"setAttribute",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];(0,B.Z)(n)||(r||n!==this.attributes[e])&&(this.internalSetAttribute(e,n,{memoize:i}),(0,X.Z)(t,"setAttribute",this,3)([e,n]))}},{key:"internalSetAttribute",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.attributes[e],i=this.parsedStyle[e];Aa.styleValueRegistry.processProperties(this,(0,V.Z)({},e,t),n),this.dirty();var a,o,s=this.parsedStyle[e];if(this.isConnected)if(Da.relatedNode=this,Da.prevValue=r,Da.newValue=t,Da.attrName=e,Da.prevParsedValue=i,Da.newParsedValue=s,this.isMutationObserved)this.dispatchEvent(Da);else{var l,u=!0===(null===(l=this.ownerDocument.defaultView.getConfig().future)||void 0===l?void 0:l.experimentalCancelEventPropagation);Da.target=this,this.ownerDocument.defaultView.dispatchEvent(Da,!0,u)}(this.isCustomElement&&this.isConnected||!this.isCustomElement)&&(null===(a=(o=this).attributeChangedCallback)||void 0===a||a.call(o,e,r,t,i,s))}},{key:"getBBox",value:function(){var e=this.getBounds(),t=e.getMin(),n=(0,h.Z)(t,2),r=n[0],i=n[1],a=e.getMax(),o=(0,h.Z)(a,2),s=o[0],l=o[1];return new xe(r,i,s-r,l-i)}},{key:"setOrigin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Aa.sceneGraphService.setOrigin(this,ke(e,t,n,!1)),this}},{key:"getOrigin",value:function(){return Aa.sceneGraphService.getOrigin(this)}},{key:"setPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Aa.sceneGraphService.setPosition(this,ke(e,t,n,!1)),this}},{key:"setLocalPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Aa.sceneGraphService.setLocalPosition(this,ke(e,t,n,!1)),this}},{key:"translate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Aa.sceneGraphService.translate(this,ke(e,t,n,!1)),this}},{key:"translateLocal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Aa.sceneGraphService.translateLocal(this,ke(e,t,n,!1)),this}},{key:"getPosition",value:function(){return Aa.sceneGraphService.getPosition(this)}},{key:"getLocalPosition",value:function(){return Aa.sceneGraphService.getLocalPosition(this)}},{key:"scale",value:function(e,t,n){return this.scaleLocal(e,t,n)}},{key:"scaleLocal",value:function(e,t,n){return"number"==typeof e&&(e=ke(e,t=t||e,n=n||e,!1)),Aa.sceneGraphService.scaleLocal(this,e),this}},{key:"setLocalScale",value:function(e,t,n){return"number"==typeof e&&(e=ke(e,t=t||e,n=n||e,!1)),Aa.sceneGraphService.setLocalScale(this,e),this}},{key:"getLocalScale",value:function(){return Aa.sceneGraphService.getLocalScale(this)}},{key:"getScale",value:function(){return Aa.sceneGraphService.getScale(this)}},{key:"getEulerAngles",value:function(){var e=Le(La,Aa.sceneGraphService.getWorldTransform(this));return Ie((0,h.Z)(e,3)[2])}},{key:"getLocalEulerAngles",value:function(){var e=Le(La,Aa.sceneGraphService.getLocalRotation(this));return Ie((0,h.Z)(e,3)[2])}},{key:"setEulerAngles",value:function(e){return Aa.sceneGraphService.setEulerAngles(this,0,0,e),this}},{key:"setLocalEulerAngles",value:function(e){return Aa.sceneGraphService.setLocalEulerAngles(this,0,0,e),this}},{key:"rotateLocal",value:function(e,t,n){return(0,T.Z)(t)&&(0,T.Z)(n)?Aa.sceneGraphService.rotateLocal(this,0,0,e):Aa.sceneGraphService.rotateLocal(this,e,t,n),this}},{key:"rotate",value:function(e,t,n){return(0,T.Z)(t)&&(0,T.Z)(n)?Aa.sceneGraphService.rotate(this,0,0,e):Aa.sceneGraphService.rotate(this,e,t,n),this}},{key:"setRotation",value:function(e,t,n,r){return Aa.sceneGraphService.setRotation(this,e,t,n,r),this}},{key:"setLocalRotation",value:function(e,t,n,r){return Aa.sceneGraphService.setLocalRotation(this,e,t,n,r),this}},{key:"setLocalSkew",value:function(e,t){return Aa.sceneGraphService.setLocalSkew(this,e,t),this}},{key:"getRotation",value:function(){return Aa.sceneGraphService.getRotation(this)}},{key:"getLocalRotation",value:function(){return Aa.sceneGraphService.getLocalRotation(this)}},{key:"getLocalSkew",value:function(){return Aa.sceneGraphService.getLocalSkew(this)}},{key:"getLocalTransform",value:function(){return Aa.sceneGraphService.getLocalTransform(this)}},{key:"getWorldTransform",value:function(){return Aa.sceneGraphService.getWorldTransform(this)}},{key:"setLocalTransform",value:function(e){return Aa.sceneGraphService.setLocalTransform(this,e),this}},{key:"resetLocalTransform",value:function(){Aa.sceneGraphService.resetLocalTransform(this)}},{key:"getAnimations",value:function(){return this.activeAnimations}},{key:"animate",value:function(e,t){var n,r=null===(n=this.ownerDocument)||void 0===n?void 0:n.timeline;return r?r.play(this,e,t):null}},{key:"isVisible",value:function(){var e;return"hidden"!==(null===(e=this.parsedStyle)||void 0===e?void 0:e.visibility)}},{key:"interactive",get:function(){return this.isInteractive()},set:function(e){this.style.pointerEvents=e?"auto":"none"}},{key:"isInteractive",value:function(){var e;return"none"!==(null===(e=this.parsedStyle)||void 0===e?void 0:e.pointerEvents)}},{key:"isCulled",value:function(){return!(!this.cullable||!this.cullable.enable||this.cullable.visible)}},{key:"toFront",value:function(){return this.parentNode&&(this.style.zIndex=Math.max.apply(Math,(0,c.Z)(this.parentNode.children.map((function(e){return Number(e.style.zIndex)}))))+1),this}},{key:"toBack",value:function(){return this.parentNode&&(this.style.zIndex=Math.min.apply(Math,(0,c.Z)(this.parentNode.children.map((function(e){return Number(e.style.zIndex)}))))-1),this}},{key:"getConfig",value:function(){return this.config}},{key:"attr",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[0],a=n[1];return i?(0,G.Z)(i)?(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),this):2===n.length?(this.setAttribute(i,a),this):this.attributes[i]:this.attributes}},{key:"getMatrix",value:function(e){var t=e||this.getWorldTransform(),n=v.getTranslation(La,t),r=(0,h.Z)(n,2),i=r[0],a=r[1],o=v.getScaling(La,t),s=(0,h.Z)(o,2),l=s[0],u=s[1],c=v.getRotation(Ba,t),d=Le(La,c),f=(0,h.Z)(d,3),p=f[0],m=f[2];return function(e,t,n,r,i){var a=Math.cos(e),o=Math.sin(e);return g.fromValues(r*a,i*o,0,-r*o,i*a,0,t,n,1)}(p||m,i,a,l,u)}},{key:"getLocalMatrix",value:function(){return this.getMatrix(this.getLocalTransform())}},{key:"setMatrix",value:function(e){var t=Be(e),n=(0,h.Z)(t,5),r=n[0],i=n[1],a=n[2],o=n[3],s=n[4];this.setEulerAngles(s).setPosition(r,i).setLocalScale(a,o)}},{key:"setLocalMatrix",value:function(e){var t=Be(e),n=(0,h.Z)(t,5),r=n[0],i=n[1],a=n[2],o=n[3],s=n[4];this.setLocalEulerAngles(s).setLocalPosition(r,i).setLocalScale(a,o)}},{key:"show",value:function(){this.forEach((function(e){e.style.visibility="visible"}))}},{key:"hide",value:function(){this.forEach((function(e){e.style.visibility="hidden"}))}},{key:"getCount",value:function(){return this.childElementCount}},{key:"getParent",value:function(){return this.parentElement}},{key:"getChildren",value:function(){return this.children}},{key:"getFirst",value:function(){return this.firstElementChild}},{key:"getLast",value:function(){return this.lastElementChild}},{key:"getChildByIndex",value:function(e){return this.children[e]||null}},{key:"add",value:function(e,t){return this.appendChild(e,t)}},{key:"set",value:function(e,t){this.config[e]=t}},{key:"get",value:function(e){return this.config[e]}},{key:"moveTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.setPosition(e,t,n),this}},{key:"move",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.setPosition(e,t,n),this}},{key:"setZIndex",value:function(e){return this.style.zIndex=e,this}}])}(Pa);wa.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","display","draggable","droppable","fill","fillOpacity","fillRule","filter","increasedLineWidthForHitTesting","lineCap","lineDash","lineDashOffset","lineJoin","lineWidth","miterLimit","hitArea","offsetDistance","offsetPath","offsetX","offsetY","opacity","pointerEvents","shadowColor","shadowType","shadowBlur","shadowOffsetX","shadowOffsetY","stroke","strokeOpacity","strokeWidth","strokeLinecap","strokeLineJoin","strokeDasharray","strokeDashoffset","transform","transformOrigin","textTransform","visibility","zIndex"]);var Fa=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.CIRCLE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa);Fa.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["cx","cy","cz","r","isBillboard","isSizeAttenuation"]));var Ua=["style"],Ga=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,ue.Z)(n,Ua);return(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({style:r},i)])).isCustomElement=!0,e}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa);Ga.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","draggable","droppable","opacity","pointerEvents","transform","transformOrigin","zIndex","visibility"]);var Za=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.ELLIPSE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa);Za.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["cx","cy","cz","rx","ry","isBillboard","isSizeAttenuation"])),(function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,[{type:he.FRAGMENT}])}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa)).PARSED_STYLE_LIST=new Set(["class","className"]);var Va=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.GROUP},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa);Va.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","draggable","droppable","opacity","pointerEvents","transform","transformOrigin","zIndex","visibility"]);var Xa=["style"],Wa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,ue.Z)(n,Xa);return(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:he.HTML,style:r},i)])).cullable.enable=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDomElement",value:function(){return this.parsedStyle.$el}},{key:"getClientRects",value:function(){return[this.getBoundingClientRect()]}},{key:"getLocalBounds",value:function(){if(this.parentNode){var e=v.invert(v.create(),this.parentNode.getWorldTransform()),t=this.getBounds();if(!Te.isEmpty(t)){var n=new Te;return n.setFromTransformedAABB(t,e),n}}return this.getBounds()}}])}(wa);Wa.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["x","y","$el","innerHTML","width","height"]));var Ha=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.IMAGE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa);Ha.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["x","y","z","src","width","height","isBillboard","billboardRotation","isSizeAttenuation","keepAspectRatio"]));var Ya=["style"],za=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,ue.Z)(n,Ya);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:he.LINE,style:(0,u.Z)({x1:0,y1:0,x2:0,y2:0,z1:0,z2:0},r)},i)])).markerStartAngle=0,e.markerEndAngle=0;var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd;return l&&Oa(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),c&&Oa(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"x1"===e||"y1"===e||"x2"===e||"y2"===e||"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&Oa(r)&&(this.markerStartAngle=0,r.remove()),i&&Oa(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e&&(r&&Oa(r)&&(this.markerEndAngle=0,r.remove()),i&&Oa(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1)))}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=t.x1,s=t.x2,l=t.y1,u=t.y2,c=e?n:r;if(c&&Oa(c)){var h,d,f,p,v,g,m;e?(p=o,v=l,d=s-o,f=u-l,g=i||0,m=this.markerStartAngle):(p=s,v=u,d=o-s,f=l-u,g=a||0,m=this.markerEndAngle),h=Math.atan2(f,d),c.setLocalEulerAngles(180*h/Math.PI+m),c.setLocalPosition(p+Math.cos(h)*g,v+Math.sin(h)*g)}}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle,r=n.x1,i=n.y1,a=n.x2,o=n.y2,s=Q(r,i,a,o,e),l=s.x,u=s.y,c=f.transformMat4(f.create(),f.fromValues(l,u,0),t?this.getWorldTransform():this.getLocalTransform());return new Ae(c[0],c[1])}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPoint(e/this.getTotalLength(),t)}},{key:"getTotalLength",value:function(){var e=this.parsedStyle;return q(e.x1,e.y1,e.x2,e.y2)}}])}(wa);za.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["x1","y1","x2","y2","z1","z2","isBillboard","isSizeAttenuation","markerStart","markerEnd","markerStartOffset","markerEndOffset"]));var Ka=["style"],ja=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,ue.Z)(n,Ka);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:he.PATH,style:r,initialParsedStyle:{miterLimit:4,d:(0,u.Z)({},tt)}},i)])).markerStartAngle=0,e.markerEndAngle=0,e.markerMidList=[];var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd,h=a.markerMid;return l&&Oa(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),h&&Oa(h)&&e.placeMarkerMid(h),c&&Oa(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"d"===e?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&Oa(r)&&(this.markerStartAngle=0,r.remove()),i&&Oa(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e?(r&&Oa(r)&&(this.markerEndAngle=0,r.remove()),i&&Oa(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1))):"markerMid"===e&&this.placeMarkerMid(i)}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=e?n:r;if(o&&Oa(o)){var s,l,u,c,d,f,p;if(e){var v=this.getStartTangent(),g=(0,h.Z)(v,2),m=g[0],y=g[1];c=y[0],d=y[1],l=m[0]-y[0],u=m[1]-y[1],f=i||0,p=this.markerStartAngle}else{var E=this.getEndTangent(),_=(0,h.Z)(E,2),T=_[0],R=_[1];c=R[0],d=R[1],l=T[0]-R[0],u=T[1]-R[1],f=a||0,p=this.markerEndAngle}s=Math.atan2(u,l),o.setLocalEulerAngles(180*s/Math.PI+p),o.setLocalPosition(c+Math.cos(s)*f,d+Math.sin(s)*f)}}},{key:"placeMarkerMid",value:function(e){var t=this.parsedStyle.d.segments;if(this.markerMidList.forEach((function(e){e.remove()})),e&&Oa(e))for(var n=1;n<t.length-1;n++){var r=(0,h.Z)(t[n].currentPoint,2),i=r[0],a=r[1],o=1===n?e:e.cloneNode(!0);this.markerMidList.push(o),this.appendChild(o),o.setLocalPosition(i,a)}}},{key:"getTotalLength",value:function(){return Wn(this)}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle.d.absolutePath,r=(0,Z.r)(n,e),i=r.x,a=r.y,o=f.transformMat4(f.create(),f.fromValues(i,a,0),t?this.getWorldTransform():this.getLocalTransform());return new Ae(o[0],o[1])}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPointAtLength(e*Wn(this),t)}},{key:"getStartTangent",value:function(){var e=this.parsedStyle.d.segments,t=[];if(e.length>1){var n=e[0].currentPoint,r=e[1].currentPoint,i=e[1].startTangent;t=[],i?(t.push([n[0]-i[0],n[1]-i[1]]),t.push([n[0],n[1]])):(t.push([r[0],r[1]]),t.push([n[0],n[1]]))}return t}},{key:"getEndTangent",value:function(){var e=this.parsedStyle.d.segments,t=e.length,n=[];if(t>1){var r=e[t-2].currentPoint,i=e[t-1].currentPoint,a=e[t-1].endTangent;n=[],a?(n.push([i[0]-a[0],i[1]-a[1]]),n.push([i[0],i[1]])):(n.push([r[0],r[1]]),n.push([i[0],i[1]]))}return n}}])}(wa);ja.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["d","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isBillboard","isSizeAttenuation"]));var qa=["style"],Qa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,ue.Z)(n,qa);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:he.POLYGON,style:r,initialParsedStyle:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!0}},i)])).markerStartAngle=0,e.markerEndAngle=0,e.markerMidList=[];var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd,h=a.markerMid;return l&&Oa(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),h&&Oa(h)&&e.placeMarkerMid(h),c&&Oa(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"points"===e?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&Oa(r)&&(this.markerStartAngle=0,r.remove()),i&&Oa(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e?(r&&Oa(r)&&(this.markerEndAngle=0,r.remove()),i&&Oa(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1))):"markerMid"===e&&this.placeMarkerMid(i)}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=(t.points||{}).points,s=e?n:r;if(s&&Oa(s)&&o){var l,u,c,h,d,f,p;if(h=o[0][0],d=o[0][1],e)u=o[1][0]-o[0][0],c=o[1][1]-o[0][1],f=i||0,p=this.markerStartAngle;else{var v=o.length;this.parsedStyle.isClosed?(u=o[v-1][0]-o[0][0],c=o[v-1][1]-o[0][1]):(h=o[v-1][0],d=o[v-1][1],u=o[v-2][0]-o[v-1][0],c=o[v-2][1]-o[v-1][1]),f=a||0,p=this.markerEndAngle}l=Math.atan2(c,u),s.setLocalEulerAngles(180*l/Math.PI+p),s.setLocalPosition(h+Math.cos(l)*f,d+Math.sin(l)*f)}}},{key:"placeMarkerMid",value:function(e){var t=(this.parsedStyle.points||{}).points;if(this.markerMidList.forEach((function(e){e.remove()})),this.markerMidList=[],e&&Oa(e)&&t)for(var n=1;n<(this.parsedStyle.isClosed?t.length:t.length-1);n++){var r=t[n][0],i=t[n][1],a=1===n?e:e.cloneNode(!0);this.markerMidList.push(a),this.appendChild(a),a.setLocalPosition(r,i)}}}])}(wa);Qa.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["points","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isClosed","isBillboard","isSizeAttenuation"]));var $a=["style"],Ja=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,ue.Z)(e,$a);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.POLYLINE,style:n,initialParsedStyle:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!1}},r)])}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getTotalLength",value:function(){return Hn(this)}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPoint(e/this.getTotalLength(),t)}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle.points.points;if(0===this.parsedStyle.points.segments.length){var r,i,a=[],o=0,s=this.getTotalLength();n.forEach((function(e,t){n[t+1]&&((r=[0,0])[0]=o/s,i=q(e[0],e[1],n[t+1][0],n[t+1][1]),o+=i,r[1]=o/s,a.push(r))})),this.parsedStyle.points.segments=a}var l=0,u=0;this.parsedStyle.points.segments.forEach((function(t,n){e>=t[0]&&e<=t[1]&&(l=(e-t[0])/(t[1]-t[0]),u=n)}));var c=Q(n[u][0],n[u][1],n[u+1][0],n[u+1][1],l),h=c.x,d=c.y,p=f.transformMat4(f.create(),f.fromValues(h,d,0),t?this.getWorldTransform():this.getLocalTransform());return new Ae(p[0],p[1])}},{key:"getStartTangent",value:function(){var e=this.parsedStyle.points.points,t=[];return t.push([e[1][0],e[1][1]]),t.push([e[0][0],e[0][1]]),t}},{key:"getEndTangent",value:function(){var e=this.parsedStyle.points.points,t=e.length-1,n=[];return n.push([e[t-1][0],e[t-1][1]]),n.push([e[t][0],e[t][1]]),n}}])}(Qa);Ja.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Qa.PARSED_STYLE_LIST),["points","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isBillboard"]));var eo=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.RECT},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(wa);eo.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["x","y","z","width","height","isBillboard","isSizeAttenuation","radius"]));var to=["style"],no=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,ue.Z)(e,to);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:he.TEXT,style:(0,u.Z)({fill:"black"},n)},r)])}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getComputedTextLength",value:function(){var e;return this.getGeometryBounds(),(null===(e=this.parsedStyle.metrics)||void 0===e?void 0:e.maxLineWidth)||0}},{key:"getLineBoundingRects",value:function(){var e;return this.getGeometryBounds(),(null===(e=this.parsedStyle.metrics)||void 0===e?void 0:e.lineMetrics)||[]}},{key:"isOverflowing",value:function(){return this.getGeometryBounds(),!!this.parsedStyle.isOverflowing}}])}(wa);no.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(wa.PARSED_STYLE_LIST),["x","y","z","isBillboard","billboardRotation","isSizeAttenuation","text","textAlign","textBaseline","fontStyle","fontSize","fontFamily","fontWeight","fontVariant","lineHeight","letterSpacing","leading","wordWrap","wordWrapWidth","maxLines","textOverflow","isOverflowing","textPath","textDecorationLine","textDecorationColor","textDecorationStyle","textPathSide","textPathStartOffset","metrics","dx","dy"]));var ro=function(){function e(t){(0,o.Z)(this,e),this.strategies=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.config,r=t.camera,i=t.renderingService,a=t.renderingContext,o=this.strategies;i.hooks.cull.tap(e.tag,(function(e){if(e){var t,i=e.cullable;if(0===o.length?i.visible=a.unculledEntities.indexOf(e.entity)>-1:i.visible=o.every((function(t){return t.isVisible(r,e)})),!e.isCulled()&&e.isVisible())return e;var s=!0===(null===(t=n.future)||void 0===t?void 0:t.experimentalCancelEventPropagation);return e.dispatchEvent(new Zi(zi.CULLED),s,s),null}return e})),i.hooks.afterRender.tap(e.tag,(function(e){e.cullable.visibilityPlaneMask=-1}))}}])}();ro.tag="Culling";var io=function(){function e(){var t=this;(0,o.Z)(this,e),this.autoPreventDefault=!1,this.rootPointerEvent=new Ui(null),this.rootWheelEvent=new Gi(null),this.onPointerMove=function(e){var n,r=null===(n=t.context.renderingContext.root)||void 0===n||null===(n=n.ownerDocument)||void 0===n?void 0:n.defaultView;if(!r.supportsTouchEvents||"touch"!==e.pointerType){var i,a=t.normalizeToPointerEvent(e,r),o=(0,le.Z)(a);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=t.bootstrapEvent(t.rootPointerEvent,s,r,e);t.context.eventService.mapEvent(l)}}catch(e){o.e(e)}finally{o.f()}t.setCursor(t.context.eventService.cursor)}},this.onClick=function(e){var n,r,i=null===(n=t.context.renderingContext.root)||void 0===n||null===(n=n.ownerDocument)||void 0===n?void 0:n.defaultView,a=t.normalizeToPointerEvent(e,i),o=(0,le.Z)(a);try{for(o.s();!(r=o.n()).done;){var s=r.value,l=t.bootstrapEvent(t.rootPointerEvent,s,i,e);t.context.eventService.mapEvent(l)}}catch(e){o.e(e)}finally{o.f()}t.setCursor(t.context.eventService.cursor)}}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this;this.context=t;var r=t.renderingService,i=this.context.renderingContext.root.ownerDocument.defaultView;this.context.eventService.setPickHandler((function(e){return n.context.renderingService.hooks.pickSync.call({position:e,picked:[],topmost:!0}).picked[0]||null})),r.hooks.pointerWheel.tap(e.tag,(function(e){var t=n.normalizeWheelEvent(e);n.context.eventService.mapEvent(t)})),r.hooks.pointerDown.tap(e.tag,(function(e){if(!i.supportsTouchEvents||"touch"!==e.pointerType){var t=n.normalizeToPointerEvent(e,i);if(n.autoPreventDefault&&t[0].isNormalized)(e.cancelable||!("cancelable"in e))&&e.preventDefault();var r,a=(0,le.Z)(t);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=n.bootstrapEvent(n.rootPointerEvent,o,i,e);n.context.eventService.mapEvent(s)}}catch(e){a.e(e)}finally{a.f()}n.setCursor(n.context.eventService.cursor)}})),r.hooks.pointerUp.tap(e.tag,(function(e){if(!i.supportsTouchEvents||"touch"!==e.pointerType){var t,r=n.context.contextService.getDomElement(),a=n.context.eventService.isNativeEventFromCanvas(r,e)?"":"outside",o=n.normalizeToPointerEvent(e,i),s=(0,le.Z)(o);try{for(s.s();!(t=s.n()).done;){var l=t.value,u=n.bootstrapEvent(n.rootPointerEvent,l,i,e);u.type+=a,n.context.eventService.mapEvent(u)}}catch(e){s.e(e)}finally{s.f()}n.setCursor(n.context.eventService.cursor)}})),r.hooks.pointerMove.tap(e.tag,this.onPointerMove),r.hooks.pointerOver.tap(e.tag,this.onPointerMove),r.hooks.pointerOut.tap(e.tag,this.onPointerMove),r.hooks.click.tap(e.tag,this.onClick),r.hooks.pointerCancel.tap(e.tag,(function(e){var t,r=n.normalizeToPointerEvent(e,i),a=(0,le.Z)(r);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=n.bootstrapEvent(n.rootPointerEvent,o,i,e);n.context.eventService.mapEvent(s)}}catch(e){a.e(e)}finally{a.f()}n.setCursor(n.context.eventService.cursor)}))}},{key:"bootstrapEvent",value:function(e,t,n,r){e.view=n,e.originalEvent=null,e.nativeEvent=r,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t);var i=this.context.eventService.client2Viewport({x:t.clientX,y:t.clientY}),a=i.x,o=i.y;e.viewport.x=a,e.viewport.y=o;var s=this.context.eventService.viewport2Canvas(e.viewport),l=s.x,u=s.y;return e.canvas.x=l,e.canvas.y=u,e.global.copyFrom(e.canvas),e.offset.copyFrom(e.canvas),e.isTrusted=r.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=Qr[e.type]||e.type),e}},{key:"normalizeWheelEvent",value:function(e){var t=this.rootWheelEvent;this.transferMouseData(t,e),t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ;var n=this.context.eventService.client2Viewport({x:e.clientX,y:e.clientY}),r=n.x,i=n.y;t.viewport.x=r,t.viewport.y=i;var a=this.context.eventService.viewport2Canvas(t.viewport),o=a.x,s=a.y;return t.canvas.x=o,t.canvas.y=s,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.nativeEvent=e,t.type=e.type,t}},{key:"transferMouseData",value:function(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=$r.now(),e.type=t.type,e.altKey=t.altKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.ctrlKey=t.ctrlKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.screen.x=t.screenX,e.screen.y=t.screenY,e.relatedTarget=null}},{key:"setCursor",value:function(e){this.context.contextService.applyCursorStyle(e||this.context.config.cursor||"default")}},{key:"normalizeToPointerEvent",value:function(e,t){var n=[];if(t.isTouchEvent(e))for(var r=0;r<e.changedTouches.length;r++){var i=e.changedTouches[r];(0,B.Z)(i.button)&&(i.button=0),(0,B.Z)(i.buttons)&&(i.buttons=1),(0,B.Z)(i.isPrimary)&&(i.isPrimary=1===e.touches.length&&"touchstart"===e.type),(0,B.Z)(i.width)&&(i.width=i.radiusX||1),(0,B.Z)(i.height)&&(i.height=i.radiusY||1),(0,B.Z)(i.tiltX)&&(i.tiltX=0),(0,B.Z)(i.tiltY)&&(i.tiltY=0),(0,B.Z)(i.pointerType)&&(i.pointerType="touch"),(0,B.Z)(i.pointerId)&&(i.pointerId=i.identifier||0),(0,B.Z)(i.pressure)&&(i.pressure=i.force||.5),(0,B.Z)(i.twist)&&(i.twist=0),(0,B.Z)(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,i.type=e.type,n.push(i)}else if(t.isMouseEvent(e)){var a=e;(0,B.Z)(a.isPrimary)&&(a.isPrimary=!0),(0,B.Z)(a.width)&&(a.width=1),(0,B.Z)(a.height)&&(a.height=1),(0,B.Z)(a.tiltX)&&(a.tiltX=0),(0,B.Z)(a.tiltY)&&(a.tiltY=0),(0,B.Z)(a.pointerType)&&(a.pointerType="mouse"),(0,B.Z)(a.pointerId)&&(a.pointerId=1),(0,B.Z)(a.pressure)&&(a.pressure=.5),(0,B.Z)(a.twist)&&(a.twist=0),(0,B.Z)(a.tangentialPressure)&&(a.tangentialPressure=0),a.isNormalized=!0,n.push(a)}else n.push(e);return n}}])}();io.tag="Event";he.CIRCLE,he.ELLIPSE,he.IMAGE,he.RECT,he.LINE,he.POLYLINE,he.POLYGON,he.TEXT,he.PATH,he.HTML;var ao=function(){function e(){(0,o.Z)(this,e),this.syncTasks=new Map,this.isFirstTimeRendering=!0,this.syncing=!1,this.isFirstTimeRenderingFinished=!1}return(0,a.Z)(e,[{key:"apply",value:function(t){var n,r,i=this,a=t.config,o=t.renderingService,s=t.renderingContext,l=t.rBushRoot,u=s.root.ownerDocument.defaultView;this.rBush=l;var c=function(e){o.dirtify()},h=function(e){i.syncTasks.set(e.target,e.detail.affectChildren),o.dirtify()},d=function(e){var t=e.target;Aa.enableSizeAttenuation&&Aa.styleValueRegistry.updateSizeAttenuation(t,u.getCamera().getZoom())},f=function(e){var t=e.target,n=t.rBushNode;null!=n&&n.aabb&&i.rBush.remove(n.aabb),i.syncTasks.delete(t),Aa.sceneGraphService.dirtyToRoot(t),o.dirtify()};o.hooks.init.tap(e.tag,(function(){u.addEventListener(zi.MOUNTED,d),u.addEventListener(zi.UNMOUNTED,f),u.addEventListener(zi.ATTR_MODIFIED,c),u.addEventListener(zi.BOUNDS_CHANGED,h)})),o.hooks.destroy.tap(e.tag,(function(){u.removeEventListener(zi.MOUNTED,d),u.removeEventListener(zi.UNMOUNTED,f),u.removeEventListener(zi.ATTR_MODIFIED,c),u.removeEventListener(zi.BOUNDS_CHANGED,h),i.syncTasks.clear()}));var p=null!==(n=Aa.globalThis.requestIdleCallback)&&void 0!==n?n:ci.bind(Aa.globalThis),v=!0===(null===(r=a.future)||void 0===r?void 0:r.experimentalRICSyncRTree);o.hooks.endFrame.tap(e.tag,(function(){i.isFirstTimeRendering?(i.isFirstTimeRendering=!1,i.syncing=!0,p((function(){i.syncRTree(!0),i.isFirstTimeRenderingFinished=!0}))):v&&Aa.globalThis.requestIdleCallback&&Aa.globalThis.cancelIdleCallback?(Aa.globalThis.cancelIdleCallback(i.ricSyncRTreeId),i.ricSyncRTreeId=Aa.globalThis.requestIdleCallback((function(){return i.syncRTree()}))):i.syncRTree()}))}},{key:"syncNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.isConnected){var n=e.rBushNode;n.aabb&&this.rBush.remove(n.aabb);var r=e.getRenderBounds();if(r){var i=e.renderable;t&&(i.dirtyRenderBounds||(i.dirtyRenderBounds=new Te),i.dirtyRenderBounds.update(r.center,r.halfExtents));var a=r.getMin(),o=(0,h.Z)(a,2),s=o[0],l=o[1],u=r.getMax(),c=(0,h.Z)(u,2),d=c[0],f=c[1];n.aabb||(n.aabb={}),n.aabb.displayObject=e,n.aabb.minX=s,n.aabb.minY=l,n.aabb.maxX=d,n.aabb.maxY=f}return n.aabb&&!(isNaN(n.aabb.maxX)||isNaN(n.aabb.maxX)||isNaN(n.aabb.minX)||isNaN(n.aabb.minY))?n.aabb:void 0}}},{key:"syncRTree",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t||!this.syncing&&0!==this.syncTasks.size){this.syncing=!0;var n=[],r=new Set,i=function(i){if(!r.has(i)&&i.renderable){var a=e.syncNode(i,t);a&&(n.push(a),r.add(i))}};this.syncTasks.forEach((function(e,t){e&&t.forEach(i);for(var n=t;n;)i(n),n=n.parentElement})),this.rBush.load(n),n.length=0,this.syncing=!1}}}])}();ao.tag="Prepare";var oo=function(e){return e.READY="ready",e.BEFORE_RENDER="beforerender",e.RERENDER="rerender",e.AFTER_RENDER="afterrender",e.BEFORE_DESTROY="beforedestroy",e.AFTER_DESTROY="afterdestroy",e.RESIZE="resize",e.DIRTY_RECTANGLE="dirtyrectangle",e.RENDERER_CHANGED="rendererchanged",e}({});new Zi(zi.MOUNTED),new Zi(zi.UNMOUNTED),new Zi(oo.BEFORE_RENDER),new Zi(oo.RERENDER),new Zi(oo.AFTER_RENDER);function so(e,t){var n=t.cx,r=void 0===n?0:n,i=t.cy,a=void 0===i?0:i,o=t.r;e.arc(r,a,o,0,2*Math.PI,!1)}function lo(e,t){var n=t.cx,r=void 0===n?0:n,i=t.cy,a=void 0===i?0:i,o=t.rx,s=t.ry;if(e.ellipse)e.ellipse(r,a,o,s,0,0,2*Math.PI,!1);else{var l=o>s?o:s,u=o>s?1:o/s,c=o>s?s/o:1;e.save(),e.scale(u,c),e.arc(r,a,l,0,2*Math.PI)}}function uo(e,t){var n,r,i=t.x1,a=t.y1,o=t.x2,s=t.y2,l=t.markerStart,u=t.markerEnd,c=t.markerStartOffset,h=t.markerEndOffset,d=0,f=0,p=0,v=0,g=0;l&&Oa(l)&&c&&(n=o-i,r=s-a,g=Math.atan2(r,n),d=Math.cos(g)*(c||0),f=Math.sin(g)*(c||0)),u&&Oa(u)&&h&&(n=i-o,r=a-s,g=Math.atan2(r,n),p=Math.cos(g)*(h||0),v=Math.sin(g)*(h||0)),e.moveTo(i+d,a+f),e.lineTo(o+p,s+v)}function co(e,t){var n,r,i=t.markerStart,a=t.markerEnd,o=t.markerStartOffset,s=t.markerEndOffset,l=t.d,u=l.absolutePath,c=l.segments,d=0,f=0,p=0,v=0,g=0;if(i&&Oa(i)&&o){var m=i.parentNode.getStartTangent(),y=(0,h.Z)(m,2),E=y[0],_=y[1];n=E[0]-_[0],r=E[1]-_[1],g=Math.atan2(r,n),d=Math.cos(g)*(o||0),f=Math.sin(g)*(o||0)}if(a&&Oa(a)&&s){var T=a.parentNode.getEndTangent(),R=(0,h.Z)(T,2),S=R[0],A=R[1];n=S[0]-A[0],r=S[1]-A[1],g=Math.atan2(r,n),p=Math.cos(g)*(s||0),v=Math.sin(g)*(s||0)}for(var x=0;x<u.length;x++){var C=u[x],M=C[0],N=u[x+1],k=0===x&&(0!==d||0!==f),b=(x===u.length-1||N&&("M"===N[0]||"Z"===N[0]))&&0!==p&&0!==v,P=k?[d,f]:[0,0],O=(0,h.Z)(P,2),I=O[0],D=O[1],L=b?[p,v]:[0,0],B=(0,h.Z)(L,2),w=B[0],F=B[1];switch(M){case"M":e.moveTo(C[1]+I,C[2]+D);break;case"L":e.lineTo(C[1]+w,C[2]+F);break;case"Q":e.quadraticCurveTo(C[1],C[2],C[3]+w,C[4]+F);break;case"C":e.bezierCurveTo(C[1],C[2],C[3],C[4],C[5]+w,C[6]+F);break;case"A":var U=c[x].arcParams,G=U.cx,Z=U.cy,V=U.rx,X=U.ry,W=U.startAngle,H=U.endAngle,Y=U.xRotation,z=U.sweepFlag;if(e.ellipse)e.ellipse(G,Z,V,X,Y,W,H,!!(1-z));else{var K=V>X?V:X,j=V>X?1:V/X,q=V>X?X/V:1;e.translate(G,Z),e.rotate(Y),e.scale(j,q),e.arc(0,0,K,W,H,!!(1-z)),e.scale(1/j,1/q),e.rotate(-Y),e.translate(-G,-Z)}b&&e.lineTo(C[6]+p,C[7]+v);break;case"Z":e.closePath()}}}function ho(e,t){var n,r,i=t.markerStart,a=t.markerEnd,o=t.markerStartOffset,s=t.markerEndOffset,l=t.points.points,u=l.length,c=l[0][0],h=l[0][1],d=l[u-1][0],f=l[u-1][1],p=0,v=0,g=0,m=0,y=0;i&&Oa(i)&&o&&(n=l[1][0]-l[0][0],r=l[1][1]-l[0][1],y=Math.atan2(r,n),p=Math.cos(y)*(o||0),v=Math.sin(y)*(o||0)),a&&Oa(a)&&s&&(n=l[u-1][0]-l[0][0],r=l[u-1][1]-l[0][1],y=Math.atan2(r,n),g=Math.cos(y)*(s||0),m=Math.sin(y)*(s||0)),e.moveTo(c+(p||g),h+(v||m));for(var E=1;E<u-1;E++){var _=l[E];e.lineTo(_[0],_[1])}e.lineTo(d,f)}function fo(e,t){var n,r,i=t.markerStart,a=t.markerEnd,o=t.markerStartOffset,s=t.markerEndOffset,l=t.points.points,u=l.length,c=l[0][0],h=l[0][1],d=l[u-1][0],f=l[u-1][1],p=0,v=0,g=0,m=0,y=0;i&&Oa(i)&&o&&(n=l[1][0]-l[0][0],r=l[1][1]-l[0][1],y=Math.atan2(r,n),p=Math.cos(y)*(o||0),v=Math.sin(y)*(o||0)),a&&Oa(a)&&s&&(n=l[u-2][0]-l[u-1][0],r=l[u-2][1]-l[u-1][1],y=Math.atan2(r,n),g=Math.cos(y)*(s||0),m=Math.sin(y)*(s||0)),e.moveTo(c+p,h+v);for(var E=1;E<u-1;E++){var _=l[E];e.lineTo(_[0],_[1])}e.lineTo(d+g,f+m)}function po(e,t){var n=t.x,r=void 0===n?0:n,i=t.y,a=void 0===i?0:i,o=t.radius,s=t.width,l=t.height,u=s,c=l;if(o&&o.some((function(e){return 0!==e}))){var d=s>0?1:-1,f=l>0?1:-1,p=d+f===0,v=o.map((function(e){return(0,S.Z)(e,0,Math.min(Math.abs(u)/2,Math.abs(c)/2))})),g=(0,h.Z)(v,4),m=g[0],y=g[1],E=g[2],_=g[3];e.moveTo(d*m+r,a),e.lineTo(u-d*y+r,a),0!==y&&e.arc(u-d*y+r,f*y+a,y,-f*Math.PI/2,d>0?0:Math.PI,p),e.lineTo(u+r,c-f*E+a),0!==E&&e.arc(u-d*E+r,c-f*E+a,E,d>0?0:Math.PI,f>0?Math.PI/2:1.5*Math.PI,p),e.lineTo(d*_+r,c+a),0!==_&&e.arc(d*_+r,c-f*_+a,_,f>0?Math.PI/2:-Math.PI/2,d>0?Math.PI:0,p),e.lineTo(r,f*m+a),0!==m&&e.arc(d*m+r,f*m+a,m,d>0?Math.PI:0,f>0?1.5*Math.PI:Math.PI/2,p)}else e.rect(r,a,u,c)}var vo=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="canvas-path-generator",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){var e,t=(e={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,he.CIRCLE,so),he.ELLIPSE,lo),he.RECT,po),he.LINE,uo),he.POLYLINE,fo),he.POLYGON,ho),he.PATH,co),he.TEXT,void 0),he.GROUP,void 0),he.IMAGE,void 0),(0,V.Z)((0,V.Z)((0,V.Z)(e,he.HTML,void 0),he.MESH,void 0),he.FRAGMENT,void 0));this.context.pathGeneratorFactory=t}},{key:"destroy",value:function(){delete this.context.pathGeneratorFactory}}])}(fe),go=n(77135),mo=n(4933),yo=n(88164),Eo=f.create(),_o=f.create(),To=f.create(),Ro=v.create(),So=function(){function e(){var t=this;(0,o.Z)(this,e),this.isHit=function(e,n,r,i){var a=t.context.pointInPathPickerFactory[e.nodeName];if(a){var o=v.invert(Ro,r),s=f.transformMat4(_o,f.set(To,n[0],n[1],0),o);if(a(e,new Ae(s[0],s[1]),i,t.isPointInPath,t.context,t.runtime))return!0}return!1},this.isPointInPath=function(e,n){var r=t.runtime.offscreenCanvasCreator.getOrCreateContext(t.context.config.offscreenCanvas),i=t.context.pathGeneratorFactory[e.nodeName];return i&&(r.beginPath(),i(r,e.parsedStyle),r.closePath()),r.isPointInPath(n.x,n.y)}}return(0,a.Z)(e,[{key:"apply",value:function(t,n){var r,i=this,a=t.renderingService,o=t.renderingContext;this.context=t,this.runtime=n;var s=null===(r=o.root)||void 0===r?void 0:r.ownerDocument;a.hooks.pick.tapPromise(e.tag,function(){var e=(0,mo.Z)((0,go.Z)().mark((function e(t){return(0,go.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.pick(s,t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.hooks.pickSync.tap(e.tag,(function(e){return i.pick(s,e)}))}},{key:"pick",value:function(e,t){var n,r=t.topmost,i=t.position,a=i.x,o=i.y,s=f.set(Eo,a,o,0),l=e.elementsFromBBox(s[0],s[1],s[0],s[1]),u=[],c=(0,le.Z)(l);try{for(c.s();!(n=c.n()).done;){var h=n.value,d=h.getWorldTransform();if(this.isHit(h,s,d,!1)){var p=qr(h);if(p){var v=p.parsedStyle.clipPath;if(this.isHit(v,s,v.getWorldTransform(),!0)){if(r)return t.picked=[h],t;u.push(h)}}else{if(r)return t.picked=[h],t;u.push(h)}}}}catch(e){c.e(e)}finally{c.f()}return t.picked=u,t}}])}();function Ao(e,t,n){var r=e.parsedStyle,i=r.cx,a=void 0===i?0:i,o=r.cy,s=void 0===o?0:o,l=r.r,u=r.fill,c=r.stroke,d=r.lineWidth,f=void 0===d?1:d,p=r.increasedLineWidthForHitTesting,v=void 0===p?0:p,g=r.pointerEvents,m=void 0===g?"auto":g,y=(f+v)/2,E=W(a,s,t.x,t.y),_=ei(m,u,c),T=(0,h.Z)(_,2),R=T[0],S=T[1];return R&&S||n?E<=l+y:R?E<=l:!!S&&(E>=l-y&&E<=l+y)}function xo(e,t,n,r){return e/(n*n)+t/(r*r)}function Co(e,t,n){var r=e.parsedStyle,i=r.cx,a=void 0===i?0:i,o=r.cy,s=void 0===o?0:o,l=r.rx,u=r.ry,c=r.fill,d=r.stroke,f=r.lineWidth,p=void 0===f?1:f,v=r.increasedLineWidthForHitTesting,g=void 0===v?0:v,m=r.pointerEvents,y=void 0===m?"auto":m,E=t.x,_=t.y,T=ei(y,c,d),R=(0,h.Z)(T,2),S=R[0],A=R[1],x=(p+g)/2,C=(E-a)*(E-a),M=(_-s)*(_-s);return S&&A||n?xo(C,M,l+x,u+x)<=1:S?xo(C,M,l,u)<=1:!!A&&(xo(C,M,l-x,u-x)>=1&&xo(C,M,l+x,u+x)<=1)}function Mo(e,t,n,r,i,a){return i>=e&&i<=e+n&&a>=t&&a<=t+r}function No(e,t,n,r,i,a,o,s){var l=(Math.atan2(s-t,o-e)+2*Math.PI)%(2*Math.PI),u={x:e+n*Math.cos(l),y:t+n*Math.sin(l)};return W(u.x,u.y,o,s)<=a/2}function ko(e,t,n,r,i,a,o){var s=Math.min(e,n),l=Math.max(e,n),u=Math.min(t,r),c=Math.max(t,r),h=i/2;return a>=s-h&&a<=l+h&&o>=u-h&&o<=c+h&&$(e,t,n,r,a,o)<=i/2}function bo(e,t,n,r,i){var a=e.length;if(a<2)return!1;for(var o=0;o<a-1;o++){if(ko(e[o][0],e[o][1],e[o+1][0],e[o+1][1],t,n,r))return!0}if(i){var s=e[0],l=e[a-1];if(ko(s[0],s[1],l[0],l[1],t,n,r))return!0}return!1}So.tag="CanvasPicker";function Po(e){return Math.abs(e)<1e-6?0:e<0?-1:1}function Oo(e,t,n){return(n[0]-e[0])*(t[1]-e[1])==(t[0]-e[0])*(n[1]-e[1])&&Math.min(e[0],t[0])<=n[0]&&n[0]<=Math.max(e[0],t[0])&&Math.min(e[1],t[1])<=n[1]&&n[1]<=Math.max(e[1],t[1])}function Io(e,t,n){var r=!1,i=e.length;if(i<=2)return!1;for(var a=0;a<i;a++){var o=e[a],s=e[(a+1)%i];if(Oo(o,s,[t,n]))return!0;Po(o[1]-n)>0!=Po(s[1]-n)>0&&Po(t-(n-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(r=!r)}return r}function Do(e,t,n){for(var r=!1,i=0;i<e.length;i++){if(r=Io(e[i],t,n))break}return r}function Lo(e,t,n){var r=e.parsedStyle,i=r.x1,a=r.y1,o=r.x2,s=r.y2,l=r.lineWidth,u=void 0===l?1:l,c=r.increasedLineWidthForHitTesting,d=void 0===c?0:c,f=r.pointerEvents,p=ei(void 0===f?"auto":f,r.fill,r.stroke);return!(!(0,h.Z)(p,2)[1]&&!n||!u)&&ko(i,a,o,s,u+d,t.x,t.y)}function Bo(e,t,n,r,i,a){var o=e.parsedStyle,s=o.lineWidth,l=void 0===s?1:s,u=o.increasedLineWidthForHitTesting,c=void 0===u?0:u,d=o.stroke,f=o.fill,p=o.d,v=o.pointerEvents,g=void 0===v?"auto":v,m=p.segments,y=p.hasArc,E=p.polylines,_=p.polygons,T=ei(g,(null==_?void 0:_.length)&&f,d),R=(0,h.Z)(T,2),S=R[0],A=R[1],x=Wn(e),C=!1;return S||n?C=y?r(e,t):Do(_,t.x,t.y)||Do(E,t.x,t.y):((A||n)&&(C=function(e,t,n,r,i){for(var a=!1,o=t/2,s=0;s<e.length;s++){var l=e[s],u=l.currentPoint,c=l.params,h=l.prePoint,d=l.box;if(!d||Mo(d.x-o,d.y-o,d.width+t,d.height+t,n,r))switch(l.command){case"L":case"Z":if(a=ko(h[0],h[1],u[0],u[1],t,n,r))return!0;break;case"Q":if(a=se(h[0],h[1],c[1],c[2],c[3],c[4],n,r)<=t/2)return!0;break;case"C":if(a=ne(h[0],h[1],c[1],c[2],c[3],c[4],c[5],c[6],n,r,i)<=t/2)return!0;break;case"A":l.cubicParams||(l.cubicParams=(0,yo.W)(h[0],h[1],c[1],c[2],c[3],c[4],c[5],c[6],c[7],void 0));for(var f=l.cubicParams,p=h,v=0;v<f.length;v+=6){var g=ne(p[0],p[1],f[v],f[v+1],f[v+2],f[v+3],f[v+4],f[v+5],n,r,i);if(p=[f[v+4],f[v+5]],a=g<=t/2)return!0}}}return a}(m,l+c,t.x,t.y,x)),C)}function wo(e,t,n){var r=e.parsedStyle,i=r.stroke,a=r.fill,o=r.lineWidth,s=void 0===o?1:o,l=r.increasedLineWidthForHitTesting,u=void 0===l?0:l,c=r.points,d=r.pointerEvents,f=ei(void 0===d?"auto":d,a,i),p=(0,h.Z)(f,2),v=p[0],g=!1;return(p[1]||n)&&(g=bo(c.points,s+u,t.x,t.y,!0)),g||!v&&!n||(g=Io(c.points,t.x,t.y)),g}function Fo(e,t,n){var r=e.parsedStyle,i=r.lineWidth,a=void 0===i?1:i,o=r.increasedLineWidthForHitTesting,s=void 0===o?0:o,l=r.points,u=r.pointerEvents,c=ei(void 0===u?"auto":u,r.fill,r.stroke);return!(!(0,h.Z)(c,2)[1]&&!n||!a)&&bo(l.points,a+s,t.x,t.y,!1)}function Uo(e,t,n,r,i){var a=e.parsedStyle,o=a.radius,s=a.fill,l=a.stroke,u=a.lineWidth,c=void 0===u?1:u,d=a.increasedLineWidthForHitTesting,f=void 0===d?0:d,p=a.x,v=void 0===p?0:p,g=a.y,m=void 0===g?0:g,y=a.width,E=a.height,_=a.pointerEvents,T=ei(void 0===_?"auto":_,s,l),R=(0,h.Z)(T,2),A=R[0],x=R[1],C=c+f;if(o&&o.some((function(e){return 0!==e}))){var M=!1;return(x||n)&&(M=function(e,t,n,r,i,a,o,s){var l=(0,h.Z)(i,4),u=l[0],c=l[1],d=l[2],f=l[3];return ko(e+u,t,e+n-c,t,a,o,s)||ko(e+n,t+c,e+n,t+r-d,a,o,s)||ko(e+n-d,t+r,e+f,t+r,a,o,s)||ko(e,t+r-f,e,t+u,a,o,s)||No(e+n-c,t+c,c,Math.PI,Math.PI,a,o,s)||No(e+n-d,t+r-d,d,0,Math.PI,a,o,s)||No(e+f,t+r-f,f,Math.PI,Math.PI,a,o,s)||No(e+u,t+u,u,Math.PI,Math.PI,a,o,s)}(v,m,y,E,o.map((function(e){return(0,S.Z)(e,0,Math.min(Math.abs(y)/2,Math.abs(E)/2))})),C,t.x,t.y)),M||!A&&!n||(M=r(e,t)),M}var N=C/2;return A&&x||n?Mo(v-N,m-N,y+N,E+N,t.x,t.y):A?Mo(v,m,y,E,t.x,t.y):!!x&&function(e,t,n,r,i,a,o){var s=i/2;return Mo(e-s,t-s,n,i,a,o)||Mo(e+n-s,t-s,i,r,a,o)||Mo(e+s,t+r-s,n,i,a,o)||Mo(e-s,t+s,i,r,a,o)}(v,m,y,E,C,t.x,t.y)}function Go(e,t,n,r,i,a){var o=e.parsedStyle,s=o.pointerEvents,l=void 0===s?"auto":s,c=o.x,h=void 0===c?0:c,d=o.y,f=void 0===d?0:d,p=o.width,v=o.height;if("non-transparent-pixel"===l){var g=i.config.offscreenCanvas,m=a.offscreenCanvasCreator.getOrCreateCanvas(g),y=a.offscreenCanvasCreator.getOrCreateContext(g,{willReadFrequently:!0});return m.width=p,m.height=v,i.defaultStyleRendererFactory[he.IMAGE].render(y,(0,u.Z)((0,u.Z)({},e.parsedStyle),{},{x:0,y:0}),e,void 0,void 0,void 0),y.getImageData(t.x-h,t.y-f,1,1).data.every((function(e){return 0!==e}))}return!0}function Zo(e,t,n,r){var i=e.getGeometryBounds();return t.x>=i.min[0]&&t.y>=i.min[1]&&t.x<=i.max[0]&&t.y<=i.max[1]}var Vo=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="canvas-picker",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){var e,t=(e={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,he.CIRCLE,Ao),he.ELLIPSE,Co),he.RECT,Uo),he.LINE,Lo),he.POLYLINE,Fo),he.POLYGON,wo),he.PATH,Bo),he.TEXT,Zo),he.GROUP,null),he.IMAGE,Go),(0,V.Z)((0,V.Z)(e,he.HTML,null),he.MESH,null));this.context.pointInPathPickerFactory=t,this.addRenderingPlugin(new So)}},{key:"destroy",value:function(){delete this.context.pointInPathPickerFactory,this.removeAllRenderingPlugins()}}])}(fe);function Xo(e,t){if(!{}.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Wo=0;function Ho(e){return"__private_"+Wo+++"_"+e}var Yo=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.cacheStore=new Map}),[{key:"onRefAdded",value:function(e){}},{key:"has",value:function(e){return this.cacheStore.has(e)}},{key:"put",value:function(e,t,n){return!this.cacheStore.has(e)&&(this.cacheStore.set(e,{value:t,counter:new Set([n.entity])}),this.onRefAdded(n),!0)}},{key:"get",value:function(e,t){var n=this.cacheStore.get(e);return n?(n.counter.has(t.entity)||(n.counter.add(t.entity),this.onRefAdded(t)),n.value):null}},{key:"update",value:function(e,t,n){var r=this.cacheStore.get(e);return!!r&&(r.value=(0,u.Z)((0,u.Z)({},r.value),t),r.counter.has(n.entity)||(r.counter.add(n.entity),this.onRefAdded(n)),!0)}},{key:"release",value:function(e,t){var n=this.cacheStore.get(e);return!!n&&(n.counter.delete(t.entity),n.counter.size<=0&&this.cacheStore.delete(e),!0)}},{key:"releaseRef",value:function(e){var t=this;Array.from(this.cacheStore.keys()).forEach((function(n){t.release(n,e)}))}},{key:"getSize",value:function(){return this.cacheStore.size}},{key:"clear",value:function(){this.cacheStore.clear()}}])}(),zo=[],Ko=[],jo=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,null,[{key:"stop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.api;e.rafId&&(t.cancelAnimationFrame(e.rafId),e.rafId=null)}},{key:"executeTask",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.api;zo.length<=0&&Ko.length<=0||(Ko.forEach((function(e){return e()})),Ko=zo.splice(0,e.TASK_NUM_PER_FRAME),e.rafId=t.requestAnimationFrame((function(){e.executeTask(t)})))}},{key:"sliceImage",value:function(t,n,r,i){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.api,s=t.naturalWidth||t.width,l=t.naturalHeight||t.height,u=n-a,c=r-a,h=Math.ceil(s/u),d=Math.ceil(l/c),f={tileSize:[n,r],gridSize:[d,h],tiles:Array(d).fill(null).map((function(){return Array(h).fill(null)}))},p=function(e){for(var a=function(a){zo.push((function(){var h=a*u,d=e*c,p=[Math.min(n,s-h),Math.min(r,l-d)],v=p[0],g=p[1],m=o.createCanvas();m.width=n,m.height=r,m.getContext("2d").drawImage(t,h,d,v,g,0,0,v,g),f.tiles[e][a]={x:h,y:d,tileX:a,tileY:e,data:m},i()}))},d=0;d<h;d++)a(d)},v=0;v<d;v++)p(v);return e.stop(),e.executeTask(),f}}])}();jo.TASK_NUM_PER_FRAME=10;var qo=new Yo;qo.onRefAdded=function(e){var t=this;e.addEventListener(zi.DESTROY,(function(){t.releaseRef(e)}),{once:!0})};var Qo=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.gradientCache={},this.patternCache={},this.context=t,this.runtime=n}),[{key:"getImageSync",value:function(e,t,n){var r=(0,R.Z)(e)?e:e.src;if(qo.has(r)){var i=qo.get(r,t);if(i.img.complete)return null==n||n(i),i}return this.getOrCreateImage(e,t).then((function(e){null==n||n(e)})).catch((function(e){console.error(e)})),null}},{key:"getOrCreateImage",value:function(e,t){var n=this,r=(0,R.Z)(e)?e:e.src;if(!(0,R.Z)(e)&&!qo.has(r)){var i={img:e,size:[e.naturalWidth||e.width,e.naturalHeight||e.height],tileSize:$o(e)};qo.put(r,i,t)}if(qo.has(r)){var a=qo.get(r,t);return a.img.complete?Promise.resolve(a):new Promise((function(e,t){a.img.addEventListener("load",(function(){a.size=[a.img.naturalWidth||a.img.width,a.img.naturalHeight||a.img.height],a.tileSize=$o(a.img),e(a)})),a.img.addEventListener("error",(function(e){t(e)}))}))}return new Promise((function(e,i){var a=n.context.config.createImage();if(a){var o={img:a,size:[0,0],tileSize:$o(a)};qo.put(r,o,t),a.onload=function(){o.size=[a.naturalWidth||a.width,a.naturalHeight||a.height],o.tileSize=$o(o.img),e(o)},a.onerror=function(e){i(e)},a.crossOrigin="Anonymous",a.src=r}}))}},{key:"createDownSampledImage",value:(t=(0,mo.Z)((0,go.Z)().mark((function e(t,n){var r,i,a,o,s,l,c,d,f,p,v,g,m,y;return(0,go.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.getOrCreateImage(t,n);case 1:if(void 0===(r=e.sent).downSamplingRate){e.next=2;break}return e.abrupt("return",r);case 2:if(i=this.context.config.enableLargeImageOptimization,o=(a="boolean"==typeof i?{}:i).maxDownSampledImageSize,s=void 0===o?2048:o,l=a.downSamplingRateThreshold,c=void 0===l?.5:l,d=this.runtime.globalThis.createImageBitmap,f=(0,h.Z)(r.size,2),p=f[0],v=f[1],g=r.img,m=Math.min((s+s)/(p+v),Math.max(.01,Math.min(c,.5))),y=(0,u.Z)((0,u.Z)({},r),{},{downSamplingRate:m}),qo.update(r.img.src,y,n),!d){e.next=7;break}return e.prev=3,e.next=4,d(r.img,{resizeWidth:p*m,resizeHeight:v*m});case 4:g=e.sent,e.next=6;break;case 5:e.prev=5,e.catch(3),m=1;case 6:e.next=8;break;case 7:m=1;case 8:return y=(0,u.Z)((0,u.Z)({},this.getImageSync(t,n)),{},{downSampled:g,downSamplingRate:m}),qo.update(r.img.src,y,n),e.abrupt("return",y);case 9:case"end":return e.stop()}}),e,this,[[3,5]])}))),function(e,n){return t.apply(this,arguments)})},{key:"createImageTiles",value:(e=(0,mo.Z)((0,go.Z)().mark((function e(t,n,r,i){var a,o,s,l,c;return(0,go.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.getOrCreateImage(t,i);case 1:return a=e.sent,o=i.ownerDocument.defaultView,s=o.requestAnimationFrame,l=o.cancelAnimationFrame,jo.api={requestAnimationFrame:s,cancelAnimationFrame:l,createCanvas:function(){return Wi.createCanvas()}},c=(0,u.Z)((0,u.Z)({},a),jo.sliceImage(a.img,a.tileSize[0],a.tileSize[0],r)),qo.update(a.img.src,c,i),e.abrupt("return",c);case 2:case"end":return e.stop()}}),e,this)}))),function(t,n,r,i){return e.apply(this,arguments)})},{key:"releaseImage",value:function(e,t){qo.release((0,R.Z)(e)?e:e.src,t)}},{key:"releaseImageRef",value:function(e){qo.releaseRef(e)}},{key:"getOrCreatePatternSync",value:function(e,t,n,r,i,a,o){var s=this.generatePatternKey(t);if(s&&this.patternCache[s])return this.patternCache[s];var l,u=t.image,c=t.repetition,h=t.transform,d=!1;if((0,R.Z)(u)){var f=this.getImageSync(u,e,o);l=null==f?void 0:f.img}else r?(l=r,d=!0):l=u;var p,g=l&&n.createPattern(l,c);g&&(p=h?Ai(pr(h),new wa({})):v.identity(v.create()),d&&v.scale(p,p,[1/i,1/i,1]),g.setTransform({a:p[0],b:p[1],c:p[4],d:p[5],e:p[12]+a[0],f:p[13]+a[1]}));return s&&g&&(this.patternCache[s]=g),g}},{key:"getOrCreateGradient",value:function(e,t){var n=this.generateGradientKey(e),r=e.type,i=e.steps,a=e.min,o=e.width,s=e.height,l=e.angle,u=e.cx,c=e.cy,h=e.size;if(this.gradientCache[n])return this.gradientCache[n];var d=null;if(r===jt.LinearGradient){var f=function(e,t,n,r){var i=Pe(r.value),a=0+t/2,o=0+n/2,s=Math.abs(t*Math.cos(i))+Math.abs(n*Math.sin(i));return{x1:e[0]+a-Math.cos(i)*s/2,y1:e[1]+o-Math.sin(i)*s/2,x2:e[0]+a+Math.cos(i)*s/2,y2:e[1]+o+Math.sin(i)*s/2}}(a,o,s,l),p=f.x1,v=f.y1,g=f.x2,m=f.y2;d=t.createLinearGradient(p,v,g,m)}else if(r===jt.RadialGradient){var y=function(e,t,n,r,i,a){var o=r.value,s=i.value;r.unit===Ft.kPercentage&&(o=r.value/100*t),i.unit===Ft.kPercentage&&(s=i.value/100*n);var l=Math.max((0,_.y)([0,0],[o,s]),(0,_.y)([0,n],[o,s]),(0,_.y)([t,n],[o,s]),(0,_.y)([t,0],[o,s]));return a&&(a instanceof Jt?l=a.value:a instanceof Qt&&("closest-side"===a.value?l=Math.min(o,t-o,s,n-s):"farthest-side"===a.value?l=Math.max(o,t-o,s,n-s):"closest-corner"===a.value&&(l=Math.min((0,_.y)([0,0],[o,s]),(0,_.y)([0,n],[o,s]),(0,_.y)([t,n],[o,s]),(0,_.y)([t,0],[o,s]))))),{x:o+e[0],y:s+e[1],r:l}}(a,o,s,u,c,h),E=y.x,T=y.y,R=y.r;d=t.createRadialGradient(E,T,0,E,T,R)}return d&&(i.forEach((function(e){var t,n=e.offset,r=e.color;n.unit===Ft.kPercentage&&(null===(t=d)||void 0===t||t.addColorStop(n.value/100,r.toString()))})),this.gradientCache[n]=d),this.gradientCache[n]}},{key:"generateGradientKey",value:function(e){var t=e.type,n=e.min,r=e.width,i=e.height,a=e.steps,o=e.angle,s=e.cx,l=e.cy,u=e.size;return"gradient-".concat(t,"-").concat((null==o?void 0:o.toString())||0,"-").concat((null==s?void 0:s.toString())||0,"-").concat((null==l?void 0:l.toString())||0,"-").concat((null==u?void 0:u.toString())||0,"-").concat(n[0],"-").concat(n[1],"-").concat(r,"-").concat(i,"-").concat(a.map((function(e){var t=e.offset,n=e.color;return"".concat(t).concat(n)})).join("-"))}},{key:"generatePatternKey",value:function(e){var t=e.image,n=e.repetition;return(0,R.Z)(t)?"pattern-".concat(t,"-").concat(n):"rect"===t.nodeName?"pattern-".concat(t.entity,"-").concat(n):void 0}}]);var e,t}();function $o(e){if(!e.complete)return[0,0];var t=e.naturalWidth||e.width,n=e.naturalHeight||e.height,r=256;return[256,512].forEach((function(e){Math.ceil(n/e)*Math.ceil(t/e)<1e3&&(r=e)})),[r,r]}Qo.isSupportTile=!!Wi.createCanvas();var Jo=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.renderingService,r=t.renderingContext,i=t.imagePool,a=r.root.ownerDocument.defaultView,o=function(e,t,n){var r=e.parsedStyle,i=r.width,a=r.height;i&&!a?e.setAttribute("height",n/t*i):!i&&a&&e.setAttribute("width",t/n*a)},s=function(e){var t=e.target,r=t.nodeName,a=t.attributes;if(r===he.IMAGE){var s=a.src,l=a.keepAspectRatio;i.getImageSync(s,t,(function(e){var r=e.img,i=r.width,a=r.height;l&&o(t,i,a),t.renderable.dirty=!0,n.dirtify()}))}},l=function(e){var t=e.target,r=e.attrName,a=e.prevValue,s=e.newValue;t.nodeName===he.IMAGE&&"src"===r&&(a!==s&&i.releaseImage(a,t),(0,R.Z)(s)&&i.getOrCreateImage(s,t).then((function(e){var r=e.img,i=r.width,a=r.height;t.attributes.keepAspectRatio&&o(t,i,a),t.renderable.dirty=!0,n.dirtify()})).catch((function(){})))};n.hooks.init.tap(e.tag,(function(){a.addEventListener(zi.MOUNTED,s),a.addEventListener(zi.ATTR_MODIFIED,l)})),n.hooks.destroy.tap(e.tag,(function(){a.removeEventListener(zi.MOUNTED,s),a.removeEventListener(zi.ATTR_MODIFIED,l)}))}}])}();Jo.tag="LoadImage";var es=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="image-loader",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(e){this.context.imagePool=new Qo(this.context,e),this.addRenderingPlugin(new Jo)}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(fe),ts=Ho("renderState"),ns=function(){function e(t){(0,o.Z)(this,e),this.removedRBushNodeAABBs=[],this.renderQueue=[],Object.defineProperty(this,ts,{writable:!0,value:{restoreStack:[],prevObject:null,currentContext:new Map}}),this.clearFullScreenLastFrame=!1,this.clearFullScreen=!1,this.vpMatrix=v.create(),this.dprMatrix=v.create(),this.tmpMat4=v.create(),this.vec3a=f.create(),this.vec3b=f.create(),this.vec3c=f.create(),this.vec3d=f.create(),this.canvasRendererPluginOptions=t}return(0,a.Z)(e,[{key:"apply",value:function(t,n){var r=this;this.context=t;var i=this.context,a=i.config,o=i.camera,s=i.renderingService,l=i.renderingContext,u=i.rBushRoot,h=i.pathGeneratorFactory,d=a.renderer.getConfig().enableRenderingOptimization;a.renderer.getConfig().enableDirtyCheck=!1,a.renderer.getConfig().enableDirtyRectangleRendering=!1,this.rBush=u,this.pathGeneratorFactory=h;var p=t.contextService,g=l.root.ownerDocument.defaultView,m=function(e){var t=e.target.rBushNode;null!=t&&t.aabb&&r.removedRBushNodeAABBs.push(t.aabb)},y=function(e){var t=e.target.rBushNode;t.aabb&&r.removedRBushNodeAABBs.push(t.aabb)};s.hooks.init.tap(e.tag,(function(){g.addEventListener(zi.UNMOUNTED,m),g.addEventListener(zi.CULLED,y);var e=p.getDPR(),t=a.width,n=a.height,i=p.getContext();r.clearRect(i,0,0,t*e,n*e,a.background)})),s.hooks.destroy.tap(e.tag,(function(){g.removeEventListener(zi.UNMOUNTED,m),g.removeEventListener(zi.CULLED,y),r.renderQueue=[],r.removedRBushNodeAABBs=[],Xo(r,ts)[ts]={restoreStack:[],prevObject:null,currentContext:null}}));var E=function(e,t){for(var i=[e];i.length>0;){var a,o=i.pop();o.isVisible()&&!o.isCulled()&&(d?r.renderDisplayObjectOptimized(o,t,r.context,Xo(r,ts)[ts],n):r.renderDisplayObject(o,t,r.context,Xo(r,ts)[ts],n));for(var s=(null===(a=o.sortable)||void 0===a||null===(a=a.sorted)||void 0===a?void 0:a.length)>0?o.sortable.sorted:o.childNodes,l=s.length-1;l>=0;l--)i.push(s[l])}};s.hooks.endFrame.tap(e.tag,(function(){if(function(){var e,t=p.getContext(),n=p.getDPR(),i=a.width,o=a.height,l=r.canvasRendererPluginOptions,u=l.dirtyObjectNumThreshold,c=l.dirtyObjectRatioThreshold,h=s.getStats(),d=h.total,f=h.rendered,v=f/d;r.clearFullScreen=r.clearFullScreenLastFrame||!(null!==(e=g.context.renderingPlugins[1])&&void 0!==e&&e.isFirstTimeRenderingFinished)||s.disableDirtyRectangleRendering()||f>u&&v>c,t&&("function"==typeof t.resetTransform?t.resetTransform():t.setTransform(1,0,0,1,0,0),r.clearFullScreen&&r.clearRect(t,0,0,i*n,o*n,a.background))}(),0!==l.root.childNodes.length){d=a.renderer.getConfig().enableRenderingOptimization,Xo(r,ts)[ts]={restoreStack:[],prevObject:null,currentContext:Xo(r,ts)[ts].currentContext},Xo(r,ts)[ts].currentContext.clear(),r.clearFullScreenLastFrame=!1;var e=p.getContext(),t=p.getDPR();if(v.fromScaling(r.dprMatrix,[t,t,1]),v.multiply(r.vpMatrix,r.dprMatrix,o.getOrthoMatrix()),r.clearFullScreen)d?(e.save(),E(l.root,e),e.restore()):E(l.root,e),r.removedRBushNodeAABBs=[];else{var i=r.safeMergeAABB.apply(r,[r.mergeDirtyAABBs(r.renderQueue)].concat((0,c.Z)(r.removedRBushNodeAABBs.map((function(e){var t=e.minX,n=e.minY,r=e.maxX,i=e.maxY,a=new Te;return a.setMinMax([t,n,0],[r,i,0]),a})))));if(r.removedRBushNodeAABBs=[],Te.isEmpty(i))return void(r.renderQueue=[]);var u=r.convertAABB2Rect(i),h=u.x,m=u.y,y=u.width,_=u.height,T=f.transformMat4(r.vec3a,[h,m,0],r.vpMatrix),R=f.transformMat4(r.vec3b,[h+y,m,0],r.vpMatrix),S=f.transformMat4(r.vec3c,[h,m+_,0],r.vpMatrix),A=f.transformMat4(r.vec3d,[h+y,m+_,0],r.vpMatrix),x=Math.min(T[0],R[0],A[0],S[0]),C=Math.min(T[1],R[1],A[1],S[1]),M=Math.max(T[0],R[0],A[0],S[0]),N=Math.max(T[1],R[1],A[1],S[1]),k=Math.floor(x),b=Math.floor(C),P=Math.ceil(M-x),O=Math.ceil(N-C);e.save(),r.clearRect(e,k,b,P,O,a.background),e.beginPath(),e.rect(k,b,P,O),e.clip(),e.setTransform(r.vpMatrix[0],r.vpMatrix[1],r.vpMatrix[4],r.vpMatrix[5],r.vpMatrix[12],r.vpMatrix[13]),a.renderer.getConfig().enableDirtyRectangleRenderingDebug&&g.dispatchEvent(new Zi(oo.DIRTY_RECTANGLE,{dirtyRect:{x:k,y:b,width:P,height:O}})),r.searchDirtyObjects(i).sort((function(e,t){return e.sortable.renderOrder-t.sortable.renderOrder})).forEach((function(t){t&&t.isVisible()&&!t.isCulled()&&r.renderDisplayObject(t,e,r.context,Xo(r,ts)[ts],n)})),e.restore(),r.renderQueue.forEach((function(e){r.saveDirtyAABB(e)})),r.renderQueue=[]}Xo(r,ts)[ts].restoreStack.forEach((function(){e.restore()})),Xo(r,ts)[ts].restoreStack=[]}else r.clearFullScreenLastFrame=!0})),s.hooks.render.tap(e.tag,(function(e){r.clearFullScreen||r.renderQueue.push(e)}))}},{key:"clearRect",value:function(e,t,n,r,i,a){e.clearRect(t,n,r,i),a&&(e.fillStyle=a,e.fillRect(t,n,r,i))}},{key:"renderDisplayObjectOptimized",value:function(e,t,n,r,i){var a=e.nodeName,o=!1,s=this.context.styleRendererFactory[a],l=this.pathGeneratorFactory[a],u=e.parsedStyle.clipPath;if(u){(!r.prevObject||!v.exactEquals(u.getWorldTransform(),r.prevObject.getWorldTransform()))&&(this.applyWorldTransform(t,u),r.prevObject=null);var c=this.pathGeneratorFactory[u.nodeName];c&&(t.save(),o=!0,t.beginPath(),c(t,u.parsedStyle),t.closePath(),t.clip())}if(s){(!r.prevObject||!v.exactEquals(e.getWorldTransform(),r.prevObject.getWorldTransform()))&&this.applyWorldTransform(t,e);var h=!r.prevObject;if(!h){var d=r.prevObject.nodeName;h=a===he.TEXT?d!==he.TEXT:a===he.IMAGE?d!==he.IMAGE:d===he.TEXT||d===he.IMAGE}s.applyStyleToContext(t,e,h,r),r.prevObject=e}l&&(t.beginPath(),l(t,e.parsedStyle),a!==he.LINE&&a!==he.PATH&&a!==he.POLYLINE&&t.closePath()),s&&s.drawToContext(t,e,Xo(this,ts)[ts],this,i),o&&t.restore(),e.dirty(!1)}},{key:"renderDisplayObject",value:function(e,t,n,r,i){var a=e.nodeName,o=r.restoreStack[r.restoreStack.length-1];!o||e.compareDocumentPosition(o)&Xi.DOCUMENT_POSITION_CONTAINS||(t.restore(),r.restoreStack.pop());var s=this.context.styleRendererFactory[a],l=this.pathGeneratorFactory[a],u=e.parsedStyle.clipPath;if(u){this.applyWorldTransform(t,u);var c=this.pathGeneratorFactory[u.nodeName];c&&(t.save(),r.restoreStack.push(e),t.beginPath(),c(t,u.parsedStyle),t.closePath(),t.clip())}s&&(this.applyWorldTransform(t,e),t.save(),this.applyAttributesToContext(t,e)),l&&(t.beginPath(),l(t,e.parsedStyle),a!==he.LINE&&a!==he.PATH&&a!==he.POLYLINE&&t.closePath()),s&&(s.render(t,e.parsedStyle,e,n,this,i),t.restore()),e.dirty(!1)}},{key:"applyAttributesToContext",value:function(e,t){var n=t.parsedStyle,r=n.stroke,i=n.fill,a=n.opacity,o=n.lineDash,s=n.lineDashOffset;o&&e.setLineDash(o),(0,T.Z)(s)||(e.lineDashOffset=s),(0,T.Z)(a)||(e.globalAlpha*=a),(0,T.Z)(r)||Array.isArray(r)||r.isNone||(e.strokeStyle=t.attributes.stroke),(0,T.Z)(i)||Array.isArray(i)||i.isNone||(e.fillStyle=t.attributes.fill)}},{key:"convertAABB2Rect",value:function(e){var t=e.getMin(),n=e.getMax(),r=Math.floor(t[0]),i=Math.floor(t[1]);return{x:r,y:i,width:Math.ceil(n[0])-r,height:Math.ceil(n[1])-i}}},{key:"mergeDirtyAABBs",value:function(e){var t=new Te;return e.forEach((function(e){var n=e.getRenderBounds();t.add(n);var r=e.renderable.dirtyRenderBounds;r&&t.add(r)})),t}},{key:"searchDirtyObjects",value:function(e){var t=e.getMin(),n=(0,h.Z)(t,2),r=n[0],i=n[1],a=e.getMax(),o=(0,h.Z)(a,2),s=o[0],l=o[1];return this.rBush.search({minX:r,minY:i,maxX:s,maxY:l}).map((function(e){return e.displayObject}))}},{key:"saveDirtyAABB",value:function(e){var t=e.renderable;t.dirtyRenderBounds||(t.dirtyRenderBounds=new Te);var n=e.getRenderBounds();n&&t.dirtyRenderBounds.update(n.center,n.halfExtents)}},{key:"applyWorldTransform",value:function(e,t,n){n?(v.copy(this.tmpMat4,t.getLocalTransform()),v.multiply(this.tmpMat4,n,this.tmpMat4),v.multiply(this.tmpMat4,this.vpMatrix,this.tmpMat4)):(v.copy(this.tmpMat4,t.getWorldTransform()),v.multiply(this.tmpMat4,this.vpMatrix,this.tmpMat4)),e.setTransform(this.tmpMat4[0],this.tmpMat4[1],this.tmpMat4[4],this.tmpMat4[5],this.tmpMat4[12],this.tmpMat4[13])}},{key:"safeMergeAABB",value:function(){for(var e=new Te,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){e.add(t)})),e}}])}();function rs(e,t,n,r,i,a,o){var s,l;if("rect"===e.image.nodeName){var u=e.image.parsedStyle,c=u.width,h=u.height;l=r.contextService.getDPR();var d=r.config.offscreenCanvas;(s=a.offscreenCanvasCreator.getOrCreateCanvas(d)).width=c*l,s.height=h*l;var f=a.offscreenCanvasCreator.getOrCreateContext(d),p={restoreStack:[],prevObject:null,currentContext:new Map};e.image.forEach((function(e){i.renderDisplayObject(e,f,r,p,a)})),p.restoreStack.forEach((function(){f.restore()}))}return o.getOrCreatePatternSync(t,e,n,s,l,t.getGeometryBounds().min,(function(){t.dirty(),r.renderingService.dirtify()}))}function is(e,t,n,r){var i;if(e.type===jt.LinearGradient||e.type===jt.RadialGradient){var a=t.getGeometryBounds(),o=a&&2*a.halfExtents[0]||1,s=a&&2*a.halfExtents[1]||1,l=a&&a.min||[0,0];i=r.getOrCreateGradient((0,u.Z)((0,u.Z)({type:e.type},e.value),{},{min:l,width:o,height:s}),n)}return i}ns.tag="CanvasRenderer";var as=["shadowBlur","shadowOffsetX","shadowOffsetY"],os=["lineCap","lineJoin","miterLimit"],ss={globalAlpha:1,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",filter:"none",globalCompositeOperation:"source-over",strokeStyle:"#000",strokeOpacity:1,lineWidth:1,lineDash:[],lineDashOffset:0,lineCap:"butt",lineJoin:"miter",miterLimit:10,fillStyle:"#000",fillOpacity:1},ls={};function us(e,t,n,r){var i=r.has(t)?r.get(t):ss[t];return i!==n&&("lineDash"===t?e.setLineDash(n):e[t]=n,r.set(t,n)),i}var cs=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.imagePool=t}),[{key:"applyAttributesToContext",value:function(e,t){}},{key:"render",value:function(e,t,n,r,i,a){}},{key:"applyCommonStyleToContext",value:function(e,t,n,r){var i=n?ls:r.prevObject.parsedStyle,a=t.parsedStyle;(n||a.opacity!==i.opacity)&&us(e,"globalAlpha",(0,T.Z)(a.opacity)?ss.globalAlpha:a.opacity,r.currentContext),(n||a.blend!==i.blend)&&us(e,"globalCompositeOperation",(0,T.Z)(a.blend)?ss.globalCompositeOperation:a.blend,r.currentContext)}},{key:"applyStrokeFillStyleToContext",value:function(e,t,n,r){var i=n?ls:r.prevObject.parsedStyle,a=t.parsedStyle,o=a.lineWidth,s=void 0===o?ss.lineWidth:o,l=a.fill&&!a.fill.isNone;if(a.stroke&&!a.stroke.isNone&&s>0){if(n||t.attributes.stroke!==r.prevObject.attributes.stroke)us(e,"strokeStyle",(0,T.Z)(a.stroke)||Array.isArray(a.stroke)||a.stroke.isNone?ss.strokeStyle:t.attributes.stroke,r.currentContext);(n||a.lineWidth!==i.lineWidth)&&us(e,"lineWidth",(0,T.Z)(a.lineWidth)?ss.lineWidth:a.lineWidth,r.currentContext),(n||a.lineDash!==i.lineDash)&&us(e,"lineDash",a.lineDash||ss.lineDash,r.currentContext),(n||a.lineDashOffset!==i.lineDashOffset)&&us(e,"lineDashOffset",(0,T.Z)(a.lineDashOffset)?ss.lineDashOffset:a.lineDashOffset,r.currentContext);for(var u=0;u<os.length;u++){var c=os[u];(n||a[c]!==i[c])&&us(e,c,(0,T.Z)(a[c])?ss[c]:a[c],r.currentContext)}}l&&(n||t.attributes.fill!==r.prevObject.attributes.fill)&&us(e,"fillStyle",(0,T.Z)(a.fill)||Array.isArray(a.fill)||a.fill.isNone?ss.fillStyle:t.attributes.fill,r.currentContext)}},{key:"applyStyleToContext",value:function(e,t,n,r){var i=t.nodeName;this.applyCommonStyleToContext(e,t,n,r),i===he.IMAGE||this.applyStrokeFillStyleToContext(e,t,n,r)}},{key:"applyShadowAndFilterStyleToContext",value:function(e,t,n,r){var i=t.parsedStyle;if(n){us(e,"shadowColor",i.shadowColor.toString(),r.currentContext);for(var a=0;a<as.length;a++){var o=as[a];us(e,o,i[o]||ss[o],r.currentContext)}}i.filter&&i.filter.length&&us(e,"filter",t.attributes.filter,r.currentContext)}},{key:"clearShadowAndFilterStyleForContext",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t){us(e,"shadowColor",ss.shadowColor,r.currentContext);for(var a=0;a<as.length;a++){var o=as[a];us(e,o,ss[o],r.currentContext)}}if(n)if(t&&i){var s=e.filter;!(0,T.Z)(s)&&s.indexOf("drop-shadow")>-1&&us(e,"filter",s.replace(/drop-shadow\([^)]*\)/,"").trim()||ss.filter,r.currentContext)}else us(e,"filter",ss.filter,r.currentContext)}},{key:"fillToContext",value:function(e,t,n,r,i){var a=this,o=t.parsedStyle,s=o.fill,l=o.fillRule,u=null;if(Array.isArray(s)&&s.length>0)s.forEach((function(r){var i=us(e,"fillStyle",is(r,t,e,a.imagePool),n.currentContext);u=null!=u?u:i,l?e.fill(l):e.fill()}));else{if(_n(s)){var c=rs(s,t,e,t.ownerDocument.defaultView.context,r,i,this.imagePool);c&&(e.fillStyle=c,u=!0)}l?e.fill(l):e.fill()}null!==u&&us(e,"fillStyle",u,n.currentContext)}},{key:"strokeToContext",value:function(e,t,n,r,i){var a=this,o=t.parsedStyle.stroke,s=null;if(Array.isArray(o)&&o.length>0)o.forEach((function(r){var i=us(e,"strokeStyle",is(r,t,e,a.imagePool),n.currentContext);s=null!=s?s:i,e.stroke()}));else{if(_n(o)){var l=rs(o,t,e,t.ownerDocument.defaultView.context,r,i,this.imagePool);if(l){var u=us(e,"strokeStyle",l,n.currentContext);s=null!=s?s:u}}e.stroke()}null!==s&&us(e,"strokeStyle",s,n.currentContext)}},{key:"drawToContext",value:function(e,t,n,r,i){var a,o=t.nodeName,s=t.parsedStyle,l=s.opacity,u=void 0===l?ss.globalAlpha:l,c=s.fillOpacity,h=void 0===c?ss.fillOpacity:c,d=s.strokeOpacity,f=void 0===d?ss.strokeOpacity:d,p=s.lineWidth,v=void 0===p?ss.lineWidth:p,g=s.fill&&!s.fill.isNone,m=s.stroke&&!s.stroke.isNone&&v>0;if(g||m){var y=!(0,T.Z)(s.shadowColor)&&s.shadowBlur>0,E="inner"===s.shadowType,_=0===(null===(a=s.fill)||void 0===a?void 0:a.alpha),R=!(!s.filter||!s.filter.length),S=y&&m&&(o===he.PATH||o===he.LINE||o===he.POLYLINE||_||E),A=null;if(g)S||this.applyShadowAndFilterStyleToContext(e,t,y,n),A=us(e,"globalAlpha",u*h,n.currentContext),this.fillToContext(e,t,n,r,i),S||this.clearShadowAndFilterStyleForContext(e,y,R,n);if(m){var x=!1,C=us(e,"globalAlpha",u*f,n.currentContext);if(A=g?A:C,S&&(this.applyShadowAndFilterStyleToContext(e,t,y,n),x=!0,E)){var M=e.globalCompositeOperation;e.globalCompositeOperation="source-atop",this.strokeToContext(e,t,n,r,i),e.globalCompositeOperation=M,this.clearShadowAndFilterStyleForContext(e,y,R,n,!0)}this.strokeToContext(e,t,n,r,i),x&&this.clearShadowAndFilterStyleForContext(e,y,R,n)}null!==A&&us(e,"globalAlpha",A,n.currentContext)}}}])}(),hs=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"render",value:function(e,t,n,r,i,a){var o=t.fill,s=t.fillRule,l=t.opacity,u=void 0===l?1:l,c=t.fillOpacity,h=void 0===c?1:c,d=t.stroke,f=t.strokeOpacity,p=void 0===f?1:f,v=t.lineWidth,g=void 0===v?1:v,m=t.lineCap,y=t.lineJoin,E=t.shadowType,_=t.shadowColor,R=t.shadowBlur,S=t.filter,A=t.miterLimit,x=o&&!o.isNone,C=d&&!d.isNone&&g>0,M=0===(null==o?void 0:o.alpha),N=!(!S||!S.length),k=!(0,T.Z)(_)&&R>0,b=n.nodeName,P="inner"===E,O=C&&k&&(b===he.PATH||b===he.LINE||b===he.POLYLINE||M||P);x&&(e.globalAlpha=u*h,O||ds(n,e,k),fs(e,n,o,s,r,i,a,this.imagePool),O||this.clearShadowAndFilter(e,N,k)),C&&(e.globalAlpha=u*p,e.lineWidth=g,(0,T.Z)(A)||(e.miterLimit=A),(0,T.Z)(m)||(e.lineCap=m),(0,T.Z)(y)||(e.lineJoin=y),O&&(P&&(e.globalCompositeOperation="source-atop"),ds(n,e,!0),P&&(ps(e,n,d,r,i,a,this.imagePool),e.globalCompositeOperation=ss.globalCompositeOperation,this.clearShadowAndFilter(e,N,!0))),ps(e,n,d,r,i,a,this.imagePool))}},{key:"clearShadowAndFilter",value:function(e,t,n){if(n&&(e.shadowColor="transparent",e.shadowBlur=0),t){var r=e.filter;!(0,T.Z)(r)&&r.indexOf("drop-shadow")>-1&&(e.filter=r.replace(/drop-shadow\([^)]*\)/,"").trim()||"none")}}}])}(cs);function ds(e,t,n){var r=e.parsedStyle,i=r.filter,a=r.shadowColor,o=r.shadowBlur,s=r.shadowOffsetX,l=r.shadowOffsetY;i&&i.length&&(t.filter=e.style.filter),n&&(t.shadowColor=a.toString(),t.shadowBlur=o||0,t.shadowOffsetX=s||0,t.shadowOffsetY=l||0)}function fs(e,t,n,r,i,a,o,s){var l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];Array.isArray(n)?n.forEach((function(n){e.fillStyle=is(n,t,e,s),l||(r?e.fill(r):e.fill())})):(_n(n)&&(e.fillStyle=rs(n,t,e,i,a,o,s)),l||(r?e.fill(r):e.fill()))}function ps(e,t,n,r,i,a,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Array.isArray(n)?n.forEach((function(n){e.strokeStyle=is(n,t,e,o),s||e.stroke()})):(_n(n)&&(e.strokeStyle=rs(n,t,e,r,i,a,o)),s||e.stroke())}var vs=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"renderDownSampled",value:function(e,t,n,r){var i=r.src,a=r.imageCache;a.downSampled?e.drawImage(a.downSampled,Math.floor(r.drawRect[0]),Math.floor(r.drawRect[1]),Math.ceil(r.drawRect[2]),Math.ceil(r.drawRect[3])):this.imagePool.createDownSampledImage(i,n).then((function(){n.ownerDocument&&(n.dirty(),n.ownerDocument.defaultView.context.renderingService.dirtify())})).catch((function(e){console.error(e)}))}},{key:"renderTile",value:function(e,t,n,r){var i=r.src,a=r.imageCache,o=r.imageRect,s=r.drawRect,l=a.size,u=e.getTransform(),c=u.a,h=u.b,d=u.c,f=u.d,p=u.e,v=u.f;if(e.resetTransform(),null!=a&&a.gridSize){for(var g=[l[0]/o[2],l[1]/o[3]],m=[a.tileSize[0]/g[0],a.tileSize[1]/g[1]],y=[Math.floor((s[0]-o[0])/m[0]),Math.ceil((s[0]+s[2]-o[0])/m[0])],E=y[0],_=y[1],T=[Math.floor((s[1]-o[1])/m[1]),Math.ceil((s[1]+s[3]-o[1])/m[1])],R=T[1],S=T[0];S<=R;S++)for(var A=E;A<=_;A++){var x=a.tiles[S][A];if(x){var C=[Math.floor(o[0]+x.tileX*m[0]),Math.floor(o[1]+x.tileY*m[1]),Math.ceil(m[0]),Math.ceil(m[1])];e.drawImage(x.data,C[0],C[1],C[2],C[3])}}e.setTransform(c,h,d,f,p,v)}else this.imagePool.createImageTiles(i,[],(function(){n.ownerDocument&&(n.dirty(),n.ownerDocument.defaultView.context.renderingService.dirtify())}),n).catch((function(e){console.error(e)}))}},{key:"render",value:function(e,n,r){var i=n.x,a=void 0===i?0:i,o=n.y,s=void 0===o?0:o,l=n.width,u=n.height,c=n.src,d=n.shadowColor,p=n.shadowBlur,g=this.imagePool.getImageSync(c,r),m=null==g?void 0:g.img,y=l,E=u;if(m){var _,R,S,A,x,C,M,N,k,b,P,O,I,D,L,B,w,F,U,G,Z,V;y||(y=m.width),E||(E=m.height),ds(r,e,!(0,T.Z)(d)&&p>0);try{var X=r.ownerDocument.defaultView.getContextService().getDomElement(),W=X.width,H=X.height,Y=e.getTransform(),z=Y.a,K=Y.b,j=Y.c,q=Y.d,Q=Y.e,$=Y.f,J=v.fromValues(z,j,0,0,K,q,0,0,0,0,1,0,Q,$,0,1),ee=(w=[a,s,y,E],F=J,U=f.transformMat4(f.create(),[w[0],w[1],0],F),G=f.transformMat4(f.create(),[w[0]+w[2],w[1],0],F),Z=f.transformMat4(f.create(),[w[0],w[1]+w[3],0],F),V=f.transformMat4(f.create(),[w[0]+w[2],w[1]+w[3],0],F),[Math.min(U[0],G[0],Z[0],V[0]),Math.min(U[1],G[1],Z[1],V[1]),Math.max(U[0],G[0],Z[0],V[0])-Math.min(U[0],G[0],Z[0],V[0]),Math.max(U[1],G[1],Z[1],V[1])-Math.min(U[1],G[1],Z[1],V[1])]),te=(_=[0,0,W,H],R=ee,S=(0,h.Z)(_,4),A=S[0],x=S[1],C=S[2],M=S[3],N=(0,h.Z)(R,4),k=N[0],b=N[1],P=N[2],O=N[3],I=Math.max(A,k),D=Math.max(x,b),L=Math.min(A+C,k+P),B=Math.min(x+M,b+O),L<=I||B<=D?null:[I,D,L-I,B-D]);if(!te)return;if(!r.ownerDocument.defaultView.getConfig().enableLargeImageOptimization)return void t.renderFull(e,n,r,{image:m,drawRect:[a,s,y,E]});if(ee[2]/g.size[0]<(g.downSamplingRate||.5))return void this.renderDownSampled(e,n,r,{src:c,imageCache:g,drawRect:[a,s,y,E]});if(!Qo.isSupportTile)return void t.renderFull(e,n,r,{image:m,drawRect:[a,s,y,E]});this.renderTile(e,n,r,{src:c,imageCache:g,imageRect:ee,drawRect:te})}catch(e){}}}},{key:"drawToContext",value:function(e,t,n,r,i){this.render(e,t.parsedStyle,t)}}],[{key:"renderFull",value:function(e,t,n,r){e.drawImage(r.image,Math.floor(r.drawRect[0]),Math.floor(r.drawRect[1]),Math.ceil(r.drawRect[2]),Math.ceil(r.drawRect[3]))}}])}(hs),gs=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"render",value:function(e,t,n,r,i,a){n.getBounds();var o=t.lineWidth,s=void 0===o?1:o,l=t.textAlign,u=void 0===l?"start":l,c=t.textBaseline,h=void 0===c?"alphabetic":c,d=t.lineJoin,f=void 0===d?"miter":d,p=t.miterLimit,v=void 0===p?10:p,g=t.letterSpacing,m=void 0===g?0:g,y=t.stroke,E=t.fill,_=t.fillRule,R=t.fillOpacity,S=void 0===R?1:R,A=t.strokeOpacity,x=void 0===A?1:A,C=t.opacity,M=void 0===C?1:C,N=t.metrics,k=t.x,b=void 0===k?0:k,P=t.y,O=void 0===P?0:P,I=t.dx,D=t.dy,L=t.shadowColor,B=t.shadowBlur,w=N.font,F=N.lines,U=N.height,G=N.lineHeight,Z=N.lineMetrics;e.font=w,e.lineWidth=s,e.textAlign="middle"===u?"center":u;var V=h;"alphabetic"===V&&(V="bottom"),e.lineJoin=f,(0,T.Z)(v)||(e.miterLimit=v);var X=O;"middle"===h?X+=-U/2-G/2:"bottom"===h||"alphabetic"===h||"ideographic"===h?X+=-U:"top"!==h&&"hanging"!==h||(X+=-G);var W=b+(I||0);X+=D||0,1===F.length&&("bottom"===V?(V="middle",X-=.5*U):"top"===V&&(V="middle",X+=.5*U)),e.textBaseline=V,ds(n,e,!(0,T.Z)(L)&&B>0);for(var H=0;H<F.length;H++){var Y=s/2+W;X+=G,(0,T.Z)(y)||y.isNone||!s||this.drawLetterSpacing(e,n,F[H],Z[H],u,Y,X,m,E,_,S,y,x,M,!0,r,i,a),(0,T.Z)(E)||this.drawLetterSpacing(e,n,F[H],Z[H],u,Y,X,m,E,_,S,y,x,M,!1,r,i,a)}}},{key:"drawLetterSpacing",value:function(e,t,n,r,i,a,o,s,l,u,c,h,d,f,p,v,g,m){if(0!==s){var y=e.textAlign;e.textAlign="left";var E=a;"center"===i||"middle"===i?E=a-r.width/2:"right"!==i&&"end"!==i||(E=a-r.width);for(var _=Array.from(n),T=e.measureText(n).width,R=0,S=0;S<_.length;++S){var A=_[S];p?this.strokeText(e,t,A,E,o,h,d,v,g,m):this.fillText(e,t,A,E,o,l,u,c,f,v,g,m),E+=T-(R=e.measureText(n.substring(S+1)).width)+s,T=R}e.textAlign=y}else p?this.strokeText(e,t,n,a,o,h,d,v,g,m):this.fillText(e,t,n,a,o,l,u,c,f,v,g,m)}},{key:"fillText",value:function(e,t,n,r,i,a,o,s,l,u,c,h){var d;fs(e,t,a,o,u,c,h,this.imagePool,!0);var f=!(0,T.Z)(s)&&1!==s;f&&(d=e.globalAlpha,e.globalAlpha=s*l),e.fillText(n,r,i),f&&(e.globalAlpha=d)}},{key:"strokeText",value:function(e,t,n,r,i,a,o,s,l,u){var c;ps(e,t,a,s,l,u,this.imagePool,!0);var h=!(0,T.Z)(o)&&1!==o;h&&(c=e.globalAlpha,e.globalAlpha=o),e.strokeText(n,r,i),h&&(e.globalAlpha=c)}},{key:"drawToContext",value:function(e,t,n,r,i){this.render(e,t.parsedStyle,t,t.ownerDocument.defaultView.context,r,i)}}])}(hs),ms=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(e=(0,s.Z)(this,t)).name="canvas-renderer",e.options=n,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){var e,t=(0,u.Z)({dirtyObjectNumThreshold:500,dirtyObjectRatioThreshold:.8},this.options),n=this.context.imagePool,r=new hs(n),i=(e={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,he.CIRCLE,r),he.ELLIPSE,r),he.RECT,r),he.IMAGE,new vs(n)),he.TEXT,new gs(n)),he.LINE,r),he.POLYLINE,r),he.POLYGON,r),he.PATH,r),he.GROUP,void 0),(0,V.Z)((0,V.Z)((0,V.Z)(e,he.HTML,void 0),he.MESH,void 0),he.FRAGMENT,void 0));this.context.defaultStyleRendererFactory=i,this.context.styleRendererFactory=i,this.addRenderingPlugin(new ns(t))}},{key:"destroy",value:function(){this.removeAllRenderingPlugins(),delete this.context.defaultStyleRendererFactory,delete this.context.styleRendererFactory}}])}(fe),ys=function(){function e(t){(0,o.Z)(this,e),this.dragndropPluginOptions=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this,r=t.renderingService,i=t.renderingContext.root.ownerDocument,a=i.defaultView,o=function(e){var t=e.target,r=t===i,o=r&&n.dragndropPluginOptions.isDocumentDraggable?i:t.closest&&t.closest("[draggable=true]");if(o){var s=!1,l=e.timeStamp,u=[e.clientX,e.clientY],c=null,h=[e.clientX,e.clientY],d=function(){var e=(0,mo.Z)((0,go.Z)().mark((function e(a){var d,f,p,v,g,m;return(0,go.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}if(d=a.timeStamp-l,f=(0,_.y)([a.clientX,a.clientY],u),!(d<=n.dragndropPluginOptions.dragstartTimeThreshold||f<=n.dragndropPluginOptions.dragstartDistanceThreshold)){e.next=1;break}return e.abrupt("return");case 1:a.type="dragstart",o.dispatchEvent(a),s=!0;case 2:if(a.type="drag",a.dx=a.clientX-h[0],a.dy=a.clientY-h[1],o.dispatchEvent(a),h=[a.clientX,a.clientY],r){e.next=4;break}return p="pointer"===n.dragndropPluginOptions.overlap?[a.canvasX,a.canvasY]:t.getBounds().center,e.next=3,i.elementsFromPoint(p[0],p[1]);case 3:v=e.sent,g=v[v.indexOf(t)+1],m=(null==g?void 0:g.closest("[droppable=true]"))||(n.dragndropPluginOptions.isDocumentDroppable?i:null),c!==m&&(c&&(a.type="dragleave",a.target=c,c.dispatchEvent(a)),m&&(a.type="dragenter",a.target=m,m.dispatchEvent(a)),(c=m)&&(a.type="dragover",a.target=c,c.dispatchEvent(a)));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();a.addEventListener("pointermove",d);var f=function(e){if(s){e.detail={preventClick:!0};var t=e.clone();c&&(t.type="drop",t.target=c,c.dispatchEvent(t)),t.type="dragend",o.dispatchEvent(t),s=!1}a.removeEventListener("pointermove",d)};t.addEventListener("pointerup",f,{once:!0}),t.addEventListener("pointerupoutside",f,{once:!0})}};r.hooks.init.tap(e.tag,(function(){a.addEventListener("pointerdown",o)})),r.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("pointerdown",o)}))}}])}();ys.tag="Dragndrop";var Es=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(e=(0,s.Z)(this,t)).name="dragndrop",e.options=n,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new ys((0,u.Z)({overlap:"pointer",isDocumentDraggable:!1,isDocumentDroppable:!1,dragstartDistanceThreshold:0,dragstartTimeThreshold:0},this.options)))}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}},{key:"setOptions",value:function(e){Object.assign(this.plugins[0].dragndropPluginOptions,e)}}])}(fe),_s=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.renderingService,r=t.contextService,i=t.config,a=r.getDomElement(),o=function(e){n.hooks.pointerDown.call(e)},s=function(e){n.hooks.pointerUp.call(e)},l=function(e){n.hooks.pointerMove.call(e)},u=function(e){n.hooks.pointerOver.call(e)},c=function(e){n.hooks.pointerOut.call(e)},h=function(e){n.hooks.click.call(e)},d=function(e){n.hooks.pointerCancel.call(e)};n.hooks.init.tap(e.tag,(function(){a.addEventListener("touchstart",o,!0),a.addEventListener("touchend",s,!0),a.addEventListener("touchmove",l,!0),a.addEventListener("touchcancel",d,!0),a.addEventListener("mouseout",c,!0),a.addEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.addEventListener("click",h,!0)})),n.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("touchstart",o,!0),a.removeEventListener("touchend",s,!0),a.removeEventListener("touchmove",l,!0),a.removeEventListener("touchcancel",d,!0),a.removeEventListener("mouseout",c,!0),a.removeEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.removeEventListener("click",h,!0)}))}}])}();_s.tag="MobileInteraction";var Ts=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="mobile-interaction",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new _s)}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(fe),Rs="object"===("undefined"==typeof performance?"undefined":i()(performance))&&performance.now?performance:Date,Ss=function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.abs(n)>Math.abs(r)?n>0?"right":"left":r>0?"down":"up"},As=function(e,t){var n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return Math.sqrt(n*n+r*r)},xs=function(){function e(t){var n=this;(0,o.Z)(this,e),this.evCache=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this._start=function(e,t){n.reset(),n.startTime=Rs.now();var r=n.evCache,i=n.startPoints;if(e){var a,o=e.pointerId,s=e.x,l=e.y,u=r.findIndex((function(e){return o===e.pointerId}));-1!==u&&r.splice(u,1),r.push({pointerId:o,x:s,y:l,ev:e});for(var h=(0,c.Z)((null===(a=e.nativeEvent)||void 0===a?void 0:a.touches)||[]),d=function(e){if(h.find((function(t){return r[e].pointerId===t.identifier})))return 1;r.splice(e,1)},f=r.length-1;f>-1;f--)d(f)}i.length=r.length;for(var p=0;p<r.length;p++){var v=r[p],g={x:v.x,y:v.y};i[p]=g}if(1!==i.length){var m,y;n.startDistance=As(i[0],i[1]),n.center=(m=i[0],y=i[1],{x:m.x+(y.x-m.x)/2,y:m.y+(y.y-m.y)/2})}else{var E=r[0].ev;n.pressTimeout=setTimeout((function(){var e="press",r="none";E.direction=r,E.deltaX=0,E.deltaY=0,E.points=i,n.emitStart(e,E,t),E.type=e,t.dispatchEvent(E),n.eventType=e,n.direction=r,n.movingTarget=t}),250)}},this._move=function(e,t){n.clearPressTimeout();var r=n.startPoints,i=n.evCache;if(r.length){for(var a=e.x,o=e.y,s=e.pointerId,l=0,u=i.length;l<u;l++)if(s===i[l].pointerId){i[l]={pointerId:s,x:a,y:o,ev:e};break}var c={x:a,y:o},h=i.map((function(e){return{x:e.x,y:e.y}})),d=Rs.now();if(n.prevMoveTime=n.lastMoveTime,n.prevMovePoint=n.lastMovePoint,n.lastMoveTime=d,n.lastMovePoint=c,1===r.length){var f=r[0],p=a-f.x,v=o-f.y,g=n.direction||Ss(f,c);n.direction=g;var m=n.getEventType(c,t,e);return e.direction=g,e.deltaX=p,e.deltaY=v,e.points=h,n.emitStart(m,e,t),e.type=m,void n.refreshAndGetTarget(t).dispatchEvent(e)}var y=n.startDistance,E=As(h[0],h[1]);e.zoom=E/y,e.center=n.center,e.points=h,n.emitStart("pinch",e,t),n._throttleEmit("pinch",e,t)}},this._end=function(e,t){var r=n.evCache,i=n.startPoints,a=r.map((function(e){return{x:e.x,y:e.y}}));if(e.points=a,n.emitEnd(e,n.refreshAndGetTarget(t)),1===r.length){var o=Rs.now(),s=n.lastMoveTime;if(o-s<100){var l=s-(n.prevMoveTime||n.startTime);if(l>0){var u=n.prevMovePoint||i[0],c=n.lastMovePoint||i[0],h=As(u,c)/l;h>.3&&(e.velocity=h,e.direction=Ss(u,c),e.type="swipe",t.dispatchEvent(e))}}}for(var d=0,f=r.length;d<f;d++)if(r[d].pointerId===e.pointerId){r.splice(d,1),i.splice(d,1);break}n.reset(),r.length>0&&n._start(void 0,t)},this._cancel=function(e,t){var r=n.evCache.map((function(e){return{x:e.x,y:e.y}}));e.points=r,n.emitEnd(e,n.refreshAndGetTarget(t)),n.evCache=[],n.reset()},this.options=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this,r=t.renderingService,i=t.renderingContext.root.ownerDocument,a=i.defaultView;this.canvas=a;var o=function(e){return e===i&&n.options.isDocumentGestureEnabled?i:e},s=function(e){var t=o(e.target);t&&n._move(e,t)},l=function(e){var t=o(e.target);t&&n._start(e,t)},u=function(e){var t=o(e.target);t&&n._end(e,t)},c=function(e){var t=o(e.target);t&&n._cancel(e,t)},h=function(e){var t=o(e.target);t&&n._end(e,t)};r.hooks.init.tap(e.tag,(function(){a.addEventListener("pointermove",s),a.addEventListener("pointerdown",l),a.addEventListener("pointerup",u),a.addEventListener("pointercancel",c),a.addEventListener("pointerupoutside",h)})),r.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("pointermove",s),a.removeEventListener("pointerdown",l),a.removeEventListener("pointerup",u),a.removeEventListener("pointercancel",c),a.removeEventListener("pointerupoutside",h)}))}},{key:"getEventType",value:function(e,t,n){var r,i=this.eventType,a=this.startTime,o=this.startPoints;if(i)return i;(this.movingTarget=t,this.isPanListenerInPath=n.path.some((function(e){var t;return!(null===(t=e.emitter)||void 0===t||null===(t=t.eventNames())||void 0===t||!t.includes("pan"))})),this.isPanListenerInPath)?r=Rs.now()-a>250&&As(o[0],e)<10?"press":"pan":r="press";return this.eventType=r,r}},{key:"enable",value:function(e){this.processEvent[e]=!0}},{key:"isProcess",value:function(e){return this.processEvent[e]}},{key:"emitStart",value:function(e,t,n){this.isProcess(e)||(this.enable(e),t.type="".concat(e,"start"),n.dispatchEvent(t))}},{key:"_throttleEmit",value:function(e,t,n){var r=this;this.pushEvent(e,t);var i=this.throttleTimer,a=this.emitThrottles,o=this.processEvent;i||(this.throttleTimer=this.canvas.requestAnimationFrame((function(){for(var e=0,t=a.length;e<t;e++){var i=a[e],s=i.type,l=i.ev;o[s]&&(l.type=s,n.dispatchEvent(l))}r.throttleTimer=0,r.emitThrottles.length=0})))}},{key:"emitEnd",value:function(e,t){var n=this.processEvent;Object.keys(n).forEach((function(r){e.type="".concat(r,"end"),t.dispatchEvent(e),delete n[r]}))}},{key:"pushEvent",value:function(e,t){for(var n=this.emitThrottles,r={type:e,ev:t},i=0,a=n.length;i<a;i++)if(n[i].type===e)return void n.splice(i,1,r);n.push(r)}},{key:"clearPressTimeout",value:function(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}},{key:"refreshAndGetTarget",value:function(e){return this.movingTarget?(this.movingTarget&&!this.movingTarget.isConnected&&(this.movingTarget=e),this.movingTarget):e}},{key:"reset",value:function(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null,this.movingTarget=null,this.isPanListenerInPath=null}}])}();xs.tag="Gesture";var Cs=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(e=(0,s.Z)(this,t)).name="gesture",e.options=n,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new xs((0,u.Z)({isDocumentGestureEnabled:!1},this.options)))}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(fe);var Ms=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.canvasConfig=t.config}),[{key:"init",value:(t=(0,mo.Z)((0,go.Z)().mark((function e(){var t,n,r,i;return(0,go.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.canvasConfig,n=t.canvas,r=t.devicePixelRatio,this.$canvas=n,this.context=this.$canvas.getContext("2d"),i=(i=r||1)>=1?Math.ceil(i):1,this.dpr=i,this.resize(this.canvasConfig.width,this.canvasConfig.height);case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getContext",value:function(){return this.context}},{key:"getDomElement",value:function(){return this.$canvas}},{key:"getDPR",value:function(){return this.dpr}},{key:"getBoundingClientRect",value:function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()}},{key:"destroy",value:function(){this.context=null,this.$canvas=null}},{key:"resize",value:function(e,t){var n,r=this.canvasConfig.devicePixelRatio,a=this.$canvas;a.style&&(a.style.width="".concat(e,"px"),a.style.height="".concat(t,"px")),(n=a)&&"object"===i()(n)&&(1===n.nodeType&&n.nodeName||n.isCanvasElement)&&(a.width=e*r,a.height=t*r,1!==r&&this.context.scale(r,r))}},{key:"applyCursorStyle",value:function(e){}},{key:"toDataURL",value:(e=(0,mo.Z)((0,go.Z)().mark((function e(t){var n,r;return(0,go.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.type,r=t.encoderOptions,e.abrupt("return",this.context.canvas.toDataURL(n,r));case 1:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})}]);var e,t}(),Ns=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="mobile-canvas-context-register",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.context.ContextService=Ms}},{key:"destroy",value:function(){delete this.context.ContextService}}])}(fe),ks=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t,[e])).registerPlugin(new Ns),n.registerPlugin(new es),n.registerPlugin(new vo),n.registerPlugin(new ms),n.registerPlugin(new Ts),n.registerPlugin(new Vo),n.registerPlugin(new Es({isDocumentDraggable:!!(0,T.Z)(null==e?void 0:e.isDocumentDraggable)||e.isDocumentDraggable,isDocumentDroppable:!!(0,T.Z)(null==e?void 0:e.isDocumentDroppable)||e.isDocumentDroppable,dragstartDistanceThreshold:(0,T.Z)(null==e?void 0:e.dragstartDistanceThreshold)?10:e.dragstartDistanceThreshold,dragstartTimeThreshold:(0,T.Z)(null==e?void 0:e.dragstartTimeThreshold)?50:e.dragstartTimeThreshold})),n.registerPlugin(new Cs({isDocumentGestureEnabled:!0})),n}return(0,l.Z)(t,e),(0,a.Z)(t)}(pe)},99349:function(e,t,n){n.d(t,{Th:function(){return K}});var r=n(51148),i=n(63118),a=n(65982),o=function(){function e(){}return e.prototype.apply=function(t){var n=t.renderingService,r=t.contextService,i=t.config,a=r.getDomElement(),o=function(e){n.hooks.pointerDown.call(e)},s=function(e){n.hooks.pointerUp.call(e)},l=function(e){n.hooks.pointerMove.call(e)},u=function(e){n.hooks.pointerOver.call(e)},c=function(e){n.hooks.pointerOut.call(e)},h=function(e){n.hooks.click.call(e)},d=function(e){n.hooks.pointerCancel.call(e)};n.hooks.init.tap(e.tag,(function(){a.addEventListener("touchstart",o,!0),a.addEventListener("touchend",s,!0),a.addEventListener("touchmove",l,!0),a.addEventListener("touchcancel",d,!0),a.addEventListener("mouseout",c,!0),a.addEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.addEventListener("click",h,!0)})),n.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("touchstart",o,!0),a.removeEventListener("touchend",s,!0),a.removeEventListener("touchmove",l,!0),a.removeEventListener("touchcancel",d,!0),a.removeEventListener("mouseout",c,!0),a.removeEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.removeEventListener("click",h,!0)}))},e.tag="MobileInteraction",e}(),s=function(e){function t(){var t=e.apply(this,(0,r.__spreadArray)([],(0,r.__read)(arguments),!1))||this;return t.name="mobile-interaction",t}return(0,r.__extends)(t,e),t.prototype.init=function(){this.addRenderingPlugin(new o)},t.prototype.destroy=function(){this.removeAllRenderingPlugins()},t}(i.F6),l=function(){function e(){}return e.prototype.apply=function(t,n){var i=this,a=t.config.document,o=t.renderingService,s=t.svgElementMap;o.hooks.pick.tapPromise(e.tag,(function(e){return(0,r.__awaiter)(i,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){return[2,this.pick(s,a,e)]}))}))})),o.hooks.pickSync.tap(e.tag,(function(e){return i.pick(s,a,e)}))},e.prototype.pick=function(e,t,n){var i,a,o=n.topmost,s=n.position,l=s.clientX,u=s.clientY;try{var c=[];try{for(var h=(0,r.__values)((t||document).elementsFromPoint(l,u)),d=h.next();!d.done;d=h.next()){var f=d.value;if(f.shadowRoot&&f.shadowRoot!==t)return this.pick(e,f.shadowRoot,n);var p=e.get(f);if(p&&p.isInteractive()&&(c.push(p),o))return n.picked=c,n}}catch(e){i={error:e}}finally{try{d&&!d.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}n.picked=c}catch(e){n.picked=[]}return n},e.tag="SVGPicker",e}(),u=function(e){function t(){var t=e.apply(this,(0,r.__spreadArray)([],(0,r.__read)(arguments),!1))||this;return t.name="svg-picker",t}return(0,r.__extends)(t,e),t.prototype.init=function(){this.addRenderingPlugin(new l)},t.prototype.destroy=function(){this.removeAllRenderingPlugins()},t}(i.F6),c=n(79364),h=n(12873),d=n(55072),f=n(17517),p=function(){function e(){}return e.tag="c-svg-element",e}();function v(e,t){return(t||document).createElementNS("http://www.w3.org/2000/svg",e)}var g="g-filter-";function m(e,t,n,r,i){var a=g+n.entity,o=t.querySelectorAll("[name=".concat(a,"]"));if(o.length&&o.forEach((function(e){t.removeChild(e)})),0===i.length)null==r||r.removeAttribute("filter");else{var s=i.map((function(n,r){var i=n.name,o=n.params,s=v("filter",e);return s.setAttribute("filterUnits","userSpaceOnUse"),"blur"===i?function(e,t,n){var r=v("feGaussianBlur",e);r.setAttribute("in","SourceGraphic"),r.setAttribute("stdDeviation","".concat(n[0].value)),t.appendChild(r)}(e,s,o):"brightness"===i?function(e,t,n){var r=y(n[0]);E(e,t,{type:"linear",slope:r,intercept:0})}(e,s,o):"drop-shadow"===i?function(e,t,n){var r=n[0].value,i=n[1].value,a=n[2].value,o=n[3].formatted,s=v("feGaussianBlur",e);s.setAttribute("in","SourceAlpha"),s.setAttribute("stdDeviation","".concat(a)),t.appendChild(s);var l=v("feOffset",e);l.setAttribute("dx","".concat(r)),l.setAttribute("dy","".concat(i)),l.setAttribute("result","offsetblur"),t.appendChild(l);var u=v("feFlood",e);u.setAttribute("flood-color",o),t.appendChild(u);var c=v("feComposite",e);c.setAttribute("in2","offsetblur"),c.setAttribute("operator","in"),t.appendChild(c);var h=v("feMerge",e);t.appendChild(h);var d=v("feMergeNode",e),f=v("feMergeNode",e);f.setAttribute("in","SourceGraphic"),h.appendChild(d),h.appendChild(f)}(e,s,o):"contrast"===i?function(e,t,n){var r=y(n[0]);E(e,t,{type:"linear",slope:r,intercept:-.5*r+.5})}(e,s,o):"grayscale"===i?function(e,t,n){var r=y(n[0]);_(e,t,[.2126+.7874*(1-r),.7152-.7152*(1-r),.0722-.0722*(1-r),0,0,.2126-.2126*(1-r),.7152+.2848*(1-r),.0722-.0722*(1-r),0,0,.2126-.2126*(1-r),.7152-.7152*(1-r),.0722+.9278*(1-r),0,0,0,0,0,1,0])}(e,s,o):"sepia"===i?function(e,t,n){var r=y(n[0]);_(e,t,[.393+.607*(1-r),.769-.769*(1-r),.189-.189*(1-r),0,0,.349-.349*(1-r),.686+.314*(1-r),.168-.168*(1-r),0,0,.272-.272*(1-r),.534-.534*(1-r),.131+.869*(1-r),0,0,0,0,0,1,0])}(e,s,o):"saturate"===i?function(e,t,n){var r=y(n[0]),i=v("feColorMatrix",e);i.setAttribute("type","saturate"),i.setAttribute("values","".concat(r)),t.appendChild(i)}(e,s,o):"hue-rotate"===i?function(e,t,n){var r=v("feColorMatrix",e);r.setAttribute("type","hueRotate"),r.setAttribute("values","".concat(n[0].value)),t.appendChild(r)}(e,s,o):"invert"===i&&function(e,t,n){var r=y(n[0]);E(e,t,{type:"table",tableValues:"".concat(r," ").concat(1-r)})}(e,s,o),s.id="".concat(a,"-").concat(r),s.setAttribute("name",a),t.appendChild(s),s.id}));setTimeout((function(){null==r||r.setAttribute("filter",s.map((function(e){return"url(#".concat(e,")")})).join(" "))}))}}function y(e){return e.unit===i.Cm.kPercentage?e.value/100:e.value}function E(e,t,n){var r=n.type,i=n.slope,a=n.intercept,o=n.tableValues,s=v("feComponentTransfer",e);[v("feFuncR",e),v("feFuncG",e),v("feFuncB",e)].forEach((function(e){e.setAttribute("type",r),"table"===r?e.setAttribute("tableValues","".concat(o)):(e.setAttribute("slope","".concat(i)),e.setAttribute("intercept","".concat(a))),s.appendChild(e)})),t.appendChild(s)}function _(e,t,n){var r=v("feColorMatrix",e);r.setAttribute("type","matrix"),r.setAttribute("values",n.join(" ")),t.appendChild(r)}var T={},R=0;function S(e,t,n,r,a,o,s,l){if(!a)return"";if(!(0,i.qA)(a)){if((0,i.R)(a)){var u=function(e,t,n,r,a,o){var s=A(r),l=t.querySelector("#".concat(s));if(!l){var u=r.image,h="";if((0,c.Z)(u)?h=u:i.jU&&(u instanceof HTMLImageElement?h=u.src:u instanceof HTMLCanvasElement&&(h=u.toDataURL())),h){var d,f=v("image",e);f.setAttribute("href",h),a?d=a(h):i.jU&&(d=new window.Image),h.match(/^data:/i)||(d.crossOrigin="Anonymous",f.setAttribute("crossorigin","anonymous")),d.src=h;var p=function(){var i=x(e,t,n,r,s,d.width,d.height);t.appendChild(i),i.appendChild(f),f.setAttribute("x","0"),f.setAttribute("y","0"),f.setAttribute("width","".concat(d.width)),f.setAttribute("height","".concat(d.height))};d.complete?p():d.onload=p}if("rect"===u.nodeName){var g=u.parsedStyle,m=g.width,y=g.height,E=x(e,t,u,r,s,m,y);u.forEach((function(t){o.createSVGDom(e,t,null);var n=t.elementSVG,r=t.getLocalTransform();o.applyTransform(n.$groupEl,r)}));var _=u.elementSVG;E.appendChild(_.$groupEl)}}return s}(e,t,n,a,s,l);return r.style[o]="url(#".concat(u,")"),u}if(1===a.length){var h=C(e,n,t,r,a[0]);return null==r||r.setAttribute(o,"url(#".concat(h,")")),h}var d=function(e,t,n,r,i){var a=g+t.entity+"-gradient",o=n.querySelector("#".concat(a));o||((o=v("filter",e)).setAttribute("filterUnits","userSpaceOnUse"),o.setAttribute("x","0%"),o.setAttribute("y","0%"),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.id=a,n.appendChild(o));var s=0;i.forEach((function(i,l){var u=C(e,t,n,r,i),c=u+"_rect",h=v("rect",e);h.setAttribute("x","0"),h.setAttribute("y","0"),h.setAttribute("width","100%"),h.setAttribute("height","100%"),h.setAttribute("fill","url(#".concat(u,")")),h.id=c,n.appendChild(h);var d=v("feImage",e);if(d.setAttribute("href","#".concat(c)),d.setAttribute("result","".concat(a,"-").concat(l)),o.appendChild(d),l>0){var f=v("feBlend",e);f.setAttribute("in",1===l?"".concat(a,"-").concat(l-1):"".concat(a,"-blended-").concat(s-1)),f.setAttribute("in2","".concat(a,"-").concat(l)),f.setAttribute("result","".concat(a,"-blended-").concat(s++)),f.setAttribute("mode","multiply"),o.appendChild(f)}}));var l=v("feComposite",e);return l.setAttribute("in","".concat(a,"-blended-").concat(s)),l.setAttribute("in2","SourceGraphic"),l.setAttribute("operator","in"),o.appendChild(l),a}(e,n,t,r,a);return null==r||r.setAttribute("filter","url(#".concat(d,")")),null==r||r.setAttribute("fill","black"),d}return"currentColor"===n.style[o]?null==r||r.setAttribute(o,"currentColor"):null==r||r.setAttribute(o,a.isNone?"none":a.toString()),""}function A(e,t){void 0===t&&(t={});var n="";if((0,i.Ny)(e)){var a=e.type,o=e.value;if(a===i.GL.LinearGradient||a===i.GL.RadialGradient){var s=(0,r.__assign)((0,r.__assign)({},o),t),l=s.type,u=s.width,h=s.height,d=s.steps,f=s.angle,p=s.cx,v=s.cy,g=s.size;n="gradient-".concat(l,"-").concat((null==f?void 0:f.toString())||0,"-").concat((null==p?void 0:p.toString())||0,"-").concat((null==v?void 0:v.toString())||0,"-").concat((null==g?void 0:g.toString())||0,"-").concat(u,"-").concat(h,"-").concat(d.map((function(e){var t=e.offset,n=e.color;return"".concat(t).concat(n)})).join("-"))}}else(0,i.R)(e)&&(n=(0,c.Z)(e.image)?"pattern-".concat(e.image,"-").concat(e.repetition):"rect"===e.image.nodeName?"pattern-rect-".concat(e.image.entity):"pattern-".concat(R));return n&&(T[n]||(T[n]="g-pattern-"+"".concat(R++))),T[n]}function x(e,t,n,a,o,s,l){var u=a.repetition,c=a.transform,h=v("pattern",e);c&&h.setAttribute("patternTransform",function(e){return(0,i.G$)(e).map((function(e){var t=e.t,n=e.d;if("translate"===t)return"translate(".concat(n[0].value," ").concat(n[1].value,")");if("translatex"===t)return"translate(".concat(n[0].value," 0)");if("translatey"===t)return"translate(0 ".concat(n[0].value,")");if("rotate"===t)return"rotate(".concat(n[0].value,")");if("scale"===t){var i=(null==n?void 0:n.map((function(e){return e.value})))||[1,1];return"scale(".concat(i[0],", ").concat(i[1],")")}if("scalex"===t)return i=(null==n?void 0:n.map((function(e){return e.value})))||[1],"scale(".concat(i[0],", 1)");if("scaley"===t)return i=(null==n?void 0:n.map((function(e){return e.value})))||[1],"scale(1, ".concat(i[0],")");if("skew"===t){var a=(null==n?void 0:n.map((function(e){return e.value})))||[0,0];return"skewX(".concat(a[0],") skewY(").concat(a[1],")")}if("skewx"===t)return a=(null==n?void 0:n.map((function(e){return e.value})))||[0],"skewX(".concat(a[0],")");if("skewy"===t)return a=(null==n?void 0:n.map((function(e){return e.value})))||[0],"skewY(".concat(a[0],")");if("matrix"===t){var o=(0,r.__read)(n.map((function(e){return e.value})),6),s=o[0],l=o[1],u=o[2],c=o[3],h=o[4],d=o[5];return"matrix(".concat(s," ").concat(l," ").concat(u," ").concat(c," ").concat(h," ").concat(d,")")}})).join(" ")}(c)),h.setAttribute("patternUnits","userSpaceOnUse"),h.id=o,t.appendChild(h),h.setAttribute("x","0"),h.setAttribute("y","0");var d=n.getGeometryBounds().halfExtents,f=s,p=l;return"repeat-x"===u?p=2*d[1]:"repeat-y"===u?f=2*d[0]:"no-repeat"===u&&(f=2*d[0],p=2*d[1]),h.setAttribute("width","".concat(f)),h.setAttribute("height","".concat(p)),h}function C(e,t,n,r,a){var o=t.getGeometryBounds(),s=o&&2*o.halfExtents[0]||0,l=o&&2*o.halfExtents[1]||0,u=A(a,{width:s,height:l}),c=n.querySelector("#".concat(u));if(!c){(c=v(a.type===i.GL.LinearGradient?"linearGradient":"radialGradient",e)).setAttribute("gradientUnits","userSpaceOnUse");var h="";a.value.steps.sort((function(e,t){return e.offset.value-t.offset.value})).forEach((function(e){var t=e.offset,n=e.color;h+='<stop offset="'.concat(t.value/100,'" stop-color="').concat(n,'"></stop>')})),c.innerHTML=h,c.id=u,n.appendChild(c)}if(a.type===i.GL.LinearGradient){var d=a.value.angle,f=(0,i.Rx)(s,l,d),p=f.x1,g=f.y1,m=f.x2,y=f.y2;c.setAttribute("x1","".concat(p)),c.setAttribute("y1","".concat(g)),c.setAttribute("x2","".concat(m)),c.setAttribute("y2","".concat(y))}else{var E=a.value,_=E.cx,T=E.cy,R=E.size,S=(0,i.o6)(s,l,_,T,R),x=S.x,C=S.y,M=S.r;c.setAttribute("cx","".concat(x)),c.setAttribute("cy","".concat(C)),c.setAttribute("r","".concat(M))}return u}var M=/url\("?#(.*)\)/,N=function(){function e(e){this.context=e,this.gradientCache={}}return e.prototype.getDefElement=function(){return this.$def},e.prototype.init=function(){var e=this.context.config.document,t=this.context.contextService.getContext();this.$def=v("defs",e),t.appendChild(this.$def)},e.prototype.clear=function(e){var t=this;Object.keys(this.gradientCache).forEach((function(n){t.clearUnusedDefElement(t.gradientCache,n,e)}))},e.prototype.clearUnusedDefElement=function(e,t,n){if(e[t]&&1===e[t].size&&e[t].has(n)){var r=this.$def.querySelector("#".concat(t));r&&this.$def.removeChild(r)}},e.prototype.createOrUpdateGradientAndPattern=function(e,t,n,r,a){var o=this.context.config,s=o.document,l=o.createImage;if(t){var u=((0,i.R)(n)?t.style[r]:t.getAttribute(r)||"").match(M);u&&u.length>1&&this.clearUnusedDefElement(this.gradientCache,u[1].replace('"',""),e.entity);var c=S(s||document,this.$def,e,t,n,r,l,a);c&&(this.gradientCache[c]||(this.gradientCache[c]=new Set),this.gradientCache[c].add(e.entity))}},e.prototype.createOrUpdateShadow=function(e,t,n){!function(e,t,n,r,i){var a=n.parsedStyle,o=a.shadowType,s=a.shadowBlur,l=a.shadowColor,u=a.shadowOffsetX,c=a.shadowOffsetY,h=!(0,d.Z)(l)&&s>0,f="g-filter-dropshadow-"+n.entity,p=t.querySelector("#".concat(f));if(p&&(p.getAttribute("data-type")===o&&h||(p.remove(),p=null)),h){if(null==r||r.setAttribute("filter","url(#".concat(f,")")),!p){if((p=v("filter",e)).setAttribute("data-type",o),"outer"===o)(C=v("feDropShadow",e)).setAttribute("dx","".concat((u||0)/2)),C.setAttribute("dy","".concat((c||0)/2)),C.setAttribute("stdDeviation","".concat((s||0)/4)),C.setAttribute("flood-color",l.toString()),p.appendChild(C);else if("inner"===o){var g=v("feComponentTransfer",e);g.setAttribute("in","SourceAlpha");var m=v("feFuncA",e);m.setAttribute("type","table"),m.setAttribute("tableValues","1 0"),g.appendChild(m),p.appendChild(g),(S=v("feGaussianBlur",e)).setAttribute("stdDeviation","".concat((s||0)/4)),p.appendChild(S),(A=v("feOffset",e)).setAttribute("dx","".concat((u||0)/2)),A.setAttribute("dy","".concat((c||0)/2)),A.setAttribute("result","offsetblur"),p.appendChild(A),(x=v("feFlood",e)).setAttribute("flood-color",l.toString()),x.setAttribute("result","color"),p.appendChild(x);var y=v("feComposite",e);y.setAttribute("in2","offsetblur"),y.setAttribute("operator","in"),p.appendChild(y);var E=v("feComposite",e);E.setAttribute("in2","SourceAlpha"),E.setAttribute("operator","in"),p.appendChild(E);var _=v("feMerge",e);p.appendChild(_);var T=v("feMergeNode",e);T.setAttribute("in","SourceGraphic");var R=v("feMergeNode",e);_.appendChild(T),_.appendChild(R)}return p.id=f,p.setAttribute("filterUnits","userSpaceOnUse"),void t.appendChild(p)}if("inner"===o){var S=p.children[1],A=p.children[2],x=p.children[3];"shadowColor"===i?x.setAttribute("flood-color",l.toString()):"shadowBlur"===i?S.setAttribute("stdDeviation","".concat((s||0)/4)):"shadowOffsetX"===i?A.setAttribute("dx","".concat((u||0)/2)):"shadowOffsetY"===i&&A.setAttribute("dy","".concat((c||0)/2))}else if("outer"===o){var C=p.children[0];"shadowColor"===i?C.setAttribute("flood-color",l.toString()):"shadowBlur"===i?C.setAttribute("stdDeviation","".concat((s||0)/4)):"shadowOffsetX"===i?C.setAttribute("dx","".concat((u||0)/2)):"shadowOffsetY"===i&&C.setAttribute("dy","".concat((c||0)/2))}}else null==r||r.removeAttribute("filter")}(this.context.config.document||document,this.$def,e,t,n)},e.prototype.createOrUpdateFilter=function(e,t,n){m(this.context.config.document||document,this.$def,e,t,n)},e}();function k(e){return e.toFixed(6).replace(".000000","")}function b(e){return e.replace(/[&|<|>|"|']/g,(function(e){return"&"===e?"&amp;":"<"===e?"&lt;":">"===e?"&gt;":'"'===e?"&quot;":"&apos;"}))}var P,O,I={opacity:"opacity",fillStyle:"fill",fill:"fill",fillRule:"fill-rule",fillOpacity:"fill-opacity",strokeStyle:"stroke",strokeOpacity:"stroke-opacity",stroke:"stroke",clipPath:"clip-path",textPath:"text-path",r:"r",rx:"rx",ry:"ry",width:"width",height:"height",lineCap:"stroke-linecap",lineJoin:"stroke-linejoin",lineWidth:"stroke-width",lineDash:"stroke-dasharray",lineDashOffset:"stroke-dashoffset",miterLimit:"stroke-miterlimit",font:"font",fontSize:"font-size",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",fontFamily:"font-family",letterSpacing:"letter-spacing",startArrow:"marker-start",endArrow:"marker-end",class:"class",id:"id",preserveAspectRatio:"preserveAspectRatio",visibility:"visibility",anchor:"anchor",shadowColor:"flood-color",shadowBlur:"stdDeviation",shadowOffsetX:"dx",shadowOffsetY:"dy",filter:"filter",innerHTML:"innerHTML",textAlign:"text-anchor",pointerEvents:"pointer-events"},D={textAlign:{inherit:"inherit",left:"left",start:"left",center:"middle",right:"end",end:"end"}},L={textAlign:"inherit",lineCap:"butt",lineJoin:"miter",lineWidth:"1px",opacity:"1",fillOpacity:"1",fillRule:"nonzero",strokeOpacity:"1",strokeWidth:"0",strokeMiterLimit:"4",letterSpacing:"0",fontSize:"inherit",fontFamily:"inherit",pointerEvents:"auto"},B="g-svg",w="clip-path-",F="text-path-",U=function(){function e(e,t,n){this.pluginOptions=e,this.defElementManager=t,this.context=n,this.svgElementMap=new WeakMap,this.renderQueue=[],this.dirtyAttributes=new WeakMap,this.pendingReorderQueue=new Set,this.clipPathUseMap=new WeakMap}return e.prototype.apply=function(t){var n=this,r=t.renderingService,a=t.renderingContext;this.context=t,this.context.svgElementMap=this.svgElementMap;var o=a.root.ownerDocument.defaultView,s=this.context.config.document,l=function(e){var t=e.target;if(n.clipPathUseMap.get(t)){var r=n.defElementManager.getDefElement().querySelector("#".concat(n.getId(t)));r&&r.remove()}n.createSVGDom(s,t,n.$camera)},u=function(e){var t=e.target;n.defElementManager.clear(t.entity),n.clipPathUseMap.delete(t),n.removeSVGDom(t)},c=function(e){var t,r,i=e.parentNode,a=null===(r=null===(t=e.parentNode)||void 0===t?void 0:t.elementSVG)||void 0===r?void 0:r.$groupEl,o=((null==i?void 0:i.children)||[]).slice();a&&n.reorderChildren(s,a,o)},h=function(e){var t=e.target;c(t)},d=function(e){var t=e.target;if(t.elementSVG){var r=e.attrName,i=n.dirtyAttributes.get(t);i||(n.dirtyAttributes.set(t,[]),i=n.dirtyAttributes.get(t)),i.push(r)}},p=function(e){var t,r=e.target,a=null===(t=r.elementSVG)||void 0===t?void 0:t.$el,o=r.parsedStyle,s=o.fill,l=o.stroke,u=o.clipPath;if(s&&!(0,i.qA)(s)&&n.defElementManager.createOrUpdateGradientAndPattern(r,a,s,"fill",n),l&&!(0,i.qA)(l)&&n.defElementManager.createOrUpdateGradientAndPattern(r,a,l,"stroke",n),u){var c=f.invert(f.create(),r.getWorldTransform()),h=w+u.entity+"-"+r.entity,d=n.defElementManager.getDefElement().querySelector("#".concat(h));d&&n.applyTransform(d,c)}};r.hooks.init.tap(e.tag,(function(){var e=n.context.config,t=e.background,r=e.document;n.defElementManager.init();var a=n.context.contextService.getContext();t&&(a.style.background=t),a.setAttribute("color-interpolation-filters","sRGB"),n.$camera=v("g",r),n.$camera.id="".concat(B,"-camera"),n.applyTransform(n.$camera,n.context.camera.getOrthoMatrix()),a.appendChild(n.$camera),o.addEventListener(i.Dk.MOUNTED,l),o.addEventListener(i.Dk.UNMOUNTED,u),o.addEventListener(i.Dk.REPARENT,h),o.addEventListener(i.Dk.ATTR_MODIFIED,d),o.addEventListener(i.Dk.BOUNDS_CHANGED,p)})),r.hooks.destroy.tap(e.tag,(function(){o.removeEventListener(i.Dk.MOUNTED,l),o.removeEventListener(i.Dk.UNMOUNTED,u),o.removeEventListener(i.Dk.REPARENT,h),o.removeEventListener(i.Dk.ATTR_MODIFIED,d),o.removeEventListener(i.Dk.BOUNDS_CHANGED,p),R=0,T={}})),r.hooks.render.tap(e.tag,(function(e){n.renderQueue.push(e)})),r.hooks.beginFrame.tap(e.tag,(function(){var e=n.context.config.document;n.pendingReorderQueue.size&&(n.pendingReorderQueue.forEach((function(t){var r,i=((null==t?void 0:t.children)||[]).slice(),a=null===(r=null==t?void 0:t.elementSVG)||void 0===r?void 0:r.$groupEl;a&&n.reorderChildren(e||s,a,i||[])})),n.pendingReorderQueue.clear())})),r.hooks.endFrame.tap(e.tag,(function(){a.renderReasons.has(i.Rr.CAMERA_CHANGED)&&n.applyTransform(n.$camera,n.context.camera.getOrthoMatrix()),n.renderQueue.forEach((function(e){var t,r,i=null===(t=e.elementSVG)||void 0===t?void 0:t.$el,a=null===(r=e.elementSVG)||void 0===r?void 0:r.$groupEl;if(i&&a){var o=e.getLocalTransform();n.applyTransform(a,o);var s=n.clipPathUseMap.get(e);s&&s.length&&s.forEach((function(t){n.applyTransform(t,e.getWorldTransform())})),e.renderable.dirty=!1}var l=n.dirtyAttributes.get(e);l&&(l.forEach((function(t){"zIndex"===t?c(e):"increasedLineWidthForHitTesting"===t&&n.createOrUpdateHitArea(e,i,a),n.updateAttribute(e,[t])})),n.dirtyAttributes.delete(e))})),n.renderQueue=[]}))},e.prototype.getId=function(e){return e.id||"".concat(B,"-").concat(e.entity)},e.prototype.reorderChildren=function(e,t,n){if(n.sort((function(e,t){return e.sortable.renderOrder-t.sortable.renderOrder})),n.length){var r=(e||document).createDocumentFragment();n.forEach((function(e){if(e.isConnected){var t=e.elementSVG.$groupEl;t&&r.appendChild(t)}})),t.appendChild(r)}},e.prototype.applyTransform=function(e,t){e.setAttribute("transform","matrix(".concat(k(t[0]),",").concat(k(t[1]),",").concat(k(t[4]),",").concat(k(t[5]),",").concat(k(t[12]),",").concat(k(t[13]),")"))},e.prototype.applyAttributes=function(e){var t=e.elementSVG,n=null==t?void 0:t.$el,r=null==t?void 0:t.$groupEl;if(n&&r){var a=e.nodeName,o=e.attributes;a!==i.bn.HTML&&n.setAttribute("fill","none"),a===i.bn.IMAGE&&n.setAttribute("preserveAspectRatio","none"),this.updateAttribute(e,Object.keys(o))}},e.prototype.updateAttribute=function(e,t){var n=this,r=this.context.enableCSSParsing,a=this.context.config.document,o=e.elementSVG,s=o.$el,l=o.$groupEl,u=o.$hitTestingEl,c=e.parsedStyle,h=e.computedStyle,f=e.nodeName;t.some((function(t){return n.context.SVGElementLifeCycleContribution.shouldUpdateElementAttribute(e,t)}))&&s&&[s,u].forEach((function(t){t&&(n.context.SVGElementLifeCycleContribution.updateElementAttribute(e,t,n.svgElementMap),e.nodeName!==i.bn.TEXT&&n.updateAnchorWithTransform(e))})),t.forEach((function(t){var o,p,v=I[t],g=r?h[t]:c[t],m=!(0,d.Z)(g)&&g.toString(),y=(null===(o=D[t])||void 0===o?void 0:o[m])||m,E=c[t],_=v&&!!(null===(p=i.N1[t])||void 0===p?void 0:p.inh);if(f===i.bn.HTML)"fill"===t?s.style.background=E.toString():"stroke"===t?(s.style["border-color"]=E.toString(),s.style["border-style"]="solid"):"lineWidth"===t?s.style["border-width"]="".concat(E||0,"px"):"lineDash"===t?s.style["border-style"]="dashed":"innerHTML"===t?n.createOrUpdateInnerHTML(a,s,E):"width"===t||"height"===t||"class"===t?s.setAttribute(t,E.toString()):"x"===t||"y"===t||(0,d.Z)(e.style[t])||""===e.style[t]||(s.style[t]=e.style[t]);else{if(!v||(f===i.bn.GROUP||e.isCustomElement)&&!r&&(_||"fill"===v||"stroke"===v))return;"fill"===t||"stroke"===t?n.defElementManager.createOrUpdateGradientAndPattern(e,s,E,v,n):r&&_?"unset"!==m&&m!==L[t]?null==l||l.setAttribute(v,y):null==l||l.removeAttribute(v):"clipPath"===t?n.createOrUpdateClipOrTextPath(a,E,e):"textPath"===t?n.createOrUpdateClipOrTextPath(a,E,e,!0):"shadowType"===t||"shadowColor"===t||"shadowBlur"===t||"shadowOffsetX"===t||"shadowOffsetY"===t?n.defElementManager.createOrUpdateShadow(e,s,t):"filter"===t?n.defElementManager.createOrUpdateFilter(e,s,E):"anchor"===t?f!==i.bn.TEXT&&n.updateAnchorWithTransform(e):(0,d.Z)(g)||[s,u].forEach((function(e){e&&v&&("unset"!==m&&m!==L[t]?e.setAttribute(v,y):e.removeAttribute(v))}))}}))},e.prototype.createSVGDom=function(e,t,n,r){var a;void 0===r&&(r=!1),t.elementSVG=new p;var o=t.elementSVG,s=this.context.SVGElementLifeCycleContribution.createElement(t,this.svgElementMap);if(s){var l=void 0;t.nodeName===i.bn.HTML&&(t.parsedStyle.$el=s),this.pluginOptions.outputSVGElementId&&(s.id=this.getId(t)),this.pluginOptions.outputSVGElementName&&t.name&&s.setAttribute("name",t.name),!s.hasAttribute("data-wrapgroup")&&"g"===s.nodeName||r?l=s:(l=v("g",e)).appendChild(s),o.$el=s,o.$groupEl=l,this.applyAttributes(t),this.createOrUpdateHitArea(t,s,l);var u=n||t.parentNode&&(null===(a=t.parentNode.elementSVG)||void 0===a?void 0:a.$groupEl);u&&(u.appendChild(l),this.pendingReorderQueue.add(t.parentNode))}},e.prototype.removeSVGDom=function(e){var t,n=null===(t=e.elementSVG)||void 0===t?void 0:t.$groupEl;n&&n.parentNode&&(n.parentNode.removeChild(n),this.context.SVGElementLifeCycleContribution.destroyElement(e,n))},e.prototype.createOrUpdateHitArea=function(e,t,n){var r=e.elementSVG,i=r.$hitTestingEl,a=Number(e.parsedStyle.increasedLineWidthForHitTesting);if(a){if(!i){i=t.cloneNode(),["filter"].forEach((function(e){i.removeAttribute(e)}));var o="none"!==t.getAttribute("fill");i.setAttribute("fill",o?"transparent":"none"),i.setAttribute("stroke","transparent"),n.appendChild(i),r.$hitTestingEl=i,this.svgElementMap.set(i,e)}i.setAttribute("stroke-width","".concat(a+e.parsedStyle.lineWidth))}else i&&(n.removeChild(i),r.$hitTestingEl=null)},e.prototype.createOrUpdateInnerHTML=function(e,t,n){var r=(e||document).createElement("div");"string"==typeof n?r.innerHTML=n:r.appendChild(n),t.innerHTML="",t.appendChild(r)},e.prototype.createOrUpdateClipOrTextPath=function(e,t,n,r){void 0===r&&(r=!1);var i=n.elementSVG.$groupEl,a=r?"g":"clipPath",o=r?"text-path":"clip-path";if(t){var s=(r?F:w)+t.entity+"-"+n.entity,l=this.defElementManager.getDefElement();if(!l.querySelector("#".concat(s))){var u=void 0;if(r)this.createSVGDom(e,t,null,!0),u=t.elementSVG.$el;else{if(!t.isConnected)l.querySelector("#".concat(this.getId(t)))||this.createSVGDom(e,t,l,!0);u=v(a,e);var c=v("use",e);c.setAttribute("href","#".concat(t.elementSVG.$el.id)),u.appendChild(c);var h=this.clipPathUseMap.get(t);h||(this.clipPathUseMap.set(t,[]),h=this.clipPathUseMap.get(t)),h.push(c),this.applyTransform(c,t.getWorldTransform());var d=f.invert(f.create(),n.getWorldTransform());this.applyTransform(u,d)}this.pluginOptions.outputSVGElementId&&(u.id=s),l.appendChild(u)}this.applyAttributes(t),r||i.setAttribute(o,"url(#".concat(s,")"))}else r||i.removeAttribute(o)},e.prototype.updateAnchorWithTransform=function(e){var t,n,r=e.getGeometryBounds(),a=r&&2*r.halfExtents[0]||0,o=r&&2*r.halfExtents[1]||0,s=(e.parsedStyle||{}).anchor;[null===(t=e.elementSVG)||void 0===t?void 0:t.$el,null===(n=e.elementSVG)||void 0===n?void 0:n.$hitTestingEl].forEach((function(t){if(t){var n=-s[0]*a,r=-s[1]*o;0===n&&0===r||t.setAttribute("transform","translate(".concat(n,",").concat(r,")")),e.nodeName!==i.bn.CIRCLE&&e.nodeName!==i.bn.ELLIPSE||(t.setAttribute("cx","".concat(a/2)),t.setAttribute("cy","".concat(o/2)))}}))},e.tag="SVGRenderer",e}(),G={top:"hanging",middle:"central",bottom:"text-after-edge",alphabetic:"alphabetic",ideographic:"ideographic",hanging:"hanging"};var Z=((P={})[i.bn.RECT]="path",P[i.bn.CIRCLE]="circle",P[i.bn.ELLIPSE]="ellipse",P[i.bn.IMAGE]="image",P[i.bn.GROUP]="g",P[i.bn.LINE]="line",P[i.bn.POLYLINE]="polyline",P[i.bn.POLYGON]="polygon",P[i.bn.TEXT]="text",P[i.bn.PATH]="path",P[i.bn.HTML]="foreignObject",P),V=((O={})[i.bn.CIRCLE]=["r"],O[i.bn.ELLIPSE]=["rx","ry"],O[i.bn.RECT]=["width","height","radius"],O[i.bn.IMAGE]=["img","width","height"],O[i.bn.LINE]=["x1","y1","x2","y2","markerStart","markerEnd","markerStartOffset","markerEndOffset"],O[i.bn.POLYLINE]=["points","markerStart","markerEnd","markerMid","markerStartOffset","markerEndOffset"],O[i.bn.POLYGON]=["points","markerStart","markerEnd","markerMid","markerStartOffset","markerEndOffset"],O[i.bn.PATH]=["path","markerStart","markerEnd","markerMid","markerStartOffset","markerEndOffset"],O[i.bn.TEXT]=["text","font","fontSize","fontFamily","fontStyle","fontWeight","fontVariant","lineHeight","letterSpacing","wordWrap","wordWrapWidth","maxLines","leading","textBaseline","textAlign","textTransform","textOverflow","textPath","textPathSide","textPathStartOffset","textDecorationLine","textDecorationColor","textDecorationStyle","dx","dy"],O),X=function(){function e(e,t){this.context=e,this.runtime=t}return e.prototype.createElement=function(e,t){var n=this.context.config.document,r=v(Z[e.nodeName]||"g",n||document);return t.set(r,e),r},e.prototype.destroyElement=function(e,t){},e.prototype.shouldUpdateElementAttribute=function(e,t){var n=e.nodeName;return(V[n]||[]).indexOf(t)>-1},e.prototype.updateElementAttribute=function(e){var t=e.elementSVG.$el,n=e.nodeName,a=e.parsedStyle;switch(n){case i.bn.IMAGE:!function(e,t){var n=t.img,r=void 0===n?"":n,i=t.width,a=t.height;if(e.setAttribute("x","0"),e.setAttribute("y","0"),(0,c.Z)(r))e.setAttribute("href",r);else if(r instanceof Image)i||e.setAttribute("width","".concat(r.width)),a||e.setAttribute("height","".concat(r.height)),e.setAttribute("href",r.src);else if(r instanceof HTMLElement&&(0,c.Z)(r.nodeName)&&"CANVAS"===r.nodeName.toUpperCase())e.setAttribute("href",r.toDataURL());else if(r instanceof ImageData){var o=document.createElement("canvas");o.setAttribute("width","".concat(r.width)),o.setAttribute("height","".concat(r.height));var s=o.getContext("2d");s&&(s.putImageData(r,0,0),i||e.setAttribute("width","".concat(r.width)),a||e.setAttribute("height","".concat(r.height)),e.setAttribute("href",o.toDataURL()))}}(t,a);break;case i.bn.RECT:!function(e,t){var n=t.radius,i=t.width,a=t.height;if(isFinite(i)&&isFinite(a)){var o="";if(n&&n.some((function(e){return 0!==e}))){var s=(0,r.__read)(n.map((function(e){return(0,h.Z)(e,0,Math.min(Math.abs(i)/2,Math.abs(a)/2))})),4),l=s[0],u=s[1],c=s[2],d=s[3],f=i>0?1:-1,p=a>0?1:-1,v=f+p!==0?1:0;o=[["M ".concat(f*l,",0")],["l ".concat(i-f*(l+u),",0")],["a ".concat(u,",").concat(u,",0,0,").concat(v,",").concat(f*u,",").concat(p*u)],["l 0,".concat(a-p*(u+c))],["a ".concat(c,",").concat(c,",0,0,").concat(v,",").concat(-f*c,",").concat(p*c)],["l ".concat(f*(c+d)-i,",0")],["a ".concat(d,",").concat(d,",0,0,").concat(v,",").concat(-f*d,",").concat(-p*d)],["l 0,".concat(p*(d+l)-a)],["a ".concat(l,",").concat(l,",0,0,").concat(v,",").concat(f*l,",").concat(-p*l)],["z"]].join(" ")}else o="M 0,0 l ".concat(i,",0 l 0,").concat(a," l").concat(-i," 0 z");e.setAttribute("d",o)}}(t,a);break;case i.bn.LINE:!function(e,t){var n,r,a=t.x1,o=t.y1,s=t.x2,l=t.y2,u=t.defX,c=void 0===u?0:u,h=t.defY,d=void 0===h?0:h,f=t.markerStart,p=t.markerEnd,v=t.markerStartOffset,g=t.markerEndOffset,m=0,y=0,E=0,_=0,T=0;f&&(0,i.RV)(f)&&v&&(n=s-a,r=l-o,T=Math.atan2(r,n),m=Math.cos(T)*(v||0),y=Math.sin(T)*(v||0)),p&&(0,i.RV)(p)&&g&&(n=a-s,r=o-l,T=Math.atan2(r,n),E=Math.cos(T)*(g||0),_=Math.sin(T)*(g||0)),e.setAttribute("x1","".concat(a-c+m)),e.setAttribute("y1","".concat(o-d+y)),e.setAttribute("x2","".concat(s-c+E)),e.setAttribute("y2","".concat(l-d+_))}(t,a);break;case i.bn.POLYGON:case i.bn.POLYLINE:!function(e,t){var n=t.points.points,r=t.defX,a=void 0===r?0:r,o=t.defY,s=void 0===o?0:o,l=t.markerStart,u=t.markerStartOffset,c=t.markerEnd,h=t.markerEndOffset,d=n.length;if(n&&d>=2){var f=0,p=0,v=0,g=0,m=0,y=void 0,E=void 0;l&&(0,i.RV)(l)&&u&&(y=n[1][0]-n[0][0],E=n[1][1]-n[0][1],m=Math.atan2(E,y),f=Math.cos(m)*(u||0),p=Math.sin(m)*(u||0)),c&&(0,i.RV)(c)&&h&&(y=n[d-2][0]-n[d-1][0],E=n[d-2][1]-n[d-1][1],m=Math.atan2(E,y),v=Math.cos(m)*(h||0),g=Math.sin(m)*(h||0)),e.setAttribute("points",n.map((function(e,t){var n=0,r=0;return 0===t?(n=f,r=p):t===d-1&&(n=v,r=g),"".concat(e[0]-a+n,",").concat(e[1]-s+r)})).join(" "))}}(t,a);break;case i.bn.PATH:!function(e,t){var n,a,o=t.path,s=t.defX,l=void 0===s?0:s,u=t.defY,c=void 0===u?0:u,h=t.markerStart,d=t.markerEnd,f=t.markerStartOffset,p=t.markerEndOffset,v=0,g=0,m=0,y=0,E=0;if(h&&(0,i.RV)(h)&&f){var _=(0,r.__read)(h.parentNode.getStartTangent(),2),T=_[0],R=_[1];n=T[0]-R[0],a=T[1]-R[1],E=Math.atan2(a,n),v=Math.cos(E)*(f||0),g=Math.sin(E)*(f||0)}if(d&&(0,i.RV)(d)&&p){var S=(0,r.__read)(d.parentNode.getEndTangent(),2);T=S[0],R=S[1],n=T[0]-R[0],a=T[1]-R[1],E=Math.atan2(a,n),m=Math.cos(E)*(p||0),y=Math.sin(E)*(p||0)}e.setAttribute("d",(0,i.MM)(o.absolutePath,l,c,v,g,m,y))}(t,a);break;case i.bn.TEXT:!function(e,t,n,r){var i=t.lineWidth,a=t.dx,o=t.dy,s=t.textPath,l=t.textPathSide,u=void 0===l?"left":l,c=t.textPathStartOffset,h=void 0===c?0:c,d=t.textDecorationLine,f=void 0===d?"":d,p=t.textDecorationColor,g=void 0===p?"":p,m=t.textDecorationStyle,y=void 0===m?"":m,E=t.metrics,_=t.textBaseline;r.enableCSSParsing||"alphabetic"!==_||(_="bottom"),e.setAttribute("dominant-baseline",G[_]),e.setAttribute("paint-order","stroke");var T=E.lines,R=E.lineHeight,S=E.height,A=T.length,x="";if(0===a&&0===o||(x+="transform:translate(".concat(a,"px, ").concat(o,"px);")),f&&"none"!==f&&(x+="text-decoration:".concat(f," ").concat(y," ").concat(g,";")),x&&e.setAttribute("style",x),1===A){var C=b(T[0]);if(e.setAttribute("dx","".concat(i/2)),"bottom"!==_&&"top"!==_||(e.setAttribute("dominant-baseline",G.middle),e.setAttribute("dy","bottom"===_?"-".concat(S/2,"px"):"".concat(S/2,"px"))),s){e.innerHTML="";var M=v("textPath",e.ownerDocument);M.setAttribute("href","#".concat(F+s.entity)),"left"!==u&&M.setAttribute("side",u),0!==h&&M.setAttribute("startOffset","".concat(h)),M.innerHTML=C,e.appendChild(M)}else e.innerHTML=C}else e.innerHTML=T.map((function(e,t){var n=0;return 0===t?"middle"===_?n=R/2-S/2:"top"===_||"hanging"===_?n=0:"bottom"!==_&&"alphabetic"!==_&&"ideographic"!==_||(n=-R*(A-1)):n=R,'<tspan x="0" dx="'.concat(i/2,'" dy="').concat(n,'">').concat(b(e),"</tspan>")})).join("")}(t,a,0,this.runtime)}},e}(),W=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return n.options=t,n.name="svg-renderer",n}return(0,r.__extends)(t,e),t.prototype.init=function(e){var t=this.options,n=t.outputSVGElementId,r=t.outputSVGElementName,i=new N(this.context),a=new X(this.context,e);this.context.defaultElementLifeCycleContribution=a,this.context.SVGElementLifeCycleContribution=a;var o={outputSVGElementId:!!(0,d.Z)(n)||!!n,outputSVGElementName:!!(0,d.Z)(r)||!!r};this.addRenderingPlugin(new U(o,i,this.context))},t.prototype.destroy=function(){this.removeAllRenderingPlugins(),delete this.context.defaultElementLifeCycleContribution,delete this.context.SVGElementLifeCycleContribution},t}(i.F6),H=n(15940),Y=function(){function e(e){this.canvasConfig=e.config}return e.prototype.init=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a;return(0,r.__generator)(this,(function(r){return e=this.canvasConfig,t=e.container,n=e.document,this.$container=(0,c.Z)(t)?(n||document).getElementById(t):t,this.$container&&(this.$container.style.position||(this.$container.style.position="relative"),(i=v("svg",n)).setAttribute("width","".concat(this.canvasConfig.width)),i.setAttribute("height","".concat(this.canvasConfig.height)),this.$container.appendChild(i),this.$namespace=i),a=(a=window.devicePixelRatio||1)>=1?Math.ceil(a):1,this.dpr=a,[2]}))}))},e.prototype.getDomElement=function(){return this.$namespace},e.prototype.getContext=function(){return this.$namespace},e.prototype.getDPR=function(){return this.dpr},e.prototype.getBoundingClientRect=function(){var e;return null===(e=this.$namespace)||void 0===e?void 0:e.getBoundingClientRect()},e.prototype.destroy=function(){this.$container&&this.$namespace&&this.$namespace.parentNode&&this.$container.removeChild(this.$namespace)},e.prototype.resize=function(e,t){this.$namespace&&(this.$namespace.setAttribute("width","".concat(e)),this.$namespace.setAttribute("height","".concat(t)))},e.prototype.applyCursorStyle=function(e){this.$container&&(this.$container.style.cursor=e)},e.prototype.toDataURL=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n;return(0,r.__generator)(this,(function(r){return e=this.$namespace.cloneNode(!0),t=document.implementation.createDocumentType("svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),(n=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",t)).replaceChild(e,n.documentElement),[2,"data:image/svg+xml;charset=utf8,".concat(encodeURIComponent((new XMLSerializer).serializeToString(n)))]}))}))},e}(),z=function(e){function t(){var t=e.apply(this,(0,r.__spreadArray)([],(0,r.__read)(arguments),!1))||this;return t.name="mobile-svg-context-register",t}return(0,r.__extends)(t,e),t.prototype.init=function(){this.context.ContextService=Y},t.prototype.destroy=function(){delete this.context.ContextService},t}(i.F6),K=function(e){function t(t){var n=e.call(this,t)||this;return n.registerPlugin(new z),n.registerPlugin(new W),n.registerPlugin(new s),n.registerPlugin(new u),n.registerPlugin(new a.S({isDocumentDraggable:!!(0,d.Z)(null==t?void 0:t.isDocumentDraggable)||t.isDocumentDraggable,isDocumentDroppable:!!(0,d.Z)(null==t?void 0:t.isDocumentDroppable)||t.isDocumentDroppable,dragstartDistanceThreshold:(0,d.Z)(null==t?void 0:t.dragstartDistanceThreshold)?10:t.dragstartDistanceThreshold,dragstartTimeThreshold:(0,d.Z)(null==t?void 0:t.dragstartTimeThreshold)?50:t.dragstartTimeThreshold})),n.registerPlugin(new H.S({isDocumentGestureEnabled:!0})),n}return(0,r.__extends)(t,e),t}(i.I8)},34381:function(e,t,n){n.d(t,{Th:function(){return of}});var r=n(34944),i=n.n(r),a=n(78643),o=n(54091),s=n(85545),l=n(62228),u=n(67538),c=n(96103),h=n(55332),d=n(38471),f=n(26186),p=n(47156),v=n(17517),g=n(88244),m=n(52810),y=n(38516),E=n(98773),_=n(43665),T=n(55072),R=n(79364),S=n(12873),A=n(24753),x=n(91508),C=n(53982),M=n(99107),N=n(57002),k=n(60241),b=n(31973),P=n(20773),O=n(50315),I=n(53894),D=n(76622),L=n(86703),B=n(70148),w=n(90176),F=n(17020),U=n(45327),G=n(21254),Z=n(57387),V=n(60286),X=n(67505);function W(e,t,n,r){var i=e-n,a=t-r;return Math.sqrt(i*i+a*a)}function H(e,t){var n=Math.min.apply(Math,(0,c.Z)(e)),r=Math.min.apply(Math,(0,c.Z)(t));return{x:n,y:r,width:Math.max.apply(Math,(0,c.Z)(e))-n,height:Math.max.apply(Math,(0,c.Z)(t))-r}}function Y(e,t,n,r,i,a){return n*Math.cos(i)*Math.cos(a)-r*Math.sin(i)*Math.sin(a)+e}function z(e,t,n,r,i,a){return n*Math.sin(i)*Math.cos(a)+r*Math.cos(i)*Math.sin(a)+t}function K(e,t,n,r,i,a,o){for(var s=function(e,t,n){return Math.atan(-t/e*Math.tan(n))}(n,r,i),l=1/0,u=-1/0,c=[a,o],h=2*-Math.PI;h<=2*Math.PI;h+=Math.PI){var d=s+h;a<o?a<d&&d<o&&c.push(d):o<d&&d<a&&c.push(d)}for(var f=0;f<c.length;f++){var p=Y(e,0,n,r,i,c[f]);p<l&&(l=p),p>u&&(u=p)}for(var v=function(e,t,n){return Math.atan(t/(e*Math.tan(n)))}(n,r,i),g=1/0,m=-1/0,y=[a,o],E=2*-Math.PI;E<=2*Math.PI;E+=Math.PI){var _=v+E;a<o?a<_&&_<o&&y.push(_):o<_&&_<a&&y.push(_)}for(var T=0;T<y.length;T++){var R=z(0,t,n,r,i,y[T]);R<g&&(g=R),R>m&&(m=R)}return{x:l,y:g,width:u-l,height:m-g}}function j(e,t,n,r){return W(e,t,n,r)}function q(e,t,n,r,i){return{x:(1-i)*e+i*n,y:(1-i)*t+i*r}}function Q(e,t,n,r,i){var a=1-i;return a*a*a*e+3*t*i*a*a+3*n*i*i*a+r*i*i*i}function $(e,t,n,r){var i,a,o,s=-3*e+9*t-9*n+3*r,l=6*e-12*t+6*n,u=3*t-3*e,c=[];if((0,M.Z)(s,0))(0,M.Z)(l,0)||(i=-u/l)>=0&&i<=1&&c.push(i);else{var h=l*l-4*s*u;(0,M.Z)(h,0)?c.push(-l/(2*s)):h>0&&(a=(-l-(o=Math.sqrt(h)))/(2*s),(i=(-l+o)/(2*s))>=0&&i<=1&&c.push(i),a>=0&&a<=1&&c.push(a))}return c}function J(e,t,n,r,i,a,o,s,l){if(0===l)return function(e,t){for(var n=0,r=e.length,i=0;i<r;i++)n+=W(e[i],t[i],e[(i+1)%r],t[(i+1)%r]);return n/2}([e,n,i,o],[t,r,a,s]);var u=function(e,t,n,r,i,a,o,s,l){var u=Q(e,n,i,o,l),c=Q(t,r,a,s,l),h=q(e,t,n,r,l),d=q(n,r,i,a,l),f=q(i,a,o,s,l),p=q(h.x,h.y,d.x,d.y,l),v=q(d.x,d.y,f.x,f.y,l);return[[e,t,h.x,h.y,p.x,p.y,u,c],[u,c,v.x,v.y,f.x,f.y,o,s]]}(e,t,n,r,i,a,o,s,.5),h=[].concat((0,c.Z)(u[0]),[l-1]),d=[].concat((0,c.Z)(u[1]),[l-1]);return J.apply(void 0,(0,c.Z)(h))+J.apply(void 0,(0,c.Z)(d))}function ee(e,t,n,r,i,a,o,s){for(var l=[e,o],u=[t,s],c=$(e,n,i,o),h=$(t,r,a,s),d=0;d<c.length;d++)l.push(Q(e,n,i,o,c[d]));for(var f=0;f<h.length;f++)u.push(Q(t,r,a,s,h[f]));return H(l,u)}function te(e){if(e.length<2)return 0;for(var t=0,n=0;n<e.length-1;n++){var r=e[n],i=e[n+1];t+=W(r[0],r[1],i[0],i[1])}return t}function ne(e,t,n,r){var i=1-r;return i*i*e+2*r*i*t+r*r*n}function re(e,t,n){var r=e+n-2*t;if((0,M.Z)(r,0))return[.5];var i=(e-t)/r;return i<=1&&i>=0?[i]:[]}function ie(e,t,n,r,i,a,o){if(0===o)return(W(e,t,n,r)+W(n,r,i,a)+W(e,t,i,a))/2;var s=function(e,t,n,r,i,a,o){var s=ne(e,n,i,o),l=ne(t,r,a,o),u=q(e,t,n,r,o),c=q(n,r,i,a,o);return[[e,t,u.x,u.y,s,l],[s,l,c.x,c.y,i,a]]}(e,t,n,r,i,a,.5),l=s[0],u=s[1];return l.push(o-1),u.push(o-1),ie.apply(void 0,(0,c.Z)(l))+ie.apply(void 0,(0,c.Z)(u))}function ae(e,t,n,r,i,a){var o=re(e,n,i)[0],s=re(t,r,a)[0],l=[e,i],u=[t,a];return void 0!==o&&l.push(ne(e,n,i,o)),void 0!==s&&u.push(ne(t,r,a,s)),H(l,u)}var oe=n(24395),se=n(76895),le=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self&&self,{exports:{}});le.exports=function(){function e(e,n,i,a,o){t(e,n,i||0,a||e.length-1,o||r)}function t(e,r,i,a,o){for(;a>i;){if(a-i>600){var s=a-i+1,l=r-i+1,u=Math.log(s),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);t(e,r,Math.max(i,Math.floor(r-l*c/s+h)),Math.min(a,Math.floor(r+(s-l)*c/s+h)),o)}var d=e[r],f=i,p=a;for(n(e,i,r),o(e[a],d)>0&&n(e,i,a);f<p;){for(n(e,f,p),f++,p--;o(e[f],d)<0;)f++;for(;o(e[p],d)>0;)p--}0===o(e[i],d)?n(e,i,p):n(e,++p,a),p<=r&&(i=p+1),r<=p&&(a=p-1)}}function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t){return e<t?-1:e>t?1:0}var i=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function o(e,t){s(e,0,e.children.length,t,e)}function s(e,t,n,r,i){i||(i=m(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var a=t;a<n;a++){var o=e.children[a];l(i,e.leaf?r(o):o)}return i}function l(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function u(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function p(e,t){var n=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,i-n)*Math.max(0,a-r)}function v(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(t,n,r,i,a){for(var o=[n,r];o.length;)if(!((r=o.pop())-(n=o.pop())<=i)){var s=n+Math.ceil((r-n)/i/2)*i;e(t,s,n,r,a),o.push(n,s,s,r)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(e){var t=this.data,n=[];if(!g(e,t))return n;for(var r=this.toBBox,i=[];t;){for(var a=0;a<t.children.length;a++){var o=t.children[a],s=t.leaf?r(o):o;g(e,s)&&(t.leaf?n.push(o):v(e,s)?this._all(o,n):i.push(o))}t=i.pop()}return n},i.prototype.collides=function(e){var t=this.data;if(!g(e,t))return!1;for(var n=[];t;){for(var r=0;r<t.children.length;r++){var i=t.children[r],a=t.leaf?this.toBBox(i):i;if(g(e,a)){if(t.leaf||v(e,a))return!0;n.push(i)}}t=n.pop()}return!1},i.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},i.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},i.prototype.clear=function(){return this.data=m([]),this},i.prototype.remove=function(e,t){if(!e)return this;for(var n,r,i,o=this.data,s=this.toBBox(e),l=[],u=[];o||l.length;){if(o||(o=l.pop(),r=l[l.length-1],n=u.pop(),i=!0),o.leaf){var c=a(e,o.children,t);if(-1!==c)return o.children.splice(c,1),l.push(o),this._condense(l),this}i||o.leaf||!v(o,s)?r?(n++,o=r.children[n],i=!1):o=null:(l.push(o),u.push(n),n=0,r=o,o=o.children[0])}return this},i.prototype.toBBox=function(e){return e},i.prototype.compareMinX=function(e,t){return e.minX-t.minX},i.prototype.compareMinY=function(e,t){return e.minY-t.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(e){return this.data=e,this},i.prototype._all=function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},i.prototype._build=function(e,t,n,r){var i,a=n-t+1,s=this._maxEntries;if(a<=s)return o(i=m(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,r-1))),(i=m([])).leaf=!1,i.height=r;var l=Math.ceil(a/s),u=l*Math.ceil(Math.sqrt(s));y(e,t,n,u,this.compareMinX);for(var c=t;c<=n;c+=u){var h=Math.min(c+u-1,n);y(e,c,h,l,this.compareMinY);for(var d=c;d<=h;d+=l){var f=Math.min(d+l-1,h);i.children.push(this._build(e,d,f,r-1))}}return o(i,this.toBBox),i},i.prototype._chooseSubtree=function(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){for(var i=1/0,a=1/0,o=void 0,s=0;s<t.children.length;s++){var l=t.children[s],u=h(l),c=f(e,l)-u;c<a?(a=c,i=u<i?u:i,o=l):c===a&&u<i&&(i=u,o=l)}t=o||t.children[0]}return t},i.prototype._insert=function(e,t,n){var r=n?e:this.toBBox(e),i=[],a=this._chooseSubtree(r,this.data,t,i);for(a.children.push(e),l(a,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)},i.prototype._split=function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var a=this._chooseSplitIndex(n,i,r),s=m(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,o(n,this.toBBox),o(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(n,s)},i.prototype._splitRoot=function(e,t){this.data=m([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(e,t,n){for(var r,i=1/0,a=1/0,o=t;o<=n-t;o++){var l=s(e,0,o,this.toBBox),u=s(e,o,n,this.toBBox),c=p(l,u),d=h(l)+h(u);c<i?(i=c,r=o,a=d<a?d:a):c===i&&d<a&&(a=d,r=o)}return r||n-t},i.prototype._chooseSplitAxis=function(e,t,n){var r=e.leaf?this.compareMinX:u,i=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},i.prototype._allDistMargin=function(e,t,n,r){e.children.sort(r);for(var i=this.toBBox,a=s(e,0,t,i),o=s(e,n-t,n,i),u=d(a)+d(o),c=t;c<n-t;c++){var h=e.children[c];l(a,e.leaf?i(h):h),u+=d(a)}for(var f=n-t-1;f>=t;f--){var p=e.children[f];l(o,e.leaf?i(p):p),u+=d(o)}return u},i.prototype._adjustParentBBoxes=function(e,t,n){for(var r=n;r>=0;r--)l(t[r],e)},i.prototype._condense=function(e){for(var t=e.length-1,n=void 0;t>=0;t--)0===e[t].children.length?t>0?(n=e[t-1].children).splice(n.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},i}();var ue=function(e){return e.GROUP="g",e.FRAGMENT="fragment",e.CIRCLE="circle",e.ELLIPSE="ellipse",e.IMAGE="image",e.RECT="rect",e.LINE="line",e.POLYLINE="polyline",e.POLYGON="polygon",e.TEXT="text",e.PATH="path",e.HTML="html",e.MESH="mesh",e}({}),ce=function(e){return e[e.ZERO=0]="ZERO",e[e.NEGATIVE_ONE=1]="NEGATIVE_ONE",e}({}),he=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.plugins=[]}),[{key:"addRenderingPlugin",value:function(e){this.plugins.push(e),this.context.renderingPlugins.push(e)}},{key:"removeAllRenderingPlugins",value:function(){var e=this;this.plugins.forEach((function(t){var n=e.context.renderingPlugins.indexOf(t);n>=0&&e.context.renderingPlugins.splice(n,1)}))}}])}(),de=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.clipSpaceNearZ=ce.NEGATIVE_ONE,this.plugins=[],this.config=(0,u.Z)({enableDirtyCheck:!0,enableCulling:!1,enableAutoRendering:!0,enableDirtyRectangleRendering:!0,enableDirtyRectangleRenderingDebug:!1,enableSizeAttenuation:!0,enableRenderingOptimization:!1},t)}),[{key:"registerPlugin",value:function(e){-1===this.plugins.findIndex((function(t){return t===e}))&&this.plugins.push(e)}},{key:"unregisterPlugin",value:function(e){var t=this.plugins.findIndex((function(t){return t===e}));t>-1&&this.plugins.splice(t,1)}},{key:"getPlugins",value:function(){return this.plugins}},{key:"getPlugin",value:function(e){return this.plugins.find((function(t){return t.name===e}))}},{key:"getConfig",value:function(){return this.config}},{key:"setConfig",value:function(e){Object.assign(this.config,e)}}])}(),fe=f.add,pe=f.copy,ve=f.max,ge=f.min,me=f.scale,ye=f.sub,Ee=function(){function e(){(0,o.Z)(this,e),this.center=[0,0,0],this.halfExtents=[0,0,0],this.min=[0,0,0],this.max=[0,0,0]}return(0,a.Z)(e,[{key:"update",value:function(e,t){pe(this.center,e),pe(this.halfExtents,t),ye(this.min,this.center,this.halfExtents),fe(this.max,this.center,this.halfExtents)}},{key:"setMinMax",value:function(e,t){fe(this.center,t,e),me(this.center,this.center,.5),ye(this.halfExtents,t,e),me(this.halfExtents,this.halfExtents,.5),pe(this.min,e),pe(this.max,t)}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"add",value:function(t){if(!e.isEmpty(t))if(e.isEmpty(this))this.setMinMax(t.getMin(),t.getMax());else{var n=this.center,r=n[0],i=n[1],a=n[2],o=this.halfExtents,s=o[0],l=o[1],u=o[2],c=r-s,h=r+s,d=i-l,f=i+l,p=a-u,v=a+u,g=t.center,m=g[0],y=g[1],E=g[2],_=t.halfExtents,T=_[0],R=_[1],S=_[2],A=m-T,x=m+T,C=y-R,M=y+R,N=E-S,k=E+S;A<c&&(c=A),x>h&&(h=x),C<d&&(d=C),M>f&&(f=M),N<p&&(p=N),k>v&&(v=k),n[0]=.5*(c+h),n[1]=.5*(d+f),n[2]=.5*(p+v),o[0]=.5*(h-c),o[1]=.5*(f-d),o[2]=.5*(v-p),this.min[0]=c,this.min[1]=d,this.min[2]=p,this.max[0]=h,this.max[1]=f,this.max[2]=v}}},{key:"setFromTransformedAABB",value:function(e,t){var n=this.center,r=this.halfExtents,i=e.center,a=e.halfExtents,o=t[0],s=t[4],l=t[8],u=t[1],c=t[5],h=t[9],d=t[2],f=t[6],p=t[10],v=Math.abs(o),g=Math.abs(s),m=Math.abs(l),y=Math.abs(u),E=Math.abs(c),_=Math.abs(h),T=Math.abs(d),R=Math.abs(f),S=Math.abs(p);n[0]=t[12]+o*i[0]+s*i[1]+l*i[2],n[1]=t[13]+u*i[0]+c*i[1]+h*i[2],n[2]=t[14]+d*i[0]+f*i[1]+p*i[2],r[0]=v*a[0]+g*a[1]+m*a[2],r[1]=y*a[0]+E*a[1]+_*a[2],r[2]=T*a[0]+R*a[1]+S*a[2],ye(this.min,n,r),fe(this.max,n,r)}},{key:"intersects",value:function(e){var t=this.getMax(),n=this.getMin(),r=e.getMax(),i=e.getMin();return n[0]<=r[0]&&t[0]>=i[0]&&n[1]<=r[1]&&t[1]>=i[1]&&n[2]<=r[2]&&t[2]>=i[2]}},{key:"intersection",value:function(t){if(!this.intersects(t))return null;var n=new e,r=ve([0,0,0],this.getMin(),t.getMin()),i=ge([0,0,0],this.getMax(),t.getMax());return n.setMinMax(r,i),n}},{key:"getNegativeFarPoint",value:function(e){return 273===e.pnVertexFlag?pe([0,0,0],this.min):272===e.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:257===e.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:256===e.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:17===e.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:16===e.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:1===e.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:[this.max[0],this.max[1],this.max[2]]}},{key:"getPositiveFarPoint",value:function(e){return 273===e.pnVertexFlag?pe([0,0,0],this.max):272===e.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:257===e.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:256===e.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:17===e.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:16===e.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:1===e.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:[this.min[0],this.min[1],this.min[2]]}}],[{key:"isEmpty",value:function(e){return!e||0===e.halfExtents[0]&&0===e.halfExtents[1]&&0===e.halfExtents[2]}}])}(),_e=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.distance=t||0,this.normal=n||f.fromValues(0,1,0),this.updatePNVertexFlag()}),[{key:"updatePNVertexFlag",value:function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)}},{key:"distanceToPoint",value:function(e){return f.dot(e,this.normal)-this.distance}},{key:"normalize",value:function(){var e=1/f.len(this.normal);f.scale(this.normal,this.normal,e),this.distance*=e}},{key:"intersectsLine",value:function(e,t,n){var r=this.distanceToPoint(e),i=r/(r-this.distanceToPoint(t)),a=i>=0&&i<=1;return a&&n&&f.lerp(n,e,t,i),a}}])}(),Te=function(){return(0,a.Z)((function e(t){if((0,o.Z)(this,e),this.planes=[],t)this.planes=t;else for(var n=0;n<6;n++)this.planes.push(new _e)}),[{key:"extractFromVPMatrix",value:function(e){var t=(0,h.Z)(e,16),n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],p=t[10],v=t[11],g=t[12],m=t[13],y=t[14],E=t[15];f.set(this.planes[0].normal,a-n,u-o,v-c),this.planes[0].distance=E-g,f.set(this.planes[1].normal,a+n,u+o,v+c),this.planes[1].distance=E+g,f.set(this.planes[2].normal,a+r,u+s,v+d),this.planes[2].distance=E+m,f.set(this.planes[3].normal,a-r,u-s,v-d),this.planes[3].distance=E-m,f.set(this.planes[4].normal,a-i,u-l,v-p),this.planes[4].distance=E-y,f.set(this.planes[5].normal,a+i,u+l,v+p),this.planes[5].distance=E+y,this.planes.forEach((function(e){e.normalize(),e.updatePNVertexFlag()}))}}])}(),Re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,o.Z)(this,e),this.x=0,this.y=0,this.x=t,this.y=n}return(0,a.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"copyFrom",value:function(e){this.x=e.x,this.y=e.y}}])}(),Se=function(){function e(t,n,r,i){(0,o.Z)(this,e),this.x=t,this.y=n,this.width=r,this.height=i,this.left=t,this.right=t+r,this.top=n,this.bottom=n+i}return(0,a.Z)(e,[{key:"toJSON",value:function(){}}],[{key:"fromRect",value:function(t){return new e(t.x,t.y,t.width,t.height)}},{key:"applyTransform",value:function(t,n){var r=p.fromValues(t.x,t.y,0,1),i=p.fromValues(t.x+t.width,t.y,0,1),a=p.fromValues(t.x,t.y+t.height,0,1),o=p.fromValues(t.x+t.width,t.y+t.height,0,1),s=p.create(),l=p.create(),u=p.create(),c=p.create();p.transformMat4(s,r,n),p.transformMat4(l,i,n),p.transformMat4(u,a,n),p.transformMat4(c,o,n);var h=Math.min(s[0],l[0],u[0],c[0]),d=Math.min(s[1],l[1],u[1],c[1]),f=Math.max(s[0],l[0],u[0],c[0]),v=Math.max(s[1],l[1],u[1],c[1]);return e.fromRect({x:h,y:d,width:f-h,height:v-d})}}])}(),Ae="Method not implemented.";function xe(e){return void 0===e?0:e>360||e<-360?e%360:e}var Ce=f.create();function Me(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Array.isArray(e)&&3===e.length?r?f.clone(e):f.copy(Ce,e):(0,E.Z)(e)?r?f.fromValues(e,t,n):f.set(Ce,e,t,n):r?f.fromValues(e[0],e[1]||t,e[2]||n):f.set(Ce,e[0],e[1]||t,e[2]||n)}var Ne=Math.PI/180;function ke(e){return e*Ne}var be=180/Math.PI;function Pe(e){return e*be}var Oe=Math.PI/2;function Ie(e,t){return 16===t.length?function(e,t){var n,r,i=v.getScaling(f.create(),t),a=(0,h.Z)(i,3),o=a[0],s=a[1],l=a[2],u=Math.asin(-t[2]/o);return u<Oe?u>-Oe?(n=Math.atan2(t[6]/s,t[10]/l),r=Math.atan2(t[1]/o,t[0]/o)):(r=0,n=-Math.atan2(t[4]/s,t[5]/s)):(r=0,n=Math.atan2(t[4]/s,t[5]/s)),e[0]=n,e[1]=u,e[2]=r,e}(e,t):function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=r*r,s=i*i,l=a*a,u=n*n+o+s+l,c=n*a-r*i;return c>.499995*u?(e[0]=Oe,e[1]=2*Math.atan2(r,n),e[2]=0):c<-.499995*u?(e[0]=-Oe,e[1]=2*Math.atan2(r,n),e[2]=0):(e[0]=Math.asin(2*(n*i-a*r)),e[1]=Math.atan2(2*(n*a+r*i),1-2*(s+l)),e[2]=Math.atan2(2*(n*r+i*a),1-2*(o+s))),e}(e,t)}function De(e){var t=e[0],n=e[1],r=e[3],i=e[4],a=Math.sqrt(t*t+n*n),o=Math.sqrt(r*r+i*i);if(t*i-n*r<0&&(t<i?a=-a:o=-o),a){var s=1/a;t*=s,n*=s}if(o){var l=1/o;r*=l,i*=l}var u=Pe(Math.atan2(n,t));return[e[6],e[7],a,o,u]}var Le=v.create(),Be=v.create(),we=p.create(),Fe=[f.create(),f.create(),f.create()],Ue=f.create();function Ge(e,t,n,r,i){e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i}var Ze=function(e){return e[e.ORBITING=0]="ORBITING",e[e.EXPLORING=1]="EXPLORING",e[e.TRACKING=2]="TRACKING",e}({}),Ve=function(e){return e[e.DEFAULT=0]="DEFAULT",e[e.ROTATIONAL=1]="ROTATIONAL",e[e.TRANSLATIONAL=2]="TRANSLATIONAL",e[e.CINEMATIC=3]="CINEMATIC",e}({}),Xe=function(e){return e[e.ORTHOGRAPHIC=0]="ORTHOGRAPHIC",e[e.PERSPECTIVE=1]="PERSPECTIVE",e}({}),We="updated",He=2e-4,Ye=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.clipSpaceNearZ=ce.NEGATIVE_ONE,this.eventEmitter=new d.Z,this.matrix=v.create(),this.right=f.fromValues(1,0,0),this.up=f.fromValues(0,1,0),this.forward=f.fromValues(0,0,1),this.position=f.fromValues(0,0,1),this.focalPoint=f.fromValues(0,0,0),this.distanceVector=f.fromValues(0,0,-1),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.zoom=1,this.rotateWorld=!1,this.fov=30,this.near=.1,this.far=1e3,this.aspect=1,this.projectionMatrix=v.create(),this.projectionMatrixInverse=v.create(),this.jitteredProjectionMatrix=void 0,this.enableUpdate=!0,this.type=Ze.EXPLORING,this.trackingMode=Ve.DEFAULT,this.projectionMode=Xe.PERSPECTIVE,this.frustum=new Te,this.orthoMatrix=v.create()}),[{key:"isOrtho",value:function(){return this.projectionMode===Xe.ORTHOGRAPHIC}},{key:"getProjectionMode",value:function(){return this.projectionMode}},{key:"getPerspective",value:function(){return this.jitteredProjectionMatrix||this.projectionMatrix}},{key:"getPerspectiveInverse",value:function(){return this.projectionMatrixInverse}},{key:"getFrustum",value:function(){return this.frustum}},{key:"getPosition",value:function(){return this.position}},{key:"getFocalPoint",value:function(){return this.focalPoint}},{key:"getDollyingStep",value:function(){return this.dollyingStep}},{key:"getNear",value:function(){return this.near}},{key:"getFar",value:function(){return this.far}},{key:"getZoom",value:function(){return this.zoom}},{key:"getOrthoMatrix",value:function(){return this.orthoMatrix}},{key:"getView",value:function(){return this.view}},{key:"setEnableUpdate",value:function(e){this.enableUpdate=e}},{key:"setType",value:function(e,t){return this.type=e,this.type===Ze.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===Ze.TRACKING&&void 0!==t&&this.setTrackingMode(t),this}},{key:"setProjectionMode",value:function(e){return this.projectionMode=e,this}},{key:"setTrackingMode",value:function(e){if(this.type!==Ze.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=e,this}},{key:"setWorldRotation",value:function(e){return this.rotateWorld=e,this._getAngles(),this}},{key:"getViewTransform",value:function(){return v.invert(v.create(),this.matrix)}},{key:"getWorldTransform",value:function(){return this.matrix}},{key:"jitterProjectionMatrix",value:function(e,t){var n=v.fromTranslation(v.create(),[e,t,0]);this.jitteredProjectionMatrix=v.multiply(v.create(),n,this.projectionMatrix)}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0}},{key:"setMatrix",value:function(e){return this.matrix=e,this._update(),this}},{key:"setProjectionMatrix",value:function(e){this.projectionMatrix=e}},{key:"setFov",value:function(e){return this.setPerspective(this.near,this.far,e,this.aspect),this}},{key:"setAspect",value:function(e){return this.setPerspective(this.near,this.far,this.fov,e),this}},{key:"setNear",value:function(e){return this.projectionMode===Xe.PERSPECTIVE?this.setPerspective(e,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,e,this.far),this}},{key:"setFar",value:function(e){return this.projectionMode===Xe.PERSPECTIVE?this.setPerspective(this.near,e,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,e),this}},{key:"setViewOffset",value:function(e,t,n,r,i,a){return this.aspect=e/t,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.projectionMode===Xe.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"clearViewOffset",value:function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===Xe.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"setZoom",value:function(e){return this.zoom=e,this.projectionMode===Xe.ORTHOGRAPHIC?this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far):this.projectionMode===Xe.PERSPECTIVE&&this.setPerspective(this.near,this.far,this.fov,this.aspect),this}},{key:"setZoomByViewportPoint",value:function(e,t){var n=this.canvas.viewport2Canvas({x:t[0],y:t[1]}),r=n.x,i=n.y,a=this.roll;this.rotate(0,0,-a),this.setPosition(r,i),this.setFocalPoint(r,i),this.setZoom(e),this.rotate(0,0,a);var o=this.canvas.viewport2Canvas({x:t[0],y:t[1]}),s=o.x,l=o.y,u=f.fromValues(s-r,l-i,0),c=f.dot(u,this.right)/f.length(this.right),d=f.dot(u,this.up)/f.length(this.up),p=this.getPosition(),v=(0,h.Z)(p,2),g=v[0],m=v[1],y=this.getFocalPoint(),E=(0,h.Z)(y,2),_=E[0],T=E[1];return this.setPosition(g-c,m-d),this.setFocalPoint(_-c,T-d),this}},{key:"setPerspective",value:function(e,t,n,r){var i;this.projectionMode=Xe.PERSPECTIVE,this.fov=n,this.near=e,this.far=t,this.aspect=r;var a=this.near*Math.tan(ke(.5*this.fov))/this.zoom,o=2*a,s=this.aspect*o,l=-.5*s;if(null!==(i=this.view)&&void 0!==i&&i.enabled){var u=this.view.fullWidth,c=this.view.fullHeight;l+=this.view.offsetX*s/u,a-=this.view.offsetY*o/c,s*=this.view.width/u,o*=this.view.height/c}return function(e,t,n,r,i,a,o){var s,l,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=2*a,h=n-t,d=r-i,f=c/h,p=c/d,v=(n+t)/h,g=(r+i)/d,m=o-a,y=o*a;u?(s=-o/m,l=-y/m):(s=-(o+a)/m,l=-2*y/m),e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=v,e[9]=g,e[10]=s,e[11]=-1,e[12]=0,e[13]=0,e[14]=l,e[15]=0}(this.projectionMatrix,l,l+s,a-o,a,e,this.far,this.clipSpaceNearZ===ce.ZERO),v.invert(this.projectionMatrixInverse,this.projectionMatrix),this.triggerUpdate(),this}},{key:"setOrthographic",value:function(e,t,n,r,i,a){var o;this.projectionMode=Xe.ORTHOGRAPHIC,this.rright=t,this.left=e,this.top=n,this.bottom=r,this.near=i,this.far=a;var s=(this.rright-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),u=(this.rright+this.left)/2,c=(this.top+this.bottom)/2,h=u-s,d=u+s,f=c+l,p=c-l;if(null!==(o=this.view)&&void 0!==o&&o.enabled){var g=(this.rright-this.left)/this.view.fullWidth/this.zoom,m=(this.top-this.bottom)/this.view.fullHeight/this.zoom;d=(h+=g*this.view.offsetX)+g*this.view.width,p=(f-=m*this.view.offsetY)-m*this.view.height}return this.clipSpaceNearZ===ce.NEGATIVE_ONE?v.ortho(this.projectionMatrix,h,d,f,p,i,a):v.orthoZO(this.projectionMatrix,h,d,f,p,i,a),v.invert(this.projectionMatrixInverse,this.projectionMatrix),this._getOrthoMatrix(),this.triggerUpdate(),this}},{key:"setPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.position[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.position[2],r=Me(e,t,n);return this._setPosition(r),this.setFocalPoint(this.focalPoint),this.triggerUpdate(),this}},{key:"setFocalPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.focalPoint[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.focalPoint[2],r=f.fromValues(0,1,0);if(this.focalPoint=Me(e,t,n),this.trackingMode===Ve.CINEMATIC){var i=f.subtract(f.create(),this.focalPoint,this.position);e=i[0],t=i[1],n=i[2];var a=f.length(i),o=Pe(Math.asin(t/a)),s=90+Pe(Math.atan2(n,e)),l=v.create();v.rotateY(l,l,ke(s)),v.rotateX(l,l,ke(o)),r=f.transformMat4(f.create(),[0,1,0],l)}return v.invert(this.matrix,v.lookAt(v.create(),this.position,this.focalPoint,r)),this._getAxes(),this._getDistance(),this._getAngles(),this.triggerUpdate(),this}},{key:"getDistance",value:function(){return this.distance}},{key:"getDistanceVector",value:function(){return this.distanceVector}},{key:"setDistance",value:function(e){if(this.distance===e||e<0)return this;this.distance=e,this.distance<He&&(this.distance=He),this.dollyingStep=this.distance/100;var t=f.create();e=this.distance;var n=this.forward,r=this.focalPoint;return t[0]=e*n[0]+r[0],t[1]=e*n[1]+r[1],t[2]=e*n[2]+r[2],this._setPosition(t),this.triggerUpdate(),this}},{key:"setMaxDistance",value:function(e){return this.maxDistance=e,this}},{key:"setMinDistance",value:function(e){return this.minDistance=e,this}},{key:"setAzimuth",value:function(e){return this.azimuth=xe(e),this.computeMatrix(),this._getAxes(),this.type===Ze.ORBITING||this.type===Ze.EXPLORING?this._getPosition():this.type===Ze.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(e){return this.elevation=xe(e),this.computeMatrix(),this._getAxes(),this.type===Ze.ORBITING||this.type===Ze.EXPLORING?this._getPosition():this.type===Ze.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getElevation",value:function(){return this.elevation}},{key:"setRoll",value:function(e){return this.roll=xe(e),this.computeMatrix(),this._getAxes(),this.type===Ze.ORBITING||this.type===Ze.EXPLORING?this._getPosition():this.type===Ze.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this}},{key:"getRoll",value:function(){return this.roll}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles(),this._getOrthoMatrix(),this.triggerUpdate()}},{key:"computeMatrix",value:function(){var e=m.setAxisAngle(m.create(),[0,0,1],ke(this.roll));v.identity(this.matrix);var t=m.setAxisAngle(m.create(),[1,0,0],ke((this.rotateWorld&&this.type!==Ze.TRACKING||this.type===Ze.TRACKING?1:-1)*this.elevation)),n=m.setAxisAngle(m.create(),[0,1,0],ke((this.rotateWorld&&this.type!==Ze.TRACKING||this.type===Ze.TRACKING?1:-1)*this.azimuth)),r=m.multiply(m.create(),n,t);r=m.multiply(m.create(),r,e);var i=v.fromQuat(v.create(),r);this.type===Ze.ORBITING||this.type===Ze.EXPLORING?(v.translate(this.matrix,this.matrix,this.focalPoint),v.multiply(this.matrix,this.matrix,i),v.translate(this.matrix,this.matrix,[0,0,this.distance])):this.type===Ze.TRACKING&&(v.translate(this.matrix,this.matrix,this.position),v.multiply(this.matrix,this.matrix,i))}},{key:"_setPosition",value:function(e,t,n){this.position=Me(e,t,n);var r=this.matrix;r[12]=this.position[0],r[13]=this.position[1],r[14]=this.position[2],r[15]=1,this._getOrthoMatrix()}},{key:"_getAxes",value:function(){f.copy(this.right,Me(p.transformMat4(p.create(),[1,0,0,0],this.matrix))),f.copy(this.up,Me(p.transformMat4(p.create(),[0,1,0,0],this.matrix))),f.copy(this.forward,Me(p.transformMat4(p.create(),[0,0,1,0],this.matrix))),f.normalize(this.right,this.right),f.normalize(this.up,this.up),f.normalize(this.forward,this.forward)}},{key:"_getAngles",value:function(){var e=this.distanceVector[0],t=this.distanceVector[1],n=this.distanceVector[2],r=f.length(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===Ze.TRACKING||this.rotateWorld?(this.elevation=Pe(Math.asin(t/r)),this.azimuth=Pe(Math.atan2(-e,-n))):(this.elevation=-Pe(Math.asin(t/r)),this.azimuth=-Pe(Math.atan2(-e,-n)))}},{key:"_getPosition",value:function(){f.copy(this.position,Me(p.transformMat4(p.create(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){f.transformMat3(this.distanceVector,[0,0,-this.distance],g.fromMat4(g.create(),this.matrix)),f.add(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=f.subtract(f.create(),this.focalPoint,this.position),this.distance=f.length(this.distanceVector),this.dollyingStep=this.distance/100}},{key:"_getOrthoMatrix",value:function(){if(this.projectionMode===Xe.ORTHOGRAPHIC){var e=this.position,t=m.setAxisAngle(m.create(),[0,0,1],-this.roll*Math.PI/180);v.fromRotationTranslationScaleOrigin(this.orthoMatrix,t,f.fromValues((this.rright-this.left)/2-e[0],(this.top-this.bottom)/2-e[1],0),f.fromValues(this.zoom,this.zoom,1),e)}}},{key:"triggerUpdate",value:function(){if(this.enableUpdate){var e=this.getViewTransform(),t=v.multiply(v.create(),this.getPerspective(),e);this.getFrustum().extractFromVPMatrix(t),this.eventEmitter.emit(We)}}},{key:"rotate",value:function(e,t,n){throw new Error(Ae)}},{key:"pan",value:function(e,t){throw new Error(Ae)}},{key:"dolly",value:function(e){throw new Error(Ae)}},{key:"createLandmark",value:function(e,t){throw new Error(Ae)}},{key:"gotoLandmark",value:function(e,t){throw new Error(Ae)}},{key:"cancelLandmarkAnimation",value:function(){throw new Error(Ae)}}])}(),ze=function(e){return e[e.Standard=0]="Standard",e}({}),Ke=function(e){return e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED",e[e.Z_INDEX_CHANGED=2]="Z_INDEX_CHANGED",e}({}),je=f.create(),qe=v.create(),Qe=m.create();function $e(e){if(e.localDirtyFlag){if(0!==e.localSkew[0]||0!==e.localSkew[1]){v.fromRotationTranslationScaleOrigin(e.localTransform,e.localRotation,e.localPosition,f.fromValues(1,1,1),e.origin),0===e.localSkew[0]&&0===e.localSkew[1]||(v.identity(qe),qe[4]=Math.tan(e.localSkew[0]),qe[1]=Math.tan(e.localSkew[1]),v.multiply(e.localTransform,e.localTransform,qe));var t=v.fromRotationTranslationScaleOrigin(qe,m.set(Qe,0,0,0,1),f.set(je,1,1,1),e.localScale,e.origin);v.multiply(e.localTransform,e.localTransform,t)}else{var n=e.localTransform,r=e.localPosition,i=e.localRotation,a=e.localScale,o=e.origin,s=0!==r[0]||0!==r[1]||0!==r[2],l=1!==i[3]||0!==i[0]||0!==i[1]||0!==i[2],u=1!==a[0]||1!==a[1]||1!==a[2],c=0!==o[0]||0!==o[1]||0!==o[2];l||u||c?v.fromRotationTranslationScaleOrigin(n,i,r,a,o):s?v.fromTranslation(n,r):v.identity(n)}e.localDirtyFlag=!1}}var Je={absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new Se(0,0,0,0)},et=function(e){return e.COORDINATE="<coordinate>",e.COLOR="<color>",e.PAINT="<paint>",e.NUMBER="<number>",e.ANGLE="<angle>",e.OPACITY_VALUE="<opacity-value>",e.SHADOW_BLUR="<shadow-blur>",e.LENGTH="<length>",e.PERCENTAGE="<percentage>",e.LENGTH_PERCENTAGE="<length> | <percentage>",e.LENGTH_PERCENTAGE_12="[<length> | <percentage>]{1,2}",e.LENGTH_PERCENTAGE_14="[<length> | <percentage>]{1,4}",e.LIST_OF_POINTS="<list-of-points>",e.PATH="<path>",e.FILTER="<filter>",e.Z_INDEX="<z-index>",e.OFFSET_DISTANCE="<offset-distance>",e.DEFINED_PATH="<defined-path>",e.MARKER="<marker>",e.TRANSFORM="<transform>",e.TRANSFORM_ORIGIN="<transform-origin>",e.TEXT="<text>",e.TEXT_TRANSFORM="<text-transform>",e}({});function tt(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function nt(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function rt(){}var it=.7,at=1/it,ot="\\s*([+-]?\\d+)\\s*",st="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",lt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ut=/^#([0-9a-f]{3,8})$/,ct=new RegExp("^rgb\\(".concat(ot,",").concat(ot,",").concat(ot,"\\)$")),ht=new RegExp("^rgb\\(".concat(lt,",").concat(lt,",").concat(lt,"\\)$")),dt=new RegExp("^rgba\\(".concat(ot,",").concat(ot,",").concat(ot,",").concat(st,"\\)$")),ft=new RegExp("^rgba\\(".concat(lt,",").concat(lt,",").concat(lt,",").concat(st,"\\)$")),pt=new RegExp("^hsl\\(".concat(st,",").concat(lt,",").concat(lt,"\\)$")),vt=new RegExp("^hsla\\(".concat(st,",").concat(lt,",").concat(lt,",").concat(st,"\\)$")),gt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function mt(){return this.rgb().formatHex()}function yt(){return this.rgb().formatRgb()}function Et(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=ut.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?_t(t):3===n?new St(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Tt(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Tt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ct.exec(e))?new St(t[1],t[2],t[3],1):(t=ht.exec(e))?new St(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=dt.exec(e))?Tt(t[1],t[2],t[3],t[4]):(t=ft.exec(e))?Tt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=pt.exec(e))?kt(t[1],t[2]/100,t[3]/100,1):(t=vt.exec(e))?kt(t[1],t[2]/100,t[3]/100,t[4]):gt.hasOwnProperty(e)?_t(gt[e]):"transparent"===e?new St(NaN,NaN,NaN,0):null}function _t(e){return new St(e>>16&255,e>>8&255,255&e,1)}function Tt(e,t,n,r){return r<=0&&(e=t=n=NaN),new St(e,t,n,r)}function Rt(e){return e instanceof rt||(e=Et(e)),e?new St((e=e.rgb()).r,e.g,e.b,e.opacity):new St}function St(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function At(){return"#".concat(Nt(this.r)).concat(Nt(this.g)).concat(Nt(this.b))}function xt(){var e=Ct(this.opacity);return"".concat(1===e?"rgb(":"rgba(").concat(Mt(this.r),", ").concat(Mt(this.g),", ").concat(Mt(this.b)).concat(1===e?")":", ".concat(e,")"))}function Ct(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Mt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Nt(e){return((e=Mt(e))<16?"0":"")+e.toString(16)}function kt(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Pt(e,t,n,r)}function bt(e){if(e instanceof Pt)return new Pt(e.h,e.s,e.l,e.opacity);if(e instanceof rt||(e=Et(e)),!e)return new Pt;if(e instanceof Pt)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new Pt(o,s,l,e.opacity)}function Pt(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Ot(e){return(e=(e||0)%360)<0?e+360:e}function It(e){return Math.max(0,Math.min(1,e||0))}function Dt(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Lt(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];var o=t?t.apply(this,i):i[0],s=n.cache;if(s.has(o))return s.get(o);var l=e.apply(this,i);return n.cache=s.set(o,l)||s,l};return n.cache=new(Lt.Cache||Map),Lt.cacheList.push(n.cache),n}tt(rt,Et,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:mt,formatHex:mt,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return bt(this).formatHsl()},formatRgb:yt,toString:yt}),tt(St,(function(e,t,n,r){return 1===arguments.length?Rt(e):new St(e,t,n,null==r?1:r)}),nt(rt,{brighter:function(e){return e=null==e?at:Math.pow(at,e),new St(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?it:Math.pow(it,e),new St(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},clamp:function(){return new St(Mt(this.r),Mt(this.g),Mt(this.b),Ct(this.opacity))},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:At,formatHex:At,formatHex8:function(){return"#".concat(Nt(this.r)).concat(Nt(this.g)).concat(Nt(this.b)).concat(Nt(255*(isNaN(this.opacity)?1:this.opacity)))},formatRgb:xt,toString:xt})),tt(Pt,(function(e,t,n,r){return 1===arguments.length?bt(e):new Pt(e,t,n,null==r?1:r)}),nt(rt,{brighter:function(e){return e=null==e?at:Math.pow(at,e),new Pt(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?it:Math.pow(it,e),new Pt(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new St(Dt(e>=240?e-240:e+120,i,r),Dt(e,i,r),Dt(e<120?e+240:e-120,i,r),this.opacity)},clamp:function(){return new Pt(Ot(this.h),It(this.s),It(this.l),Ct(this.opacity))},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=Ct(this.opacity);return"".concat(1===e?"hsl(":"hsla(").concat(Ot(this.h),", ").concat(100*It(this.s),"%, ").concat(100*It(this.l),"%").concat(1===e?")":", ".concat(e,")"))}})),Lt.Cache=Map,Lt.cacheList=[],Lt.clearCache=function(){Lt.cacheList.forEach((function(e){return e.clear()}))};var Bt=function(e){return e[e.kUnknown=0]="kUnknown",e[e.kNumber=1]="kNumber",e[e.kPercentage=2]="kPercentage",e[e.kEms=3]="kEms",e[e.kPixels=4]="kPixels",e[e.kRems=5]="kRems",e[e.kDegrees=6]="kDegrees",e[e.kRadians=7]="kRadians",e[e.kGradians=8]="kGradians",e[e.kTurns=9]="kTurns",e[e.kMilliseconds=10]="kMilliseconds",e[e.kSeconds=11]="kSeconds",e[e.kInteger=12]="kInteger",e}({}),wt=function(e){return e[e.kUNumber=0]="kUNumber",e[e.kUPercent=1]="kUPercent",e[e.kULength=2]="kULength",e[e.kUAngle=3]="kUAngle",e[e.kUTime=4]="kUTime",e[e.kUOther=5]="kUOther",e}({}),Ft=function(e){return e[e.kYes=0]="kYes",e[e.kNo=1]="kNo",e}({}),Ut=function(e){return e[e.kYes=0]="kYes",e[e.kNo=1]="kNo",e}({}),Gt=[{name:"em",unit_type:Bt.kEms},{name:"px",unit_type:Bt.kPixels},{name:"deg",unit_type:Bt.kDegrees},{name:"rad",unit_type:Bt.kRadians},{name:"grad",unit_type:Bt.kGradians},{name:"ms",unit_type:Bt.kMilliseconds},{name:"s",unit_type:Bt.kSeconds},{name:"rem",unit_type:Bt.kRems},{name:"turn",unit_type:Bt.kTurns}],Zt=function(e){return e[e.kUnknownType=0]="kUnknownType",e[e.kUnparsedType=1]="kUnparsedType",e[e.kKeywordType=2]="kKeywordType",e[e.kUnitType=3]="kUnitType",e[e.kSumType=4]="kSumType",e[e.kProductType=5]="kProductType",e[e.kNegateType=6]="kNegateType",e[e.kInvertType=7]="kInvertType",e[e.kMinType=8]="kMinType",e[e.kMaxType=9]="kMaxType",e[e.kClampType=10]="kClampType",e[e.kTransformType=11]="kTransformType",e[e.kPositionType=12]="kPositionType",e[e.kURLImageType=13]="kURLImageType",e[e.kColorType=14]="kColorType",e[e.kUnsupportedColorType=15]="kUnsupportedColorType",e}({}),Vt=function(e){return e?"number"===e?Bt.kNumber:"percent"===e||"%"===e?Bt.kPercentage:function(e){return Gt.find((function(t){return t.name===e})).unit_type}(e):Bt.kUnknown},Xt=function(e){var t=1;switch(e){case Bt.kPixels:case Bt.kDegrees:case Bt.kSeconds:break;case Bt.kMilliseconds:t=.001;break;case Bt.kRadians:t=180/Math.PI;break;case Bt.kGradians:t=.9;break;case Bt.kTurns:t=360}return t},Wt=function(e){switch(e){case Bt.kNumber:case Bt.kInteger:return"";case Bt.kPercentage:return"%";case Bt.kEms:return"em";case Bt.kRems:return"rem";case Bt.kPixels:return"px";case Bt.kDegrees:return"deg";case Bt.kRadians:return"rad";case Bt.kGradians:return"grad";case Bt.kMilliseconds:return"ms";case Bt.kSeconds:return"s";case Bt.kTurns:return"turn"}return""},Ht=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"toString",value:function(){return this.buildCSSText(Ft.kNo,Ut.kNo,"")}},{key:"isNumericValue",value:function(){return this.getType()>=Zt.kUnitType&&this.getType()<=Zt.kClampType}}],[{key:"isAngle",value:function(e){return e===Bt.kDegrees||e===Bt.kRadians||e===Bt.kGradians||e===Bt.kTurns}},{key:"isLength",value:function(e){return e>=Bt.kEms&&e<Bt.kDegrees}},{key:"isRelativeUnit",value:function(e){return e===Bt.kPercentage||e===Bt.kEms||e===Bt.kRems}},{key:"isTime",value:function(e){return e===Bt.kSeconds||e===Bt.kMilliseconds}}])}(),Yt=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).colorSpace=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getType",value:function(){return Zt.kColorType}},{key:"to",value:function(e){return this}}])}(Ht),zt=function(e){return e[e.Constant=0]="Constant",e[e.LinearGradient=1]="LinearGradient",e[e.RadialGradient=2]="RadialGradient",e}({}),Kt=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t)).type=e,r.value=n,r}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.type,this.value)}},{key:"buildCSSText",value:function(e,t,n){return n}},{key:"getType",value:function(){return Zt.kColorType}}])}(Ht),jt=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).value=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.value)}},{key:"getType",value:function(){return Zt.kKeywordType}},{key:"buildCSSText",value:function(e,t,n){return n+this.value}}])}(Ht),qt=function(e){return function(e){switch(e){case wt.kUNumber:return Bt.kNumber;case wt.kULength:return Bt.kPixels;case wt.kUPercent:return Bt.kPercentage;case wt.kUTime:return Bt.kSeconds;case wt.kUAngle:return Bt.kDegrees;default:return Bt.kUnknown}}(function(e){switch(e){case Bt.kNumber:case Bt.kInteger:return wt.kUNumber;case Bt.kPercentage:return wt.kUPercent;case Bt.kPixels:return wt.kULength;case Bt.kMilliseconds:case Bt.kSeconds:return wt.kUTime;case Bt.kDegrees:case Bt.kRadians:case Bt.kGradians:case Bt.kTurns:return wt.kUAngle;default:return wt.kUOther}}(e))},Qt=function(e){function t(e){var n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Bt.kNumber;return(0,o.Z)(this,t),n=(0,s.Z)(this,t),r="string"==typeof i?Vt(i):i,n.unit=r,n.value=e,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.value,this.unit)}},{key:"equals",value:function(e){var t=e;return this.value===t.value&&this.unit===t.unit}},{key:"getType",value:function(){return Zt.kUnitType}},{key:"convertTo",value:function(e){if(this.unit===e)return new t(this.value,this.unit);var n=qt(this.unit);if(n!==qt(e)||n===Bt.kUnknown)return null;var r=Xt(this.unit)/Xt(e);return new t(this.value*r,e)}},{key:"buildCSSText",value:function(e,t,n){var r;switch(this.unit){case Bt.kUnknown:break;case Bt.kInteger:r=Number(this.value).toFixed(0);break;case Bt.kNumber:case Bt.kPercentage:case Bt.kEms:case Bt.kRems:case Bt.kPixels:case Bt.kDegrees:case Bt.kRadians:case Bt.kGradians:case Bt.kMilliseconds:case Bt.kSeconds:case Bt.kTurns:var i=this.value,a=Wt(this.unit);if(i<-999999||i>999999){var o=Wt(this.unit);r=!Number.isFinite(i)||Number.isNaN(i)?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(Number.isFinite(e)?"NaN":e>0?"infinity":"-infinity")+t}(i,o):i+(o||"")}else r="".concat(i).concat(a)}return n+=r}}])}(Ht),$t=new Qt(0,"px");new Qt(1,"px");var Jt=new Qt(0,"deg"),en=function(e){function t(e,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,o.Z)(this,t),(i=(0,s.Z)(this,t,["rgb"])).r=e,i.g=n,i.b=r,i.alpha=a,i.isNone=l,i}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return new t(this.r,this.g,this.b,this.alpha)}},{key:"buildCSSText",value:function(e,t,n){return"".concat(n,"rgba(").concat(this.r,",").concat(this.g,",").concat(this.b,",").concat(this.alpha,")")}}])}(Yt),tn=new jt("unset"),nn={"":tn,unset:tn,initial:new jt("initial"),inherit:new jt("inherit")},rn=new en(0,0,0,0,!0),an=new en(0,0,0,0),on=Lt((function(e,t,n,r){return new en(e,t,n,r)}),(function(e,t,n,r){return"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(r,")")})),sn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Bt.kNumber;return new Qt(e,t)};function ln(e){var t=e.type,n=e.value;return"hex"===t?"#".concat(n):"literal"===t?n:"rgb"===t?"rgb(".concat(n.join(","),")"):"rgba(".concat(n.join(","),")")}new Qt(50,"%");var un=function(){var e=/^(linear\-gradient)/i,t=/^(repeating\-linear\-gradient)/i,n=/^(radial\-gradient)/i,r=/^(repeating\-radial\-gradient)/i,i=/^(conic\-gradient)/i,a=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,o=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,s=/^(left|center|right|top|bottom)/i,l=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,u=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,c=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,h=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,d=/^\(/,f=/^\)/,p=/^,/,v=/^\#([0-9a-fA-F]+)/,g=/^([a-zA-Z]+)/,m=/^rgb/i,y=/^rgba/i,E=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/,_="";function T(e){throw new Error("".concat(_,": ").concat(e))}function R(){var e=O(S);return _.length>0&&T("Invalid input not EOF"),e}function S(){return A("linear-gradient",e,C)||A("repeating-linear-gradient",t,C)||A("radial-gradient",n,M)||A("repeating-radial-gradient",r,M)||A("conic-gradient",i,M)}function A(e,t,n){return x(t,(function(t){var r=n();return r&&(F(p)||T("Missing comma before color stops")),{type:e,orientation:r,colorStops:O(I)}}))}function x(e,t){var n=F(e);if(n){F(d)||T("Missing (");var r=t(n);return F(f)||T("Missing )"),r}}function C(){return w("directional",a,1)||w("angular",h,1)}function M(){var e,t,n=N();return n&&((e=[]).push(n),t=_,F(p)&&((n=N())?e.push(n):_=t)),e}function N(){var e=function(){var e=w("shape",/^(circle)/i,0);e&&(e.style=B()||k());return e}()||function(){var e=w("shape",/^(ellipse)/i,0);e&&(e.style=L()||k());return e}();if(e)e.at=b();else{var t=k();if(t){e=t;var n=b();n&&(e.at=n)}else{var r=P();r&&(e={type:"default-radial",at:r})}}return e}function k(){return w("extent-keyword",o,1)}function b(){if(w("position",/^at/,0)){var e=P();return e||T("Missing positioning value"),e}}function P(){var e={x:L(),y:L()};if(e.x||e.y)return{type:"position",value:e}}function O(e){var t=e(),n=[];if(t)for(n.push(t);F(p);)(t=e())?n.push(t):T("One extra comma");return n}function I(){var e=w("hex",v,1)||x(y,(function(){return{type:"rgba",value:O(D)}}))||x(m,(function(){return{type:"rgb",value:O(D)}}))||w("literal",g,0);return e||T("Expected color definition"),e.length=L(),e}function D(){return F(E)[1]}function L(){return w("%",u,1)||w("position-keyword",s,1)||B()}function B(){return w("px",l,1)||w("em",c,1)}function w(e,t,n){var r=F(t);if(r)return{type:e,value:r[n]}}function F(e){var t=/^[\n\r\t\s]+/.exec(_);t&&U(t[0].length);var n=e.exec(_);return n&&U(n[0].length),n}function U(e){_=_.substring(e)}return function(e){return _=e,R()}}();var cn=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,hn=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,dn=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,fn=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;var pn={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},vn=Lt((function(e){var t;return t="angular"===e.type?Number(e.value):pn[e.value]||0,sn(t,"deg")})),gn=Lt((function(e){var t=50,n=50,r="%",i="%";if("position"===(null==e?void 0:e.type)){var a=e.value,o=a.x,s=a.y;"position-keyword"===(null==o?void 0:o.type)&&("left"===o.value?t=0:"center"===o.value?t=50:"right"===o.value?t=100:"top"===o.value?n=0:"bottom"===o.value&&(n=100)),"position-keyword"===(null==s?void 0:s.type)&&("left"===s.value?t=0:"center"===s.value?n=50:"right"===s.value?t=100:"top"===s.value?n=0:"bottom"===s.value&&(n=100)),"px"!==(null==o?void 0:o.type)&&"%"!==(null==o?void 0:o.type)&&"em"!==(null==o?void 0:o.type)||(r=null==o?void 0:o.type,t=Number(o.value)),"px"!==(null==s?void 0:s.type)&&"%"!==(null==s?void 0:s.type)&&"em"!==(null==s?void 0:s.type)||(i=null==s?void 0:s.type,n=Number(s.value))}return{cx:sn(t,r),cy:sn(n,i)}})),mn=Lt((function(e){if(e.indexOf("linear")>-1||e.indexOf("radial")>-1)return un(e).map((function(e){var t=e.type,n=e.orientation,r=e.colorStops;!function(e){var t,n,r=e.length;e[r-1].length=null!==(t=e[r-1].length)&&void 0!==t?t:{type:"%",value:"100"},r>1&&(e[0].length=null!==(n=e[0].length)&&void 0!==n?n:{type:"%",value:"0"});for(var i=0,a=Number(e[0].length.value),o=1;o<r;o++){var s,l=null===(s=e[o].length)||void 0===s?void 0:s.value;if(!(0,T.Z)(l)&&!(0,T.Z)(a)){for(var u=1;u<o-i;u++)e[i+u].length={type:"%",value:"".concat(a+(Number(l)-a)*u/(o-i))};i=o,a=Number(l)}}}(r);var i,a=r.map((function(e){return{offset:sn(Number(e.length.value),"%"),color:ln(e)}}));if("linear-gradient"===t)return new Kt(zt.LinearGradient,{angle:n?vn(n):Jt,steps:a});if("radial-gradient"===t&&(n||(n=[{type:"shape",value:"circle"}]),"shape"===n[0].type&&"circle"===n[0].value)){var o,s=gn(n[0].at),l=s.cx,u=s.cy;if(n[0].style){var c=n[0].style,h=c.type,d=c.value;"extent-keyword"===h?(nn[i=d]||(nn[i]=new jt(i)),o=nn[i]):o=sn(d,h)}return new Kt(zt.RadialGradient,{cx:l,cy:u,size:o,steps:a})}}));var t=e[0];if("("===e[1]||"("===e[2])if("l"===t){var n=cn.exec(e);if(n){var r,i=(null===(r=n[2].match(fn))||void 0===r?void 0:r.map((function(e){return e.split(":")})))||[];return[new Kt(zt.LinearGradient,{angle:sn(parseFloat(n[1]),"deg"),steps:i.map((function(e){var t=(0,h.Z)(e,2),n=t[0],r=t[1];return{offset:sn(100*Number(n),"%"),color:r}}))})]}}else if("r"===t){var a=function(e){var t=hn.exec(e);if(t){var n,r=(null===(n=t[4].match(fn))||void 0===n?void 0:n.map((function(e){return e.split(":")})))||[];return{cx:sn(50,"%"),cy:sn(50,"%"),steps:r.map((function(e){var t=(0,h.Z)(e,2),n=t[0],r=t[1];return{offset:sn(100*Number(n),"%"),color:r}}))}}return null}(e);if(a){if(!(0,R.Z)(a))return[new Kt(zt.RadialGradient,a)];e=a}}else if("p"===t)return function(e){var t=dn.exec(e);if(t){var n=t[1],r=t[2];switch(n){case"a":n="repeat";break;case"x":n="repeat-x";break;case"y":n="repeat-y";break;default:n="no-repeat"}return{image:r,repetition:n}}return null}(e)}));function yn(e){return e&&!!e.image}function En(e){return e&&!(0,T.Z)(e.r)&&!(0,T.Z)(e.g)&&!(0,T.Z)(e.b)}var _n=Lt((function(e){if(yn(e))return(0,u.Z)({repetition:"repeat"},e);if((0,T.Z)(e)&&(e=""),"transparent"===e)return an;if("currentColor"===e)e="black";else if("none"===e)return rn;var t=mn(e);if(t)return t;var n=Et(e),r=[0,0,0,0];return null!==n&&(r[0]=n.r||0,r[1]=n.g||0,r[2]=n.b||0,r[3]=n.opacity),on.apply(void 0,r)}));function Tn(e,t){if(En(e)&&En(t))return[[Number(e.r),Number(e.g),Number(e.b),Number(e.alpha)],[Number(t.r),Number(t.g),Number(t.b),Number(t.alpha)],function(e){var t=e.slice();if(t[3])for(var n=0;n<3;n++)t[n]=Math.round((0,S.Z)(t[n],0,255));return t[3]=(0,S.Z)(t[3],0,1),"rgba(".concat(t.join(","),")")}]}function Rn(e,t){if((0,T.Z)(t))return sn(0,"px");if(t="".concat(t).trim().toLowerCase(),isFinite(Number(t))){if("px".search(e)>=0)return sn(Number(t),"px");if("deg".search(e)>=0)return sn(Number(t),"deg")}var n=[];t=t.replace(e,(function(e){return n.push(e),"U".concat(e)}));var r="U(".concat(e.source,")");return n.map((function(e){return sn(Number(t.replace(new RegExp("U".concat(e),"g"),"").replace(new RegExp(r,"g"),"*0")),e)}))[0]}var Sn=function(e){return Rn(new RegExp("px","g"),e)},An=Lt(Sn);Lt((function(e){return Rn(new RegExp("%","g"),e)}));var xn=function(e){return(0,E.Z)(e)||isFinite(Number(e))?sn(Number(e)||0,"px"):Rn(new RegExp("px|%|em|rem","g"),e)},Cn=Lt(xn),Mn=function(e){return Rn(new RegExp("deg|rad|grad|turn","g"),e)},Nn=Lt(Mn);function kn(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a="",o=e.value||0,s=t.value||0,l=qt(e.unit),u=e.convertTo(l),c=t.convertTo(l);return u&&c?(o=u.value,s=c.value,a=Wt(e.unit)):(Qt.isLength(e.unit)||Qt.isLength(t.unit))&&(o=On(e,i,n),s=On(t,i,n),a="px"),[o,s,function(e){return r&&(e=Math.max(e,0)),e+a}]}function bn(e){var t=0;return e.unit===Bt.kDegrees?t=e.value:e.unit===Bt.kRadians?t=Pe(Number(e.value)):e.unit===Bt.kTurns?t=360*Number(e.value):e.value&&(t=e.value),t}function Pn(e,t){var n;return Array.isArray(e)?n=e.map((function(e){return Number(e)})):(0,R.Z)(e)?n=e.split(" ").map((function(e){return Number(e)})):(0,E.Z)(e)&&(n=[e]),2===t?1===n.length?[n[0],n[0]]:[n[0],n[1]]:4===t?1===n.length?[n[0],n[0],n[0],n[0]]:2===n.length?[n[0],n[1],n[0],n[1]]:3===n.length?[n[0],n[1],n[2],n[1]]:[n[0],n[1],n[2],n[3]]:"even"===t&&n.length%2==1?[].concat((0,c.Z)(n),(0,c.Z)(n)):n}function On(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.unit===Bt.kPixels)return Number(e.value);if(e.unit===Bt.kPercentage&&n){var i=n.nodeName===ue.GROUP?n.getLocalBounds():n.getGeometryBounds();return(r?i.min[t]:0)+e.value/100*i.halfExtents[t]*2}return 0}var In=function(e){return Rn(/deg|rad|grad|turn|px|%/g,e)},Dn=["blur","brightness","drop-shadow","contrast","grayscale","sepia","saturate","hue-rotate","invert"];function Ln(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("none"===(e=e.toLowerCase().trim()))return[];for(var t,n=/\s*([\w-]+)\(([^)]*)\)/g,r=[],i=0;t=n.exec(e);){if(t.index!==i)return[];if(i=t.index+t[0].length,Dn.indexOf(t[1])>-1&&r.push({name:t[1],params:t[2].split(" ").map((function(e){return In(e)||_n(e)}))}),n.lastIndex===e.length)return r}return[]}function Bn(e){return e.toString()}var wn=function(e){return"number"==typeof e?sn(e):/^\s*[-+]?(\d*\.)?\d+\s*$/.test(e)?sn(Number(e)):sn(0)},Fn=Lt(wn);function Un(e,t){return[e,t,Bn]}function Gn(e,t){return function(n,r){return[n,r,function(n){return Bn((0,S.Z)(n,e,t))}]}}function Zn(e,t){if(e.length===t.length)return[e,t,function(e){return e}]}function Vn(e){return 0===e.parsedStyle.d.totalLength&&(e.parsedStyle.d.totalLength=(0,A.D)(e.parsedStyle.d.absolutePath)),e.parsedStyle.d.totalLength}function Xn(e){return 0===e.parsedStyle.points.totalLength&&(e.parsedStyle.points.totalLength=te(e.parsedStyle.points.points)),e.parsedStyle.points.totalLength}function Wn(e,t){return e[0]===t[0]&&e[1]===t[1]}function Hn(e,t){var n=e.prePoint,r=e.currentPoint,i=e.nextPoint,a=Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2),o=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2),s=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2),l=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!l||0===Math.sin(l)||(0,M.Z)(l,0))return{xExtra:0,yExtra:0};var u=Math.abs(Math.atan2(i[1]-r[1],i[0]-r[0])),c=Math.abs(Math.atan2(i[0]-r[0],i[1]-r[1]));return u=u>Math.PI/2?Math.PI-u:u,c=c>Math.PI/2?Math.PI-c:c,{xExtra:Math.cos(l/2-u)*(t/2*(1/Math.sin(l/2)))-t/2||0,yExtra:Math.cos(c-l/2)*(t/2*(1/Math.sin(l/2)))-t/2||0}}function Yn(e,t){return[t[0]+(t[0]-e[0]),t[1]+(t[1]-e[1])]}Lt((function(e){return(0,R.Z)(e)?e.split(" ").map(Fn):e.map(Fn)}));var zn=function(e,t){var n=e.x*t.x+e.y*t.y,r=Math.sqrt((Math.pow(e.x,2)+Math.pow(e.y,2))*(Math.pow(t.x,2)+Math.pow(t.y,2)));return(e.x*t.y-e.y*t.x<0?-1:1)*Math.acos(n/r)},Kn=function(e,t,n,r,i,a,o,s){t=Math.abs(t),n=Math.abs(n);var l=ke(r=(0,N.Z)(r,360));if(e.x===o.x&&e.y===o.y)return{x:e.x,y:e.y,ellipticalArcAngle:0};if(0===t||0===n)return{x:0,y:0,ellipticalArcAngle:0};var u=(e.x-o.x)/2,c=(e.y-o.y)/2,h={x:Math.cos(l)*u+Math.sin(l)*c,y:-Math.sin(l)*u+Math.cos(l)*c},d=Math.pow(h.x,2)/Math.pow(t,2)+Math.pow(h.y,2)/Math.pow(n,2);d>1&&(t*=Math.sqrt(d),n*=Math.sqrt(d));var f=(Math.pow(t,2)*Math.pow(n,2)-Math.pow(t,2)*Math.pow(h.y,2)-Math.pow(n,2)*Math.pow(h.x,2))/(Math.pow(t,2)*Math.pow(h.y,2)+Math.pow(n,2)*Math.pow(h.x,2));f=f<0?0:f;var p=(i!==a?1:-1)*Math.sqrt(f),v=p*(t*h.y/n),g=p*(-n*h.x/t),m={x:Math.cos(l)*v-Math.sin(l)*g+(e.x+o.x)/2,y:Math.sin(l)*v+Math.cos(l)*g+(e.y+o.y)/2},y={x:(h.x-v)/t,y:(h.y-g)/n},E=zn({x:1,y:0},y),_=zn(y,{x:(-h.x-v)/t,y:(-h.y-g)/n});!a&&_>0?_-=2*Math.PI:a&&_<0&&(_+=2*Math.PI);var T=E+(_%=2*Math.PI)*s,R=t*Math.cos(T),S=n*Math.sin(T);return{x:Math.cos(l)*R-Math.sin(l)*S+m.x,y:Math.sin(l)*R+Math.cos(l)*S+m.y,ellipticalArcStartAngle:E,ellipticalArcEndAngle:E+_,ellipticalArcAngle:T,ellipticalArcCenter:m,resultantRx:t,resultantRy:n}};function jn(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.arcParams,i=r.rx,a=void 0===i?0:i,o=r.ry,s=void 0===o?0:o,l=r.xRotation,u=r.arcFlag,c=r.sweepFlag,h=Kn({x:e.prePoint[0],y:e.prePoint[1]},a,s,l,!!u,!!c,{x:e.currentPoint[0],y:e.currentPoint[1]},t),d=Kn({x:e.prePoint[0],y:e.prePoint[1]},a,s,l,!!u,!!c,{x:e.currentPoint[0],y:e.currentPoint[1]},n?t+.005:t-.005),f=d.x-h.x,p=d.y-h.y,v=Math.sqrt(f*f+p*p);return{x:-f/v,y:-p/v}}function qn(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Qn(e,t){return qn(e)*qn(t)?(e[0]*t[0]+e[1]*t[1])/(qn(e)*qn(t)):1}function $n(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(Qn(e,t))}function Jn(e,t){var n=t[1],r=t[2],i=(0,N.Z)(ke(t[3]),2*Math.PI),a=t[4],o=t[5],s=e[0],l=e[1],u=t[6],c=t[7],h=Math.cos(i)*(s-u)/2+Math.sin(i)*(l-c)/2,d=-1*Math.sin(i)*(s-u)/2+Math.cos(i)*(l-c)/2,f=h*h/(n*n)+d*d/(r*r);f>1&&(n*=Math.sqrt(f),r*=Math.sqrt(f));var p=n*n*(d*d)+r*r*(h*h),v=p?Math.sqrt((n*n*(r*r)-p)/p):1;a===o&&(v*=-1),isNaN(v)&&(v=0);var g=r?v*n*d/r:0,m=n?v*-r*h/n:0,y=(s+u)/2+Math.cos(i)*g-Math.sin(i)*m,E=(l+c)/2+Math.sin(i)*g+Math.cos(i)*m,_=[(h-g)/n,(d-m)/r],T=[(-1*h-g)/n,(-1*d-m)/r],R=$n([1,0],_),S=$n(_,T);return Qn(_,T)<=-1&&(S=Math.PI),Qn(_,T)>=1&&(S=0),0===o&&S>0&&(S-=2*Math.PI),1===o&&S<0&&(S+=2*Math.PI),{cx:y,cy:E,rx:Wn(e,[u,c])?0:n,ry:Wn(e,[u,c])?0:r,startAngle:R,endAngle:R+S,xRotation:i,arcFlag:a,sweepFlag:o}}function er(e,t,n){return e.reduce((function(e,t){var r="";if("M"===t[0]||"L"===t[0]){var i=f.fromValues(t[1],t[2],0);n&&f.transformMat4(i,i,n),r="".concat(t[0]).concat(i[0],",").concat(i[1])}else if("Z"===t[0])r=t[0];else if("C"===t[0]){var a=f.fromValues(t[1],t[2],0),o=f.fromValues(t[3],t[4],0),s=f.fromValues(t[5],t[6],0);n&&(f.transformMat4(a,a,n),f.transformMat4(o,o,n),f.transformMat4(s,s,n)),r="".concat(t[0]).concat(a[0],",").concat(a[1],",").concat(o[0],",").concat(o[1],",").concat(s[0],",").concat(s[1])}else if("A"===t[0]){var l=f.fromValues(t[6],t[7],0);n&&f.transformMat4(l,l,n),r="".concat(t[0]).concat(t[1],",").concat(t[2],",").concat(t[3],",").concat(t[4],",").concat(t[5],",").concat(l[0],",").concat(l[1])}else if("Q"===t[0]){var u=f.fromValues(t[1],t[2],0),c=f.fromValues(t[3],t[4],0);n&&(f.transformMat4(u,u,n),f.transformMat4(c,c,n)),r="".concat(t[0]).concat(t[1],",").concat(t[2],",").concat(t[3],",").concat(t[4],"}")}return e+r}),"")}function tr(e,t,n,r){return[["M",e,t],["L",n,r]]}function nr(e,t,n,r){var i=(-1+Math.sqrt(2))/3*4,a=e*i,o=t*i,s=n-e,l=n+e,u=r-t,c=r+t;return[["M",s,r],["C",s,r-o,n-a,u,n,u],["C",n+a,u,l,r-o,l,r],["C",l,r+o,n+a,c,n,c],["C",n-a,c,s,r+o,s,r],["Z"]]}function rr(e,t){var n=e.map((function(e,t){return[0===t?"M":"L",e[0],e[1]]}));return t&&n.push(["Z"]),n}function ir(e,t,n,r,i){if(i){var a=(0,h.Z)(i,4),o=a[0],s=a[1],l=a[2],u=a[3],c=e>0?1:-1,d=t>0?1:-1,f=c+d!==0?1:0;return[["M",c*o+n,r],["L",e-c*s+n,r],s?["A",s,s,0,0,f,e+n,d*s+r]:null,["L",e+n,t-d*l+r],l?["A",l,l,0,0,f,e+n-c*l,t+r]:null,["L",n+c*u,t+r],u?["A",u,u,0,0,f,n,t+r-d*u]:null,["L",n,d*o+r],o?["A",o,o,0,0,f,c*o+n,r]:null,["Z"]].filter((function(e){return e}))}return[["M",n,r],["L",n+e,r],["L",n+e,r+t],["L",n,r+t],["Z"]]}function ar(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.getLocalTransform(),n=[];switch(e.nodeName){case ue.LINE:var r=e.parsedStyle,i=r.x1,a=void 0===i?0:i,o=r.y1,s=void 0===o?0:o,l=r.x2,u=void 0===l?0:l,h=r.y2,d=void 0===h?0:h;n=tr(a,s,u,d);break;case ue.CIRCLE:var f=e.parsedStyle,p=f.r,v=void 0===p?0:p,g=f.cx,m=void 0===g?0:g,y=f.cy,E=void 0===y?0:y;n=nr(v,v,m,E);break;case ue.ELLIPSE:var _=e.parsedStyle,T=_.rx,R=void 0===T?0:T,A=_.ry,x=void 0===A?0:A,C=_.cx,M=void 0===C?0:C,N=_.cy,k=void 0===N?0:N;n=nr(R,x,M,k);break;case ue.POLYLINE:case ue.POLYGON:var b=e.parsedStyle.points;n=rr(b.points,e.nodeName===ue.POLYGON);break;case ue.RECT:var P=e.parsedStyle,O=P.width,I=void 0===O?0:O,D=P.height,L=void 0===D?0:D,B=P.x,w=void 0===B?0:B,F=P.y,U=void 0===F?0:F,G=P.radius,Z=G&&G.some((function(e){return 0!==e}));n=ir(I,L,w,U,Z&&G.map((function(e){return(0,S.Z)(e,0,Math.min(Math.abs(I)/2,Math.abs(L)/2))})));break;case ue.PATH:var V=e.parsedStyle.d.absolutePath;n=(0,c.Z)(V)}if(n.length)return er(n,0,t)}var or=function(e){if(""===e||Array.isArray(e)&&0===e.length)return{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:{x:0,y:0,width:0,height:0}};var t;try{t=(0,k.A)(e)}catch(n){t=(0,k.A)(""),console.error("[g]: Invalid SVG Path definition: ".concat(e))}!function(e){for(var t=0;t<e.length;t++){var n=e[t-1],r=e[t];if("M"===r[0]&&n){var i=n[0],a=[r[1],r[2]],o=void 0;"L"===i||"M"===i?o=[n[1],n[2]]:"C"!==i&&"A"!==i&&"Q"!==i||(o=[n[n.length-2],n[n.length-1]]),o&&Wn(a,o)&&(e.splice(t,1),t--)}}}(t);var n=function(e){for(var t=!1,n=e.length,r=0;r<n;r++){var i=e[r][0];if("C"===i||"A"===i||"Q"===i){t=!0;break}}return t}(t),r=function(e){for(var t=[],n=[],r=[],i=0;i<e.length;i++){var a=e[i],o=a[0];"M"===o?(r.length&&(n.push(r),r=[]),r.push([a[1],a[2]])):"Z"===o?r.length&&(t.push(r),r=[]):r.push([a[1],a[2]])}return r.length>0&&n.push(r),{polygons:t,polylines:n}}(t),i=r.polygons,a=r.polylines,o=function(e){for(var t=[],n=null,r=null,i=null,a=0,o=e.length,s=0;s<o;s++){var l=e[s];r=e[s+1];var u=l[0],c={command:u,prePoint:n,params:l,startTangent:null,endTangent:null,currentPoint:null,nextPoint:null,arcParams:null,box:null,cubicParams:null};switch(u){case"M":i=[l[1],l[2]],a=s;break;case"A":var h=Jn(n,l);c.arcParams=h}if("Z"===u)n=i,r=e[a+1];else{var d=l.length;n=[l[d-2],l[d-1]]}r&&"Z"===r[0]&&(r=e[a],t[a]&&(t[a].prePoint=n)),c.currentPoint=n,t[a]&&Wn(n,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var f=r?[r[r.length-2],r[r.length-1]]:null;c.nextPoint=f;var p=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[p[0]-n[0],p[1]-n[1]],c.endTangent=[n[0]-p[0],n[1]-p[1]];else if("Q"===u){var v=[l[1],l[2]];c.startTangent=[p[0]-v[0],p[1]-v[1]],c.endTangent=[n[0]-v[0],n[1]-v[1]]}else if("T"===u){var g=t[s-1],m=Yn(g.currentPoint,p);"Q"===g.command?(c.command="Q",c.startTangent=[p[0]-m[0],p[1]-m[1]],c.endTangent=[n[0]-m[0],n[1]-m[1]]):(c.command="TL",c.startTangent=[p[0]-n[0],p[1]-n[1]],c.endTangent=[n[0]-p[0],n[1]-p[1]])}else if("C"===u){var y=[l[1],l[2]],E=[l[3],l[4]];c.startTangent=[p[0]-y[0],p[1]-y[1]],c.endTangent=[n[0]-E[0],n[1]-E[1]],0===c.startTangent[0]&&0===c.startTangent[1]&&(c.startTangent=[y[0]-E[0],y[1]-E[1]]),0===c.endTangent[0]&&0===c.endTangent[1]&&(c.endTangent=[E[0]-y[0],E[1]-y[1]])}else if("S"===u){var _=t[s-1],T=Yn(_.currentPoint,p),R=[l[1],l[2]];"C"===_.command?(c.command="C",c.startTangent=[p[0]-T[0],p[1]-T[1]],c.endTangent=[n[0]-R[0],n[1]-R[1]]):(c.command="SQ",c.startTangent=[p[0]-R[0],p[1]-R[1]],c.endTangent=[n[0]-R[0],n[1]-R[1]])}else if("A"===u){var S=jn(c,0),A=S.x,x=S.y,C=jn(c,1,!1),M=C.x,N=C.y;c.startTangent=[A,x],c.endTangent=[M,N]}t.push(c)}return t}(t),s=function(e,t){for(var n=[],r=[],i=[],a=0;a<e.length;a++){var o=e[a],s=o.currentPoint,l=o.params,u=o.prePoint,c=void 0;switch(o.command){case"Q":c=ae(u[0],u[1],l[1],l[2],l[3],l[4]);break;case"C":c=ee(u[0],u[1],l[1],l[2],l[3],l[4],l[5],l[6]);break;case"A":var h=o.arcParams;c=K(h.cx,h.cy,h.rx,h.ry,h.xRotation,h.startAngle,h.endAngle);break;default:n.push(s[0]),r.push(s[1])}c&&(o.box=c,n.push(c.x,c.x+c.width),r.push(c.y,c.y+c.height)),t&&("L"===o.command||"M"===o.command)&&o.prePoint&&o.nextPoint&&i.push(o)}n=n.filter((function(e){return!Number.isNaN(e)&&e!==1/0&&e!==-1/0})),r=r.filter((function(e){return!Number.isNaN(e)&&e!==1/0&&e!==-1/0}));var d=(0,x.Z)(n),f=(0,x.Z)(r),p=(0,C.Z)(n),v=(0,C.Z)(r);if(0===i.length)return{x:d,y:f,width:p-d,height:v-f};for(var g=0;g<i.length;g++){var m=i[g],y=m.currentPoint;y[0]===d?d-=Hn(m,t).xExtra:y[0]===p&&(p+=Hn(m,t).xExtra),y[1]===f?f-=Hn(m,t).yExtra:y[1]===v&&(v+=Hn(m,t).yExtra)}return{x:d,y:f,width:p-d,height:v-f}}(o,0),l=s.x,u=s.y,c=s.width,h=s.height;return{absolutePath:t,hasArc:n,segments:o,polygons:i,polylines:a,totalLength:0,rect:{x:Number.isFinite(l)?l:0,y:Number.isFinite(u)?u:0,width:Number.isFinite(c)?c:0,height:Number.isFinite(h)?h:0}}},sr=Lt(or);function lr(e){return(0,R.Z)(e)?sr(e):or(e)}function ur(e,t,n){var r=e.curve,i=t.curve;r&&0!==r.length||(r=(0,b.Y)(e.absolutePath,!1),e.curve=r),i&&0!==i.length||(i=(0,b.Y)(t.absolutePath,!1),t.curve=i);var a=[r,i];r.length!==i.length&&(a=(0,P.x)(r,i));var o=(0,O.b)(a[0])!==(0,O.b)(a[1])?(0,I.G)(a[0]):(0,D.U)(a[0]);return[o,(0,L.g)(a[1],o),function(e){return e}]}function cr(e,t){return{points:(0,R.Z)(e)?e.split(" ").map((function(e){var t=e.split(","),n=(0,h.Z)(t,2),r=n[0],i=n[1];return[Number(r),Number(i)]})):e,totalLength:0,segments:[]}}function hr(e,t){return[e.points,t.points,function(e){return e}]}var dr=null,fr=/\s*(\w+)\(([^)]*)\)/g;function pr(e){return function(t){var n=0;return e.map((function(e){return e===dr?t[n++]:e}))}}function vr(e){return e}var gr={matrix:["NNNNNN",[dr,dr,0,0,dr,dr,0,0,0,0,1,0,dr,dr,0,1],vr],matrix3d:["NNNNNNNNNNNNNNNN",vr],rotate:["A"],rotateX:["A"],rotateY:["A"],rotateZ:["A"],rotate3d:["NNNA"],perspective:["L"],scale:["Nn",pr([dr,dr,new Qt(1)]),vr],scaleX:["N",pr([dr,new Qt(1),new Qt(1)]),pr([dr,new Qt(1)])],scaleY:["N",pr([new Qt(1),dr,new Qt(1)]),pr([new Qt(1),dr])],scaleZ:["N",pr([new Qt(1),new Qt(1),dr])],scale3d:["NNN",vr],skew:["Aa",null,vr],skewX:["A",null,pr([dr,Jt])],skewY:["A",null,pr([Jt,dr])],translate:["Tt",pr([dr,dr,$t]),vr],translateX:["T",pr([dr,$t,$t]),pr([dr,$t])],translateY:["T",pr([$t,dr,$t]),pr([$t,dr])],translateZ:["L",pr([$t,$t,dr])],translate3d:["TTL",vr]};function mr(e){for(var t=[],n=e.length,r=0;r<n;r++){var i=e[r],a=i[0],o=i.slice(1);if("translate"===a||"skew"===a?1===o.length&&o.push(0):"scale"===a&&1===o.length&&o.push(o[0]),!gr[a])return[];var s=o.map((function(e){return sn(e)}));t.push({t:a,d:s})}return t}function yr(e){if(Array.isArray(e))return mr(e);if("none"===(e=(e||"none").trim()))return[];var t,n=[],r=0;for(fr.lastIndex=0;t=fr.exec(e);){if(t.index!==r)return[];r=t.index+t[0].length;var i=t[1],a=gr[i];if(!a)return[];var o=t[2].split(","),s=a[0];if(s.length<o.length)return[];for(var l=[],u=0;u<s.length;u++){var c=o[u],h=s[u],d=void 0;if(void 0===(d=c?{A:function(e){return"0"===e.trim()?Jt:Nn(e)},N:Fn,T:Cn,L:An}[h.toUpperCase()](c):{a:Jt,n:l[0],t:$t}[h]))return[];l.push(d)}if(n.push({t:i,d:l}),fr.lastIndex===e.length)return n}return[]}function Er(e){if(Array.isArray(e))return mr(e);if("none"===(e=(e||"none").trim()))return[];var t,n=[],r=0;for(fr.lastIndex=0;t=fr.exec(e);){if(t.index!==r)return[];r=t.index+t[0].length;var i=t[1],a=gr[i];if(!a)return[];var o=t[2].split(","),s=a[0];if(s.length<o.length)return[];for(var l=[],u=0;u<s.length;u++){var c=o[u],h=s[u],d=void 0;if(void 0===(d=c?{A:function(e){return"0"===e.trim()?Jt:Mn(e)},N:wn,T:xn,L:Sn}[h.toUpperCase()](c):{a:Jt,n:l[0],t:$t}[h]))return[];l.push(d)}if(n.push({t:i,d:l}),fr.lastIndex===e.length)return n}return[]}function _r(e){var t,n,r,i;switch(e.t){case"rotateX":return i=ke(bn(e.d[0])),[1,0,0,0,0,Math.cos(i),Math.sin(i),0,0,-Math.sin(i),Math.cos(i),0,0,0,0,1];case"rotateY":return i=ke(bn(e.d[0])),[Math.cos(i),0,-Math.sin(i),0,0,1,0,0,Math.sin(i),0,Math.cos(i),0,0,0,0,1];case"rotate":case"rotateZ":return i=ke(bn(e.d[0])),[Math.cos(i),Math.sin(i),0,0,-Math.sin(i),Math.cos(i),0,0,0,0,1,0,0,0,0,1];case"rotate3d":t=e.d[0].value,n=e.d[1].value,r=e.d[2].value,i=ke(bn(e.d[3]));var a=t*t+n*n+r*r;if(0===a)t=1,n=0,r=0;else if(1!==a){var o=Math.sqrt(a);t/=o,n/=o,r/=o}var s=Math.sin(i/2),l=s*Math.cos(i/2),u=s*s;return[1-2*(n*n+r*r)*u,2*(t*n*u+r*l),2*(t*r*u-n*l),0,2*(t*n*u-r*l),1-2*(t*t+r*r)*u,2*(n*r*u+t*l),0,2*(t*r*u+n*l),2*(n*r*u-t*l),1-2*(t*t+n*n)*u,0,0,0,0,1];case"scale":return[e.d[0].value,0,0,0,0,e.d[1].value,0,0,0,0,1,0,0,0,0,1];case"scaleX":return[e.d[0].value,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"scaleY":return[1,0,0,0,0,e.d[0].value,0,0,0,0,1,0,0,0,0,1];case"scaleZ":return[1,0,0,0,0,1,0,0,0,0,e.d[0].value,0,0,0,0,1];case"scale3d":return[e.d[0].value,0,0,0,0,e.d[1].value,0,0,0,0,e.d[2].value,0,0,0,0,1];case"skew":var c=ke(bn(e.d[0])),h=ke(bn(e.d[1]));return[1,Math.tan(h),0,0,Math.tan(c),1,0,0,0,0,1,0,0,0,0,1];case"skewX":return i=ke(bn(e.d[0])),[1,0,0,0,Math.tan(i),1,0,0,0,0,1,0,0,0,0,1];case"skewY":return i=ke(bn(e.d[0])),[1,Math.tan(i),0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"translate":return[1,0,0,0,0,1,0,0,0,0,1,0,t=On(e.d[0],0,null)||0,n=On(e.d[1],0,null)||0,0,1];case"translateX":return[1,0,0,0,0,1,0,0,0,0,1,0,t=On(e.d[0],0,null)||0,0,0,1];case"translateY":return[1,0,0,0,0,1,0,0,0,0,1,0,0,n=On(e.d[0],0,null)||0,0,1];case"translateZ":return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,r=On(e.d[0],0,null)||0,1];case"translate3d":return[1,0,0,0,0,1,0,0,0,0,1,0,t=On(e.d[0],0,null)||0,n=On(e.d[1],0,null)||0,r=On(e.d[2],0,null)||0,1];case"perspective":var d=On(e.d[0],0,null)||0;return[1,0,0,0,0,1,0,0,0,0,1,d?-1/d:0,0,0,0,1];case"matrix":return[e.d[0].value,e.d[1].value,0,0,e.d[2].value,e.d[3].value,0,0,0,0,1,0,e.d[4].value,e.d[5].value,0,1];case"matrix3d":return e.d.map((function(e){return e.value}))}}function Tr(e,t){return[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],e[0]*t[4]+e[4]*t[5]+e[8]*t[6]+e[12]*t[7],e[1]*t[4]+e[5]*t[5]+e[9]*t[6]+e[13]*t[7],e[2]*t[4]+e[6]*t[5]+e[10]*t[6]+e[14]*t[7],e[3]*t[4]+e[7]*t[5]+e[11]*t[6]+e[15]*t[7],e[0]*t[8]+e[4]*t[9]+e[8]*t[10]+e[12]*t[11],e[1]*t[8]+e[5]*t[9]+e[9]*t[10]+e[13]*t[11],e[2]*t[8]+e[6]*t[9]+e[10]*t[10]+e[14]*t[11],e[3]*t[8]+e[7]*t[9]+e[11]*t[10]+e[15]*t[11],e[0]*t[12]+e[4]*t[13]+e[8]*t[14]+e[12]*t[15],e[1]*t[12]+e[5]*t[13]+e[9]*t[14]+e[13]*t[15],e[2]*t[12]+e[6]*t[13]+e[10]*t[14]+e[14]*t[15],e[3]*t[12]+e[7]*t[13]+e[11]*t[14]+e[15]*t[15]]}function Rr(e){var t=[0,0,0],n=[1,1,1],r=[0,0,0],i=[0,0,0,1],a=[0,0,0,1];return function(e,t,n,r,i,a){if(!function(e,t){var n=t[15];if(0===n)return!1;for(var r=1/n,i=0;i<16;i++)e[i]=t[i]*r;return!0}(Le,e))return!1;if(v.copy(Be,Le),Be[3]=0,Be[7]=0,Be[11]=0,Be[15]=1,Math.abs(v.determinant(Be))<1e-8)return!1;var o,s,l=Le[3],u=Le[7],c=Le[11],h=Le[12],d=Le[13],g=Le[14],m=Le[15];if(0!==l||0!==u||0!==c){if(we[0]=l,we[1]=u,we[2]=c,we[3]=m,!v.invert(Be,Be))return!1;v.transpose(Be,Be),p.transformMat4(i,we,Be)}else i[0]=i[1]=i[2]=0,i[3]=1;if(t[0]=h,t[1]=d,t[2]=g,s=Le,(o=Fe)[0][0]=s[0],o[0][1]=s[1],o[0][2]=s[2],o[1][0]=s[4],o[1][1]=s[5],o[1][2]=s[6],o[2][0]=s[8],o[2][1]=s[9],o[2][2]=s[10],n[0]=f.length(Fe[0]),f.normalize(Fe[0],Fe[0]),r[0]=f.dot(Fe[0],Fe[1]),Ge(Fe[1],Fe[1],Fe[0],1,-r[0]),n[1]=f.length(Fe[1]),f.normalize(Fe[1],Fe[1]),r[0]/=n[1],r[1]=f.dot(Fe[0],Fe[2]),Ge(Fe[2],Fe[2],Fe[0],1,-r[1]),r[2]=f.dot(Fe[1],Fe[2]),Ge(Fe[2],Fe[2],Fe[1],1,-r[2]),n[2]=f.length(Fe[2]),f.normalize(Fe[2],Fe[2]),r[1]/=n[2],r[2]/=n[2],f.cross(Ue,Fe[1],Fe[2]),f.dot(Fe[0],Ue)<0)for(var y=0;y<3;y++)n[y]*=-1,Fe[y][0]*=-1,Fe[y][1]*=-1,Fe[y][2]*=-1;a[0]=.5*Math.sqrt(Math.max(1+Fe[0][0]-Fe[1][1]-Fe[2][2],0)),a[1]=.5*Math.sqrt(Math.max(1-Fe[0][0]+Fe[1][1]-Fe[2][2],0)),a[2]=.5*Math.sqrt(Math.max(1-Fe[0][0]-Fe[1][1]+Fe[2][2],0)),a[3]=.5*Math.sqrt(Math.max(1+Fe[0][0]+Fe[1][1]+Fe[2][2],0)),Fe[2][1]>Fe[1][2]&&(a[0]=-a[0]),Fe[0][2]>Fe[2][0]&&(a[1]=-a[1]),Fe[1][0]>Fe[0][1]&&(a[2]=-a[2])}(function(e){return 0===e.length?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:e.map(_r).reduce(Tr)}(e),t,n,r,i,a),[[t,n,r,a,i]]}var Sr=function(){function e(e,t){for(var n=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],r=0;r<4;r++)for(var i=0;i<4;i++)for(var a=0;a<4;a++)n[r][i]+=t[r][a]*e[a][i];return n}return function(t,n,r,i,a){for(var o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],s=0;s<4;s++)o[s][3]=a[s];for(var l=0;l<3;l++)for(var u=0;u<3;u++)o[3][l]+=t[u]*o[u][l];var c=i[0],h=i[1],d=i[2],f=i[3],p=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];p[0][0]=1-2*(h*h+d*d),p[0][1]=2*(c*h-d*f),p[0][2]=2*(c*d+h*f),p[1][0]=2*(c*h+d*f),p[1][1]=1-2*(c*c+d*d),p[1][2]=2*(h*d-c*f),p[2][0]=2*(c*d-h*f),p[2][1]=2*(h*d+c*f),p[2][2]=1-2*(c*c+h*h),o=e(o,p);var v,g=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];r[2]&&(g[2][1]=r[2],o=e(o,g)),r[1]&&(g[2][1]=0,g[2][0]=r[0],o=e(o,g)),r[0]&&(g[2][0]=0,g[1][0]=r[0],o=e(o,g));for(var m=0;m<3;m++)for(var y=0;y<3;y++)o[m][y]*=n[m];return 0===(v=o)[0][2]&&0===v[0][3]&&0===v[1][2]&&0===v[1][3]&&0===v[2][0]&&0===v[2][1]&&1===v[2][2]&&0===v[2][3]&&0===v[3][2]&&1===v[3][3]?[o[0][0],o[0][1],o[1][0],o[1][1],o[3][0],o[3][1]]:o[0].concat(o[1],o[2],o[3])}}();function Ar(e){return e.toFixed(6).replace(".000000","")}function xr(e,t){var n,r;return e.decompositionPair!==t&&(e.decompositionPair=t,n=Rr(e)),t.decompositionPair!==e&&(t.decompositionPair=e,r=Rr(t)),null===n[0]||null===r[0]?[[!1],[!0],function(n){return n?t[0].d:e[0].d}]:(n[0].push(0),r[0].push(1),[n,r,function(e){var t=function(e,t,n){var r=function(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}(e,t);r=(0,S.Z)(r,-1,1);var i=[];if(1===r)i=e;else for(var a=Math.acos(r),o=1*Math.sin(n*a)/Math.sqrt(1-r*r),s=0;s<4;s++)i.push(e[s]*(Math.cos(n*a)-r*o)+t[s]*o);return i}(n[0][3],r[0][3],e[5]);return Sr(e[0],e[1],e[2],t,e[4]).map(Ar).join(",")}])}function Cr(e){return e.replace(/[XY]/,"")}function Mr(e){return e.replace(/(X|Y|Z|3d)?$/,"3d")}function Nr(e,t,n){var r=!1;if(!e.length||!t.length){e.length||(r=!0,e=t,t=[]);for(var i=function(){var n=e[a],r=n.t,i=n.d,o="scale"===r.substring(0,5)?1:0;t.push({t:r,d:i.map((function(e){return"number"==typeof e?sn(o):sn(o,e.unit)}))})},a=0;a<e.length;a++)i()}var o,s,l=[],u=[],c=[];if(e.length!==t.length){var h=xr(e,t);l=[h[0]],u=[h[1]],c=[["matrix",[h[2]]]]}else for(var d=0;d<e.length;d++){var f=e[d].t,p=t[d].t,v=e[d].d,g=t[d].d,m=gr[f],y=gr[p],E=void 0;if(s=p,"perspective"===(o=f)&&"perspective"===s||!("matrix"!==o&&"matrix3d"!==o||"matrix"!==s&&"matrix3d"!==s)){var _=xr([e[d]],[t[d]]);l.push(_[0]),u.push(_[1]),c.push(["matrix",[_[2]]])}else{if(f===p)E=f;else if(m[2]&&y[2]&&Cr(f)===Cr(p))E=Cr(f),v=m[2](v),g=y[2](g);else{if(!m[1]||!y[1]||Mr(f)!==Mr(p)){var T=xr(e,t);l=[T[0]],u=[T[1]],c=[["matrix",[T[2]]]];break}E=Mr(f),v=m[1](v),g=y[1](g)}for(var R=[],S=[],A=[],x=0;x<v.length;x++){var C=kn(v[x],g[x],n,!1,x);R[x]=C[0],S[x]=C[1],A.push(C[2])}l.push(R),u.push(S),c.push([E,A])}}if(r){var M=l;l=u,u=M}return[l,u,function(e){return e.map((function(e,t){var n=e.map((function(e,n){return c[t][1][n](e)})).join(",");return"matrix"===c[t][0]&&16===n.split(",").length&&(c[t][0]="matrix3d"),"matrix3d"===c[t][0]&&6===n.split(",").length&&(c[t][0]="matrix"),"".concat(c[t][0],"(").concat(n,")")})).join(" ")}]}var kr=Lt((function(e){if((0,R.Z)(e)){if("text-anchor"===e)return[sn(0,"px"),sn(0,"px")];var t=e.split(" ");return 1===t.length&&("top"===t[0]||"bottom"===t[0]?(t[1]=t[0],t[0]="center"):t[1]="center"),2!==t.length?null:[Cn(br(t[0])),Cn(br(t[1]))]}return[sn(e[0]||0,"px"),sn(e[1]||0,"px")]}));function br(e){return"center"===e?"50%":"left"===e||"top"===e?"0%":"right"===e||"bottom"===e?"100%":e}var Pr=[{n:"display",k:["none"]},{n:"opacity",int:!0,inh:!0,d:"1",syntax:et.OPACITY_VALUE},{n:"fillOpacity",int:!0,inh:!0,d:"1",syntax:et.OPACITY_VALUE},{n:"strokeOpacity",int:!0,inh:!0,d:"1",syntax:et.OPACITY_VALUE},{n:"fill",int:!0,k:["none"],d:"none",syntax:et.PAINT},{n:"fillRule",k:["nonzero","evenodd"],d:"nonzero"},{n:"stroke",int:!0,k:["none"],d:"none",syntax:et.PAINT,l:!0},{n:"shadowType",k:["inner","outer","both"],d:"outer",l:!0},{n:"shadowColor",int:!0,syntax:et.COLOR},{n:"shadowOffsetX",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"shadowOffsetY",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"shadowBlur",int:!0,l:!0,d:"0",syntax:et.SHADOW_BLUR},{n:"lineWidth",int:!0,inh:!0,d:"1",l:!0,a:["strokeWidth"],syntax:et.LENGTH_PERCENTAGE},{n:"increasedLineWidthForHitTesting",inh:!0,d:"0",l:!0,syntax:et.LENGTH_PERCENTAGE},{n:"lineJoin",inh:!0,l:!0,a:["strokeLinejoin"],k:["miter","bevel","round"],d:"miter"},{n:"lineCap",inh:!0,l:!0,a:["strokeLinecap"],k:["butt","round","square"],d:"butt"},{n:"lineDash",int:!0,inh:!0,k:["none"],a:["strokeDasharray"],syntax:et.LENGTH_PERCENTAGE_12},{n:"lineDashOffset",int:!0,inh:!0,d:"0",a:["strokeDashoffset"],syntax:et.LENGTH_PERCENTAGE},{n:"offsetPath",syntax:et.DEFINED_PATH},{n:"offsetDistance",int:!0,syntax:et.OFFSET_DISTANCE},{n:"dx",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"dy",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"zIndex",ind:!0,int:!0,d:"0",k:["auto"],syntax:et.Z_INDEX},{n:"visibility",k:["visible","hidden"],ind:!0,inh:!0,int:!0,d:"visible"},{n:"pointerEvents",inh:!0,k:["none","auto","stroke","fill","painted","visible","visiblestroke","visiblefill","visiblepainted","all"],d:"auto"},{n:"filter",ind:!0,l:!0,k:["none"],d:"none",syntax:et.FILTER},{n:"clipPath",syntax:et.DEFINED_PATH},{n:"textPath",syntax:et.DEFINED_PATH},{n:"textPathSide",k:["left","right"],d:"left"},{n:"textPathStartOffset",l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"transform",p:100,int:!0,k:["none"],d:"none",syntax:et.TRANSFORM},{n:"transformOrigin",p:100,d:"0 0",l:!0,syntax:et.TRANSFORM_ORIGIN},{n:"cx",int:!0,l:!0,d:"0",syntax:et.COORDINATE},{n:"cy",int:!0,l:!0,d:"0",syntax:et.COORDINATE},{n:"cz",int:!0,l:!0,d:"0",syntax:et.COORDINATE},{n:"r",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"rx",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"ry",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"x",int:!0,l:!0,d:"0",syntax:et.COORDINATE},{n:"y",int:!0,l:!0,d:"0",syntax:et.COORDINATE},{n:"z",int:!0,l:!0,d:"0",syntax:et.COORDINATE},{n:"width",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"height",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:et.LENGTH_PERCENTAGE},{n:"radius",int:!0,l:!0,d:"0",syntax:et.LENGTH_PERCENTAGE_14},{n:"x1",int:!0,l:!0,syntax:et.COORDINATE},{n:"y1",int:!0,l:!0,syntax:et.COORDINATE},{n:"z1",int:!0,l:!0,syntax:et.COORDINATE},{n:"x2",int:!0,l:!0,syntax:et.COORDINATE},{n:"y2",int:!0,l:!0,syntax:et.COORDINATE},{n:"z2",int:!0,l:!0,syntax:et.COORDINATE},{n:"d",int:!0,l:!0,d:"",syntax:et.PATH,p:50},{n:"points",int:!0,l:!0,syntax:et.LIST_OF_POINTS,p:50},{n:"text",l:!0,d:"",syntax:et.TEXT,p:50},{n:"textTransform",l:!0,inh:!0,k:["capitalize","uppercase","lowercase","none"],d:"none",syntax:et.TEXT_TRANSFORM,p:51},{n:"font",l:!0},{n:"fontSize",int:!0,inh:!0,d:"16px",l:!0,syntax:et.LENGTH_PERCENTAGE},{n:"fontFamily",l:!0,inh:!0,d:"sans-serif"},{n:"fontStyle",l:!0,inh:!0,k:["normal","italic","oblique"],d:"normal"},{n:"fontWeight",l:!0,inh:!0,k:["normal","bold","bolder","lighter"],d:"normal"},{n:"fontVariant",l:!0,inh:!0,k:["normal","small-caps"],d:"normal"},{n:"lineHeight",l:!0,syntax:et.LENGTH,int:!0,d:"0"},{n:"letterSpacing",l:!0,syntax:et.LENGTH,int:!0,d:"0"},{n:"miterLimit",l:!0,syntax:et.NUMBER,d:function(e){return e===ue.PATH||e===ue.POLYGON||e===ue.POLYLINE?"4":"10"}},{n:"wordWrap",l:!0},{n:"wordWrapWidth",l:!0},{n:"maxLines",l:!0},{n:"textOverflow",l:!0,d:"clip"},{n:"leading",l:!0},{n:"textBaseline",l:!0,inh:!0,k:["top","hanging","middle","alphabetic","ideographic","bottom"],d:"alphabetic"},{n:"textAlign",l:!0,inh:!0,k:["start","center","middle","end","left","right"],d:"start"},{n:"markerStart",syntax:et.MARKER},{n:"markerEnd",syntax:et.MARKER},{n:"markerMid",syntax:et.MARKER},{n:"markerStartOffset",syntax:et.LENGTH,l:!0,int:!0,d:"0"},{n:"markerEndOffset",syntax:et.LENGTH,l:!0,int:!0,d:"0"}],Or=new Set(Pr.filter((function(e){return!!e.l})).map((function(e){return e.n}))),Ir={},Dr=function(){return(0,a.Z)((function e(t){var n=this;(0,o.Z)(this,e),this.runtime=t,Pr.forEach((function(e){n.registerMetadata(e)}))}),[{key:"registerMetadata",value:function(e){[e.n].concat((0,c.Z)(e.a||[])).forEach((function(t){Ir[t]=e}))}},{key:"getPropertySyntax",value:function(e){return this.runtime.CSSPropertySyntaxFactory[e]}},{key:"processProperties",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{skipUpdateAttribute:!1,skipParse:!1,forceUpdateGeometry:!1,usedAttributes:[],memoize:!0};Object.assign(e.attributes,t);var r=e.parsedStyle.clipPath,i=e.parsedStyle.offsetPath;Lr(e,t);var a=!!n.forceUpdateGeometry;if(!a)for(var o in t)if(Or.has(o)){a=!0;break}var s=Br(e);s.has("fill")&&t.fill&&(e.parsedStyle.fill=_n(t.fill)),s.has("stroke")&&t.stroke&&(e.parsedStyle.stroke=_n(t.stroke)),s.has("shadowColor")&&t.shadowColor&&(e.parsedStyle.shadowColor=_n(t.shadowColor)),s.has("filter")&&t.filter&&(e.parsedStyle.filter=Ln(t.filter)),s.has("radius")&&!(0,T.Z)(t.radius)&&(e.parsedStyle.radius=Pn(t.radius,4)),s.has("lineDash")&&!(0,T.Z)(t.lineDash)&&(e.parsedStyle.lineDash=Pn(t.lineDash,"even")),s.has("points")&&t.points&&(e.parsedStyle.points=cr(t.points)),s.has("d")&&""===t.d&&(e.parsedStyle.d=(0,u.Z)({},Je)),s.has("d")&&t.d&&(e.parsedStyle.d=lr(t.d)),s.has("textTransform")&&t.textTransform&&this.runtime.CSSPropertySyntaxFactory[et.TEXT_TRANSFORM].calculator(null,null,{value:t.textTransform},e,null),s.has("clipPath")&&!(0,B.Z)(t.clipPath)&&this.runtime.CSSPropertySyntaxFactory[et.DEFINED_PATH].calculator("clipPath",r,t.clipPath,e,this.runtime),s.has("offsetPath")&&t.offsetPath&&this.runtime.CSSPropertySyntaxFactory[et.DEFINED_PATH].calculator("offsetPath",i,t.offsetPath,e,this.runtime),s.has("transform")&&t.transform&&(e.parsedStyle.transform=yr(t.transform)),s.has("transformOrigin")&&t.transformOrigin&&(e.parsedStyle.transformOrigin=kr(t.transformOrigin)),s.has("markerStart")&&t.markerStart&&(e.parsedStyle.markerStart=this.runtime.CSSPropertySyntaxFactory[et.MARKER].calculator(null,t.markerStart,t.markerStart,null,null)),s.has("markerEnd")&&t.markerEnd&&(e.parsedStyle.markerEnd=this.runtime.CSSPropertySyntaxFactory[et.MARKER].calculator(null,t.markerEnd,t.markerEnd,null,null)),s.has("markerMid")&&t.markerMid&&(e.parsedStyle.markerMid=this.runtime.CSSPropertySyntaxFactory[et.MARKER].calculator("",t.markerMid,t.markerMid,null,null)),s.has("zIndex")&&!(0,T.Z)(t.zIndex)&&this.runtime.CSSPropertySyntaxFactory[et.Z_INDEX].postProcessor(e),s.has("offsetDistance")&&!(0,T.Z)(t.offsetDistance)&&this.runtime.CSSPropertySyntaxFactory[et.OFFSET_DISTANCE].postProcessor(e),s.has("transform")&&t.transform&&this.runtime.CSSPropertySyntaxFactory[et.TRANSFORM].postProcessor(e),s.has("transformOrigin")&&t.transformOrigin&&this.runtime.CSSPropertySyntaxFactory[et.TRANSFORM_ORIGIN].postProcessor(e),a&&(e.geometry.dirty=!0,e.dirty(!0,!0),n.forceUpdateGeometry||this.runtime.sceneGraphService.dirtyToRoot(e))}},{key:"updateGeometry",value:function(e){var t=e.nodeName,n=this.runtime.geometryUpdaterFactory[t];if(n){var r=e.geometry;r.contentBounds||(r.contentBounds=new Ee),r.renderBounds||(r.renderBounds=new Ee);var i=e.parsedStyle,a=n.update(i,e),o=a.cx,s=void 0===o?0:o,l=a.cy,u=void 0===l?0:l,c=a.cz,h=void 0===c?0:c,d=a.hwidth,p=void 0===d?0:d,v=a.hheight,g=void 0===v?0:v,m=a.hdepth,y=void 0===m?0:m,E=[Math.abs(p),Math.abs(g),y],_=i.stroke,T=i.lineWidth,R=void 0===T?1:T,S=i.increasedLineWidthForHitTesting,A=void 0===S?0:S,x=i.shadowType,C=void 0===x?"outer":x,M=i.shadowColor,N=i.filter,k=void 0===N?[]:N,b=i.transformOrigin,P=[s,u,h];r.contentBounds.update(P,E);var O=t===ue.POLYLINE||t===ue.POLYGON||t===ue.PATH?Math.SQRT2:.5;if(_&&!_.isNone){var I=((R||0)+(A||0))*O;E[0]+=I,E[1]+=I}if(r.renderBounds.update(P,E),M&&C&&"inner"!==C){var D=r.renderBounds,L=D.min,B=D.max,w=i.shadowBlur||0,F=i.shadowOffsetX||0,U=i.shadowOffsetY||0,G=L[0]-w+F,Z=B[0]+w+F,V=L[1]-w+U,X=B[1]+w+U;L[0]=Math.min(L[0],G),B[0]=Math.max(B[0],Z),L[1]=Math.min(L[1],V),B[1]=Math.max(B[1],X),r.renderBounds.setMinMax(L,B)}k.forEach((function(e){var t=e.name,n=e.params;if("blur"===t){var i=n[0].value;r.renderBounds.update(r.renderBounds.center,f.add(r.renderBounds.halfExtents,r.renderBounds.halfExtents,[i,i,0]))}else if("drop-shadow"===t){var a=n[0].value,o=n[1].value,s=n[2].value,l=r.renderBounds,u=l.min,c=l.max,h=u[0]-s+a,d=c[0]+s+a,p=u[1]-s+o,v=c[1]+s+o;u[0]=Math.min(u[0],h),c[0]=Math.max(c[0],d),u[1]=Math.min(u[1],p),c[1]=Math.max(c[1],v),r.renderBounds.setMinMax(u,c)}})),e.geometry.dirty=!1;var W=g<0,H=(p<0?-1:1)*(b?On(b[0],0,e,!0):0),Y=(W?-1:1)*(b?On(b[1],1,e,!0):0);(H||Y)&&e.setOrigin(H,Y)}}},{key:"updateSizeAttenuation",value:function(e,t){e.style.isSizeAttenuation?(e.style.rawLineWidth||(e.style.rawLineWidth=e.style.lineWidth),e.style.lineWidth=(e.style.rawLineWidth||1)/t,e.nodeName===ue.CIRCLE&&(e.style.rawR||(e.style.rawR=e.style.r),e.style.r=(e.style.rawR||1)/t)):(e.style.rawLineWidth&&(e.style.lineWidth=e.style.rawLineWidth,delete e.style.rawLineWidth),e.nodeName===ue.CIRCLE&&e.style.rawR&&(e.style.r=e.style.rawR,delete e.style.rawR))}}])}();function Lr(e,t){var n=Br(e);for(var r in t)n.has(r)&&(e.parsedStyle[r]=t[r])}function Br(e){return e.constructor.PARSED_STYLE_LIST}var wr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Un}),[{key:"calculator",value:function(e,t,n,r){return bn(n)}}])}(),Fr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r,i){return n instanceof jt&&(n=null),i.sceneGraphService.updateDisplayObjectDependency(e,t,n,r),"clipPath"===e&&r.forEach((function(e){0===e.childNodes.length&&i.sceneGraphService.dirtyToRoot(e)})),n}}])}(),Ur=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=_n,this.mixer=Tn}),[{key:"calculator",value:function(e,t,n,r){return n instanceof jt?"none"===n.value?rn:an:n}}])}(),Gr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n){return n instanceof jt?[]:n}}])}();function Zr(e){var t=e.parsedStyle.fontSize;return(0,T.Z)(t)?null:t}var Vr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Un}),[{key:"calculator",value:function(e,t,n,r,i){if((0,E.Z)(n))return n;if(!Qt.isRelativeUnit(n.unit))return n.value;if(n.unit===Bt.kPercentage)return 0;if(n.unit===Bt.kEms){if(r.parentNode){var a=Zr(r.parentNode);if(a)return a*=n.value}return 0}if(n.unit===Bt.kRems){var o;if(null!=r&&null!==(o=r.ownerDocument)&&void 0!==o&&o.documentElement){var s=Zr(r.ownerDocument.documentElement);if(s)return s*=n.value}return 0}}}])}(),Xr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Zn}),[{key:"calculator",value:function(e,t,n){return n.map((function(e){return e.value}))}}])}(),Wr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Zn}),[{key:"calculator",value:function(e,t,n){return n.map((function(e){return e.value}))}}])}(),Hr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){var i;n instanceof jt&&(n=null);var a=null===(i=n)||void 0===i?void 0:i.cloneNode(!0);return a&&(a.style.isMarker=!0),a}}])}(),Yr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Un}),[{key:"calculator",value:function(e,t,n){return n.value}}])}(),zr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Gn(0,1)}),[{key:"calculator",value:function(e,t,n){return n.value}},{key:"postProcessor",value:function(e){var t=e.parsedStyle,n=t.offsetPath,r=t.offsetDistance;if(n){var i=n.nodeName;if(i===ue.LINE||i===ue.PATH||i===ue.POLYLINE){var a=n.getPoint(r);a&&e.setLocalPosition(a.x,a.y)}}}}])}(),Kr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=Gn(0,1)}),[{key:"calculator",value:function(e,t,n){return n.value}}])}(),jr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=lr,this.mixer=ur}),[{key:"calculator",value:function(e,t,n){return n instanceof jt&&"unset"===n.value?{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new Se(0,0,0,0)}:n}}])}(),qr=(0,a.Z)((function e(){(0,o.Z)(this,e),this.mixer=hr})),Qr=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).mixer=Gn(0,1/0),e}return(0,l.Z)(t,e),(0,a.Z)(t)}(Vr),$r=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){return n instanceof jt?"unset"===n.value?"":n.value:"".concat(n)}},{key:"postProcessor",value:function(e){e.nodeValue="".concat(e.parsedStyle.text)||""}}])}(),Jr=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){var i=r.getAttribute("text");if(i){var a=i;"capitalize"===n.value?a=i.charAt(0).toUpperCase()+i.slice(1):"lowercase"===n.value?a=i.toLowerCase():"uppercase"===n.value&&(a=i.toUpperCase()),r.parsedStyle.text=a}return n.value}}])}();new WeakMap;"undefined"!=typeof window&&window.document;function ei(e){var t=e;do{var n;if(null===(n=t.parsedStyle)||void 0===n?void 0:n.clipPath)return t;t=t.parentElement}while(null!==t);return null}var ti={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},ni="object"===("undefined"==typeof performance?"undefined":i()(performance))&&performance.now?performance:Date;function ri(e){return e.nodeName===ue.FRAGMENT||e.getRootNode().nodeName===ue.FRAGMENT}var ii=1,ai="object"===("undefined"==typeof self?"undefined":i()(self))&&self.self===self?self:"object"===(void 0===n.g?"undefined":i()(n.g))&&n.g.global===n.g?n.g:{},oi=Date.now(),si={},li=Date.now(),ui=function(e){if("function"!=typeof e)throw new TypeError("".concat(e," is not a function"));var t=Date.now(),n=t-li,r=n>16?0:16-n,i=ii++;return si[i]=e,Object.keys(si).length>1||setTimeout((function(){li=t;var e=si;si={},Object.keys(e).forEach((function(t){return e[t](ai.performance&&"function"==typeof ai.performance.now?ai.performance.now():Date.now()-oi)}))}),r),i},ci=function(e){delete si[e]},hi=function(e){return"string"!=typeof e?ui:""===e?ai.requestAnimationFrame:ai["".concat(e,"RequestAnimationFrame")]},di=function(e,t){for(var n=0;void 0!==e[n];){if(t(e[n]))return e[n];n+=1}}(["","webkit","moz","ms","o"],(function(e){return!!hi(e)})),fi=hi(di),pi=function(e){return"string"!=typeof e?ci:""===e?ai.cancelAnimationFrame:ai["".concat(e,"CancelAnimationFrame")]||ai["".concat(e,"CancelRequestAnimationFrame")]}(di);ai.requestAnimationFrame=fi,ai.cancelAnimationFrame=pi;var vi=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],gi=/([\"\'])[^\'\"]+\1/;function mi(e){var t=e.fontSize,n=void 0===t?16:t,r=e.fontFamily,i=void 0===r?"sans-serif":r,a=e.fontStyle,o=void 0===a?"normal":a,s=e.fontVariant,l=void 0===s?"normal":s,u=e.fontWeight;return{fontSize:n,fontFamily:i,fontStyle:o,fontVariant:l,fontWeight:void 0===u?"normal":u}}var yi=Lt((function(e){for(var t=mi(e),n=t.fontSize,r=t.fontFamily,i=t.fontStyle,a=t.fontVariant,o=t.fontWeight,s=(0,E.Z)(n)&&"".concat(n,"px")||"16px",l=r.split(","),u=l.length-1;u>=0;u--){var c=l[u].trim();!gi.test(c)&&vi.indexOf(c)<0&&(c='"'.concat(c,'"')),l[u]=c}return"".concat(i," ").concat(a," ").concat(o," ").concat(s," ").concat(l.join(","))}),(function(e){var t=mi(e),n=t.fontSize,r=t.fontFamily,i=t.fontStyle,a=t.fontVariant,o=t.fontWeight;return"".concat(i,"_").concat(a,"_").concat(o,"_").concat(n,"_").concat(r)})),Ei=function(e){return Math.max(e,1e-6)};function _i(e,t,n){return v.identity(e),e[4]=Math.tan(t),e[1]=Math.tan(n),e}var Ti=v.create(),Ri=v.create(),Si={scale:function(e){v.fromScaling(Ti,[e[0].value,e[1].value,1].map((function(e){return Ei(e)})))},scaleX:function(e){v.fromScaling(Ti,[e[0].value,1,1].map((function(e){return Ei(e)})))},scaleY:function(e){v.fromScaling(Ti,[1,e[0].value,1].map((function(e){return Ei(e)})))},scaleZ:function(e){v.fromScaling(Ti,[1,1,e[0].value].map((function(e){return Ei(e)})))},scale3d:function(e){v.fromScaling(Ti,[e[0].value,e[1].value,e[2].value].map((function(e){return Ei(e)})))},translate:function(e){v.fromTranslation(Ti,[e[0].value,e[1].value,0])},translateX:function(e){v.fromTranslation(Ti,[e[0].value,0,0])},translateY:function(e){v.fromTranslation(Ti,[0,e[0].value,0])},translateZ:function(e){v.fromTranslation(Ti,[0,0,e[0].value])},translate3d:function(e){v.fromTranslation(Ti,[e[0].value,e[1].value,e[2].value])},rotate:function(e){v.fromZRotation(Ti,ke(bn(e[0])))},rotateX:function(e){v.fromXRotation(Ti,ke(bn(e[0])))},rotateY:function(e){v.fromYRotation(Ti,ke(bn(e[0])))},rotateZ:function(e){v.fromZRotation(Ti,ke(bn(e[0])))},rotate3d:function(e){v.fromRotation(Ti,ke(bn(e[3])),[e[0].value,e[1].value,e[2].value])},skew:function(e){_i(Ti,ke(e[0].value),ke(e[1].value))},skewX:function(e){_i(Ti,ke(e[0].value),0)},skewY:function(e){_i(Ti,0,ke(e[0].value))},matrix:function(e){v.set(Ti,e[0].value,e[1].value,0,0,e[2].value,e[3].value,0,0,0,0,1,0,e[4].value,e[5].value,0,1)},matrix3d:function(e){v.set.apply(v,[Ti].concat((0,c.Z)(e.map((function(e){return e.value})))))}},Ai=f.fromValues(1,1,1),xi=f.create(),Ci={translate:function(e,t){Na.sceneGraphService.setLocalScale(e,Ai,!1),Na.sceneGraphService.setLocalEulerAngles(e,xi,void 0,void 0,!1),Na.sceneGraphService.setLocalPosition(e,[t[0].value,t[1].value,0],!1),Na.sceneGraphService.dirtyLocalTransform(e,e.transformable)}};function Mi(e,t){if(e.length){if(1===e.length&&Ci[e[0].t])return void Ci[e[0].t](t,e[0].d);for(var n=v.identity(Ri),r=0;r<e.length;r++){var i=e[r],a=i.t,o=i.d,s=Si[a];s&&(s(o),v.mul(n,n,Ti))}t.setLocalTransform(n)}else t.resetLocalTransform();return t.getLocalTransform()}var Ni=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.parser=Er,this.mixer=Nr}),[{key:"calculator",value:function(e,t,n,r){return n instanceof jt?[]:n}},{key:"postProcessor",value:function(e){Mi(e.parsedStyle.transform,e)}}])}(),ki=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"postProcessor",value:function(e){var t=e.parsedStyle.transformOrigin;t[0].unit===Bt.kPixels&&t[1].unit===Bt.kPixels?e.setOrigin(t[0].value,t[1].value):e.getGeometryBounds()}}])}(),bi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"calculator",value:function(e,t,n,r){return n.value}},{key:"postProcessor",value:function(e){if(e.parentNode){var t=e.parentNode,n=t.renderable,r=t.sortable;n&&t.dirty(),r&&(r.dirty=!0,r.dirtyReason=Ke.Z_INDEX_CHANGED)}}}])}(),Pi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.cx,r=void 0===n?0:n,i=e.cy,a=void 0===i?0:i,o=e.r,s=void 0===o?0:o;return{cx:r,cy:a,hwidth:s,hheight:s}}}])}(),Oi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.cx,r=void 0===n?0:n,i=e.cy,a=void 0===i?0:i,o=e.rx,s=void 0===o?0:o,l=e.ry;return{cx:r,cy:a,hwidth:s,hheight:void 0===l?0:l}}}])}(),Ii=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){var t=e.x1,n=e.y1,r=e.x2,i=e.y2,a=Math.min(t,r),o=Math.max(t,r),s=Math.min(n,i),l=(o-a)/2,u=(Math.max(n,i)-s)/2;return{cx:a+l,cy:s+u,hwidth:l,hheight:u}}}])}(),Di=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){var t=e.d.rect,n=t.x,r=t.y,i=t.width/2,a=t.height/2;return{cx:n+i,cy:r+a,hwidth:i,hheight:a}}}])}(),Li=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){if(e.points&&(0,w.Z)(e.points.points)){var t=e.points.points,n=Math.min.apply(Math,(0,c.Z)(t.map((function(e){return e[0]})))),r=Math.max.apply(Math,(0,c.Z)(t.map((function(e){return e[0]})))),i=Math.min.apply(Math,(0,c.Z)(t.map((function(e){return e[1]})))),a=(r-n)/2,o=(Math.max.apply(Math,(0,c.Z)(t.map((function(e){return e[1]}))))-i)/2;return{cx:n+a,cy:i+o,hwidth:a,hheight:o}}return{cx:0,cy:0,hwidth:0,hheight:0}}}])}(),Bi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.x,r=void 0===n?0:n,i=e.y,a=void 0===i?0:i,o=e.src,s=e.width,l=void 0===s?0:s,u=e.height,c=l,h=void 0===u?0:u;return o&&!(0,R.Z)(o)&&(c||(c=o.width,e.width=c),h||(h=o.height,e.height=h)),{cx:r+c/2,cy:a+h/2,hwidth:c/2,hheight:h/2}}}])}(),wi=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.globalRuntime=t}),[{key:"isReadyToMeasure",value:function(e,t){return e.text}},{key:"update",value:function(e,t){var n,r=e.text,i=e.textAlign,a=void 0===i?"start":i,o=e.lineWidth,s=void 0===o?1:o,l=e.textBaseline,u=void 0===l?"alphabetic":l,c=e.dx,h=void 0===c?0:c,d=e.dy,f=void 0===d?0:d,p=e.x,v=void 0===p?0:p,g=e.y,m=void 0===g?0:g;if(!this.isReadyToMeasure(e,t))return e.metrics={font:"",width:0,height:0,lines:[],lineWidths:[],lineHeight:0,maxLineWidth:0,fontProperties:{ascent:0,descent:0,fontSize:0},lineMetrics:[]},{hwidth:0,hheight:0,cx:0,cy:0};var y=((null==t||null===(n=t.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n?void 0:n.getConfig())||{}).offscreenCanvas,E=this.globalRuntime.textService.measureText(r,e,y);e.metrics=E;var _=E.width/2,T=E.height/2,R=v+_;"center"===a||"middle"===a?R+=s/2-_:"right"!==a&&"end"!==a||(R+=s-2*_);var S=m-T;return"middle"===u?S+=T:"top"===u||"hanging"===u?S+=2*T:"alphabetic"===u||"bottom"!==u&&"ideographic"!==u||(S+=0),h&&(R+=h),f&&(S+=f),{cx:R,cy:S,hwidth:_,hheight:T}}}])}(),Fi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){return{cx:0,cy:0,hwidth:0,hheight:0}}}])}(),Ui=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e,t){var n=e.x,r=void 0===n?0:n,i=e.y,a=void 0===i?0:i,o=e.width,s=void 0===o?0:o,l=e.height,u=void 0===l?0:l;return{cx:r+s/2,cy:a+u/2,hwidth:s/2,hheight:u/2}}}])}();var Gi=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.eventPhase=e.prototype.NONE,this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.defaultPrevented=!1,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Re,this.page=new Re,this.canvas=new Re,this.viewport=new Re,this.composed=!1,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}),[{key:"name",get:function(){return this.type}},{key:"layerX",get:function(){return this.layer.x}},{key:"layerY",get:function(){return this.layer.y}},{key:"pageX",get:function(){return this.page.x}},{key:"pageY",get:function(){return this.page.y}},{key:"x",get:function(){return this.canvas.x}},{key:"y",get:function(){return this.canvas.y}},{key:"canvasX",get:function(){return this.canvas.x}},{key:"canvasY",get:function(){return this.canvas.y}},{key:"viewportX",get:function(){return this.viewport.x}},{key:"viewportY",get:function(){return this.viewport.y}},{key:"composedPath",value:function(){return!this.manager||this.path&&this.path[0]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}},{key:"propagationPath",get:function(){return this.composedPath()}},{key:"preventDefault",value:function(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}},{key:"stopImmediatePropagation",value:function(){this.propagationImmediatelyStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"initEvent",value:function(){}},{key:"initUIEvent",value:function(){}},{key:"clone",value:function(){throw new Error(Ae)}}])}(),Zi=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).client=new Re,e.movement=new Re,e.offset=new Re,e.global=new Re,e.screen=new Re,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clientX",get:function(){return this.client.x}},{key:"clientY",get:function(){return this.client.y}},{key:"movementX",get:function(){return this.movement.x}},{key:"movementY",get:function(){return this.movement.y}},{key:"offsetX",get:function(){return this.offset.x}},{key:"offsetY",get:function(){return this.offset.y}},{key:"globalX",get:function(){return this.global.x}},{key:"globalY",get:function(){return this.global.y}},{key:"screenX",get:function(){return this.screen.x}},{key:"screenY",get:function(){return this.screen.y}},{key:"getModifierState",value:function(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}},{key:"initMouseEvent",value:function(){throw new Error(Ae)}}])}(Gi),Vi=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).width=0,e.height=0,e.isPrimary=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getCoalescedEvents",value:function(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}},{key:"getPredictedEvents",value:function(){throw new Error("getPredictedEvents is not supported!")}},{key:"clone",value:function(){return this.manager.clonePointerEvent(this)}}])}(Zi),Xi=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"clone",value:function(){return this.manager.cloneWheelEvent(this)}}])}(Zi),Wi=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t,[null])).type=e,r.detail=n,Object.assign(r,n),r}return(0,l.Z)(t,e),(0,a.Z)(t)}(Gi),Hi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.emitter=new d.Z}),[{key:"on",value:function(e,t,n){return this.addEventListener(e,t,n),this}},{key:"addEventListener",value:function(e,t,n){var r=!1,i=!1;if((0,F.Z)(n))r=n;else if(n){var a=n.capture;r=void 0!==a&&a;var o=n.once;i=void 0!==o&&o}r&&(e+="capture"),t=(0,U.Z)(t)?t:t.handleEvent;var s=(0,U.Z)(t)?void 0:t;return i?this.emitter.once(e,t,s):this.emitter.on(e,t,s),this}},{key:"off",value:function(e,t,n){return e?this.removeEventListener(e,t,n):this.removeAllEventListeners(),this}},{key:"removeAllEventListeners",value:function(){var e;null===(e=this.emitter)||void 0===e||e.removeAllListeners()}},{key:"removeEventListener",value:function(e,t,n){var r;if(!this.emitter)return this;((0,F.Z)(n)?n:null==n?void 0:n.capture)&&(e+="capture"),t=(0,U.Z)(t)?t:null===(r=t)||void 0===r?void 0:r.handleEvent;var i=(0,U.Z)(t)?void 0:t;return this.emitter.off(e,t,i),this}},{key:"emit",value:function(e,t){this.dispatchEvent(new Wi(e,t))}},{key:"dispatchEventToSelf",value:function(e){e.target||(e.target=this),e.currentTarget=this,this.emitter.emit(e.type,e)}},{key:"dispatchEvent",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(r)return this.dispatchEventToSelf(e),!0;if(this.document)t=this;else if(this.defaultView)t=this.defaultView;else{var i;t=null===(i=this.ownerDocument)||void 0===i?void 0:i.defaultView}if(t){if(e.manager=t.getEventService(),!e.manager)return!1;e.defaultPrevented=!1,e.path?e.path.length=0:e.page=[],n||(e.target=this),e.manager.dispatchEvent(e,e.type,n)}else this.dispatchEventToSelf(e);return!e.defaultPrevented}}])}(),Yi=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).shadow=!1,e.ownerDocument=null,e.isConnected=!1,e.baseURI="",e.childNodes=[],e.nodeType=0,e.nodeName="",e.nodeValue=null,e.parentNode=null,e.destroyed=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"textContent",get:function(){var e="";this.nodeName===ue.TEXT&&(e+=this.style.text);var t,n=(0,oe.Z)(this.childNodes);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.nodeName===ue.TEXT?e+=r.nodeValue:e+=r.textContent}}catch(e){n.e(e)}finally{n.f()}return e},set:function(e){var t=this;this.childNodes.slice().forEach((function(e){t.removeChild(e)})),this.nodeName===ue.TEXT&&(this.style.text="".concat(e))}},{key:"getRootNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.parentNode?this.parentNode.getRootNode(e):e.composed&&this.host?this.host.getRootNode(e):this}},{key:"hasChildNodes",value:function(){return this.childNodes.length>0}},{key:"isDefaultNamespace",value:function(e){throw new Error(Ae)}},{key:"lookupNamespaceURI",value:function(e){throw new Error(Ae)}},{key:"lookupPrefix",value:function(e){throw new Error(Ae)}},{key:"normalize",value:function(){throw new Error(Ae)}},{key:"isEqualNode",value:function(e){return this===e}},{key:"isSameNode",value:function(e){return this.isEqualNode(e)}},{key:"parent",get:function(){return this.parentNode}},{key:"parentElement",get:function(){return null}},{key:"nextSibling",get:function(){return null}},{key:"previousSibling",get:function(){return null}},{key:"firstChild",get:function(){return this.childNodes.length>0?this.childNodes[0]:null}},{key:"lastChild",get:function(){return this.childNodes.length>0?this.childNodes[this.childNodes.length-1]:null}},{key:"compareDocumentPosition",value:function(e){if(e===this)return 0;for(var n=e,r=this,i=[n],a=[r];null!==(o=n.parentNode)&&void 0!==o?o:r.parentNode;){var o;n=n.parentNode?(i.push(n.parentNode),n.parentNode):n,r=r.parentNode?(a.push(r.parentNode),r.parentNode):r}if(n!==r)return t.DOCUMENT_POSITION_DISCONNECTED|t.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC|t.DOCUMENT_POSITION_PRECEDING;var s=i.length>a.length?i:a,l=s===i?a:i;if(s[s.length-l.length]===l[0])return s===i?t.DOCUMENT_POSITION_CONTAINED_BY|t.DOCUMENT_POSITION_FOLLOWING:t.DOCUMENT_POSITION_CONTAINS|t.DOCUMENT_POSITION_PRECEDING;for(var u=s.length-l.length,c=l.length-1;c>=0;c--){var h=l[c],d=s[u+c];if(d!==h){var f=h.parentNode.childNodes;return f.indexOf(h)<f.indexOf(d)?l===i?t.DOCUMENT_POSITION_PRECEDING:t.DOCUMENT_POSITION_FOLLOWING:s===i?t.DOCUMENT_POSITION_PRECEDING:t.DOCUMENT_POSITION_FOLLOWING}}return t.DOCUMENT_POSITION_FOLLOWING}},{key:"contain",value:function(e){return this.contains(e)}},{key:"contains",value:function(e){for(var t=e;t&&this!==t;)t=t.parentNode;return!!t}},{key:"getAncestor",value:function(e){for(var t=this;e>0&&t;)t=t.parentNode,e--;return t}},{key:"forEach",value:function(e){for(var t=[this];t.length>0;){var n=t.pop();if(!1===e(n))break;for(var r=n.childNodes.length-1;r>=0;r--)t.push(n.childNodes[r])}}}],[{key:"isNode",value:function(e){return!!e.childNodes}}])}(Hi);Yi.DOCUMENT_POSITION_DISCONNECTED=1,Yi.DOCUMENT_POSITION_PRECEDING=2,Yi.DOCUMENT_POSITION_FOLLOWING=4,Yi.DOCUMENT_POSITION_CONTAINS=8,Yi.DOCUMENT_POSITION_CONTAINED_BY=16,Yi.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32;var zi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"getOrCreateCanvas",value:function(e,t){if(this.canvas)return this.canvas;if(e||Na.offscreenCanvas)this.canvas=e||Na.offscreenCanvas,this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t));else try{this.canvas=new window.OffscreenCanvas(0,0),this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t)),this.context&&this.context.measureText||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"))}catch(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d",(0,u.Z)({willReadFrequently:!0},t))}return this.canvas.width=10,this.canvas.height=10,this.canvas}},{key:"getOrCreateContext",value:function(e,t){return this.context||this.getOrCreateCanvas(e,t),this.context}}],[{key:"createCanvas",value:function(){try{return new window.OffscreenCanvas(0,0)}catch(e){}try{return document.createElement("canvas")}catch(e){}return null}}])}(),Ki=function(e){return e[e.CAMERA_CHANGED=0]="CAMERA_CHANGED",e[e.DISPLAY_OBJECT_CHANGED=1]="DISPLAY_OBJECT_CHANGED",e[e.NONE=2]="NONE",e}({}),ji=/\[\s*(.*)=(.*)\s*\]/,qi=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"selectOne",value:function(e,t){var n=this;if(e.startsWith("."))return t.find((function(t){return((null==t?void 0:t.classList)||[]).indexOf(n.getIdOrClassname(e))>-1}));if(e.startsWith("#"))return t.find((function(t){return t.id===n.getIdOrClassname(e)}));if(e.startsWith("[")){var r=this.getAttribute(e),i=r.name,a=r.value;return i?t.find((function(e){return t!==e&&("name"===i?e.name===a:n.attributeToString(e,i)===a)})):null}return t.find((function(n){return t!==n&&n.nodeName===e}))}},{key:"selectAll",value:function(e,t){var n=this;if(e.startsWith("."))return t.findAll((function(r){return t!==r&&((null==r?void 0:r.classList)||[]).indexOf(n.getIdOrClassname(e))>-1}));if(e.startsWith("#"))return t.findAll((function(r){return t!==r&&r.id===n.getIdOrClassname(e)}));if(e.startsWith("[")){var r=this.getAttribute(e),i=r.name,a=r.value;return i?t.findAll((function(e){return t!==e&&("name"===i?e.name===a:n.attributeToString(e,i)===a)})):[]}return t.findAll((function(n){return t!==n&&n.nodeName===e}))}},{key:"is",value:function(e,t){if(e.startsWith("."))return t.className===this.getIdOrClassname(e);if(e.startsWith("#"))return t.id===this.getIdOrClassname(e);if(e.startsWith("[")){var n=this.getAttribute(e),r=n.name,i=n.value;return"name"===r?t.name===i:this.attributeToString(t,r)===i}return t.nodeName===e}},{key:"getIdOrClassname",value:function(e){return e.substring(1)}},{key:"getAttribute",value:function(e){var t=e.match(ji),n="",r="";return t&&t.length>2&&(n=t[1].replace(/"/g,""),r=t[2].replace(/"/g,"")),{name:n,value:r}}},{key:"attributeToString",value:function(e,t){if(!e.getAttribute)return"";var n=e.getAttribute(t);return(0,T.Z)(n)?"":n.toString?n.toString():""}}])}(),Qi=function(e){return e.ATTR_MODIFIED="DOMAttrModified",e.INSERTED="DOMNodeInserted",e.MOUNTED="DOMNodeInsertedIntoDocument",e.REMOVED="removed",e.UNMOUNTED="DOMNodeRemovedFromDocument",e.REPARENT="reparent",e.DESTROY="destroy",e.BOUNDS_CHANGED="bounds-changed",e.CULLED="culled",e}({}),$i=function(e){function t(e,n,r,i,a,l,u,c){var h;return(0,o.Z)(this,t),(h=(0,s.Z)(this,t,[null])).relatedNode=n,h.prevValue=r,h.newValue=i,h.attrName=a,h.attrChange=l,h.prevParsedValue=u,h.newParsedValue=c,h.type=e,h}return(0,l.Z)(t,e),(0,a.Z)(t)}(Gi);$i.ADDITION=2,$i.MODIFICATION=1,$i.REMOVAL=3;var Ji,ea,ta,na=new $i(Qi.REPARENT,null,"","","",0,"",""),ra=y.create(),ia=f.create(),aa=f.fromValues(1,1,1),oa=v.create(),sa=y.create(),la=f.create(),ua=v.create(),ca=m.create(),ha=f.create(),da=m.create(),fa=f.create(),pa=f.create(),va=f.create(),ga=v.create(),ma=m.create(),ya=m.create(),Ea=m.create(),_a={affectChildren:!0},Ta=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.pendingEvents=new Map,this.boundsChangedEvent=new Wi(Qi.BOUNDS_CHANGED),this.displayObjectDependencyMap=new WeakMap,this.runtime=t}),[{key:"matches",value:function(e,t){return this.runtime.sceneGraphSelector.is(e,t)}},{key:"querySelector",value:function(e,t){return this.runtime.sceneGraphSelector.selectOne(e,t)}},{key:"querySelectorAll",value:function(e,t){return this.runtime.sceneGraphSelector.selectAll(e,t)}},{key:"attach",value:function(e,t,n){var r,i=!1;e.parentNode&&(i=e.parentNode!==t,this.detach(e));var a=e.nodeName===ue.FRAGMENT,o=ri(t);e.parentNode=t;var s=a?e.childNodes:[e];(0,E.Z)(n)?s.forEach((function(e){t.childNodes.splice(n,0,e),e.parentNode=t})):s.forEach((function(e){t.childNodes.push(e),e.parentNode=t}));var l=t.sortable;if((null!=l&&null!==(r=l.sorted)&&void 0!==r&&r.length||l.dirty||e.parsedStyle.zIndex)&&(-1===l.dirtyChildren.indexOf(e)&&l.dirtyChildren.push(e),l.dirty=!0,l.dirtyReason=Ke.ADDED),!o){if(a)this.dirtifyFragment(e);else{var u=e.transformable;u&&this.dirtyWorldTransform(e,u)}if(i){var c,h=!0===(null===(c=t.ownerDocument)||void 0===c||null===(c=c.defaultView)||void 0===c||null===(c=c.getConfig())||void 0===c||null===(c=c.future)||void 0===c?void 0:c.experimentalCancelEventPropagation);e.dispatchEvent(na,h,h)}}}},{key:"detach",value:function(e){var t,n;if(e.parentNode){var r=e.transformable,i=e.parentNode.sortable;(null!=i&&null!==(t=i.sorted)&&void 0!==t&&t.length||null!==(n=e.style)&&void 0!==n&&n.zIndex)&&(-1===i.dirtyChildren.indexOf(e)&&i.dirtyChildren.push(e),i.dirty=!0,i.dirtyReason=Ke.REMOVED);var a=e.parentNode.childNodes.indexOf(e);a>-1&&e.parentNode.childNodes.splice(a,1),r&&this.dirtyWorldTransform(e,r),e.parentNode=null}}},{key:"getLocalPosition",value:function(e){return e.transformable.localPosition}},{key:"getLocalRotation",value:function(e){return e.transformable.localRotation}},{key:"getLocalScale",value:function(e){return e.transformable.localScale}},{key:"getLocalSkew",value:function(e){return e.transformable.localSkew}},{key:"getLocalTransform",value:function(e){var t=e.transformable;return $e(t),t.localTransform}},{key:"setLocalPosition",value:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.transformable;pa[0]=t[0],pa[1]=t[1],pa[2]=null!==(n=t[2])&&void 0!==n?n:0,f.equals(i.localPosition,pa)||(f.copy(i.localPosition,pa),r&&this.dirtyLocalTransform(e,i))}},{key:"translateLocal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;f.equals(t,ia)||(f.transformQuat(t,t,i.localRotation),f.add(i.localPosition,i.localPosition,t),this.dirtyLocalTransform(e,i))}},{key:"setLocalRotation",value:function(e,t,n,r,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];"number"==typeof t&&(t=m.set(ca,t,n,r,i));var o=e.transformable;m.copy(o.localRotation,t),a&&this.dirtyLocalTransform(e,o)}},{key:"rotateLocal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;m.fromEuler(ya,t[0],t[1],t[2]),m.mul(i.localRotation,i.localRotation,ya),this.dirtyLocalTransform(e,i)}},{key:"setLocalScale",value:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.transformable;f.set(la,t[0],t[1],null!==(n=t[2])&&void 0!==n?n:i.localScale[2]),f.equals(la,i.localScale)||(f.copy(i.localScale,la),r&&this.dirtyLocalTransform(e,i))}},{key:"scaleLocal",value:function(e,t){var n,r=e.transformable;f.multiply(r.localScale,r.localScale,f.set(la,t[0],t[1],null!==(n=t[2])&&void 0!==n?n:1)),this.dirtyLocalTransform(e,r)}},{key:"setLocalSkew",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];"number"==typeof t&&(t=y.set(sa,t,n));var i=e.transformable;y.copy(i.localSkew,t),r&&this.dirtyLocalTransform(e,i)}},{key:"setLocalEulerAngles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];"number"==typeof t&&(t=f.fromValues(t,n,r));var a=e.transformable;m.fromEuler(a.localRotation,t[0],t[1],t[2]),i&&this.dirtyLocalTransform(e,a)}},{key:"setLocalTransform",value:function(e,t){var n=v.getTranslation(ha,t),r=v.getRotation(da,t),i=v.getScaling(fa,t);this.setLocalScale(e,i,!1),this.setLocalPosition(e,n,!1),this.setLocalRotation(e,r,void 0,void 0,void 0,!1),this.dirtyLocalTransform(e,e.transformable)}},{key:"resetLocalTransform",value:function(e){this.setLocalScale(e,aa,!1),this.setLocalPosition(e,ia,!1),this.setLocalEulerAngles(e,ia,void 0,void 0,!1),this.setLocalSkew(e,ra,void 0,!1),this.dirtyLocalTransform(e,e.transformable)}},{key:"getPosition",value:function(e){var t=e.transformable;return v.getTranslation(t.position,this.getWorldTransform(e,t))}},{key:"getRotation",value:function(e){var t=e.transformable;return v.getRotation(t.rotation,this.getWorldTransform(e,t))}},{key:"getScale",value:function(e){var t=e.transformable;return v.getScaling(t.scaling,this.getWorldTransform(e,t))}},{key:"getOrigin",value:function(e){return e.getGeometryBounds(),e.transformable.origin}},{key:"getWorldTransform",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transformable;return t.localDirtyFlag||t.dirtyFlag?(e.parentNode&&e.parentNode.transformable&&this.getWorldTransform(e.parentNode),this.internalUpdateTransform(e),t.worldTransform):t.worldTransform}},{key:"setPosition",value:function(e,t){var n,r=e.transformable;if(va[0]=t[0],va[1]=t[1],va[2]=null!==(n=t[2])&&void 0!==n?n:0,!f.equals(this.getPosition(e),va)){if(f.copy(r.position,va),null!==e.parentNode&&e.parentNode.transformable){var i=e.parentNode.transformable;v.copy(ga,i.worldTransform),v.invert(ga,ga),f.transformMat4(r.localPosition,va,ga)}else f.copy(r.localPosition,va);this.dirtyLocalTransform(e,r)}}},{key:"translate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.set(la,t,n,r)),f.equals(t,ia)||(f.add(la,this.getPosition(e),t),this.setPosition(e,la))}},{key:"setRotation",value:function(e,t,n,r,i){var a=e.transformable;if("number"==typeof t&&(t=m.fromValues(t,n,r,i)),null!==e.parentNode&&e.parentNode.transformable){var o=this.getRotation(e.parentNode);m.copy(ca,o),m.invert(ca,ca),m.multiply(a.localRotation,ca,t),m.normalize(a.localRotation,a.localRotation),this.dirtyLocalTransform(e,a)}else this.setLocalRotation(e,t)}},{key:"rotate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;if(null!==e.parentNode&&e.parentNode.transformable){var a=ca;m.fromEuler(a,t[0],t[1],t[2]);var o=this.getRotation(e),s=this.getRotation(e.parentNode);m.copy(Ea,s),m.invert(Ea,Ea),m.multiply(a,Ea,a),m.multiply(i.localRotation,a,o),m.normalize(i.localRotation,i.localRotation),this.dirtyLocalTransform(e,i)}else this.rotateLocal(e,t)}},{key:"setOrigin",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=[t,n,r]);var i=e.transformable;if(t[0]!==i.origin[0]||t[1]!==i.origin[1]||t[2]!==i.origin[2]){var a=i.origin;a[0]=t[0],a[1]=t[1],a[2]=t[2]||0,this.dirtyLocalTransform(e,i)}}},{key:"setEulerAngles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"==typeof t&&(t=f.fromValues(t,n,r));var i=e.transformable;if(null!==e.parentNode&&e.parentNode.transformable){m.fromEuler(i.localRotation,t[0],t[1],t[2]);var a=this.getRotation(e.parentNode);m.copy(ma,m.invert(ca,a)),m.mul(i.localRotation,i.localRotation,ma),this.dirtyLocalTransform(e,i)}else this.setLocalEulerAngles(e,t)}},{key:"getTransformedGeometryBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.getGeometryBounds(e,t);if(!Ee.isEmpty(r)){var i=n||new Ee;return i.setFromTransformedAABB(r,this.getWorldTransform(e)),i}return null}},{key:"getGeometryBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e,r=n.geometry;r.dirty&&Na.styleValueRegistry.updateGeometry(e);var i=t?r.renderBounds:r.contentBounds||null;return i||new Ee}},{key:"getBounds",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e,i=r.renderable;if(!i.boundsDirty&&!n&&i.bounds)return i.bounds;if(!i.renderBoundsDirty&&n&&i.renderBounds)return i.renderBounds;var a=n?i.renderBounds:i.bounds,o=this.getTransformedGeometryBounds(e,n,a),s=e.childNodes;if(s.forEach((function(e){var r=t.getBounds(e,n);r&&(o?o.add(r):(o=a||new Ee).update(r.center,r.halfExtents))})),o||(o=new Ee),n){var l=ei(e);if(l){var u=l.parsedStyle.clipPath.getBounds(n);o?u&&(o=u.intersection(o)):o.update(u.center,u.halfExtents)}}return n?(i.renderBounds=o,i.renderBoundsDirty=!1):(i.bounds=o,i.boundsDirty=!1),o}},{key:"getLocalBounds",value:function(e){if(e.parentNode){var t=oa;e.parentNode.transformable&&(t=v.invert(ua,this.getWorldTransform(e.parentNode)));var n=this.getBounds(e);if(!Ee.isEmpty(n)){var r=new Ee;return r.setFromTransformedAABB(n,t),r}}return this.getBounds(e)}},{key:"getBoundingClientRect",value:function(e){var t,n,r=this.getGeometryBounds(e);Ee.isEmpty(r)||(n=new Ee).setFromTransformedAABB(r,this.getWorldTransform(e));var i=null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t?void 0:t.getContextService().getBoundingClientRect();if(n){var a=n.getMin(),o=(0,h.Z)(a,2),s=o[0],l=o[1],u=n.getMax(),c=(0,h.Z)(u,2),d=c[0],f=c[1];return new Se(s+((null==i?void 0:i.left)||0),l+((null==i?void 0:i.top)||0),d-s,f-l)}return new Se((null==i?void 0:i.left)||0,(null==i?void 0:i.top)||0,0,0)}},{key:"internalUpdateTransform",value:function(e){var t,n=null===(t=e.parentNode)||void 0===t?void 0:t.transformable;$e(e.transformable),function(e,t){e.dirtyFlag&&(t?v.multiply(e.worldTransform,t.worldTransform,e.localTransform):v.copy(e.worldTransform,e.localTransform),e.dirtyFlag=!1)}(e.transformable,n)}},{key:"internalUpdateElement",value:function(e,t){var n,r,i,a,o,s,l=!0===(null===(n=e.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n||null===(n=n.getConfig())||void 0===n||null===(n=n.future)||void 0===n?void 0:n.experimentalAttributeUpdateOptimization),u=t[t.length-1],c=(null==u?void 0:u.transformDirty)||(null===(r=e.transformable)||void 0===r?void 0:r.localDirtyFlag);e.transformable&&((o=e.transformable).dirtyFlag||(o.dirtyFlag=c));(this.internalUpdateTransform(e),c)&&(null===(s=e.dirty)||void 0===s||s.call(e,!0,!0));var h=(null===(i=e.renderable)||void 0===i?void 0:i.boundsDirty)||(null===(a=e.renderable)||void 0===a?void 0:a.renderBoundsDirty);if((c||h)&&!1===(null==u?void 0:u.shapeUpdated)&&l)for(var d=t.length-1;d>=0;){var f,p,v=t[d];if(v.shapeUpdated)break;null===(f=(p=v.node).dirty)||void 0===f||f.call(p,!0,!0),v.shapeUpdated=!0,d-=1}return c}},{key:"syncHierarchy",value:function(e){for(var t,n,r=[e],i=e.parentNode?[{node:e.parentNode,transformDirty:(null===(t=e.parentNode.transformable)||void 0===t?void 0:t.localDirtyFlag)||(null===(n=e.parentNode.transformable)||void 0===n?void 0:n.dirtyFlag),shapeUpdated:!1}]:[];r.length>0;){for(var a=r.pop(),o=i[i.length-1];i.length>0&&a.parentNode!==o.node;)o=i.pop();var s=this.internalUpdateElement(a,i);if(a.childNodes.length>0){for(var l=a.childNodes.length-1;l>=0;l--)r.push(a.childNodes[l]);i.push({node:a,transformDirty:s,shapeUpdated:!1})}}}},{key:"dirtyLocalTransform",value:function(e,t){ri(e)||t.localDirtyFlag||(t.localDirtyFlag=!0,t.dirtyFlag||this.dirtyWorldTransform(e,t))}},{key:"dirtyWorldTransform",value:function(e,t){this.dirtifyWorldInternal(e,t),this.dirtyToRoot(e,!0)}},{key:"dirtifyWorldInternal",value:function(e,t){var n,r=this,i=!0===(null===(n=e.ownerDocument)||void 0===n||null===(n=n.defaultView)||void 0===n||null===(n=n.getConfig())||void 0===n||null===(n=n.future)||void 0===n?void 0:n.experimentalAttributeUpdateOptimization);t.dirtyFlag||(t.dirtyFlag=!0,e.dirty(!0,!0),i||e.childNodes.forEach((function(e){var t=e.transformable;r.dirtifyWorldInternal(e,t)})))}},{key:"dirtyToRoot",value:function(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e,i=!0===(null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig())||void 0===t||null===(t=t.future)||void 0===t?void 0:t.experimentalAttributeUpdateOptimization);r;){var a,o;if(null===(a=(o=r).dirty)||void 0===a||a.call(o,!0,!0),i)break;r=r.parentNode}n&&e.forEach((function(e){var t;null===(t=e.dirty)||void 0===t||t.call(e,!0,!0)})),this.informDependentDisplayObjects(e),this.pendingEvents.set(e,n)}},{key:"dirtifyFragment",value:function(e){var t,n,r=e.transformable;r&&(r.dirtyFlag=!0,r.localDirtyFlag=!0),null===(t=(n=e).dirty)||void 0===t||t.call(n,!0,!0);for(var i=e.childNodes.length,a=0;a<i;a++)this.dirtifyFragment(e.childNodes[a]);e.nodeName===ue.FRAGMENT&&this.pendingEvents.set(e,!1)}},{key:"triggerPendingEvents",value:function(){var e,t,n=this,r=new Set,i=function(t,i){if(t.isConnected&&!r.has(t)&&t.nodeName!==ue.FRAGMENT){if(n.boundsChangedEvent.detail=i,n.boundsChangedEvent.target=t,t.isMutationObserved)t.dispatchEvent(n.boundsChangedEvent);else{var a;if(void 0===e)e=!0===(null===(a=t.ownerDocument.defaultView)||void 0===a||null===(a=a.getConfig())||void 0===a||null===(a=a.future)||void 0===a?void 0:a.experimentalCancelEventPropagation);t.ownerDocument.defaultView.dispatchEvent(n.boundsChangedEvent,!0,e)}r.add(t)}};this.pendingEvents.forEach((function(e,n){if(n.nodeName!==ue.FRAGMENT){var r;if(void 0===t)t=!0===(null===(r=n.ownerDocument)||void 0===r||null===(r=r.defaultView)||void 0===r||null===(r=r.getConfig())||void 0===r||null===(r=r.future)||void 0===r?void 0:r.experimentalAttributeUpdateOptimization);_a.affectChildren=e,t?i(n,_a):e?n.forEach((function(e){i(e,_a)})):i(n,_a)}})),r.clear(),this.clearPendingEvents()}},{key:"clearPendingEvents",value:function(){this.pendingEvents.clear()}},{key:"updateDisplayObjectDependency",value:function(e,t,n,r){if(t&&t!==n){var i=this.displayObjectDependencyMap.get(t);if(i&&i[e]){var a=i[e].indexOf(r);i[e].splice(a,1)}}if(n){var o=this.displayObjectDependencyMap.get(n);o||(this.displayObjectDependencyMap.set(n,{}),o=this.displayObjectDependencyMap.get(n)),o[e]||(o[e]=[]),o[e].push(r)}}},{key:"informDependentDisplayObjects",value:function(e){var t,n=this,r=this.displayObjectDependencyMap.get(e);if(r){var i=null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig())||void 0===t||null===(t=t.future)||void 0===t?void 0:t.experimentalCancelEventPropagation;Object.keys(r).forEach((function(e){r[e].forEach((function(t){n.dirtyToRoot(t,!0),t.dispatchEvent(new $i(Qi.ATTR_MODIFIED,t,n,n,e,$i.MODIFICATION,n,n),i,i),t.isCustomElement&&t.isConnected&&t.attributeChangedCallback&&t.attributeChangedCallback(e,n,n)}))}))}}}])}(),Ra=function(){return(0,a.Z)((function e(t){if((0,o.Z)(this,e),t<=0)throw new Error("LRU capacity must be a positive number.");this.capacity=t,this.cache=new Map}),[{key:"get",value:function(e){if(this.cache.has(e)){var t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}}},{key:"put",value:function(e,t){if(this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,t),this.cache.size>this.capacity){var n=this.cache.keys().next().value;this.cache.delete(n)}}},{key:"len",value:function(){return this.cache.size}},{key:"clear",value:function(){this.cache.clear()}}])}(),Sa={MetricsString:"|q",BaselineSymbol:"M",BaselineMultiplier:1.4,HeightMultiplier:2,Newlines:[10,13],BreakingSpaces:[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]},Aa=/[a-zA-Z0-9\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u00ff!"#$%&'()*+,-./:;]/,xa=new RegExp("".concat(/[!%),.:;?\]}'""]/.source,"|").concat(/[!),.:;?\]}'""]/.source,"|").concat(/[)\]'"?!:;,.]/.source,"|").concat(/[!%),.:;?\]}'"]/.source)),Ca=new RegExp("".concat(/[$('"]/.source,"|").concat(/[([{'"]/.source,"|").concat(/[(['"...]/.source,"|").concat(/[$([{'"#]/.source)),Ma=function(){return(0,a.Z)((function e(t){var n=this;(0,o.Z)(this,e),this.fontMetricsCache={},this.shouldBreakByKinsokuShorui=function(e,t){return!n.isBreakingSpace(t)&&!(!e||!Ca.exec(t)&&!xa.exec(e))},this.trimByKinsokuShorui=function(e){var t=(0,c.Z)(e),n=t[t.length-2];if(!n)return e;var r=n[n.length-1];return t[t.length-2]=n.slice(0,-1),t[t.length-1]=r+t[t.length-1],t},this.runtime=t,this.charWidthCache=new Ra(100)}),[{key:"measureFont",value:function(e,t){if(this.fontMetricsCache[e])return this.fontMetricsCache[e];var n={ascent:0,descent:0,fontSize:0},r=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(t),i=this.runtime.offscreenCanvasCreator.getOrCreateContext(t,{willReadFrequently:!0});i.font=e;var a=Sa.MetricsString+Sa.BaselineSymbol,o=Math.ceil(i.measureText(a).width),s=Math.ceil(i.measureText(Sa.BaselineSymbol).width),l=Sa.HeightMultiplier*s;s=s*Sa.BaselineMultiplier|0,r.width=o,r.height=l,i.fillStyle="#f00",i.fillRect(0,0,o,l),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(a,0,s);var u=i.getImageData(0,0,o||1,l||1).data,c=u.length,h=4*o,d=0,f=0,p=!1;for(d=0;d<s;++d){for(var v=0;v<h;v+=4)if(255!==u[f+v]){p=!0;break}if(p)break;f+=h}for(n.ascent=s-d,f=c-h,p=!1,d=l;d>s;--d){for(var g=0;g<h;g+=4)if(255!==u[f+g]){p=!0;break}if(p)break;f-=h}return n.descent=d-s,n.fontSize=n.ascent+n.descent,this.fontMetricsCache[e]=n,n}},{key:"measureText",value:function(e,t,n){var r=t.fontSize,i=void 0===r?16:r,a=t.wordWrap,o=void 0!==a&&a,s=t.lineHeight,l=t.lineWidth,u=void 0===l?1:l,c=t.textBaseline,h=void 0===c?"alphabetic":c,d=t.textAlign,f=void 0===d?"start":d,p=t.letterSpacing,v=void 0===p?0:p,g=t.textPath;t.textPathSide,t.textPathStartOffset;var m=t.leading,y=void 0===m?0:m,E=yi(t),_=this.measureFont(E,n);0===_.fontSize&&(_.fontSize=i,_.ascent=i);var T=this.runtime.offscreenCanvasCreator.getOrCreateContext(n);T.font=E,t.isOverflowing=!1;var R=(o?this.wordWrap(e,t,n):e).split(/(?:\r\n|\r|\n)/),S=new Array(R.length),A=0;if(!g){for(var x=0;x<R.length;x++){var C=T.measureText(R[x]).width+(R[x].length-1)*v;S[x]=C,A=Math.max(A,C)}var M=A+u,N=s||_.fontSize+u,k=Math.max(N,_.fontSize+u)+(R.length-1)*(N+y),b=0;return"middle"===h?b=-k/2:"bottom"===h||"alphabetic"===h||"ideographic"===h?b=-k:"top"!==h&&"hanging"!==h||(b=0),{font:E,width:M,height:k,lines:R,lineWidths:S,lineHeight:N+=y,maxLineWidth:A,fontProperties:_,lineMetrics:S.map((function(e,t){var n=0;return"center"===f||"middle"===f?n-=e/2:"right"!==f&&"end"!==f||(n-=e),new Se(n-u/2,b+t*N,e+u,N)}))}}g.getTotalLength();for(var P=0;P<R.length;P++)T.measureText(R[P]).width,R[P].length}},{key:"wordWrap",value:function(e,t,n){var r=this,i=Array.from(e);if(0===i.length)return"";var a=this,o=t.wordWrapWidth,s=void 0===o?0:o,l=t.letterSpacing,u=void 0===l?0:l,c=t.maxLines,h=void 0===c?1/0:c,d=t.textOverflow,f=this.runtime.offscreenCanvasCreator.getOrCreateContext(n),p=s+u,v="";"ellipsis"===d?v="...":d&&"clip"!==d&&(v=d);var g=[""],m=0,y=0,E=-1,_=yi(t),T=this.charWidthCache.get(_);T||(T=new Ra(500),this.charWidthCache.put(_,T));var R=function(e){return r.getFromCache(e,u,T,f)},S=R(v);function A(e,t,n,r){for(;R(e)<r&&t<i.length-1&&!a.isNewline(i[t+1]);)e+=i[t+=1];for(;R(e)>r&&t>=n;)t-=1,e=e.slice(0,-1);return{lineTxt:e,txtLastCharIndex:t}}function x(e,t){if(!(S<=0||S>p))if(g[e]){var n=A(g[e],t,E+1,p-S);g[e]=n.lineTxt+v}else g[e]=v}for(var C=0;C<i.length;C++){var M=i[C],N=i[C-1],k=i[C+1],b=R(M);if(this.isNewline(M)){if(m+1>=h){C<i.length-1&&x(m,C-1),t.isOverflowing=!0;break}E=C-1,y=0,g[m+=1]=""}else{if(b>p){x(m,C-1),t.isOverflowing=!0;break}if(y>0&&y+b>p){var P=A(g[m],C-1,E+1,p);if(P.txtLastCharIndex!==C-1){if(g[m]=P.lineTxt,P.txtLastCharIndex===i.length-1)break;C=P.txtLastCharIndex+1,M=i[C],N=i[C-1],k=i[C+1],b=R(M)}if(m+1>=h){x(m,C-1),t.isOverflowing=!0;break}if(E=C-1,y=0,g[m+=1]="",this.isBreakingSpace(M))continue;this.canBreakInLastChar(M)||(g=this.trimToBreakable(g),y=this.sumTextWidthByCache(g[m]||"",R)),this.shouldBreakByKinsokuShorui(M,k)&&(g=this.trimByKinsokuShorui(g),y+=R(N||""))}y+=b,g[m]+=M}}return g.join("\n")}},{key:"isBreakingSpace",value:function(e){return"string"==typeof e&&Sa.BreakingSpaces.indexOf(e.charCodeAt(0))>=0}},{key:"isNewline",value:function(e){return"string"==typeof e&&Sa.Newlines.indexOf(e.charCodeAt(0))>=0}},{key:"trimToBreakable",value:function(e){var t=(0,c.Z)(e),n=t[t.length-2],r=this.findBreakableIndex(n);if(-1===r||!n)return t;var i=n.slice(r,r+1),a=r+1,o=r+(this.isBreakingSpace(i)?0:1);return t[t.length-1]+=n.slice(a,n.length),t[t.length-2]=n.slice(0,o),t}},{key:"canBreakInLastChar",value:function(e){return!e||!Aa.test(e)}},{key:"sumTextWidthByCache",value:function(e,t){return e.split("").reduce((function(e,n){return e+t(n)}),0)}},{key:"findBreakableIndex",value:function(e){for(var t=e.length-1;t>=0;t--)if(!Aa.test(e[t]))return t;return-1}},{key:"getFromCache",value:function(e,t,n,r){var i=n.get(e);if("number"!=typeof i){var a=e.length*t;i=r.measureText(e).width+a,n.put(e,i)}return i}},{key:"clearCache",value:function(){this.fontMetricsCache={},this.charWidthCache.clear()}}])}(),Na={},ka=(ea=new Bi,ta=new Li,Ji={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(Ji,ue.FRAGMENT,null),ue.CIRCLE,new Pi),ue.ELLIPSE,new Oi),ue.RECT,ea),ue.IMAGE,ea),ue.GROUP,new Fi),ue.LINE,new Ii),ue.TEXT,new wi(Na)),ue.POLYLINE,ta),ue.POLYGON,ta),(0,V.Z)((0,V.Z)((0,V.Z)(Ji,ue.PATH,new Di),ue.HTML,new Ui),ue.MESH,null)),ba=function(e){var t=new Ur,n=new Vr;return e={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,et.PERCENTAGE,null),et.NUMBER,new Yr),et.ANGLE,new wr),et.DEFINED_PATH,new Fr),et.PAINT,t),et.COLOR,t),et.FILTER,new Gr),et.LENGTH,n),et.LENGTH_PERCENTAGE,n),et.LENGTH_PERCENTAGE_12,new Xr),(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(e,et.LENGTH_PERCENTAGE_14,new Wr),et.COORDINATE,new Vr),et.OFFSET_DISTANCE,new zr),et.OPACITY_VALUE,new Kr),et.PATH,new jr),et.LIST_OF_POINTS,new qr),et.SHADOW_BLUR,new Qr),et.TEXT,new $r),et.TEXT_TRANSFORM,new Jr),et.TRANSFORM,new Ni),(0,V.Z)((0,V.Z)((0,V.Z)(e,et.TRANSFORM_ORIGIN,new ki),et.Z_INDEX,new bi),et.MARKER,new Hr)}();Na.CameraContribution=Ye,Na.AnimationTimeline=null,Na.EasingFunction=null,Na.offscreenCanvasCreator=new zi,Na.sceneGraphSelector=new qi,Na.sceneGraphService=new Ta(Na),Na.textService=new Ma(Na),Na.geometryUpdaterFactory=ka,Na.CSSPropertySyntaxFactory=ba,Na.styleValueRegistry=new Dr(Na),Na.layoutRegistry=null,Na.globalThis="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},Na.enableStyleSyntax=!0,Na.enableSizeAttenuation=!1;var Pa=0;var Oa=new $i(Qi.INSERTED,null,"","","",0,"",""),Ia=new $i(Qi.REMOVED,null,"","","",0,"",""),Da=new Wi(Qi.DESTROY),La=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).entity=Pa++,e.transformable={dirtyFlag:!1,localDirtyFlag:!1,localPosition:[0,0,0],localRotation:[0,0,0,1],localScale:[1,1,1],localTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],localSkew:[0,0],position:[0,0,0],rotation:[0,0,0,1],scaling:[1,1,1],worldTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],origin:[0,0,0]},e.renderable={bounds:void 0,boundsDirty:!0,renderBounds:void 0,renderBoundsDirty:!0,dirtyRenderBounds:void 0,dirty:!1},e.geometry={contentBounds:void 0,renderBounds:void 0,dirty:!0},e.cullable={strategy:ze.Standard,visibilityPlaneMask:-1,visible:!0,enable:!0},e.sortable={dirty:!1,sorted:void 0,renderOrder:0,dirtyChildren:[],dirtyReason:void 0},e.rBushNode={aabb:void 0},e.namespaceURI="g",e.scrollLeft=0,e.scrollTop=0,e.clientTop=0,e.clientLeft=0,e.style={},e.computedStyle={},e.parsedStyle={},e.attributes={},e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"dirty",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.renderable.dirty=e,t&&(this.renderable.boundsDirty=e,this.renderable.renderBoundsDirty=e)}},{key:"className",get:function(){return this.getAttribute("class")||""},set:function(e){this.setAttribute("class",e)}},{key:"classList",get:function(){return this.className.split(" ").filter((function(e){return""!==e}))}},{key:"tagName",get:function(){return this.nodeName}},{key:"children",get:function(){return this.childNodes}},{key:"childElementCount",get:function(){return this.childNodes.length}},{key:"firstElementChild",get:function(){return this.firstChild}},{key:"lastElementChild",get:function(){return this.lastChild}},{key:"parentElement",get:function(){return this.parentNode}},{key:"nextSibling",get:function(){if(this.parentNode){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e+1]||null}return null}},{key:"previousSibling",get:function(){if(this.parentNode){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e-1]||null}return null}},{key:"cloneNode",value:function(e){throw new Error(Ae)}},{key:"appendChild",value:function(e,t){var n;if(e.destroyed)throw new Error("Cannot append a destroyed element.");return Na.sceneGraphService.attach(e,this,t),null!==(n=this.ownerDocument)&&void 0!==n&&n.defaultView&&(ri(this)||e.nodeName!==ue.FRAGMENT?this.ownerDocument.defaultView.mountChildren(e):this.ownerDocument.defaultView.mountFragment(e)),this.isMutationObserved&&(Oa.relatedNode=this,e.dispatchEvent(Oa)),e}},{key:"insertBefore",value:function(e,t){if(t){e.parentElement&&e.parentElement.removeChild(e);var n=this.childNodes.indexOf(t);-1===n?this.appendChild(e):this.appendChild(e,n)}else this.appendChild(e);return e}},{key:"replaceChild",value:function(e,t){var n=this.childNodes.indexOf(t);return this.removeChild(t),this.appendChild(e,n),t}},{key:"removeChild",value:function(e){var t,n,r=!0===(null===(t=this.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t||null===(t=t.getConfig().future)||void 0===t?void 0:t.experimentalCancelEventPropagation);return Ia.relatedNode=this,e.dispatchEvent(Ia,r,r),null!==(n=e.ownerDocument)&&void 0!==n&&n.defaultView&&e.ownerDocument.defaultView.unmountChildren(e),Na.sceneGraphService.detach(e),e}},{key:"removeChildren",value:function(){for(var e=this.childNodes.length-1;e>=0;e--){var t=this.childNodes[e];this.removeChild(t)}}},{key:"destroyChildren",value:function(){for(var e=this.childNodes.length-1;e>=0;e--){var t=this.childNodes[e];t.childNodes.length>0&&t.destroyChildren(),t.destroy()}}},{key:"matches",value:function(e){return Na.sceneGraphService.matches(e,this)}},{key:"getElementById",value:function(e){return Na.sceneGraphService.querySelector("#".concat(e),this)}},{key:"getElementsByName",value:function(e){return Na.sceneGraphService.querySelectorAll('[name="'.concat(e,'"]'),this)}},{key:"getElementsByClassName",value:function(e){return Na.sceneGraphService.querySelectorAll(".".concat(e),this)}},{key:"getElementsByTagName",value:function(e){return Na.sceneGraphService.querySelectorAll(e,this)}},{key:"querySelector",value:function(e){return Na.sceneGraphService.querySelector(e,this)}},{key:"querySelectorAll",value:function(e){return Na.sceneGraphService.querySelectorAll(e,this)}},{key:"closest",value:function(e){var t=this;do{if(Na.sceneGraphService.matches(e,t))return t;t=t.parentElement}while(null!==t);return null}},{key:"find",value:function(e){var t=this,n=null;return this.forEach((function(r){return r===t||!e(r)||(n=r,!1)})),n}},{key:"findAll",value:function(e){var t=this,n=[];return this.forEach((function(r){r!==t&&e(r)&&n.push(r)})),n}},{key:"after",value:function(){var e=this;if(this.parentNode){for(var t=this.parentNode.childNodes.indexOf(this),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r.forEach((function(n,r){var i;return null===(i=e.parentNode)||void 0===i?void 0:i.appendChild(n,t+r+1)}))}}},{key:"before",value:function(){if(this.parentNode){for(var e,t=this.parentNode.childNodes.indexOf(this),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=r[0],o=r.slice(1);this.parentNode.appendChild(a,t),(e=a).after.apply(e,(0,c.Z)(o))}}},{key:"replaceWith",value:function(){this.after.apply(this,arguments),this.remove()}},{key:"append",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){return e.appendChild(t)}))}},{key:"prepend",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t,n){return e.appendChild(t,n)}))}},{key:"replaceChildren",value:function(){for(;this.childNodes.length&&this.firstChild;)this.removeChild(this.firstChild);this.append.apply(this,arguments)}},{key:"remove",value:function(){return this.parentNode?this.parentNode.removeChild(this):this}},{key:"destroy",value:function(){var e,t=!0===(null===(e=this.ownerDocument)||void 0===e||null===(e=e.defaultView)||void 0===e||null===(e=e.getConfig().future)||void 0===e?void 0:e.experimentalCancelEventPropagation);this.destroyChildren(),this.dispatchEvent(Da,t,t),this.remove(),this.emitter.removeAllListeners(),this.destroyed=!0}},{key:"getGeometryBounds",value:function(){return Na.sceneGraphService.getGeometryBounds(this)}},{key:"getRenderBounds",value:function(){return Na.sceneGraphService.getBounds(this,!0)}},{key:"getBounds",value:function(){return Na.sceneGraphService.getBounds(this)}},{key:"getLocalBounds",value:function(){return Na.sceneGraphService.getLocalBounds(this)}},{key:"getBoundingClientRect",value:function(){return Na.sceneGraphService.getBoundingClientRect(this)}},{key:"getClientRects",value:function(){return[this.getBoundingClientRect()]}},{key:"computedStyleMap",value:function(){return new Map(Object.entries(this.computedStyle))}},{key:"getAttributeNames",value:function(){return Object.keys(this.attributes)}},{key:"getAttribute",value:function(e){if("symbol"!==i()(e)){var t=this.attributes[e];return t}}},{key:"hasAttribute",value:function(e){return this.getAttributeNames().includes(e)}},{key:"hasAttributes",value:function(){return!!this.getAttributeNames().length}},{key:"removeAttribute",value:function(e){this.setAttribute(e,null),delete this.attributes[e]}},{key:"setAttribute",value:function(e,t,n,r){this.attributes[e]=t}},{key:"getAttributeNS",value:function(e,t){throw new Error(Ae)}},{key:"getAttributeNode",value:function(e){throw new Error(Ae)}},{key:"getAttributeNodeNS",value:function(e,t){throw new Error(Ae)}},{key:"hasAttributeNS",value:function(e,t){throw new Error(Ae)}},{key:"removeAttributeNS",value:function(e,t){throw new Error(Ae)}},{key:"removeAttributeNode",value:function(e){throw new Error(Ae)}},{key:"setAttributeNS",value:function(e,t,n){throw new Error(Ae)}},{key:"setAttributeNode",value:function(e){throw new Error(Ae)}},{key:"setAttributeNodeNS",value:function(e){throw new Error(Ae)}},{key:"toggleAttribute",value:function(e,t){throw new Error(Ae)}}])}(Yi);function Ba(e){return!(null==e||!e.nodeName)}var wa=Na.globalThis.Proxy?Na.globalThis.Proxy:function(){},Fa=new $i(Qi.ATTR_MODIFIED,null,null,null,null,$i.MODIFICATION,null,null),Ua=f.create(),Ga=m.create(),Za=function(e){function t(e){var n;return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).isCustomElement=!1,n.isMutationObserved=!1,n.activeAnimations=[],n.config=e,n.id=e.id||"",n.name=e.name||"",(e.className||e.class)&&(n.className=e.className||e.class),n.nodeName=e.type||ue.GROUP,e.initialParsedStyle&&Object.assign(n.parsedStyle,e.initialParsedStyle),n.initAttributes(e.style),Na.enableStyleSyntax&&(n.style=new wa({setProperty:function(e,t){n.setAttribute(e,t)},getPropertyValue:function(e){return n.getAttribute(e)},removeProperty:function(e){n.removeAttribute(e)},item:function(){return""}},{get:function(e,t){return void 0!==e[t]?e[t]:n.getAttribute(t)},set:function(e,t,r){return n.setAttribute(t,r),!0}})),n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"destroy",value:function(){(0,X.Z)(t,"destroy",this,3)([]),this.getAnimations().forEach((function(e){e.cancel()}))}},{key:"cloneNode",value:function(e,t){var n=(0,u.Z)({},this.attributes);for(var r in n){var i=n[r];Ba(i)&&"clipPath"!==r&&"offsetPath"!==r&&"textPath"!==r&&(n[r]=i.cloneNode(e)),t&&(n[r]=t(r,i))}var a=new this.constructor((0,u.Z)((0,u.Z)({},this.config),{},{style:n}));return a.setLocalTransform(this.getLocalTransform()),e&&this.children.forEach((function(t){if(!t.style.isMarker){var n=t.cloneNode(e);a.appendChild(n)}})),a}},{key:"initAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={forceUpdateGeometry:!0};Na.styleValueRegistry.processProperties(this,e,t),this.dirty()}},{key:"setAttribute",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];(0,B.Z)(n)||(r||n!==this.attributes[e])&&(this.internalSetAttribute(e,n,{memoize:i}),(0,X.Z)(t,"setAttribute",this,3)([e,n]))}},{key:"internalSetAttribute",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.attributes[e],i=this.parsedStyle[e];Na.styleValueRegistry.processProperties(this,(0,V.Z)({},e,t),n),this.dirty();var a,o,s=this.parsedStyle[e];if(this.isConnected)if(Fa.relatedNode=this,Fa.prevValue=r,Fa.newValue=t,Fa.attrName=e,Fa.prevParsedValue=i,Fa.newParsedValue=s,this.isMutationObserved)this.dispatchEvent(Fa);else{var l,u=!0===(null===(l=this.ownerDocument.defaultView.getConfig().future)||void 0===l?void 0:l.experimentalCancelEventPropagation);Fa.target=this,this.ownerDocument.defaultView.dispatchEvent(Fa,!0,u)}(this.isCustomElement&&this.isConnected||!this.isCustomElement)&&(null===(a=(o=this).attributeChangedCallback)||void 0===a||a.call(o,e,r,t,i,s))}},{key:"getBBox",value:function(){var e=this.getBounds(),t=e.getMin(),n=(0,h.Z)(t,2),r=n[0],i=n[1],a=e.getMax(),o=(0,h.Z)(a,2),s=o[0],l=o[1];return new Se(r,i,s-r,l-i)}},{key:"setOrigin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Na.sceneGraphService.setOrigin(this,Me(e,t,n,!1)),this}},{key:"getOrigin",value:function(){return Na.sceneGraphService.getOrigin(this)}},{key:"setPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Na.sceneGraphService.setPosition(this,Me(e,t,n,!1)),this}},{key:"setLocalPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Na.sceneGraphService.setLocalPosition(this,Me(e,t,n,!1)),this}},{key:"translate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Na.sceneGraphService.translate(this,Me(e,t,n,!1)),this}},{key:"translateLocal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Na.sceneGraphService.translateLocal(this,Me(e,t,n,!1)),this}},{key:"getPosition",value:function(){return Na.sceneGraphService.getPosition(this)}},{key:"getLocalPosition",value:function(){return Na.sceneGraphService.getLocalPosition(this)}},{key:"scale",value:function(e,t,n){return this.scaleLocal(e,t,n)}},{key:"scaleLocal",value:function(e,t,n){return"number"==typeof e&&(e=Me(e,t=t||e,n=n||e,!1)),Na.sceneGraphService.scaleLocal(this,e),this}},{key:"setLocalScale",value:function(e,t,n){return"number"==typeof e&&(e=Me(e,t=t||e,n=n||e,!1)),Na.sceneGraphService.setLocalScale(this,e),this}},{key:"getLocalScale",value:function(){return Na.sceneGraphService.getLocalScale(this)}},{key:"getScale",value:function(){return Na.sceneGraphService.getScale(this)}},{key:"getEulerAngles",value:function(){var e=Ie(Ua,Na.sceneGraphService.getWorldTransform(this));return Pe((0,h.Z)(e,3)[2])}},{key:"getLocalEulerAngles",value:function(){var e=Ie(Ua,Na.sceneGraphService.getLocalRotation(this));return Pe((0,h.Z)(e,3)[2])}},{key:"setEulerAngles",value:function(e){return Na.sceneGraphService.setEulerAngles(this,0,0,e),this}},{key:"setLocalEulerAngles",value:function(e){return Na.sceneGraphService.setLocalEulerAngles(this,0,0,e),this}},{key:"rotateLocal",value:function(e,t,n){return(0,T.Z)(t)&&(0,T.Z)(n)?Na.sceneGraphService.rotateLocal(this,0,0,e):Na.sceneGraphService.rotateLocal(this,e,t,n),this}},{key:"rotate",value:function(e,t,n){return(0,T.Z)(t)&&(0,T.Z)(n)?Na.sceneGraphService.rotate(this,0,0,e):Na.sceneGraphService.rotate(this,e,t,n),this}},{key:"setRotation",value:function(e,t,n,r){return Na.sceneGraphService.setRotation(this,e,t,n,r),this}},{key:"setLocalRotation",value:function(e,t,n,r){return Na.sceneGraphService.setLocalRotation(this,e,t,n,r),this}},{key:"setLocalSkew",value:function(e,t){return Na.sceneGraphService.setLocalSkew(this,e,t),this}},{key:"getRotation",value:function(){return Na.sceneGraphService.getRotation(this)}},{key:"getLocalRotation",value:function(){return Na.sceneGraphService.getLocalRotation(this)}},{key:"getLocalSkew",value:function(){return Na.sceneGraphService.getLocalSkew(this)}},{key:"getLocalTransform",value:function(){return Na.sceneGraphService.getLocalTransform(this)}},{key:"getWorldTransform",value:function(){return Na.sceneGraphService.getWorldTransform(this)}},{key:"setLocalTransform",value:function(e){return Na.sceneGraphService.setLocalTransform(this,e),this}},{key:"resetLocalTransform",value:function(){Na.sceneGraphService.resetLocalTransform(this)}},{key:"getAnimations",value:function(){return this.activeAnimations}},{key:"animate",value:function(e,t){var n,r=null===(n=this.ownerDocument)||void 0===n?void 0:n.timeline;return r?r.play(this,e,t):null}},{key:"isVisible",value:function(){var e;return"hidden"!==(null===(e=this.parsedStyle)||void 0===e?void 0:e.visibility)}},{key:"interactive",get:function(){return this.isInteractive()},set:function(e){this.style.pointerEvents=e?"auto":"none"}},{key:"isInteractive",value:function(){var e;return"none"!==(null===(e=this.parsedStyle)||void 0===e?void 0:e.pointerEvents)}},{key:"isCulled",value:function(){return!(!this.cullable||!this.cullable.enable||this.cullable.visible)}},{key:"toFront",value:function(){return this.parentNode&&(this.style.zIndex=Math.max.apply(Math,(0,c.Z)(this.parentNode.children.map((function(e){return Number(e.style.zIndex)}))))+1),this}},{key:"toBack",value:function(){return this.parentNode&&(this.style.zIndex=Math.min.apply(Math,(0,c.Z)(this.parentNode.children.map((function(e){return Number(e.style.zIndex)}))))-1),this}},{key:"getConfig",value:function(){return this.config}},{key:"attr",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[0],a=n[1];return i?(0,G.Z)(i)?(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),this):2===n.length?(this.setAttribute(i,a),this):this.attributes[i]:this.attributes}},{key:"getMatrix",value:function(e){var t=e||this.getWorldTransform(),n=v.getTranslation(Ua,t),r=(0,h.Z)(n,2),i=r[0],a=r[1],o=v.getScaling(Ua,t),s=(0,h.Z)(o,2),l=s[0],u=s[1],c=v.getRotation(Ga,t),d=Ie(Ua,c),f=(0,h.Z)(d,3),p=f[0],m=f[2];return function(e,t,n,r,i){var a=Math.cos(e),o=Math.sin(e);return g.fromValues(r*a,i*o,0,-r*o,i*a,0,t,n,1)}(p||m,i,a,l,u)}},{key:"getLocalMatrix",value:function(){return this.getMatrix(this.getLocalTransform())}},{key:"setMatrix",value:function(e){var t=De(e),n=(0,h.Z)(t,5),r=n[0],i=n[1],a=n[2],o=n[3],s=n[4];this.setEulerAngles(s).setPosition(r,i).setLocalScale(a,o)}},{key:"setLocalMatrix",value:function(e){var t=De(e),n=(0,h.Z)(t,5),r=n[0],i=n[1],a=n[2],o=n[3],s=n[4];this.setLocalEulerAngles(s).setLocalPosition(r,i).setLocalScale(a,o)}},{key:"show",value:function(){this.forEach((function(e){e.style.visibility="visible"}))}},{key:"hide",value:function(){this.forEach((function(e){e.style.visibility="hidden"}))}},{key:"getCount",value:function(){return this.childElementCount}},{key:"getParent",value:function(){return this.parentElement}},{key:"getChildren",value:function(){return this.children}},{key:"getFirst",value:function(){return this.firstElementChild}},{key:"getLast",value:function(){return this.lastElementChild}},{key:"getChildByIndex",value:function(e){return this.children[e]||null}},{key:"add",value:function(e,t){return this.appendChild(e,t)}},{key:"set",value:function(e,t){this.config[e]=t}},{key:"get",value:function(e){return this.config[e]}},{key:"moveTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.setPosition(e,t,n),this}},{key:"move",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.setPosition(e,t,n),this}},{key:"setZIndex",value:function(e){return this.style.zIndex=e,this}}])}(La);Za.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","display","draggable","droppable","fill","fillOpacity","fillRule","filter","increasedLineWidthForHitTesting","lineCap","lineDash","lineDashOffset","lineJoin","lineWidth","miterLimit","hitArea","offsetDistance","offsetPath","offsetX","offsetY","opacity","pointerEvents","shadowColor","shadowType","shadowBlur","shadowOffsetX","shadowOffsetY","stroke","strokeOpacity","strokeWidth","strokeLinecap","strokeLineJoin","strokeDasharray","strokeDashoffset","transform","transformOrigin","textTransform","visibility","zIndex"]);var Va=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.CIRCLE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Za);Va.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Za.PARSED_STYLE_LIST),["cx","cy","cz","r","isBillboard","isSizeAttenuation"]));var Xa=["style"],Wa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,se.Z)(n,Xa);return(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({style:r},i)])).isCustomElement=!0,e}return(0,l.Z)(t,e),(0,a.Z)(t)}(Za);Wa.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","draggable","droppable","opacity","pointerEvents","transform","transformOrigin","zIndex","visibility"]);var Ha=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.ELLIPSE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Za);Ha.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Za.PARSED_STYLE_LIST),["cx","cy","cz","rx","ry","isBillboard","isSizeAttenuation"])),(function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,[{type:ue.FRAGMENT}])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Za)).PARSED_STYLE_LIST=new Set(["class","className"]);var Ya=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.GROUP},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Za);Ya.PARSED_STYLE_LIST=new Set(["class","className","clipPath","cursor","draggable","droppable","opacity","pointerEvents","transform","transformOrigin","zIndex","visibility"]);var za=["style"],Ka=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,se.Z)(n,za);return(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:ue.HTML,style:r},i)])).cullable.enable=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDomElement",value:function(){return this.parsedStyle.$el}},{key:"getClientRects",value:function(){return[this.getBoundingClientRect()]}},{key:"getLocalBounds",value:function(){if(this.parentNode){var e=v.invert(v.create(),this.parentNode.getWorldTransform()),t=this.getBounds();if(!Ee.isEmpty(t)){var n=new Ee;return n.setFromTransformedAABB(t,e),n}}return this.getBounds()}}])}(Za);Ka.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Za.PARSED_STYLE_LIST),["x","y","$el","innerHTML","width","height"]));var ja=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.IMAGE},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Za);ja.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Za.PARSED_STYLE_LIST),["x","y","z","src","width","height","isBillboard","billboardRotation","isSizeAttenuation","keepAspectRatio"]));var qa=["style"],Qa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,se.Z)(n,qa);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:ue.LINE,style:(0,u.Z)({x1:0,y1:0,x2:0,y2:0,z1:0,z2:0},r)},i)])).markerStartAngle=0,e.markerEndAngle=0;var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd;return l&&Ba(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),c&&Ba(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"x1"===e||"y1"===e||"x2"===e||"y2"===e||"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&Ba(r)&&(this.markerStartAngle=0,r.remove()),i&&Ba(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e&&(r&&Ba(r)&&(this.markerEndAngle=0,r.remove()),i&&Ba(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1)))}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=t.x1,s=t.x2,l=t.y1,u=t.y2,c=e?n:r;if(c&&Ba(c)){var h,d,f,p,v,g,m;e?(p=o,v=l,d=s-o,f=u-l,g=i||0,m=this.markerStartAngle):(p=s,v=u,d=o-s,f=l-u,g=a||0,m=this.markerEndAngle),h=Math.atan2(f,d),c.setLocalEulerAngles(180*h/Math.PI+m),c.setLocalPosition(p+Math.cos(h)*g,v+Math.sin(h)*g)}}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle,r=n.x1,i=n.y1,a=n.x2,o=n.y2,s=q(r,i,a,o,e),l=s.x,u=s.y,c=f.transformMat4(f.create(),f.fromValues(l,u,0),t?this.getWorldTransform():this.getLocalTransform());return new Re(c[0],c[1])}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPoint(e/this.getTotalLength(),t)}},{key:"getTotalLength",value:function(){var e=this.parsedStyle;return j(e.x1,e.y1,e.x2,e.y2)}}])}(Za);Qa.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Za.PARSED_STYLE_LIST),["x1","y1","x2","y2","z1","z2","isBillboard","isSizeAttenuation","markerStart","markerEnd","markerStartOffset","markerEndOffset"]));var $a=["style"],Ja=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,se.Z)(n,$a);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:ue.PATH,style:r,initialParsedStyle:{miterLimit:4,d:(0,u.Z)({},Je)}},i)])).markerStartAngle=0,e.markerEndAngle=0,e.markerMidList=[];var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd,h=a.markerMid;return l&&Ba(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),h&&Ba(h)&&e.placeMarkerMid(h),c&&Ba(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"d"===e?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&Ba(r)&&(this.markerStartAngle=0,r.remove()),i&&Ba(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e?(r&&Ba(r)&&(this.markerEndAngle=0,r.remove()),i&&Ba(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1))):"markerMid"===e&&this.placeMarkerMid(i)}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=e?n:r;if(o&&Ba(o)){var s,l,u,c,d,f,p;if(e){var v=this.getStartTangent(),g=(0,h.Z)(v,2),m=g[0],y=g[1];c=y[0],d=y[1],l=m[0]-y[0],u=m[1]-y[1],f=i||0,p=this.markerStartAngle}else{var E=this.getEndTangent(),_=(0,h.Z)(E,2),T=_[0],R=_[1];c=R[0],d=R[1],l=T[0]-R[0],u=T[1]-R[1],f=a||0,p=this.markerEndAngle}s=Math.atan2(u,l),o.setLocalEulerAngles(180*s/Math.PI+p),o.setLocalPosition(c+Math.cos(s)*f,d+Math.sin(s)*f)}}},{key:"placeMarkerMid",value:function(e){var t=this.parsedStyle.d.segments;if(this.markerMidList.forEach((function(e){e.remove()})),e&&Ba(e))for(var n=1;n<t.length-1;n++){var r=(0,h.Z)(t[n].currentPoint,2),i=r[0],a=r[1],o=1===n?e:e.cloneNode(!0);this.markerMidList.push(o),this.appendChild(o),o.setLocalPosition(i,a)}}},{key:"getTotalLength",value:function(){return Vn(this)}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle.d.absolutePath,r=(0,Z.r)(n,e),i=r.x,a=r.y,o=f.transformMat4(f.create(),f.fromValues(i,a,0),t?this.getWorldTransform():this.getLocalTransform());return new Re(o[0],o[1])}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPointAtLength(e*Vn(this),t)}},{key:"getStartTangent",value:function(){var e=this.parsedStyle.d.segments,t=[];if(e.length>1){var n=e[0].currentPoint,r=e[1].currentPoint,i=e[1].startTangent;t=[],i?(t.push([n[0]-i[0],n[1]-i[1]]),t.push([n[0],n[1]])):(t.push([r[0],r[1]]),t.push([n[0],n[1]]))}return t}},{key:"getEndTangent",value:function(){var e=this.parsedStyle.d.segments,t=e.length,n=[];if(t>1){var r=e[t-2].currentPoint,i=e[t-1].currentPoint,a=e[t-1].endTangent;n=[],a?(n.push([i[0]-a[0],i[1]-a[1]]),n.push([i[0],i[1]])):(n.push([r[0],r[1]]),n.push([i[0],i[1]]))}return n}}])}(Za);Ja.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Za.PARSED_STYLE_LIST),["d","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isBillboard","isSizeAttenuation"]));var eo=["style"],to=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.style,i=(0,se.Z)(n,eo);(0,o.Z)(this,t),(e=(0,s.Z)(this,t,[(0,u.Z)({type:ue.POLYGON,style:r,initialParsedStyle:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!0}},i)])).markerStartAngle=0,e.markerEndAngle=0,e.markerMidList=[];var a=e.parsedStyle,l=a.markerStart,c=a.markerEnd,h=a.markerMid;return l&&Ba(l)&&(e.markerStartAngle=l.getLocalEulerAngles(),e.appendChild(l)),h&&Ba(h)&&e.placeMarkerMid(h),c&&Ba(c)&&(e.markerEndAngle=c.getLocalEulerAngles(),e.appendChild(c)),e.transformMarker(!0),e.transformMarker(!1),e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"attributeChangedCallback",value:function(e,t,n,r,i){"points"===e?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===e||"markerEndOffset"===e?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===e?(r&&Ba(r)&&(this.markerStartAngle=0,r.remove()),i&&Ba(i)&&(this.markerStartAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!0))):"markerEnd"===e?(r&&Ba(r)&&(this.markerEndAngle=0,r.remove()),i&&Ba(i)&&(this.markerEndAngle=i.getLocalEulerAngles(),this.appendChild(i),this.transformMarker(!1))):"markerMid"===e&&this.placeMarkerMid(i)}},{key:"transformMarker",value:function(e){var t=this.parsedStyle,n=t.markerStart,r=t.markerEnd,i=t.markerStartOffset,a=t.markerEndOffset,o=(t.points||{}).points,s=e?n:r;if(s&&Ba(s)&&o){var l,u,c,h,d,f,p;if(h=o[0][0],d=o[0][1],e)u=o[1][0]-o[0][0],c=o[1][1]-o[0][1],f=i||0,p=this.markerStartAngle;else{var v=o.length;this.parsedStyle.isClosed?(u=o[v-1][0]-o[0][0],c=o[v-1][1]-o[0][1]):(h=o[v-1][0],d=o[v-1][1],u=o[v-2][0]-o[v-1][0],c=o[v-2][1]-o[v-1][1]),f=a||0,p=this.markerEndAngle}l=Math.atan2(c,u),s.setLocalEulerAngles(180*l/Math.PI+p),s.setLocalPosition(h+Math.cos(l)*f,d+Math.sin(l)*f)}}},{key:"placeMarkerMid",value:function(e){var t=(this.parsedStyle.points||{}).points;if(this.markerMidList.forEach((function(e){e.remove()})),this.markerMidList=[],e&&Ba(e)&&t)for(var n=1;n<(this.parsedStyle.isClosed?t.length:t.length-1);n++){var r=t[n][0],i=t[n][1],a=1===n?e:e.cloneNode(!0);this.markerMidList.push(a),this.appendChild(a),a.setLocalPosition(r,i)}}}])}(Za);to.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Za.PARSED_STYLE_LIST),["points","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isClosed","isBillboard","isSizeAttenuation"]));var no=["style"],ro=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,se.Z)(e,no);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.POLYLINE,style:n,initialParsedStyle:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!1}},r)])}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getTotalLength",value:function(){return Xn(this)}},{key:"getPointAtLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getPoint(e/this.getTotalLength(),t)}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.parsedStyle.points.points;if(0===this.parsedStyle.points.segments.length){var r,i,a=[],o=0,s=this.getTotalLength();n.forEach((function(e,t){n[t+1]&&((r=[0,0])[0]=o/s,i=j(e[0],e[1],n[t+1][0],n[t+1][1]),o+=i,r[1]=o/s,a.push(r))})),this.parsedStyle.points.segments=a}var l=0,u=0;this.parsedStyle.points.segments.forEach((function(t,n){e>=t[0]&&e<=t[1]&&(l=(e-t[0])/(t[1]-t[0]),u=n)}));var c=q(n[u][0],n[u][1],n[u+1][0],n[u+1][1],l),h=c.x,d=c.y,p=f.transformMat4(f.create(),f.fromValues(h,d,0),t?this.getWorldTransform():this.getLocalTransform());return new Re(p[0],p[1])}},{key:"getStartTangent",value:function(){var e=this.parsedStyle.points.points,t=[];return t.push([e[1][0],e[1][1]]),t.push([e[0][0],e[0][1]]),t}},{key:"getEndTangent",value:function(){var e=this.parsedStyle.points.points,t=e.length-1,n=[];return n.push([e[t-1][0],e[t-1][1]]),n.push([e[t][0],e[t][1]]),n}}])}(to);ro.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(to.PARSED_STYLE_LIST),["points","markerStart","markerMid","markerEnd","markerStartOffset","markerEndOffset","isBillboard"]));var io=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.RECT},e)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Za);io.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Za.PARSED_STYLE_LIST),["x","y","z","width","height","isBillboard","isSizeAttenuation","radius"]));var ao=["style"],oo=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,se.Z)(e,ao);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:ue.TEXT,style:(0,u.Z)({fill:"black"},n)},r)])}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getComputedTextLength",value:function(){var e;return this.getGeometryBounds(),(null===(e=this.parsedStyle.metrics)||void 0===e?void 0:e.maxLineWidth)||0}},{key:"getLineBoundingRects",value:function(){var e;return this.getGeometryBounds(),(null===(e=this.parsedStyle.metrics)||void 0===e?void 0:e.lineMetrics)||[]}},{key:"isOverflowing",value:function(){return this.getGeometryBounds(),!!this.parsedStyle.isOverflowing}}])}(Za);oo.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Za.PARSED_STYLE_LIST),["x","y","z","isBillboard","billboardRotation","isSizeAttenuation","text","textAlign","textBaseline","fontStyle","fontSize","fontFamily","fontWeight","fontVariant","lineHeight","letterSpacing","leading","wordWrap","wordWrapWidth","maxLines","textOverflow","isOverflowing","textPath","textDecorationLine","textDecorationColor","textDecorationStyle","textPathSide","textPathStartOffset","metrics","dx","dy"]));var so=function(){function e(t){(0,o.Z)(this,e),this.strategies=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.config,r=t.camera,i=t.renderingService,a=t.renderingContext,o=this.strategies;i.hooks.cull.tap(e.tag,(function(e){if(e){var t,i=e.cullable;if(0===o.length?i.visible=a.unculledEntities.indexOf(e.entity)>-1:i.visible=o.every((function(t){return t.isVisible(r,e)})),!e.isCulled()&&e.isVisible())return e;var s=!0===(null===(t=n.future)||void 0===t?void 0:t.experimentalCancelEventPropagation);return e.dispatchEvent(new Wi(Qi.CULLED),s,s),null}return e})),i.hooks.afterRender.tap(e.tag,(function(e){e.cullable.visibilityPlaneMask=-1}))}}])}();so.tag="Culling";var lo=function(){function e(){var t=this;(0,o.Z)(this,e),this.autoPreventDefault=!1,this.rootPointerEvent=new Vi(null),this.rootWheelEvent=new Xi(null),this.onPointerMove=function(e){var n,r=null===(n=t.context.renderingContext.root)||void 0===n||null===(n=n.ownerDocument)||void 0===n?void 0:n.defaultView;if(!r.supportsTouchEvents||"touch"!==e.pointerType){var i,a=t.normalizeToPointerEvent(e,r),o=(0,oe.Z)(a);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=t.bootstrapEvent(t.rootPointerEvent,s,r,e);t.context.eventService.mapEvent(l)}}catch(e){o.e(e)}finally{o.f()}t.setCursor(t.context.eventService.cursor)}},this.onClick=function(e){var n,r,i=null===(n=t.context.renderingContext.root)||void 0===n||null===(n=n.ownerDocument)||void 0===n?void 0:n.defaultView,a=t.normalizeToPointerEvent(e,i),o=(0,oe.Z)(a);try{for(o.s();!(r=o.n()).done;){var s=r.value,l=t.bootstrapEvent(t.rootPointerEvent,s,i,e);t.context.eventService.mapEvent(l)}}catch(e){o.e(e)}finally{o.f()}t.setCursor(t.context.eventService.cursor)}}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this;this.context=t;var r=t.renderingService,i=this.context.renderingContext.root.ownerDocument.defaultView;this.context.eventService.setPickHandler((function(e){return n.context.renderingService.hooks.pickSync.call({position:e,picked:[],topmost:!0}).picked[0]||null})),r.hooks.pointerWheel.tap(e.tag,(function(e){var t=n.normalizeWheelEvent(e);n.context.eventService.mapEvent(t)})),r.hooks.pointerDown.tap(e.tag,(function(e){if(!i.supportsTouchEvents||"touch"!==e.pointerType){var t=n.normalizeToPointerEvent(e,i);if(n.autoPreventDefault&&t[0].isNormalized)(e.cancelable||!("cancelable"in e))&&e.preventDefault();var r,a=(0,oe.Z)(t);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=n.bootstrapEvent(n.rootPointerEvent,o,i,e);n.context.eventService.mapEvent(s)}}catch(e){a.e(e)}finally{a.f()}n.setCursor(n.context.eventService.cursor)}})),r.hooks.pointerUp.tap(e.tag,(function(e){if(!i.supportsTouchEvents||"touch"!==e.pointerType){var t,r=n.context.contextService.getDomElement(),a=n.context.eventService.isNativeEventFromCanvas(r,e)?"":"outside",o=n.normalizeToPointerEvent(e,i),s=(0,oe.Z)(o);try{for(s.s();!(t=s.n()).done;){var l=t.value,u=n.bootstrapEvent(n.rootPointerEvent,l,i,e);u.type+=a,n.context.eventService.mapEvent(u)}}catch(e){s.e(e)}finally{s.f()}n.setCursor(n.context.eventService.cursor)}})),r.hooks.pointerMove.tap(e.tag,this.onPointerMove),r.hooks.pointerOver.tap(e.tag,this.onPointerMove),r.hooks.pointerOut.tap(e.tag,this.onPointerMove),r.hooks.click.tap(e.tag,this.onClick),r.hooks.pointerCancel.tap(e.tag,(function(e){var t,r=n.normalizeToPointerEvent(e,i),a=(0,oe.Z)(r);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=n.bootstrapEvent(n.rootPointerEvent,o,i,e);n.context.eventService.mapEvent(s)}}catch(e){a.e(e)}finally{a.f()}n.setCursor(n.context.eventService.cursor)}))}},{key:"bootstrapEvent",value:function(e,t,n,r){e.view=n,e.originalEvent=null,e.nativeEvent=r,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t);var i=this.context.eventService.client2Viewport({x:t.clientX,y:t.clientY}),a=i.x,o=i.y;e.viewport.x=a,e.viewport.y=o;var s=this.context.eventService.viewport2Canvas(e.viewport),l=s.x,u=s.y;return e.canvas.x=l,e.canvas.y=u,e.global.copyFrom(e.canvas),e.offset.copyFrom(e.canvas),e.isTrusted=r.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=ti[e.type]||e.type),e}},{key:"normalizeWheelEvent",value:function(e){var t=this.rootWheelEvent;this.transferMouseData(t,e),t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ;var n=this.context.eventService.client2Viewport({x:e.clientX,y:e.clientY}),r=n.x,i=n.y;t.viewport.x=r,t.viewport.y=i;var a=this.context.eventService.viewport2Canvas(t.viewport),o=a.x,s=a.y;return t.canvas.x=o,t.canvas.y=s,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.nativeEvent=e,t.type=e.type,t}},{key:"transferMouseData",value:function(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=ni.now(),e.type=t.type,e.altKey=t.altKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.ctrlKey=t.ctrlKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.screen.x=t.screenX,e.screen.y=t.screenY,e.relatedTarget=null}},{key:"setCursor",value:function(e){this.context.contextService.applyCursorStyle(e||this.context.config.cursor||"default")}},{key:"normalizeToPointerEvent",value:function(e,t){var n=[];if(t.isTouchEvent(e))for(var r=0;r<e.changedTouches.length;r++){var i=e.changedTouches[r];(0,B.Z)(i.button)&&(i.button=0),(0,B.Z)(i.buttons)&&(i.buttons=1),(0,B.Z)(i.isPrimary)&&(i.isPrimary=1===e.touches.length&&"touchstart"===e.type),(0,B.Z)(i.width)&&(i.width=i.radiusX||1),(0,B.Z)(i.height)&&(i.height=i.radiusY||1),(0,B.Z)(i.tiltX)&&(i.tiltX=0),(0,B.Z)(i.tiltY)&&(i.tiltY=0),(0,B.Z)(i.pointerType)&&(i.pointerType="touch"),(0,B.Z)(i.pointerId)&&(i.pointerId=i.identifier||0),(0,B.Z)(i.pressure)&&(i.pressure=i.force||.5),(0,B.Z)(i.twist)&&(i.twist=0),(0,B.Z)(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,i.type=e.type,n.push(i)}else if(t.isMouseEvent(e)){var a=e;(0,B.Z)(a.isPrimary)&&(a.isPrimary=!0),(0,B.Z)(a.width)&&(a.width=1),(0,B.Z)(a.height)&&(a.height=1),(0,B.Z)(a.tiltX)&&(a.tiltX=0),(0,B.Z)(a.tiltY)&&(a.tiltY=0),(0,B.Z)(a.pointerType)&&(a.pointerType="mouse"),(0,B.Z)(a.pointerId)&&(a.pointerId=1),(0,B.Z)(a.pressure)&&(a.pressure=.5),(0,B.Z)(a.twist)&&(a.twist=0),(0,B.Z)(a.tangentialPressure)&&(a.tangentialPressure=0),a.isNormalized=!0,n.push(a)}else n.push(e);return n}}])}();lo.tag="Event";ue.CIRCLE,ue.ELLIPSE,ue.IMAGE,ue.RECT,ue.LINE,ue.POLYLINE,ue.POLYGON,ue.TEXT,ue.PATH,ue.HTML;var uo=function(){function e(){(0,o.Z)(this,e),this.syncTasks=new Map,this.isFirstTimeRendering=!0,this.syncing=!1,this.isFirstTimeRenderingFinished=!1}return(0,a.Z)(e,[{key:"apply",value:function(t){var n,r,i=this,a=t.config,o=t.renderingService,s=t.renderingContext,l=t.rBushRoot,u=s.root.ownerDocument.defaultView;this.rBush=l;var c=function(e){o.dirtify()},h=function(e){i.syncTasks.set(e.target,e.detail.affectChildren),o.dirtify()},d=function(e){var t=e.target;Na.enableSizeAttenuation&&Na.styleValueRegistry.updateSizeAttenuation(t,u.getCamera().getZoom())},f=function(e){var t=e.target,n=t.rBushNode;null!=n&&n.aabb&&i.rBush.remove(n.aabb),i.syncTasks.delete(t),Na.sceneGraphService.dirtyToRoot(t),o.dirtify()};o.hooks.init.tap(e.tag,(function(){u.addEventListener(Qi.MOUNTED,d),u.addEventListener(Qi.UNMOUNTED,f),u.addEventListener(Qi.ATTR_MODIFIED,c),u.addEventListener(Qi.BOUNDS_CHANGED,h)})),o.hooks.destroy.tap(e.tag,(function(){u.removeEventListener(Qi.MOUNTED,d),u.removeEventListener(Qi.UNMOUNTED,f),u.removeEventListener(Qi.ATTR_MODIFIED,c),u.removeEventListener(Qi.BOUNDS_CHANGED,h),i.syncTasks.clear()}));var p=null!==(n=Na.globalThis.requestIdleCallback)&&void 0!==n?n:fi.bind(Na.globalThis),v=!0===(null===(r=a.future)||void 0===r?void 0:r.experimentalRICSyncRTree);o.hooks.endFrame.tap(e.tag,(function(){i.isFirstTimeRendering?(i.isFirstTimeRendering=!1,i.syncing=!0,p((function(){i.syncRTree(!0),i.isFirstTimeRenderingFinished=!0}))):v&&Na.globalThis.requestIdleCallback&&Na.globalThis.cancelIdleCallback?(Na.globalThis.cancelIdleCallback(i.ricSyncRTreeId),i.ricSyncRTreeId=Na.globalThis.requestIdleCallback((function(){return i.syncRTree()}))):i.syncRTree()}))}},{key:"syncNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.isConnected){var n=e.rBushNode;n.aabb&&this.rBush.remove(n.aabb);var r=e.getRenderBounds();if(r){var i=e.renderable;t&&(i.dirtyRenderBounds||(i.dirtyRenderBounds=new Ee),i.dirtyRenderBounds.update(r.center,r.halfExtents));var a=r.getMin(),o=(0,h.Z)(a,2),s=o[0],l=o[1],u=r.getMax(),c=(0,h.Z)(u,2),d=c[0],f=c[1];n.aabb||(n.aabb={}),n.aabb.displayObject=e,n.aabb.minX=s,n.aabb.minY=l,n.aabb.maxX=d,n.aabb.maxY=f}return n.aabb&&!(isNaN(n.aabb.maxX)||isNaN(n.aabb.maxX)||isNaN(n.aabb.minX)||isNaN(n.aabb.minY))?n.aabb:void 0}}},{key:"syncRTree",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t||!this.syncing&&0!==this.syncTasks.size){this.syncing=!0;var n=[],r=new Set,i=function(i){if(!r.has(i)&&i.renderable){var a=e.syncNode(i,t);a&&(n.push(a),r.add(i))}};this.syncTasks.forEach((function(e,t){e&&t.forEach(i);for(var n=t;n;)i(n),n=n.parentElement})),this.rBush.load(n),n.length=0,this.syncing=!1}}}])}();uo.tag="Prepare";var co,ho,fo,po,vo,go,mo,yo,Eo,_o,To,Ro,So,Ao,xo,Co,Mo,No,ko,bo,Po,Oo,Io,Do,Lo,Bo,wo,Fo=function(e){return e.READY="ready",e.BEFORE_RENDER="beforerender",e.RERENDER="rerender",e.AFTER_RENDER="afterrender",e.BEFORE_DESTROY="beforedestroy",e.AFTER_DESTROY="afterdestroy",e.RESIZE="resize",e.DIRTY_RECTANGLE="dirtyrectangle",e.RENDERER_CHANGED="rendererchanged",e}({}),Uo=(new Wi(Qi.MOUNTED),new Wi(Qi.UNMOUNTED),new Wi(Fo.BEFORE_RENDER),new Wi(Fo.RERENDER),new Wi(Fo.AFTER_RENDER),n(77135)),Go=n(4933),Zo=n(88164),Vo=n(17662),Xo=n.n(Vo),Wo=n(31404),Ho=n.n(Wo),Yo=n(5486),zo=n.n(Yo),Ko=n(30702),jo=n.n(Ko),qo=n(51148);function Qo(e,t,n,r){return{dimension:Co.TEXTURE_2D,format:e,width:t,height:n,depthOrArrayLayers:1,mipLevelCount:r,usage:Mo.SAMPLED}}function $o(e,t,n){return e<<16|t<<8|n}function Jo(e){return e>>>8&255}function es(e){return e>>>16&255}function ts(e){return 255&e}function ns(e){switch(e){case Do.F32:case Do.U32:case Do.S32:return 4;case Do.U16:case Do.S16:case Do.F16:return 2;case Do.U8:case Do.S8:return 1;default:throw new Error("whoops")}}function rs(e){return ns(es(e))}function is(e){var t=ts(e);if(t&Bo.Depth)return bo.Depth;if(t&Bo.Normalized)return bo.Float;var n=es(e);if(n===Do.F16||n===Do.F32)return bo.Float;if(n===Do.U8||n===Do.U16||n===Do.U32)return bo.Uint;if(n===Do.S8||n===Do.S16||n===Do.S32)return bo.Sint;throw new Error("whoops")}function as(e,t){if(void 0===t&&(t=""),!e)throw new Error("Assert fail: ".concat(t))}function os(e){if(null!=e)return e;throw new Error("Missing object")}function ss(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function ls(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function us(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}function cs(e,t,n,r){return void 0===r&&(r=1),{r:e,g:t,b:n,a:r}}!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"}(co||(co={})),function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool",e[e.RenderBundle=11]="RenderBundle"}(ho||(ho={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(fo||(fo={})),function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"}(po||(po={})),function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"}(vo||(vo={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(go||(go={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"}(mo||(mo={})),function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"}(yo||(yo={})),function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"}(Eo||(Eo={})),function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"}(_o||(_o={})),function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"}(To||(To={})),function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"}(Ro||(Ro={})),function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"}(So||(So={})),function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"}(Ao||(Ao={})),function(e){e.LOADED="loaded"}(xo||(xo={})),function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"}(Co||(Co={})),function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"}(Mo||(Mo={})),function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"}(No||(No={})),function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"}(ko||(ko={})),function(e){e[e.Float=0]="Float",e[e.UnfilterableFloat=1]="UnfilterableFloat",e[e.Uint=2]="Uint",e[e.Sint=3]="Sint",e[e.Depth=4]="Depth"}(bo||(bo={})),function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"}(Po||(Po={})),function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"}(Oo||(Oo={})),function(e){e[e.OcclusionConservative=0]="OcclusionConservative"}(Io||(Io={})),function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"}(Do||(Do={})),function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"}(Lo||(Lo={})),function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"}(Bo||(Bo={})),function(e){e[e.ALPHA=$o(Do.U8,Lo.A,Bo.None)]="ALPHA",e[e.U8_LUMINANCE=$o(Do.U8,Lo.A,Bo.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=$o(Do.F16,Lo.A,Bo.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=$o(Do.F32,Lo.A,Bo.Luminance)]="F32_LUMINANCE",e[e.F16_R=$o(Do.F16,Lo.R,Bo.None)]="F16_R",e[e.F16_RG=$o(Do.F16,Lo.RG,Bo.None)]="F16_RG",e[e.F16_RGB=$o(Do.F16,Lo.RGB,Bo.None)]="F16_RGB",e[e.F16_RGBA=$o(Do.F16,Lo.RGBA,Bo.None)]="F16_RGBA",e[e.F32_R=$o(Do.F32,Lo.R,Bo.None)]="F32_R",e[e.F32_RG=$o(Do.F32,Lo.RG,Bo.None)]="F32_RG",e[e.F32_RGB=$o(Do.F32,Lo.RGB,Bo.None)]="F32_RGB",e[e.F32_RGBA=$o(Do.F32,Lo.RGBA,Bo.None)]="F32_RGBA",e[e.U8_R=$o(Do.U8,Lo.R,Bo.None)]="U8_R",e[e.U8_R_NORM=$o(Do.U8,Lo.R,Bo.Normalized)]="U8_R_NORM",e[e.U8_RG=$o(Do.U8,Lo.RG,Bo.None)]="U8_RG",e[e.U8_RG_NORM=$o(Do.U8,Lo.RG,Bo.Normalized)]="U8_RG_NORM",e[e.U8_RGB=$o(Do.U8,Lo.RGB,Bo.None)]="U8_RGB",e[e.U8_RGB_NORM=$o(Do.U8,Lo.RGB,Bo.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=$o(Do.U8,Lo.RGB,Bo.sRGB|Bo.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=$o(Do.U8,Lo.RGBA,Bo.None)]="U8_RGBA",e[e.U8_RGBA_NORM=$o(Do.U8,Lo.RGBA,Bo.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=$o(Do.U8,Lo.RGBA,Bo.sRGB|Bo.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=$o(Do.U16,Lo.R,Bo.None)]="U16_R",e[e.U16_R_NORM=$o(Do.U16,Lo.R,Bo.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=$o(Do.U16,Lo.RG,Bo.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=$o(Do.U16,Lo.RGBA,Bo.Normalized)]="U16_RGBA_NORM",e[e.U16_RGBA=$o(Do.U16,Lo.RGBA,Bo.None)]="U16_RGBA",e[e.U16_RGB=$o(Do.U16,Lo.RGB,Bo.None)]="U16_RGB",e[e.U16_RG=$o(Do.U16,Lo.RG,Bo.None)]="U16_RG",e[e.U32_R=$o(Do.U32,Lo.R,Bo.None)]="U32_R",e[e.U32_RG=$o(Do.U32,Lo.RG,Bo.None)]="U32_RG",e[e.U32_RGB=$o(Do.U32,Lo.RGB,Bo.None)]="U32_RGB",e[e.U32_RGBA=$o(Do.U32,Lo.RGBA,Bo.None)]="U32_RGBA",e[e.S8_R=$o(Do.S8,Lo.R,Bo.None)]="S8_R",e[e.S8_R_NORM=$o(Do.S8,Lo.R,Bo.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=$o(Do.S8,Lo.RG,Bo.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=$o(Do.S8,Lo.RGB,Bo.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=$o(Do.S8,Lo.RGBA,Bo.Normalized)]="S8_RGBA_NORM",e[e.S16_R=$o(Do.S16,Lo.R,Bo.None)]="S16_R",e[e.S16_RG=$o(Do.S16,Lo.RG,Bo.None)]="S16_RG",e[e.S16_RG_NORM=$o(Do.S16,Lo.RG,Bo.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=$o(Do.S16,Lo.RGB,Bo.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=$o(Do.S16,Lo.RGBA,Bo.None)]="S16_RGBA",e[e.S16_RGBA_NORM=$o(Do.S16,Lo.RGBA,Bo.Normalized)]="S16_RGBA_NORM",e[e.S32_R=$o(Do.S32,Lo.R,Bo.None)]="S32_R",e[e.S32_RG=$o(Do.S32,Lo.RG,Bo.None)]="S32_RG",e[e.S32_RGB=$o(Do.S32,Lo.RGB,Bo.None)]="S32_RGB",e[e.S32_RGBA=$o(Do.S32,Lo.RGBA,Bo.None)]="S32_RGBA",e[e.U16_RGBA_5551=$o(Do.U16_PACKED_5551,Lo.RGBA,Bo.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=$o(Do.U16_PACKED_565,Lo.RGB,Bo.Normalized)]="U16_RGB_565",e[e.BC1=$o(Do.BC1,Lo.RGBA,Bo.Normalized)]="BC1",e[e.BC1_SRGB=$o(Do.BC1,Lo.RGBA,Bo.Normalized|Bo.sRGB)]="BC1_SRGB",e[e.BC2=$o(Do.BC2,Lo.RGBA,Bo.Normalized)]="BC2",e[e.BC2_SRGB=$o(Do.BC2,Lo.RGBA,Bo.Normalized|Bo.sRGB)]="BC2_SRGB",e[e.BC3=$o(Do.BC3,Lo.RGBA,Bo.Normalized)]="BC3",e[e.BC3_SRGB=$o(Do.BC3,Lo.RGBA,Bo.Normalized|Bo.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=$o(Do.BC4_UNORM,Lo.R,Bo.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=$o(Do.BC4_SNORM,Lo.R,Bo.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=$o(Do.BC5_UNORM,Lo.RG,Bo.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=$o(Do.BC5_SNORM,Lo.RG,Bo.Normalized)]="BC5_SNORM",e[e.D24=$o(Do.D24,Lo.R,Bo.Depth)]="D24",e[e.D24_S8=$o(Do.D24S8,Lo.RG,Bo.Depth|Bo.Stencil)]="D24_S8",e[e.D32F=$o(Do.D32F,Lo.R,Bo.Depth)]="D32F",e[e.D32F_S8=$o(Do.D32FS8,Lo.RG,Bo.Depth|Bo.Stencil)]="D32F_S8",e[e.U8_RGB_RT=$o(Do.U8,Lo.RGB,Bo.RenderTarget|Bo.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=$o(Do.U8,Lo.RGBA,Bo.RenderTarget|Bo.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=$o(Do.U8,Lo.RGBA,Bo.RenderTarget|Bo.Normalized|Bo.sRGB)]="U8_RGBA_RT_SRGB"}(wo||(wo={}));var hs=cs(0,0,0,0),ds=cs(0,0,0,1),fs=cs(1,1,1,0),ps=cs(1,1,1,1);function vs(e){return!(!e||0!=(e&e-1))}function gs(e,t){return null!=e?e:t}function ms(e){return void 0===e?null:e}function ys(e,t,n){e.length=t,e.fill(n)}function Es(e,t){var n=t-1;return e+n&~n}function _s(e,t){return((e+t-1)/t|0)*t}function Ts(e,t,n){return n?e|=t:e&=~t,e}function Rs(e,t){for(var n=new Array(e),r=0;r<e;r++)n[r]=t();return n}function Ss(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function As(e,t){return void 0===e&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e.mask=t.mask,e}function xs(e,t){return void 0===e&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),Ss(e.rgbBlendState,t.rgbBlendState),Ss(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function Cs(e,t){e.length!==t.length&&(e.length=t.length);for(var n=0;n<t.length;n++)e[n]=xs(e[n],t[n])}function Ms(e,t){void 0!==t.attachmentsState&&Cs(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&ls(e.blendConstant,t.blendConstant),e.depthCompare=gs(t.depthCompare,e.depthCompare),e.depthWrite=gs(t.depthWrite,e.depthWrite),e.stencilWrite=gs(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&As(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&As(e.stencilBack,t.stencilBack),e.cullMode=gs(t.cullMode,e.cullMode),e.frontFace=gs(t.frontFace,e.frontFace),e.polygonOffset=gs(t.polygonOffset,e.polygonOffset),e.polygonOffsetFactor=gs(t.polygonOffsetFactor,e.polygonOffsetFactor),e.polygonOffsetUnits=gs(t.polygonOffsetUnits,e.polygonOffsetUnits)}function Ns(e){var t=Object.assign({},e);return t.attachmentsState=[],Cs(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&us(t.blendConstant),t.stencilFront=As(void 0,e.stencilFront),t.stencilBack=As(void 0,e.stencilBack),t}var ks={blendMode:mo.ADD,blendSrcFactor:go.ONE,blendDstFactor:go.ZERO},bs={attachmentsState:[{channelWriteMask:No.ALL,rgbBlendState:ks,alphaBlendState:ks}],blendConstant:us(hs),depthWrite:!0,depthCompare:fo.LEQUAL,stencilWrite:!1,stencilFront:{compare:fo.ALWAYS,passOp:ko.KEEP,depthFailOp:ko.KEEP,failOp:ko.KEEP},stencilBack:{compare:fo.ALWAYS,passOp:ko.KEEP,depthFailOp:ko.KEEP,failOp:ko.KEEP},cullMode:vo.NONE,frontFace:po.CCW,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0};var Ps=function(e,t){void 0===e&&(e=null),void 0===t&&(t=bs);var n=Ns(t);return null!==e&&Ms(n,e),n}({depthCompare:fo.ALWAYS,depthWrite:!1},bs);function Os(e,t){return void 0===e.attachmentsState&&(e.attachmentsState=[],Cs(e.attachmentsState,bs.attachmentsState)),function(e,t){void 0!==t.channelWriteMask&&(e.channelWriteMask=t.channelWriteMask),void 0!==t.rgbBlendMode&&(e.rgbBlendState.blendMode=t.rgbBlendMode),void 0!==t.alphaBlendMode&&(e.alphaBlendState.blendMode=t.alphaBlendMode),void 0!==t.rgbBlendSrcFactor&&(e.rgbBlendState.blendSrcFactor=t.rgbBlendSrcFactor),void 0!==t.alphaBlendSrcFactor&&(e.alphaBlendState.blendSrcFactor=t.alphaBlendSrcFactor),void 0!==t.rgbBlendDstFactor&&(e.rgbBlendState.blendDstFactor=t.rgbBlendDstFactor),void 0!==t.alphaBlendDstFactor&&(e.alphaBlendState.blendDstFactor=t.alphaBlendDstFactor)}(e.attachmentsState[0],t),e}var Is,Ds={texture:null,sampler:null,formatKind:bo.Float,dimension:Co.TEXTURE_2D};function Ls(e,t,n){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}function Bs(e,t){for(var n=Array(e.length),r=0;r<e.length;r++)n[r]=t(e[r]);return n}function ws(e,t){return e.texture===t.texture&&e.binding===t.binding}function Fs(e,t){return e.buffer===t.buffer&&e.size===t.size&&e.binding===t.binding&&e.offset===t.offset}function Us(e,t){return null===e?null===t:null!==t&&(e.sampler===t.sampler&&e.texture===t.texture&&e.dimension===t.dimension&&e.formatKind===t.formatKind&&e.comparison===t.comparison)}function Gs(e,t){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],e.samplerBindings.length===t.samplerBindings.length&&(!!Ls(e.samplerBindings,t.samplerBindings,Us)&&(!!Ls(e.uniformBufferBindings,t.uniformBufferBindings,Fs)&&(!!Ls(e.storageBufferBindings,t.storageBufferBindings,Fs)&&!!Ls(e.storageTextureBindings,t.storageTextureBindings,ws))))}function Zs(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function Vs(e,t){return!!Zs(e.rgbBlendState,t.rgbBlendState)&&(!!Zs(e.alphaBlendState,t.alphaBlendState)&&e.channelWriteMask===t.channelWriteMask)}function Xs(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp&&e.mask===t.mask}function Ws(e,t){return e.id===t.id}function Hs(e,t){return e===t}function Ys(e,t){return e.topology===t.topology&&(e.inputLayout===t.inputLayout&&(e.sampleCount===t.sampleCount&&(!(e.megaStateDescriptor&&t.megaStateDescriptor&&!function(e,t){return!(!Ls(e.attachmentsState,t.attachmentsState,Vs)||e.blendConstant&&t.blendConstant&&!ss(e.blendConstant,t.blendConstant)||e.stencilFront&&t.stencilFront&&!Xs(e.stencilFront,t.stencilFront)||e.stencilBack&&t.stencilBack&&!Xs(e.stencilBack,t.stencilBack)||e.depthCompare!==t.depthCompare||e.depthWrite!==t.depthWrite||e.stencilWrite!==t.stencilWrite||e.cullMode!==t.cullMode||e.frontFace!==t.frontFace||e.polygonOffset!==t.polygonOffset||e.polygonOffsetFactor!==t.polygonOffsetFactor||e.polygonOffsetUnits!==t.polygonOffsetUnits)}(e.megaStateDescriptor,t.megaStateDescriptor))&&(!!Ws(e.program,t.program)&&(!!Ls(e.colorAttachmentFormats,t.colorAttachmentFormats,Hs)&&e.depthStencilAttachmentFormat===t.depthStencilAttachmentFormat)))))}function zs(e,t){return e.offset===t.offset&&e.shaderLocation===t.shaderLocation&&e.format===t.format&&e.divisor===t.divisor}function Ks(e,t){return(0,T.Z)(e)?(0,T.Z)(t):!(0,T.Z)(t)&&(e.arrayStride===t.arrayStride&&e.stepMode===t.stepMode&&Ls(e.attributes,t.attributes,zs))}function js(e,t){return e.indexBufferFormat===t.indexBufferFormat&&(!!Ls(e.vertexBufferDescriptors,t.vertexBufferDescriptors,Ks)&&!!Ws(e.program,t.program))}function qs(e,t){return e.addressModeU===t.addressModeU&&e.addressModeV===t.addressModeV&&e.minFilter===t.minFilter&&e.magFilter===t.magFilter&&e.mipmapFilter===t.mipmapFilter&&e.lodMinClamp===t.lodMinClamp&&e.lodMaxClamp===t.lodMaxClamp&&e.maxAnisotropy===t.maxAnisotropy&&e.compareFunction===t.compareFunction}function Qs(e){return{sampler:e.sampler,texture:e.texture,dimension:e.dimension,formatKind:e.formatKind,comparison:e.comparison}}function $s(e){var t=e.buffer,n=e.size;return{binding:e.binding,buffer:t,offset:e.offset,size:n}}function Js(e){return{binding:e.binding,texture:e.texture}}function el(e){return{shaderLocation:e.shaderLocation,format:e.format,offset:e.offset,divisor:e.divisor}}function tl(e){return(0,T.Z)(e)?e:{arrayStride:e.arrayStride,stepMode:e.stepMode,attributes:Bs(e.attributes,el)}}var nl=/([^[]*)(\[[0-9]+\])?/;function rl(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};var t=e.match(nl);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:Boolean(t[2])}}function il(){var e=null;return function(t,n,r){var i=e!==r;return i&&(t.uniform1i(n,r),e=r),i}}function al(e,t,n,r){var i=null,a=null;return function(o,s,l){var u=t(l,n),c=u.length,h=!1;if(null===i)i=new Float32Array(c),a=c,h=!0;else{as(a===c,"Uniform length cannot change.");for(var d=0;d<c;++d)if(u[d]!==i[d]){h=!0;break}}return h&&(r(o,e,s,u),i.set(u)),h}}function ol(e,t,n,r){e[t](n,r)}function sl(e,t,n,r){e[t](n,!1,r)}var ll={},ul={},cl={},hl=[0];function dl(e,t,n,r){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(hl[0]=e,e=hl);var i=e.length;if(e instanceof n)return e;var a=r[i];a||(a=new n(i),r[i]=a);for(var o=0;o<i;o++)a[o]=e[o];return a}function fl(e,t){return dl(e,t,Float32Array,ll)}function pl(e,t){return dl(e,t,Int32Array,ul)}function vl(e,t){return dl(e,t,Uint32Array,cl)}var gl=((Is={})[co.FLOAT]=al.bind(null,"uniform1fv",fl,1,ol),Is[co.FLOAT_VEC2]=al.bind(null,"uniform2fv",fl,2,ol),Is[co.FLOAT_VEC3]=al.bind(null,"uniform3fv",fl,3,ol),Is[co.FLOAT_VEC4]=al.bind(null,"uniform4fv",fl,4,ol),Is[co.INT]=al.bind(null,"uniform1iv",pl,1,ol),Is[co.INT_VEC2]=al.bind(null,"uniform2iv",pl,2,ol),Is[co.INT_VEC3]=al.bind(null,"uniform3iv",pl,3,ol),Is[co.INT_VEC4]=al.bind(null,"uniform4iv",pl,4,ol),Is[co.BOOL]=al.bind(null,"uniform1iv",pl,1,ol),Is[co.BOOL_VEC2]=al.bind(null,"uniform2iv",pl,2,ol),Is[co.BOOL_VEC3]=al.bind(null,"uniform3iv",pl,3,ol),Is[co.BOOL_VEC4]=al.bind(null,"uniform4iv",pl,4,ol),Is[co.FLOAT_MAT2]=al.bind(null,"uniformMatrix2fv",fl,4,sl),Is[co.FLOAT_MAT3]=al.bind(null,"uniformMatrix3fv",fl,9,sl),Is[co.FLOAT_MAT4]=al.bind(null,"uniformMatrix4fv",fl,16,sl),Is[co.UNSIGNED_INT]=al.bind(null,"uniform1uiv",vl,1,ol),Is[co.UNSIGNED_INT_VEC2]=al.bind(null,"uniform2uiv",vl,2,ol),Is[co.UNSIGNED_INT_VEC3]=al.bind(null,"uniform3uiv",vl,3,ol),Is[co.UNSIGNED_INT_VEC4]=al.bind(null,"uniform4uiv",vl,4,ol),Is[co.FLOAT_MAT2x3]=al.bind(null,"uniformMatrix2x3fv",fl,6,sl),Is[co.FLOAT_MAT2x4]=al.bind(null,"uniformMatrix2x4fv",fl,8,sl),Is[co.FLOAT_MAT3x2]=al.bind(null,"uniformMatrix3x2fv",fl,6,sl),Is[co.FLOAT_MAT3x4]=al.bind(null,"uniformMatrix3x4fv",fl,12,sl),Is[co.FLOAT_MAT4x2]=al.bind(null,"uniformMatrix4x2fv",fl,8,sl),Is[co.FLOAT_MAT4x3]=al.bind(null,"uniformMatrix4x3fv",fl,12,sl),Is[co.SAMPLER_2D]=il,Is[co.SAMPLER_CUBE]=il,Is[co.SAMPLER_3D]=il,Is[co.SAMPLER_2D_SHADOW]=il,Is[co.SAMPLER_2D_ARRAY]=il,Is[co.SAMPLER_2D_ARRAY_SHADOW]=il,Is[co.SAMPLER_CUBE_SHADOW]=il,Is[co.INT_SAMPLER_2D]=il,Is[co.INT_SAMPLER_3D]=il,Is[co.INT_SAMPLER_CUBE]=il,Is[co.INT_SAMPLER_2D_ARRAY]=il,Is[co.UNSIGNED_INT_SAMPLER_2D]=il,Is[co.UNSIGNED_INT_SAMPLER_3D]=il,Is[co.UNSIGNED_INT_SAMPLER_CUBE]=il,Is[co.UNSIGNED_INT_SAMPLER_2D_ARRAY]=il,Is);function ml(e,t,n){var r=gl[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,e,t)}var yl={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function El(e,t){return"#define ".concat(e," ").concat(t)}function _l(e){if(void 0===e)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(null!==t){var n=parseInt(t[1],10);if(!Number.isNaN(n))return n}return null}function Tl(e){return[e,""]}function Rl(e,t,n,r,i){var a;void 0===r&&(r=null),void 0===i&&(i=!0);var o="#version 100"===e.glslVersion,s="frag"===t&&(null===(a=n.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))||void 0===a?void 0:a.length)>1,l=n.replace("\r\n","\n").split("\n").map((function(e){return e.replace(/[/][/].*$/,"")})).filter((function(e){return!(!e||/^\s+$/.test(e))})),u="";null!==r&&(u=Object.keys(r).map((function(e){return El(e,r[e])})).join("\n"));var c=l.find((function(e){return e.startsWith("precision")}))||"precision mediump float;",h=i?l.filter((function(e){return!e.startsWith("precision")})).join("\n"):l.join("\n"),d="";if(e.viewportOrigin===Po.UPPER_LEFT&&(d+="".concat(El("VIEWPORT_ORIGIN_TL","1"),"\n")),e.clipSpaceNearZ===Oo.ZERO&&(d+="".concat(El("CLIPSPACE_NEAR_ZERO","1"),"\n")),e.explicitBindingLocations){var f=0,p=0,v=0;h=h.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,(function(e,t,n,r){var i=n?"".concat(n,", "):"";return"layout(".concat(i,"set = ").concat(f,", binding = ").concat(p++,") uniform ").concat(r)})),f++,p=0,as(e.separateSamplerTextures),h=h.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(e,n,r,i,a){var o=_l(r);null===o&&(o=p++);var s=(0,qo.__read)(Tl(i),2),l=s[0],u=s[1];return"frag"===t?"\nlayout(set = ".concat(f,", binding = ").concat(2*o+0,") uniform texture").concat(l," T_").concat(a,";\nlayout(set = ").concat(f,", binding = ").concat(2*o+1,") uniform sampler").concat(u," S_").concat(a,";").trim():""})),h=h.replace("frag"===t?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,(function(e,t){return"layout(location = ".concat(v++,") ").concat(t)})),d+="".concat(El("gl_VertexID","gl_VertexIndex"),"\n"),d+="".concat(El("gl_InstanceID","gl_InstanceIndex"),"\n"),c=c.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var g=0;h=h.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(e,t,n,r,i){var a=_l(n);return null===a&&(a=g++),"uniform sampler".concat(r," ").concat(i,"; // BINDING=").concat(a)}))}if(h=(h=(h=h.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"SAMPLER_".concat(t,"(P_").concat(n,")")}))).replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"PP_SAMPLER_".concat(t,"(P_").concat(n,")")}))).replace(/\bPU_TEXTURE\((.*?)\)/g,(function(e,t){return"TEXTURE(P_".concat(t,")")})),e.separateSamplerTextures)h=h.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){var r=(0,qo.__read)(Tl(t),2),i=r[0],a=r[1];return"texture".concat(i," T_P_").concat(n,", sampler").concat(a," S_P_").concat(n)})),h=(h=(h=h.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"T_".concat(n,", S_").concat(n)}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"sampler".concat(t,"(T_").concat(n,", S_").concat(n,")")}))).replace(/\bTEXTURE\((.*?)\)/g,(function(e,t){return"T_".concat(t)}));else{var m=[];h=(h=(h=h.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"sampler".concat(t," P_").concat(n)}))).replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return n}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return m.push([n,t]),n})),o&&m.forEach((function(e){var t=(0,qo.__read)(e,2),n=t[0],r=t[1];h=h.replace(new RegExp("texture\\(".concat(n),"g"),(function(){return"texture".concat(r,"(").concat(n)}))})),h=h.replace(/\bTEXTURE\((.*?)\)/g,(function(e,t){return t}))}var y="".concat(o?"":e.glslVersion,"\n").concat(o&&s?"#extension GL_EXT_draw_buffers : require\n":"","\n").concat(o&&"frag"===t?"#extension GL_OES_standard_derivatives : enable\n":"").concat(i?c:"","\n").concat(d||"").concat(u?u+"\n":"","\n").concat(h,"\n").trim();if(e.explicitBindingLocations&&"frag"===t&&(y=y.replace(/^\b(out)\b/g,(function(e,t){return"layout(location = 0) ".concat(t)}))),o){if("frag"===t&&(y=y.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"varying ".concat(t," ").concat(n,";\n")}))),"vert"===t&&(y=(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"varying ".concat(t," ").concat(n,";\n")}))).replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"attribute ".concat(t," ").concat(n,";\n")}))),y=y.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(e,t){return t.trim().replace(/^.*$/gm,(function(e){var t=e.trim();return t.startsWith("#")?t:e?"uniform ".concat(t):""}))})),"frag"===t)if(s){var E=[];y=y.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,(function(e,t){return E.push(t),"vec4 ".concat(t,";\n")}));var _=y.lastIndexOf("}");y=y.substring(0,_)+"\n    ".concat(E.map((function(e,t){return"gl_FragData[".concat(t,"] = ").concat(e,";\n    ")})).join("\n"))+y.substring(_)}else{var T;if(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return T=n,"".concat(t," ").concat(n,";\n")})),T){_=y.lastIndexOf("}");y=y.substring(0,_)+"\n  gl_FragColor = vec4(".concat(T,");\n")+y.substring(_)}}y=y.replace(/^\s*layout\((.*)\)/gm,"")}return y}var Sl,Al=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this)||this;return i.id=n,i.device=r,null!==i.device.resourceCreationTracker&&i.device.resourceCreationTracker.trackResourceCreated(i),i}return(0,qo.__extends)(t,e),t.prototype.destroy=function(){null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(d.Z),xl=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=ho.Bindings;var o=i.uniformBufferBindings,s=i.samplerBindings;return a.uniformBufferBindings=o||[],a.samplerBindings=s||[],a.bindingLayouts=a.createBindingLayouts(),a}return(0,qo.__extends)(t,e),t.prototype.createBindingLayouts=function(){var e=0,t=0,n=[],r=this.uniformBufferBindings.length,i=this.samplerBindings.length;return n.push({firstUniformBuffer:e,numUniformBuffers:r,firstSampler:t,numSamplers:i}),{numUniformBuffers:e+=r,numSamplers:t+=i,bindingLayoutTables:n}},t}(Al);function Cl(e){return void 0!==Sl?Sl:"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext?(Sl=!0,!0):Sl=Boolean(e&&2===e._version)}function Ml(e){switch(es(e)){case Do.BC1:case Do.BC2:case Do.BC3:case Do.BC4_UNORM:case Do.BC4_SNORM:case Do.BC5_UNORM:case Do.BC5_SNORM:return!0;default:return!1}}function Nl(e){if(ts(e)&Bo.Normalized)return!1;var t=es(e);return t===Do.S8||t===Do.S16||t===Do.S32||(t===Do.U8||t===Do.U16||t===Do.U32)}function kl(e){return e&Ro.INDEX?co.ELEMENT_ARRAY_BUFFER:e&Ro.VERTEX?co.ARRAY_BUFFER:e&Ro.UNIFORM?co.UNIFORM_BUFFER:void 0}function bl(e){var t=es(e),n=Jo(e),r=ts(e),i=function(e){switch(e){case Do.U8:return co.UNSIGNED_BYTE;case Do.U16:return co.UNSIGNED_SHORT;case Do.U32:return co.UNSIGNED_INT;case Do.S8:return co.BYTE;case Do.S16:return co.SHORT;case Do.S32:return co.INT;case Do.F16:return co.HALF_FLOAT;case Do.F32:return co.FLOAT;default:throw new Error("whoops")}}(t),a=function(e){switch(e){case Lo.R:return 1;case Lo.RG:return 2;case Lo.RGB:return 3;case Lo.RGBA:return 4;default:return 1}}(n);return{size:a,type:i,normalized:!!(r&Bo.Normalized)}}function Pl(e){switch(e){case yo.CLAMP_TO_EDGE:return co.CLAMP_TO_EDGE;case yo.REPEAT:return co.REPEAT;case yo.MIRRORED_REPEAT:return co.MIRRORED_REPEAT;default:throw new Error("whoops")}}function Ol(e,t){if(t===_o.LINEAR&&e===Eo.BILINEAR)return co.LINEAR_MIPMAP_LINEAR;if(t===_o.LINEAR&&e===Eo.POINT)return co.NEAREST_MIPMAP_LINEAR;if(t===_o.NEAREST&&e===Eo.BILINEAR)return co.LINEAR_MIPMAP_NEAREST;if(t===_o.NEAREST&&e===Eo.POINT)return co.NEAREST_MIPMAP_NEAREST;if(t===_o.NO_MIP&&e===Eo.BILINEAR)return co.LINEAR;if(t===_o.NO_MIP&&e===Eo.POINT)return co.NEAREST;throw new Error("Unknown texture filter mode")}function Il(e,t){void 0===t&&(t=0);var n=e;return n.gl_buffer_pages[t/n.pageByteSize|0]}function Dl(e){return e.gl_texture}function Ll(e){return e.gl_sampler}function Bl(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function wl(e,t){for(var n=[];;){var r=t.exec(e);if(!r)break;n.push(r)}return n}function Fl(e){return e.blendMode==mo.ADD&&e.blendSrcFactor==go.ONE&&e.blendDstFactor===go.ZERO}function Ul(e){if(e===Co.TEXTURE_2D)return co.TEXTURE_2D;if(e===Co.TEXTURE_2D_ARRAY)return co.TEXTURE_2D_ARRAY;if(e===Co.TEXTURE_CUBE_MAP)return co.TEXTURE_CUBE_MAP;if(e===Co.TEXTURE_3D)return co.TEXTURE_3D;throw new Error("whoops")}function Gl(e,t,n,r){return e%n==0&&t%r==0}var Zl,Vl=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=ho.Buffer;var o=i.viewOrSize,s=i.usage,l=i.hint,u=void 0===l?So.STATIC:l,c=r.uniformBufferMaxPageByteSize,h=r.gl,d=s&Ro.UNIFORM;d||(Cl(h)?h.bindVertexArray(null):r.OES_vertex_array_object.bindVertexArrayOES(null));var f,p=(0,E.Z)(o)?Es(o,4):Es(o.byteLength,4);if(a.gl_buffer_pages=[],d){for(var v=p;v>0;)a.gl_buffer_pages.push(a.createBufferPage(Math.min(v,c),s,u)),v-=c;f=c}else a.gl_buffer_pages.push(a.createBufferPage(p,s,u)),f=p;return a.pageByteSize=f,a.byteSize=p,a.usage=s,a.gl_target=kl(s),(0,E.Z)(o)||a.setSubData(0,new Uint8Array(o.buffer)),d||(Cl(h)?h.bindVertexArray(a.device.currentBoundVAO):r.OES_vertex_array_object.bindVertexArrayOES(a.device.currentBoundVAO)),a}return(0,qo.__extends)(t,e),t.prototype.setSubData=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.byteLength-n);for(var i=this.device.gl,a=this.pageByteSize,o=e+r,s=e,l=e%a;s<o;){var u=Cl(i)?i.COPY_WRITE_BUFFER:this.gl_target,c=Il(this,s);if(c.ubo)return;i.bindBuffer(u,c),Cl(i)?i.bufferSubData(u,l,t,n,Math.min(o-s,a)):i.bufferSubData(u,l,t),s+=a,l=0,n+=a,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(e,t,n){var r=this.device.gl,i=t&Ro.UNIFORM;if(!Cl(r)&&i)return{ubo:!0};var a=this.device.ensureResourceExists(r.createBuffer()),o=kl(t),s=function(e){switch(e){case So.STATIC:return co.STATIC_DRAW;case So.DYNAMIC:return co.DYNAMIC_DRAW}}(n);return r.bindBuffer(o,a),r.bufferData(o,e,s),a},t}(Al),Xl=function(e){function t(t){var n,r,i,a,o,s=t.id,l=t.device,u=t.descriptor,c=e.call(this,{id:s,device:l})||this;c.type=ho.InputLayout;var h=u.vertexBufferDescriptors,d=u.indexBufferFormat,f=u.program;as(d===wo.U16_R||d===wo.U32_R||null===d);var p=null!==d?function(e){switch(e){case wo.U8_R:return co.UNSIGNED_BYTE;case wo.U16_R:return co.UNSIGNED_SHORT;case wo.U32_R:return co.UNSIGNED_INT;default:throw new Error("whoops")}}(d):null,v=null!==d?rs(d):null,g=c.device.gl,m=c.device.ensureResourceExists(Cl(g)?g.createVertexArray():l.OES_vertex_array_object.createVertexArrayOES());Cl(g)?g.bindVertexArray(m):l.OES_vertex_array_object.bindVertexArrayOES(m),g.bindBuffer(g.ARRAY_BUFFER,Il(c.device.fallbackVertexBuffer));try{for(var y=(0,qo.__values)(u.vertexBufferDescriptors),E=y.next();!E.done;E=y.next()){var _=E.value,R=_.stepMode,S=_.attributes;try{for(var A=(i=void 0,(0,qo.__values)(S)),x=A.next();!x.done;x=A.next()){var C=x.value,M=C.shaderLocation,N=C.format,k=C.divisor,b=void 0===k?1:k,P=Cl(g)?M:null===(o=f.attributes[M])||void 0===o?void 0:o.location,O=bl(N);if(C.vertexFormat=O,!(0,T.Z)(P)){Nl(N);var I=O.size,D=O.type,L=O.normalized;g.vertexAttribPointer(P,I,D,L,0,0),R===Ao.INSTANCE&&(Cl(g)?g.vertexAttribDivisor(P,b):l.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(P,b)),g.enableVertexAttribArray(P)}}}catch(e){i={error:e}}finally{try{x&&!x.done&&(a=A.return)&&a.call(A)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{E&&!E.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}return Cl(g)?g.bindVertexArray(null):l.OES_vertex_array_object.bindVertexArrayOES(null),c.vertexBufferDescriptors=h,c.vao=m,c.indexBufferFormat=d,c.indexBufferType=p,c.indexBufferCompByteSize=v,c.program=f,c}return(0,qo.__extends)(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Cl(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(Al),Wl=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=t.fake,o=e.call(this,{id:n,device:r})||this;o.type=ho.Texture,i=(0,qo.__assign)({dimension:Co.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},i);var s,l,u=o.device.gl,c=o.clampmipLevelCount(i);if(o.immutable=i.usage===Mo.RENDER_TARGET,o.pixelStore=i.pixelStore,o.format=i.format,o.dimension=i.dimension,o.formatKind=is(i.format),o.width=i.width,o.height=i.height,o.depthOrArrayLayers=i.depthOrArrayLayers,o.mipmaps=c>=1,!a){l=o.device.ensureResourceExists(u.createTexture());var h=o.device.translateTextureType(i.format),d=o.device.translateTextureInternalFormat(i.format);if(o.device.setActiveTexture(u.TEXTURE0),o.device.currentTextures[0]=null,o.preprocessImage(),i.dimension===Co.TEXTURE_2D){if(s=co.TEXTURE_2D,u.bindTexture(s,l),o.immutable)if(Cl(u))u.texStorage2D(s,c,d,i.width,i.height);else{var f=(d===co.DEPTH_COMPONENT||o.isNPOT(),0);(o.format!==wo.D32F&&o.format!==wo.D24_S8||Cl(u)||r.WEBGL_depth_texture)&&(u.texImage2D(s,f,d,i.width,i.height,0,d,h,null),o.mipmaps&&(o.mipmaps=!1,u.texParameteri(co.TEXTURE_2D,co.TEXTURE_MIN_FILTER,co.LINEAR),u.texParameteri(co.TEXTURE_2D,co.TEXTURE_WRAP_S,co.CLAMP_TO_EDGE),u.texParameteri(co.TEXTURE_2D,co.TEXTURE_WRAP_T,co.CLAMP_TO_EDGE)))}as(1===i.depthOrArrayLayers)}else if(i.dimension===Co.TEXTURE_2D_ARRAY)s=co.TEXTURE_2D_ARRAY,u.bindTexture(s,l),o.immutable&&Cl(u)&&u.texStorage3D(s,c,d,i.width,i.height,i.depthOrArrayLayers);else if(i.dimension===Co.TEXTURE_3D)s=co.TEXTURE_3D,u.bindTexture(s,l),o.immutable&&Cl(u)&&u.texStorage3D(s,c,d,i.width,i.height,i.depthOrArrayLayers);else{if(i.dimension!==Co.TEXTURE_CUBE_MAP)throw new Error("whoops");s=co.TEXTURE_CUBE_MAP,u.bindTexture(s,l),o.immutable&&Cl(u)&&u.texStorage2D(s,c,d,i.width,i.height),as(6===i.depthOrArrayLayers)}}return o.gl_texture=l,o.gl_target=s,o.mipLevelCount=c,o}return(0,qo.__extends)(t,e),t.prototype.setImageData=function(e,t){void 0===t&&(t=0);var n=this.device.gl;Ml(this.format);var r,i=this.gl_target===co.TEXTURE_3D||this.gl_target===co.TEXTURE_2D_ARRAY,a=this.gl_target===co.TEXTURE_CUBE_MAP,o=(r=e[0],Object.prototype.toString.call(r)in yl);this.device.setActiveTexture(n.TEXTURE0),this.device.currentTextures[0]=null;var s,l,u=e[0];o?(s=this.width,l=this.height):(s=u.width,l=u.height,this.width=s,this.height=l),n.bindTexture(this.gl_target,this.gl_texture);var c=this.device.translateTextureFormat(this.format),h=Cl(n)?this.device.translateInternalTextureFormat(this.format):c,d=this.device.translateTextureType(this.format);this.preprocessImage();for(var f=0;f<this.depthOrArrayLayers;f++){var p=e[f],v=this.gl_target;a&&(v=co.TEXTURE_CUBE_MAP_POSITIVE_X+f%6),this.immutable?n.texSubImage2D(v,t,0,0,s,l,c,d,p):Cl(n)?i?n.texImage3D(v,t,h,s,l,this.depthOrArrayLayers,0,c,d,p):n.texImage2D(v,t,h,s,l,0,c,d,p):o?n.texImage2D(v,t,c,s,l,0,c,d,p):n.texImage2D(v,t,c,c,d,p)}this.mipmaps&&this.generateMipmap(i)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(Dl(this))},t.prototype.clampmipLevelCount=function(e){if(e.dimension===Co.TEXTURE_2D_ARRAY&&e.depthOrArrayLayers>1&&es(e.format)===Do.BC1)for(var t=e.width,n=e.height,r=0;r<e.mipLevelCount;r++){if(t<=2||n<=2)return r-1;t=Math.max(t/2|0,1),n=Math.max(n/2|0,1)}return e.mipLevelCount},t.prototype.preprocessImage=function(){var e=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&e.pixelStorei(co.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&e.pixelStorei(co.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&e.pixelStorei(co.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(e){void 0===e&&(e=!1);var t=this.device.gl;return!Cl(t)&&this.isNPOT()||this.gl_texture&&this.gl_target&&(t.bindTexture(this.gl_target,this.gl_texture),e?(t.texParameteri(this.gl_target,co.TEXTURE_BASE_LEVEL,0),t.texParameteri(this.gl_target,co.TEXTURE_MAX_LEVEL,Math.log2(this.width)),t.texParameteri(this.gl_target,co.TEXTURE_MIN_FILTER,co.LINEAR_MIPMAP_LINEAR),t.texParameteri(this.gl_target,co.TEXTURE_MAG_FILTER,co.LINEAR)):t.texParameteri(co.TEXTURE_2D,co.TEXTURE_MIN_FILTER,co.NEAREST_MIPMAP_LINEAR),t.generateMipmap(this.gl_target),t.bindTexture(this.gl_target,null)),this},t.prototype.isNPOT=function(){return!Cl(this.device.gl)&&(!vs(this.width)||!vs(this.height))},t}(Al),Hl=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=ho.RenderTarget,a.gl_renderbuffer=null,a.texture=null;var o=a.device.gl,s=i.format,l=i.width,u=i.height,c=i.sampleCount,h=void 0===c?1:c,d=i.texture,f=!1;if(s!==wo.D32F&&s!==wo.D24_S8||!d||Cl(o)||r.WEBGL_depth_texture||(d.destroy(),a.texture=null,f=!0),!f&&d)a.texture=d;else{a.gl_renderbuffer=a.device.ensureResourceExists(o.createRenderbuffer()),o.bindRenderbuffer(o.RENDERBUFFER,a.gl_renderbuffer);var p=a.device.translateTextureInternalFormat(s,!0);Cl(o)&&h>1?o.renderbufferStorageMultisample(co.RENDERBUFFER,h,p,l,u):o.renderbufferStorage(co.RENDERBUFFER,p,l,u)}return a.format=s,a.width=l,a.height=u,a.sampleCount=h,a}return(0,qo.__extends)(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),null!==this.gl_renderbuffer&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(Al);!function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"}(Zl||(Zl={}));var Yl,zl=function(e){function t(t,n){var r=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:r,device:i})||this;o.rawVertexGLSL=n,o.type=ho.Program,o.uniformSetters={},o.attributes=[];var s=o.device.gl;return o.descriptor=a,o.gl_program=o.device.ensureResourceExists(s.createProgram()),o.gl_shader_vert=null,o.gl_shader_frag=null,o.compileState=Zl.NeedsCompile,o.tryCompileProgram(),o}return(0,qo.__extends)(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){as(this.compileState===Zl.NeedsCompile);var e=this.descriptor,t=e.vertex,n=e.fragment,r=this.device.gl;(null==t?void 0:t.glsl)&&(null==n?void 0:n.glsl)&&(this.gl_shader_vert=this.compileShader(t.postprocess?t.postprocess(t.glsl):t.glsl,r.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(n.postprocess?n.postprocess(n.glsl):n.glsl,r.FRAGMENT_SHADER),r.attachShader(this.gl_program,this.gl_shader_vert),r.attachShader(this.gl_program,this.gl_shader_frag),r.linkProgram(this.gl_program),this.compileState=Zl.Compiling,Cl(r)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var e,t=this.device.gl,n=t.getProgramParameter(this.gl_program,t.ACTIVE_ATTRIBUTES),r=function(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,(function(e,n,r){var i=Number(r);return t[n]=isNaN(i)?r:i,""})),t}(this.descriptor.vertex.glsl),i=function(e,t){var n=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,(function(e,r,i){var a=Number(r);return n.push({location:isNaN(a)?t[r]:a,name:i}),""})),n}(this.rawVertexGLSL,r),a=function(n){var r=t.getActiveAttrib(o.gl_program,n),a=r.name,s=r.type,l=r.size,u=t.getAttribLocation(o.gl_program,a),c=null===(e=i.find((function(e){return e.name===a})))||void 0===e?void 0:e.location;u>=0&&!(0,T.Z)(c)&&(o.attributes[c]={name:a,location:u,type:s,size:l})},o=this,s=0;s<n;s++)a(s)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var e=this.device.gl,t=e.getProgramParameter(this.gl_program,e.ACTIVE_UNIFORMS),n=0;n<t;n++){var r=e.getActiveUniform(this.gl_program,n),i=rl(r.name).name,a=e.getUniformLocation(this.gl_program,i);if(this.uniformSetters[i]=ml(e,a,r),r&&r.size>1)for(var o=0;o<r.size;o++)a=e.getUniformLocation(this.gl_program,"".concat(i,"[").concat(o,"]")),this.uniformSetters["".concat(i,"[").concat(o,"]")]=ml(e,a,r)}},t.prototype.compileShader=function(e,t){var n=this.device.gl,r=this.device.ensureResourceExists(n.createShader(t));return n.shaderSource(r,e),n.compileShader(r),r},t.prototype.setUniformsLegacy=function(e){void 0===e&&(e={});var t=this.device.gl;if(!Cl(t)){var n=!1;for(var r in e){n||(t.useProgram(this.gl_program),n=!0);var i=e[r],a=this.uniformSetters[r];if(a){var o=i;o instanceof Wl&&(o=o.textureIndex),a(o)}}}return this},t}(Al),Kl=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=ho.QueryPool;var o=a.device.gl;if(Cl(o)){var s=i.elemCount,l=i.type;a.gl_query=Rs(s,(function(){return a.device.ensureResourceExists(o.createQuery())})),a.gl_query_type=function(e){if(e===Io.OcclusionConservative)return co.ANY_SAMPLES_PASSED_CONSERVATIVE;throw new Error("whoops")}(l)}return a}return(0,qo.__extends)(t,e),t.prototype.queryResultOcclusion=function(e){var t=this.device.gl;if(Cl(t)){var n=this.gl_query[e];return t.getQueryParameter(n,t.QUERY_RESULT_AVAILABLE)?!!t.getQueryParameter(n,t.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(Cl(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},t}(Al),jl=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=ho.Readback,i.gl_pbo=null,i.gl_sync=null,i}return(0,qo.__extends)(t,e),t.prototype.clientWaitAsync=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=10);var r=this.device.gl;return new Promise((function(i,a){!function o(){var s=r.clientWaitSync(e,t,0);s!=r.WAIT_FAILED?s!=r.TIMEOUT_EXPIRED?i():setTimeout(o,(0,S.Z)(n,0,r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL)):a()}()}))},t.prototype.getBufferSubDataAsync=function(e,t,n,r,i,a){return(0,qo.__awaiter)(this,void 0,void 0,(function(){var o;return(0,qo.__generator)(this,(function(s){switch(s.label){case 0:return Cl(o=this.device.gl)?(this.gl_sync=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0),o.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return s.sent(),o.bindBuffer(e,t),o.getBufferSubData(e,n,r,i,a),o.bindBuffer(e,null),[2,r];case 2:return[2]}}))}))},t.prototype.readTexture=function(e,t,n,r,i,a,o,s){return void 0===o&&(o=0),void 0===s&&(s=a.byteLength||0),(0,qo.__awaiter)(this,void 0,void 0,(function(){var l,u,c,h,d;return(0,qo.__generator)(this,(function(f){var p;return l=this.device.gl,u=e,c=this.device.translateTextureFormat(u.format),h=this.device.translateTextureType(u.format),p=u.format,d=ns(es(p))*Jo(p),Cl(l)?(this.gl_pbo=this.device.ensureResourceExists(l.createBuffer()),l.bindBuffer(l.PIXEL_PACK_BUFFER,this.gl_pbo),l.bufferData(l.PIXEL_PACK_BUFFER,s,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.bindFramebuffer(co.READ_FRAMEBUFFER,this.device.readbackFramebuffer),l.framebufferTexture2D(co.READ_FRAMEBUFFER,co.COLOR_ATTACHMENT0,co.TEXTURE_2D,u.gl_texture,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,this.gl_pbo),l.readPixels(t,n,r,i,c,h,o*d),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(l.PIXEL_PACK_BUFFER,this.gl_pbo,0,a,o,0)]):[2,this.readTextureSync(e,t,n,r,i,a,o,s)]}))}))},t.prototype.readTextureSync=function(e,t,n,r,i,a,o,s){void 0===s&&(s=a.byteLength||0);var l=this.device.gl,u=e,c=this.device.translateTextureType(u.format);return l.bindFramebuffer(co.FRAMEBUFFER,this.device.readbackFramebuffer),l.framebufferTexture2D(co.FRAMEBUFFER,co.COLOR_ATTACHMENT0,co.TEXTURE_2D,u.gl_texture,0),l.pixelStorei(l.PACK_ALIGNMENT,4),l.readPixels(t,n,r,i,l.RGBA,c,a),a},t.prototype.readBuffer=function(e,t,n,r,i){return(0,qo.__awaiter)(this,void 0,void 0,(function(){var a;return(0,qo.__generator)(this,(function(o){return Cl(a=this.device.gl)?[2,this.getBufferSubDataAsync(a.ARRAY_BUFFER,Il(e,t),t,n,r,i)]:[2,Promise.reject()]}))}))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Cl(this.device.gl)&&(null!==this.gl_sync&&this.device.gl.deleteSync(this.gl_sync),null!==this.gl_pbo&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(Al),ql=function(e){function t(t){var n,r,i=t.id,a=t.device,o=t.descriptor,s=e.call(this,{id:i,device:a})||this;return s.type=ho.RenderPipeline,s.drawMode=function(e){switch(e){case To.TRIANGLES:return co.TRIANGLES;case To.POINTS:return co.POINTS;case To.TRIANGLE_STRIP:return co.TRIANGLE_STRIP;case To.LINES:return co.LINES;case To.LINE_STRIP:return co.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}(null!==(n=o.topology)&&void 0!==n?n:To.TRIANGLES),s.program=o.program,s.inputLayout=o.inputLayout,s.megaState=(0,qo.__assign)((0,qo.__assign)({},Ns(bs)),o.megaStateDescriptor),s.colorAttachmentFormats=o.colorAttachmentFormats.slice(),s.depthStencilAttachmentFormat=o.depthStencilAttachmentFormat,s.sampleCount=null!==(r=o.sampleCount)&&void 0!==r?r:1,s}return(0,qo.__extends)(t,e),t}(Al),Ql=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;return a.type=ho.ComputePipeline,a.descriptor=i,a}return(0,qo.__extends)(t,e),t}(Al),$l=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(e){this.creationStacks.set(e,(new Error).stack),this.liveObjects.add(e)},e.prototype.trackResourceDestroyed=function(e){this.deletionStacks.has(e)&&console.warn("Object double freed:",e,"\n\nCreation stack: ",this.creationStacks.get(e),"\n\nDeletion stack: ",this.deletionStacks.get(e),"\n\nThis stack: ",(new Error).stack),this.deletionStacks.set(e,(new Error).stack),this.liveObjects.delete(e)},e.prototype.checkForLeaks=function(){var e,t;try{for(var n=(0,qo.__values)(this.liveObjects.values()),r=n.next();!r.done;r=n.next()){var i=r.value;console.warn("Object leaked:",i,"Creation stack:",this.creationStacks.get(i))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.setResourceLeakCheck=function(e,t){t?this.liveObjects.add(e):this.liveObjects.delete(e)},e}(),Jl=function(e){function t(t){var n,r,i=t.id,a=t.device,o=t.descriptor,s=e.call(this,{id:i,device:a})||this;s.type=ho.Sampler;var l=s.device.gl;if(Cl(l)){var u=s.device.ensureResourceExists(l.createSampler());l.samplerParameteri(u,co.TEXTURE_WRAP_S,Pl(o.addressModeU)),l.samplerParameteri(u,co.TEXTURE_WRAP_T,Pl(o.addressModeV)),l.samplerParameteri(u,co.TEXTURE_WRAP_R,Pl(null!==(n=o.addressModeW)&&void 0!==n?n:o.addressModeU)),l.samplerParameteri(u,co.TEXTURE_MIN_FILTER,Ol(o.minFilter,o.mipmapFilter)),l.samplerParameteri(u,co.TEXTURE_MAG_FILTER,Ol(o.magFilter,_o.NO_MIP)),void 0!==o.lodMinClamp&&l.samplerParameterf(u,co.TEXTURE_MIN_LOD,o.lodMinClamp),void 0!==o.lodMaxClamp&&l.samplerParameterf(u,co.TEXTURE_MAX_LOD,o.lodMaxClamp),void 0!==o.compareFunction&&(l.samplerParameteri(u,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE),l.samplerParameteri(u,l.TEXTURE_COMPARE_FUNC,o.compareFunction));var c=null!==(r=o.maxAnisotropy)&&void 0!==r?r:1;c>1&&null!==s.device.EXT_texture_filter_anisotropic&&(as(o.minFilter===Eo.BILINEAR&&o.magFilter===Eo.BILINEAR&&o.mipmapFilter===_o.LINEAR),l.samplerParameterf(u,s.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c)),s.gl_sampler=u}else s.descriptor=o;return s}return(0,qo.__extends)(t,e),t.prototype.setTextureParameters=function(e,t,n){var r,i=this.device.gl,a=this.descriptor;this.isNPOT(t,n)?i.texParameteri(co.TEXTURE_2D,co.TEXTURE_MIN_FILTER,co.LINEAR):i.texParameteri(e,co.TEXTURE_MIN_FILTER,Ol(a.minFilter,a.mipmapFilter)),i.texParameteri(co.TEXTURE_2D,co.TEXTURE_WRAP_S,Pl(a.addressModeU)),i.texParameteri(co.TEXTURE_2D,co.TEXTURE_WRAP_T,Pl(a.addressModeV)),i.texParameteri(e,co.TEXTURE_MAG_FILTER,Ol(a.magFilter,_o.NO_MIP));var o=null!==(r=a.maxAnisotropy)&&void 0!==r?r:1;o>1&&null!==this.device.EXT_texture_filter_anisotropic&&(as(a.minFilter===Eo.BILINEAR&&a.magFilter===Eo.BILINEAR&&a.mipmapFilter===_o.LINEAR),i.texParameteri(e,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Cl(this.device.gl)&&this.device.gl.deleteSampler(Ll(this))},t.prototype.isNPOT=function(e,t){return!vs(e)||!vs(t)},t}(Al),eu=function(){function e(){}return e.prototype.dispatchWorkgroups=function(e,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(e,t){},e.prototype.setPipeline=function(e){},e.prototype.setBindings=function(e){},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e}(),tu=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=ho.RenderBundle,t.commands=[],t}return(0,qo.__extends)(t,e),t.prototype.push=function(e){this.commands.push(e)},t.prototype.replay=function(){this.commands.forEach((function(e){return e()}))},t}(Al),nu=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,ru=function(){function e(e,t){void 0===t&&(t={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=Ns(bs),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=Po.LOWER_LEFT,this.clipSpaceNearZ=Oo.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=e,this.contextAttributes=os(e.getContextAttributes()),Cl(e)?(this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=e.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=e.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),e.getExtension("EXT_frag_depth"),e.getExtension("OES_element_index_uint"),e.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=e.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=e.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=e.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=e.getExtension("KHR_parallel_shader_compile"),Cl(e)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new Wl({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Co.TEXTURE_2D,mipLevelCount:1,usage:Mo.RENDER_TARGET,format:!1===this.contextAttributes.alpha?wo.U8_RGB_RT:wo.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=bo.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Co.TEXTURE_2D,bo.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Co.TEXTURE_2D,bo.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:Ro.VERTEX,hint:So.STATIC}),Cl(e)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Co.TEXTURE_2D_ARRAY,bo.Float),this.fallbackTexture3D=this.createFallbackTexture(Co.TEXTURE_3D,bo.Float),this.fallbackTextureCube=this.createFallbackTexture(Co.TEXTURE_CUBE_MAP,bo.Float)),this.currentMegaState.depthCompare=fo.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=No.ALL,e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new $l)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(e,t){var n=e===Co.TEXTURE_CUBE_MAP?6:1,r=t===bo.Depth?wo.D32F:wo.U8_RGBA_NORM,i=this.createTexture({dimension:e,format:r,usage:Mo.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===bo.Float&&i.setImageData([new Uint8Array(4*n)]),Dl(i)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var e=this.gl;if(this.maxVertexAttribs=e.getParameter(co.MAX_VERTEX_ATTRIBS),Cl(e)){this.uniformBufferMaxPageByteSize=Math.min(e.getParameter(co.MAX_UNIFORM_BLOCK_SIZE),65536),this.uniformBufferWordAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=e.getInternalformatParameter(e.RENDERBUFFER,e.DEPTH32F_STENCIL8,e.SAMPLES);this.supportedSampleCounts=t?(0,qo.__spreadArray)([],(0,qo.__read)(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=65536;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort((function(e,t){return e-t}))},e.prototype.configureSwapChain=function(e,t,n){var r=this.scTexture;r.width=e,r.height=t,this.scPlatformFramebuffer=ms(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(e,t){switch(void 0===t&&(t=!1),e){case wo.ALPHA:return co.ALPHA;case wo.U8_LUMINANCE:case wo.F16_LUMINANCE:case wo.F32_LUMINANCE:return co.LUMINANCE;case wo.F16_R:return co.R16F;case wo.F16_RG:return co.RG16F;case wo.F16_RGB:return co.RGB16F;case wo.F16_RGBA:return co.RGBA16F;case wo.F32_R:return co.R32F;case wo.F32_RG:return co.RG32F;case wo.F32_RGB:return co.RGB32F;case wo.F32_RGBA:return Cl(this.gl)?co.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:co.RGBA;case wo.U8_R_NORM:return co.R8;case wo.U8_RG_NORM:return co.RG8;case wo.U8_RGB_NORM:case wo.U8_RGB_RT:return co.RGB8;case wo.U8_RGB_SRGB:return co.SRGB8;case wo.U8_RGBA_NORM:case wo.U8_RGBA_RT:return Cl(this.gl)?co.RGBA8:t?co.RGBA4:co.RGBA;case wo.U8_RGBA:return co.RGBA;case wo.U8_RGBA_SRGB:case wo.U8_RGBA_RT_SRGB:return co.SRGB8_ALPHA8;case wo.U16_R:return co.R16UI;case wo.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case wo.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case wo.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case wo.U16_RGBA_5551:return co.RGB5_A1;case wo.U16_RGB_565:return co.RGB565;case wo.U32_R:return co.R32UI;case wo.S8_RGBA_NORM:return co.RGBA8_SNORM;case wo.S8_RG_NORM:return co.RG8_SNORM;case wo.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case wo.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case wo.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case wo.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case wo.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case wo.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case wo.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case wo.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case wo.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case wo.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case wo.D32F_S8:return Cl(this.gl)?co.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?co.DEPTH_STENCIL:co.DEPTH_COMPONENT16;case wo.D24_S8:return Cl(this.gl)?co.DEPTH24_STENCIL8:this.WEBGL_depth_texture?co.DEPTH_STENCIL:co.DEPTH_COMPONENT16;case wo.D32F:return Cl(this.gl)?co.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?co.DEPTH_COMPONENT:co.DEPTH_COMPONENT16;case wo.D24:return Cl(this.gl)?co.DEPTH_COMPONENT24:this.WEBGL_depth_texture?co.DEPTH_COMPONENT:co.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(e){switch(es(e)){case Do.U8:return co.UNSIGNED_BYTE;case Do.U16:return co.UNSIGNED_SHORT;case Do.U32:return co.UNSIGNED_INT;case Do.S8:return co.BYTE;case Do.F16:return co.HALF_FLOAT;case Do.F32:return co.FLOAT;case Do.U16_PACKED_5551:return co.UNSIGNED_SHORT_5_5_5_1;case Do.D32F:return Cl(this.gl)?co.FLOAT:this.WEBGL_depth_texture?co.UNSIGNED_INT:co.UNSIGNED_BYTE;case Do.D24:return Cl(this.gl)?co.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?co.UNSIGNED_SHORT:co.UNSIGNED_BYTE;case Do.D24S8:return Cl(this.gl)?co.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?co.UNSIGNED_INT_24_8_WEBGL:co.UNSIGNED_BYTE;case Do.D32FS8:return co.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(e){switch(e){case wo.F32_R:return co.R32F;case wo.F32_RG:return co.RG32F;case wo.F32_RGB:return co.RGB32F;case wo.F32_RGBA:return co.RGBA32F;case wo.F16_R:return co.R16F;case wo.F16_RG:return co.RG16F;case wo.F16_RGB:return co.RGB16F;case wo.F16_RGBA:return co.RGBA16F}return this.translateTextureFormat(e)},e.prototype.translateTextureFormat=function(e){if(Ml(e)||e===wo.F32_LUMINANCE||e===wo.U8_LUMINANCE)return this.translateTextureInternalFormat(e);var t=Cl(this.gl)||!Cl(this.gl)&&!!this.WEBGL_depth_texture;switch(e){case wo.D24_S8:case wo.D32F_S8:return t?co.DEPTH_STENCIL:co.RGBA;case wo.D24:case wo.D32F:return t?co.DEPTH_COMPONENT:co.RGBA}var n=Nl(e);switch(Jo(e)){case Lo.A:return co.ALPHA;case Lo.R:return n?co.RED_INTEGER:co.RED;case Lo.RG:return n?co.RG_INTEGER:co.RG;case Lo.RGB:return n?co.RGB_INTEGER:co.RGB;case Lo.RGBA:return co.RGBA}},e.prototype.setActiveTexture=function(e){this.currentActiveTexture!==e&&(this.gl.activeTexture(e),this.currentActiveTexture=e)},e.prototype.bindVAO=function(e){this.currentBoundVAO!==e&&(Cl(this.gl)?this.gl.bindVertexArray(e):this.OES_vertex_array_object.bindVertexArrayOES(e),this.currentBoundVAO=e)},e.prototype.programCompiled=function(e){as(e.compileState!==Zl.NeedsCompile),e.compileState===Zl.Compiling&&(e.compileState=Zl.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(e))},e.prototype.useProgram=function(e){this.currentProgram!==e&&(this.programCompiled(e),this.gl.useProgram(e.gl_program),this.currentProgram=e)},e.prototype.ensureResourceExists=function(e){if(null===e){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}return e},e.prototype.createBuffer=function(e){return new Vl({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new Wl({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new Jl({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){return new Hl({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTargetFromTexture=function(e){var t=e,n=t.format,r=t.width,i=t.height;return as(1===t.mipLevelCount),this.createRenderTarget({format:n,width:r,height:i,sampleCount:1,texture:e})},e.prototype.createProgram=function(e){var t,n,r,i=null===(t=e.vertex)||void 0===t?void 0:t.glsl;return(null===(n=e.vertex)||void 0===n?void 0:n.glsl)&&(e.vertex.glsl=Rl(this.queryVendorInfo(),"vert",e.vertex.glsl)),(null===(r=e.fragment)||void 0===r?void 0:r.glsl)&&(e.fragment.glsl=Rl(this.queryVendorInfo(),"frag",e.fragment.glsl)),this.createProgramSimple(e,i)},e.prototype.createProgramSimple=function(e,t){return new zl({id:this.getNextUniqueId(),device:this,descriptor:e},t)},e.prototype.createBindings=function(e){return new xl({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new Xl({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new ql({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePass=function(){return new eu},e.prototype.createComputePipeline=function(e){return new Ql({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createReadback=function(){return new jl({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(e,t){return new Kl({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(e){var t,n,r,i,a,o,s=e.colorAttachment;e.depthClearValue=null!==(t=e.depthClearValue)&&void 0!==t?t:"load",e.stencilClearValue=null!==(n=e.stencilClearValue)&&void 0!==n?n:"load";for(var l=0;l<s.length;l++)e.colorAttachmentLevel||(e.colorAttachmentLevel=[]),e.colorAttachmentLevel[l]=null!==(r=e.colorAttachmentLevel[l])&&void 0!==r?r:0,e.colorResolveToLevel||(e.colorResolveToLevel=[]),e.colorResolveToLevel[l]=null!==(i=e.colorResolveToLevel[l])&&void 0!==i?i:0,e.colorClearColor||(e.colorClearColor=[]),e.colorClearColor[l]=null!==(a=e.colorClearColor[l])&&void 0!==a?a:"load",e.colorStore||(e.colorStore=[]),e.colorStore[l]=null!==(o=e.colorStore[l])&&void 0!==o&&o},e.prototype.createRenderBundle=function(){return new tu({id:this.getNextUniqueId(),device:this})},e.prototype.beginBundle=function(e){this.renderBundle=e},e.prototype.endBundle=function(){this.renderBundle=void 0},e.prototype.executeBundles=function(e){e.forEach((function(e){e.replay()}))},e.prototype.createRenderPass=function(e){null!==this.currentRenderPassDescriptor&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=e,this.formatRenderPassDescriptor(e);var t=e.colorAttachment,n=e.colorAttachmentLevel,r=e.colorClearColor,i=e.colorResolveTo,a=e.colorResolveToLevel,o=e.depthStencilAttachment,s=e.depthClearValue,l=e.stencilClearValue,u=e.depthStencilResolveTo,c=i&&1===i.length&&i[0]===this.scTexture;this.setRenderPassParametersBegin(t.length,c);for(var h=0;h<t.length;h++)this.setRenderPassParametersColor(h,t[h],n[h],i[h],a[h],c);this.setRenderPassParametersDepthStencil(o,u,c),this.validateCurrentAttachments();for(h=0;h<t.length;h++){var d=r[h];"load"!==d&&this.setRenderPassParametersClearColor(h,d.r,d.g,d.b,d.a)}return this.setRenderPassParametersClearDepthStencil(s,l),this},e.prototype.submitPass=function(e){as(null!==this.currentRenderPassDescriptor),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(e,t,n,r,i,a){var o=this.gl,s=e,l=r;if(as(1===l.mipLevelCount),as(1===s.mipLevelCount),Cl(o))s===this.scTexture?o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,s,0)),o.bindFramebuffer(o.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,l,0),o.blitFramebuffer(i,a,i+l.width,a+l.height,t,n,t+l.width,n+l.height,o.COLOR_BUFFER_BIT,o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,null);else if(s===this.scTexture){var u=this.createRenderTargetFromTexture(r);this.submitBlitRenderPass(u,s)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(e,t,n){switch(e){case wo.BC1_SRGB:case wo.BC2_SRGB:case wo.BC3_SRGB:return null!==this.WEBGL_compressed_texture_s3tc_srgb&&Gl(t,n,4,4);case wo.BC1:case wo.BC2:case wo.BC3:return null!==this.WEBGL_compressed_texture_s3tc&&Gl(t,n,4,4);case wo.BC4_UNORM:case wo.BC4_SNORM:case wo.BC5_UNORM:case wo.BC5_SNORM:return null!==this.EXT_texture_compression_rgtc&&Gl(t,n,4,4);case wo.U16_R_NORM:case wo.U16_RG_NORM:case wo.U16_RGBA_NORM:return null!==this.EXT_texture_norm16;case wo.F32_R:case wo.F32_RG:case wo.F32_RGB:case wo.F32_RGBA:return null!==this.OES_texture_float_linear;case wo.F16_R:case wo.F16_RG:case wo.F16_RGB:case wo.F16_RGBA:return null!==this.OES_texture_half_float_linear;default:return!0}},e.prototype.queryProgramReady=function(e){var t=this.gl;if(e.compileState===Zl.NeedsCompile)throw new Error("whoops");if(e.compileState===Zl.Compiling){var n=void 0;return(n=null===this.KHR_parallel_shader_compile||t.getProgramParameter(e.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR))&&this.programCompiled(e),n}return e.compileState===Zl.NeedsBind||e.compileState===Zl.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===ho.Buffer)for(var n=e.gl_buffer_pages,r=0;r<n.length;r++)Bl(n[r],"".concat(t," Page ").concat(r));else if(e.type===ho.Texture)Bl(Dl(e),t);else if(e.type===ho.Sampler)Bl(Ll(e),t);else if(e.type===ho.RenderTarget){var i=e.gl_renderbuffer;null!==i&&Bl(i,t)}else e.type===ho.InputLayout&&Bl(e.vao,t)},e.prototype.setResourceLeakCheck=function(e,t){null!==this.resourceCreationTracker&&this.resourceCreationTracker.setResourceLeakCheck(e,t)},e.prototype.checkForLeaks=function(){null!==this.resourceCreationTracker&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e.prototype.programPatched=function(e,t){as(this.shaderDebug)},e.prototype.getBufferData=function(e,t,n){void 0===n&&(n=0);var r=this.gl;Cl(r)&&(r.bindBuffer(r.COPY_READ_BUFFER,Il(e,4*n)),r.getBufferSubData(r.COPY_READ_BUFFER,4*n,t))},e.prototype.debugGroupStatisticsDrawCall=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=e},e.prototype.debugGroupStatisticsBufferUpload=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=e},e.prototype.debugGroupStatisticsTextureBind=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=e},e.prototype.debugGroupStatisticsTriangles=function(e){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=e},e.prototype.reportShaderError=function(e,t){var n=this.gl,r=n.getShaderParameter(e,n.COMPILE_STATUS);if(!r){console.error(function(e,t){return void 0===t&&(t=1),e.split("\n").map((function(e,n){return"".concat(function(e,t,n){for(void 0===n&&(n="0");e.length<t;)e="".concat(n).concat(e);return e}(""+(t+n),4," "),"  ").concat(e)})).join("\n")}(t));var i=n.getExtension("WEBGL_debug_shaders");i&&console.error(i.getTranslatedShaderSource(e)),console.error(n.getShaderInfoLog(e))}return r},e.prototype.checkProgramCompilationForErrors=function(e){var t=this.gl,n=e.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var r=e.descriptor;if(!this.reportShaderError(e.gl_shader_vert,r.vertex.glsl))return;if(!this.reportShaderError(e.gl_shader_frag,r.fragment.glsl))return;console.error(t.getProgramInfoLog(e.gl_program))}},e.prototype.bindFramebufferAttachment=function(e,t,n,r){var i=this.gl;if((0,T.Z)(n))i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,null);else if(n.type===ho.RenderTarget)null!==n.gl_renderbuffer?i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,n.gl_renderbuffer):null!==n.texture&&i.framebufferTexture2D(e,t,co.TEXTURE_2D,Dl(n.texture),r);else if(n.type===ho.Texture){var a=Dl(n);n.dimension===Co.TEXTURE_2D?i.framebufferTexture2D(e,t,co.TEXTURE_2D,a,r):Cl(i)&&(n.dimension,Co.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(e,t){var n=this.gl,r=(0,T.Z)(t)?Bo.Depth|Bo.Stencil:ts(t.format),i=!!(r&Bo.Depth),a=!!(r&Bo.Stencil);i&&a?Cl(this.gl)||!Cl(this.gl)&&!!this.WEBGL_depth_texture?this.bindFramebufferAttachment(e,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t,0):i?(this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,null,0)):a&&(this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var e=-1,t=-1,n=-1,r=0;r<this.currentColorAttachments.length;r++){var i=this.currentColorAttachments[r];null!==i&&(-1===e?(e=i.sampleCount,t=i.width,n=i.height):(as(e===i.sampleCount),as(t===i.width),as(n===i.height)))}this.currentDepthStencilAttachment&&(-1===e?e=this.currentDepthStencilAttachment.sampleCount:(as(e===this.currentDepthStencilAttachment.sampleCount),as(t===this.currentDepthStencilAttachment.width),as(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=e},e.prototype.setRenderPassParametersBegin=function(e,t){void 0===t&&(t=!1);var n=this.gl;if(t)n.bindFramebuffer(co.FRAMEBUFFER,null);else if(Cl(n)?n.bindFramebuffer(co.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||n.bindFramebuffer(co.FRAMEBUFFER,this.renderPassDrawFramebuffer),Cl(n)?n.drawBuffers([co.COLOR_ATTACHMENT0,co.COLOR_ATTACHMENT1,co.COLOR_ATTACHMENT2,co.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([co.COLOR_ATTACHMENT0_WEBGL,co.COLOR_ATTACHMENT1_WEBGL,co.COLOR_ATTACHMENT2_WEBGL,co.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var r=e;r<this.currentColorAttachments.length;r++){var i=Cl(n)?co.DRAW_FRAMEBUFFER:co.FRAMEBUFFER,a=Cl(n)?co.COLOR_ATTACHMENT0:co.COLOR_ATTACHMENT0_WEBGL;n.framebufferRenderbuffer(i,a+r,co.RENDERBUFFER,null),n.framebufferTexture2D(i,a+r,co.TEXTURE_2D,null,0)}this.currentColorAttachments.length=e},e.prototype.setRenderPassParametersColor=function(e,t,n,r,i,a){void 0===a&&(a=!1);var o=Cl(this.gl);this.currentColorAttachments[e]===t&&this.currentColorAttachmentLevels[e]===n||(this.currentColorAttachments[e]=t,this.currentColorAttachmentLevels[e]=n,!a&&(o||!o&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(o?co.DRAW_FRAMEBUFFER:co.FRAMEBUFFER,(o?co.COLOR_ATTACHMENT0:co.COLOR_ATTACHMENT0_WEBGL)+e,t,n),this.resolveColorAttachmentsChanged=!0),this.currentColorResolveTos[e]===r&&this.currentColorResolveToLevels[e]===i||(this.currentColorResolveTos[e]=r,this.currentColorResolveToLevels[e]=i,null!==r&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(e,t,n){void 0===n&&(n=!1);var r=this.gl;this.currentDepthStencilAttachment!==e&&(this.currentDepthStencilAttachment=e,n||this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(Cl(r)?co.DRAW_FRAMEBUFFER:co.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(e,t,n,r,i){var a,o=this.gl;null!==this.OES_draw_buffers_indexed?(a=this.currentMegaState.attachmentsState[e])&&a.channelWriteMask!==No.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(e,!0,!0,!0,!0),a.channelWriteMask=No.ALL):(a=this.currentMegaState.attachmentsState[0])&&a.channelWriteMask!==No.ALL&&(o.colorMask(!0,!0,!0,!0),a.channelWriteMask=No.ALL);this.setScissorRectEnabled(!1),Cl(o)?o.clearBufferfv(o.COLOR,e,[t,n,r,i]):(o.clearColor(t,n,r,i),o.clear(o.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(e,t){void 0===e&&(e="load"),void 0===t&&(t="load");var n=this.gl;"load"!==e&&(as(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),Cl(n)?n.clearBufferfv(n.DEPTH,0,[e]):(n.clearDepth(e),n.clear(n.DEPTH_BUFFER_BIT))),"load"!==t&&(as(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),Cl(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(e){var t,n=this;if(this.renderBundle)this.renderBundle.push((function(){return n.setBindings(e)}));else{var r=this.gl,i=e,a=i.uniformBufferBindings,o=i.samplerBindings,s=i.bindingLayouts;as(0<s.bindingLayoutTables.length);var l=s.bindingLayoutTables[0];as(a.length>=l.numUniformBuffers),as(o.length>=l.numSamplers);for(var u=0;u<a.length;u++){if(0!==(g=a[u]).size){var c=l.firstUniformBuffer+u,h=g.buffer,d=g.offset||0,f=g.size||h.byteSize;if(h!==this.currentUniformBuffers[c]||d!==this.currentUniformBufferByteOffsets[c]||f!==this.currentUniformBufferByteSizes[c]){var p=d%h.pageByteSize,v=h.gl_buffer_pages[d/h.pageByteSize|0];as(p+f<=h.pageByteSize),Cl(r)&&r.bindBufferRange(r.UNIFORM_BUFFER,c,v,p,f),this.currentUniformBuffers[c]=h,this.currentUniformBufferByteOffsets[c]=d,this.currentUniformBufferByteSizes[c]=f}}}for(u=0;u<l.numSamplers;u++){var g=o[u],m=l.firstSampler+u,y=null!==g&&null!==g.sampler?Ll(g.sampler):null,E=null!==g&&null!==g.texture?Dl(g.texture):null;if(this.currentSamplers[m]!==y&&(Cl(r)&&r.bindSampler(m,y),this.currentSamplers[m]=y),this.currentTextures[m]!==E){if(this.setActiveTexture(r.TEXTURE0+m),null!==E){var _=os(g).texture,T=_.gl_target,R=_.width,S=_.height;g.texture.textureIndex=m,r.bindTexture(T,E),Cl(r)||null===(t=g.sampler)||void 0===t||t.setTextureParameters(T,R,S),this.debugGroupStatisticsTextureBind()}else{var A=(0,qo.__assign)((0,qo.__assign)({},g),Ds),x=A.dimension,C=A.formatKind;T=Ul(x);r.bindTexture(T,this.getFallbackTexture((0,qo.__assign)({gl_target:T,formatKind:C},A)))}this.currentTextures[m]=E}}}},e.prototype.setViewport=function(e,t,n,r){this.gl.viewport(e,t,n,r)},e.prototype.setScissorRect=function(e,t,n,r){var i=this.gl;this.setScissorRectEnabled(!0),i.scissor(e,t,n,r)},e.prototype.applyAttachmentStateIndexed=function(e,t,n){var r=this.gl,i=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(i.colorMaskiOES(e,!!(n.channelWriteMask&No.RED),!!(n.channelWriteMask&No.GREEN),!!(n.channelWriteMask&No.BLUE),!!(n.channelWriteMask&No.ALPHA)),t.channelWriteMask=n.channelWriteMask);var a=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,o=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(o||a)&&(Fl(t.rgbBlendState)&&Fl(t.alphaBlendState)?i.enableiOES(e,r.BLEND):Fl(n.rgbBlendState)&&Fl(n.alphaBlendState)&&i.disableiOES(e,r.BLEND)),a&&(i.blendEquationSeparateiOES(e,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),o&&(i.blendFuncSeparateiOES(e,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(e,t){var n=this.gl;e.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&No.RED),!!(t.channelWriteMask&No.GREEN),!!(t.channelWriteMask&No.BLUE),!!(t.channelWriteMask&No.ALPHA)),e.channelWriteMask=t.channelWriteMask);var r=e.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,i=e.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(i||r)&&(Fl(e.rgbBlendState)&&Fl(e.alphaBlendState)?n.enable(n.BLEND):Fl(t.rgbBlendState)&&Fl(t.alphaBlendState)&&n.disable(n.BLEND)),r&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),e.rgbBlendState.blendMode=t.rgbBlendState.blendMode,e.alphaBlendState.blendMode=t.alphaBlendState.blendMode),i&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(e){var t=this.gl,n=this.currentMegaState;if(null!==this.OES_draw_buffers_indexed)for(var r=0;r<e.attachmentsState.length;r++)this.applyAttachmentStateIndexed(r,n.attachmentsState[0],e.attachmentsState[0]);else as(1===e.attachmentsState.length),this.applyAttachmentState(n.attachmentsState[0],e.attachmentsState[0]);ss(n.blendConstant,e.blendConstant)||(t.blendColor(e.blendConstant.r,e.blendConstant.g,e.blendConstant.b,e.blendConstant.a),ls(n.blendConstant,e.blendConstant)),n.depthCompare!==e.depthCompare&&(t.depthFunc(e.depthCompare),n.depthCompare=e.depthCompare),!!n.depthWrite!=!!e.depthWrite&&(t.depthMask(e.depthWrite),n.depthWrite=e.depthWrite),!!n.stencilWrite!=!!e.stencilWrite&&(t.stencilMask(e.stencilWrite?255:0),n.stencilWrite=e.stencilWrite);var i=!1;if(!Xs(n.stencilFront,e.stencilFront)){i=!0;var a=e.stencilFront,o=a.passOp,s=a.failOp,l=a.depthFailOp,u=a.compare;n.stencilFront.passOp===o&&n.stencilFront.failOp===s&&n.stencilFront.depthFailOp===l||(t.stencilOpSeparate(t.FRONT,s,l,o),n.stencilFront.passOp=o,n.stencilFront.failOp=s,n.stencilFront.depthFailOp=l),n.stencilFront.compare!==u&&(this.setStencilReference(0),n.stencilFront.compare=u)}if(!Xs(n.stencilBack,e.stencilBack)){i=!0;var c=e.stencilBack;o=c.passOp,s=c.failOp,l=c.depthFailOp,u=c.compare;n.stencilBack.passOp===o&&n.stencilBack.failOp===s&&n.stencilBack.depthFailOp===l||(t.stencilOpSeparate(t.BACK,s,l,o),n.stencilBack.passOp=o,n.stencilBack.failOp=s,n.stencilBack.depthFailOp=l),n.stencilBack.compare!==u&&(this.setStencilReference(0),n.stencilBack.compare=u)}n.stencilFront.mask===e.stencilFront.mask&&n.stencilBack.mask===e.stencilBack.mask||(i=!0,n.stencilFront.mask=e.stencilFront.mask,n.stencilBack.mask=e.stencilBack.mask),i&&this.applyStencil(),n.cullMode!==e.cullMode&&(n.cullMode===vo.NONE?t.enable(t.CULL_FACE):e.cullMode===vo.NONE&&t.disable(t.CULL_FACE),e.cullMode===vo.BACK?t.cullFace(t.BACK):e.cullMode===vo.FRONT?t.cullFace(t.FRONT):e.cullMode===vo.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=e.cullMode),n.frontFace!==e.frontFace&&(t.frontFace(e.frontFace),n.frontFace=e.frontFace),n.polygonOffset!==e.polygonOffset&&(e.polygonOffset?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=e.polygonOffset),n.polygonOffsetFactor===e.polygonOffsetFactor&&n.polygonOffsetUnits===e.polygonOffsetUnits||(t.polygonOffset(e.polygonOffsetFactor,e.polygonOffsetUnits),n.polygonOffsetFactor=e.polygonOffsetFactor,n.polygonOffsetUnits=e.polygonOffsetUnits)},e.prototype.validatePipelineFormats=function(e){for(var t=0;t<this.currentColorAttachments.length;t++)this.currentColorAttachments[t];this.currentDepthStencilAttachment&&as(this.currentDepthStencilAttachment.format===e.depthStencilAttachmentFormat),-1!==this.currentSampleCount&&as(this.currentSampleCount===e.sampleCount)},e.prototype.setPipeline=function(e){var t=this;if(this.renderBundle)this.renderBundle.push((function(){return t.setPipeline(e)}));else{this.currentPipeline=e,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var n=this.currentPipeline.program;if(this.useProgram(n),n.compileState===Zl.NeedsBind){var r=this.gl,i=n.gl_program,a=n.descriptor,o=wl(a.vertex.glsl,nu);if(Cl(r))for(var s=0;s<o.length;s++){var l=(0,qo.__read)(o[s],2)[1],u=r.getUniformBlockIndex(i,l);-1!==u&&4294967295!==u&&r.uniformBlockBinding(i,u,s)}var c=wl(a.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm);for(s=0;s<c.length;s++){var h=(0,qo.__read)(c[s],3),d=h[1],f=h[2],p=r.getUniformLocation(i,d);r.uniform1i(p,parseInt(f))}n.compileState=Zl.ReadyToUse}}},e.prototype.setVertexInput=function(e,t,n){var r,i,a,o=this;if(this.renderBundle)this.renderBundle.push((function(){return o.setVertexInput(e,t,n)}));else if(null!==e){as(this.currentPipeline.inputLayout===e);var s=e;this.bindVAO(s.vao);for(var l=this.gl,u=0;u<s.vertexBufferDescriptors.length;u++){var c=s.vertexBufferDescriptors[u],h=c.arrayStride,d=c.attributes;try{for(var f=(r=void 0,(0,qo.__values)(d)),p=f.next();!p.done;p=f.next()){var v=p.value,g=v.shaderLocation,m=v.offset,y=Cl(l)?g:null===(a=s.program.attributes[g])||void 0===a?void 0:a.location;if(!(0,T.Z)(y)){var E=t[u];if(null===E)continue;var _=v.vertexFormat;l.bindBuffer(l.ARRAY_BUFFER,Il(E.buffer));var R=(E.offset||0)+m;l.vertexAttribPointer(y,_.size,_.type,_.normalized,h,R)}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}if(as(null!==n==(null!==s.indexBufferFormat)),null!==n){var S=n.buffer;as(S.usage===Ro.INDEX),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,Il(S)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else as(null===this.currentPipeline.inputLayout),as(null===n),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(e){this.currentStencilRef!==e&&(this.currentStencilRef=e,this.applyStencil())},e.prototype.draw=function(e,t,n,r){var i,a=this;if(this.renderBundle)this.renderBundle.push((function(){return a.draw(e,t,n,r)}));else{var o=this.gl,s=this.currentPipeline;if(t){var l=[s.drawMode,n||0,e,t];Cl(o)?o.drawArraysInstanced.apply(o,(0,qo.__spreadArray)([],(0,qo.__read)(l),!1)):(i=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(i,(0,qo.__spreadArray)([],(0,qo.__read)(l),!1))}else o.drawArrays(s.drawMode,n,e);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))}},e.prototype.drawIndexed=function(e,t,n,r,i){var a,o=this;if(this.renderBundle)this.renderBundle.push((function(){return o.drawIndexed(e,t,n,r,i)}));else{var s=this.gl,l=this.currentPipeline,u=os(l.inputLayout),c=os(this.currentIndexBufferByteOffset)+n*u.indexBufferCompByteSize;if(t){var h=[l.drawMode,e,u.indexBufferType,c,t];Cl(s)?s.drawElementsInstanced.apply(s,(0,qo.__spreadArray)([],(0,qo.__read)(h),!1)):(a=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(a,(0,qo.__spreadArray)([],(0,qo.__read)(h),!1))}else s.drawElements(l.drawMode,e,u.indexBufferType,c);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))}},e.prototype.drawIndirect=function(e,t){},e.prototype.drawIndexedIndirect=function(e,t){},e.prototype.beginOcclusionQuery=function(e){var t=this.gl;if(Cl(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[e])}},e.prototype.endOcclusionQuery=function(){var e=this.gl;if(Cl(e)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;e.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(e){var t=e;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(e){},e.prototype.endPass=function(){for(var e=this.gl,t=Cl(e),n=1===this.currentColorResolveTos.length&&this.currentColorResolveTos[0]===this.scTexture,r=!1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];if(null!==a){var o=this.currentColorResolveTos[i],s=!1;null!==o&&(as(a.width===o.width&&a.height===o.height),this.setScissorRectEnabled(!1),n||(t&&e.bindFramebuffer(e.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),s=!0,n||(o===this.scTexture?e.bindFramebuffer(t?co.DRAW_FRAMEBUFFER:co.FRAMEBUFFER,this.scPlatformFramebuffer):(e.bindFramebuffer(t?co.DRAW_FRAMEBUFFER:co.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&e.framebufferTexture2D(t?co.DRAW_FRAMEBUFFER:co.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o.gl_texture,this.currentColorResolveToLevels[i]))),n||(t?(e.blitFramebuffer(0,0,a.width,a.height,0,0,o.width,o.height,e.COLOR_BUFFER_BIT,e.LINEAR),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(a,o)),r=!0),this.currentRenderPassDescriptor.colorStore[i]||n||s||(e.bindFramebuffer(t?co.READ_FRAMEBUFFER:co.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?co.READ_FRAMEBUFFER:co.FRAMEBUFFER,e.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),n||e.bindFramebuffer(t?co.READ_FRAMEBUFFER:co.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var l=this.currentDepthStencilAttachment;if(l){var u=this.currentDepthStencilResolveTo;s=!1;u&&(as(l.width===u.width&&l.height===u.height),this.setScissorRectEnabled(!1),n||(e.bindFramebuffer(t?co.READ_FRAMEBUFFER:co.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),e.bindFramebuffer(t?co.DRAW_FRAMEBUFFER:co.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?co.READ_FRAMEBUFFER:co.FRAMEBUFFER,l),this.bindFramebufferDepthStencilAttachment(t?co.DRAW_FRAMEBUFFER:co.FRAMEBUFFER,u))),s=!0,n||(t&&e.blitFramebuffer(0,0,l.width,l.height,0,0,u.width,u.height,e.DEPTH_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(t?co.DRAW_FRAMEBUFFER:co.FRAMEBUFFER,null)),r=!0),n||this.currentRenderPassDescriptor.depthStencilStore||(s||(e.bindFramebuffer(t?co.READ_FRAMEBUFFER:co.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?co.READ_FRAMEBUFFER:co.FRAMEBUFFER,l),s=!0),t&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[e.DEPTH_STENCIL_ATTACHMENT])),!n&&s&&e.bindFramebuffer(t?co.READ_FRAMEBUFFER:co.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||r||e.bindFramebuffer(t?co.DRAW_FRAMEBUFFER:co.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(e){if(this.currentScissorEnabled!==e){var t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=e}},e.prototype.applyStencil=function(){(0,T.Z)(this.currentStencilRef)||(this.gl.stencilFuncSeparate(co.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(co.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},e.prototype.getFallbackTexture=function(e){var t=e.gl_target,n=e.formatKind;if(t===co.TEXTURE_2D)return n===bo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===co.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===co.TEXTURE_3D)return this.fallbackTexture3D;if(t===co.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(e,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:"layout(location = 0) in vec2 a_Position;\nout vec2 v_TexCoord;\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}"},fragment:{glsl:"uniform sampler2D u_Texture;\nin vec2 v_TexCoord;\nout vec4 outputColor;\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);\n}"}}),this.blitVertexBuffer=this.createBuffer({usage:Ro.VERTEX|Ro.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:8,stepMode:Ao.VERTEX,attributes:[{format:wo.F32_RG,offset:0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:To.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[wo.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:Ns(bs)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:e.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:e}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var r=this.createRenderPass({colorAttachment:[e],colorResolveTo:[t],colorClearColor:[fs]}),i=this.getCanvas(),a=i.width,o=i.height;r.setPipeline(this.blitRenderPipeline),r.setBindings(this.blitBindings),r.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),r.setViewport(0,0,a,o),this.gl.disable(this.gl.BLEND),r.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),iu=function(){function e(e){this.pluginOptions=e}return e.prototype.createSwapChain=function(e){return(0,qo.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,l,u,c,h,d,f;return(0,qo.__generator)(this,(function(p){return t=this.pluginOptions,n=t.targets,r=t.xrCompatible,i=t.antialias,a=void 0!==i&&i,o=t.preserveDrawingBuffer,s=void 0!==o&&o,l=t.premultipliedAlpha,u=void 0===l||l,c=t.shaderDebug,h=t.trackResources,d={antialias:a,preserveDrawingBuffer:s,stencil:!0,premultipliedAlpha:u,xrCompatible:r},this.handleContextEvents(e),n.includes("webgl2")&&(f=e.getContext("webgl2",d)||e.getContext("experimental-webgl2",d)),!f&&n.includes("webgl1")&&(f=e.getContext("webgl",d)||e.getContext("experimental-webgl",d)),[2,new ru(f,{shaderDebug:c,trackResources:h})]}))}))},e.prototype.handleContextEvents=function(e){var t=this.pluginOptions,n=t.onContextLost,r=t.onContextRestored,i=t.onContextCreationError;i&&e.addEventListener("webglcontextcreationerror",i,!1),n&&e.addEventListener("webglcontextlost",n,!1),r&&e.addEventListener("webglcontextrestored",r,!1)},e}(),au="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:function(){throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&au.decode();var ou=null;function su(){return null!==ou&&0!==ou.byteLength||(ou=new Uint8Array(Yl.memory.buffer)),ou}function lu(e,t){return e>>>=0,au.decode(su().subarray(e,e+t))}var uu=new Array(128).fill(void 0);uu.push(void 0,null,!0,!1);var cu=uu.length;function hu(e){return uu[e]}function du(e){var t=hu(e);return function(e){e<132||(uu[e]=cu,cu=e)}(e),t}var fu=0,pu="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:function(){throw Error("TextEncoder not available")}},vu="function"==typeof pu.encodeInto?function(e,t){return pu.encodeInto(e,t)}:function(e,t){var n=pu.encode(e);return t.set(n),{read:e.length,written:n.length}};function gu(e,t,n){if(void 0===n){var r=pu.encode(e),i=t(r.length,1)>>>0;return su().subarray(i,i+r.length).set(r),fu=r.length,i}for(var a=e.length,o=t(a,1)>>>0,s=su(),l=0;l<a;l++){var u=e.charCodeAt(l);if(u>127)break;s[o+l]=u}if(l!==a){0!==l&&(e=e.slice(l)),o=n(o,a,a=l+3*e.length,1)>>>0;var c=su().subarray(o+l,o+a);l+=vu(e,c).written}return fu=l,o}var mu=null;function yu(){return null!==mu&&0!==mu.byteLength||(mu=new Int32Array(Yl.memory.buffer)),mu}function Eu(e,t,n){var r,i;try{var a=Yl.__wbindgen_add_to_stack_pointer(-16),o=gu(e,Yl.__wbindgen_malloc,Yl.__wbindgen_realloc),s=fu,l=gu(t,Yl.__wbindgen_malloc,Yl.__wbindgen_realloc),u=fu;Yl.glsl_compile(a,o,s,l,u,n);var c=yu()[a/4+0],h=yu()[a/4+1];return r=c,i=h,lu(c,h)}finally{Yl.__wbindgen_add_to_stack_pointer(16),Yl.__wbindgen_free(r,i,1)}}var _u,Tu,Ru=function(){function e(){zo()(this,e);var t=Yl.wgslcomposer_new();return e.__wrap(t)}return jo()(e,[{key:"__destroy_into_raw",value:function(){var e=this.__wbg_ptr;return this.__wbg_ptr=0,e}},{key:"free",value:function(){var e=this.__destroy_into_raw();Yl.__wbg_wgslcomposer_free(e)}},{key:"load_composable",value:function(e){var t=gu(e,Yl.__wbindgen_malloc,Yl.__wbindgen_realloc),n=fu;Yl.wgslcomposer_load_composable(this.__wbg_ptr,t,n)}},{key:"wgsl_compile",value:function(e){var t,n;try{var r=Yl.__wbindgen_add_to_stack_pointer(-16),i=gu(e,Yl.__wbindgen_malloc,Yl.__wbindgen_realloc),a=fu;Yl.wgslcomposer_wgsl_compile(r,this.__wbg_ptr,i,a);var o=yu()[r/4+0],s=yu()[r/4+1];return t=o,n=s,lu(o,s)}finally{Yl.__wbindgen_add_to_stack_pointer(16),Yl.__wbindgen_free(t,n,1)}}}],[{key:"__wrap",value:function(t){t>>>=0;var n=Object.create(e.prototype);return n.__wbg_ptr=t,n}}]),e}();function Su(e,t){return Au.apply(this,arguments)}function Au(){return Au=Ho()(Xo()().mark((function e(t,n){var r,i;return Xo()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("function"==typeof Response&&t instanceof Response)){e.next=23;break}if("function"!=typeof WebAssembly.instantiateStreaming){e.next=15;break}return e.prev=2,e.next=5,WebAssembly.instantiateStreaming(t,n);case 5:case 20:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(2),"application/wasm"==t.headers.get("Content-Type")){e.next=14;break}console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e.t0),e.next=15;break;case 14:throw e.t0;case 15:return e.next=17,t.arrayBuffer();case 17:return r=e.sent,e.next=20,WebAssembly.instantiate(r,n);case 23:return e.next=25,WebAssembly.instantiate(t,n);case 25:if(!((i=e.sent)instanceof WebAssembly.Instance)){e.next=30;break}return e.abrupt("return",{instance:i,module:t});case 30:return e.abrupt("return",i);case 31:case"end":return e.stop()}}),e,null,[[2,8]])}))),Au.apply(this,arguments)}function xu(){var e={wbg:{}};return e.wbg.__wbindgen_string_new=function(e,t){return function(e){cu===uu.length&&uu.push(uu.length+1);var t=cu;return cu=uu[t],uu[t]=e,t}(lu(e,t))},e.wbg.__wbindgen_object_drop_ref=function(e){du(e)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(hu(e))},e.wbg.__wbg_log_576ca876af0d4a77=function(e,t){console.log(hu(e),hu(t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(lu(e,t))},e}function Cu(e,t){return Yl=e.exports,Mu.__wbindgen_wasm_module=t,mu=null,ou=null,Yl}function Mu(e){return Nu.apply(this,arguments)}function Nu(){return Nu=Ho()(Xo()().mark((function e(t){var n,r,i,a;return Xo()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===Yl){e.next=2;break}return e.abrupt("return",Yl);case 2:return n=xu(),("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t)),e.t0=Su,e.next=7,t;case 7:return e.t1=e.sent,e.t2=n,e.next=11,(0,e.t0)(e.t1,e.t2);case 11:return r=e.sent,i=r.instance,a=r.module,e.abrupt("return",Cu(i,a));case 15:case"end":return e.stop()}}),e)}))),Nu.apply(this,arguments)}function ku(e){if(e===wo.U8_R_NORM)return"r8unorm";if(e===wo.S8_R_NORM)return"r8snorm";if(e===wo.U8_RG_NORM)return"rg8unorm";if(e===wo.S8_RG_NORM)return"rg8snorm";if(e===wo.U32_R)return"r32uint";if(e===wo.S32_R)return"r32sint";if(e===wo.F32_R)return"r32float";if(e===wo.U16_RG)return"rg16uint";if(e===wo.S16_RG)return"rg16sint";if(e===wo.F16_RG)return"rg16float";if(e===wo.U8_RGBA_RT)return"bgra8unorm";if(e===wo.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===wo.U8_RGBA_NORM)return"rgba8unorm";if(e===wo.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===wo.S8_RGBA_NORM)return"rgba8snorm";if(e===wo.U32_RG)return"rg32uint";if(e===wo.S32_RG)return"rg32sint";if(e===wo.F32_RG)return"rg32float";if(e===wo.U16_RGBA)return"rgba16uint";if(e===wo.S16_RGBA)return"rgba16sint";if(e===wo.F16_RGBA)return"rgba16float";if(e===wo.F32_RGBA)return"rgba32float";if(e===wo.U32_RGBA)return"rgba32uint";if(e===wo.S32_RGBA)return"rgba32sint";if(e===wo.D24)return"depth24plus";if(e===wo.D24_S8)return"depth24plus-stencil8";if(e===wo.D32F)return"depth32float";if(e===wo.D32F_S8)return"depth32float-stencil8";if(e===wo.BC1)return"bc1-rgba-unorm";if(e===wo.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===wo.BC2)return"bc2-rgba-unorm";if(e===wo.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===wo.BC3)return"bc3-rgba-unorm";if(e===wo.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===wo.BC4_SNORM)return"bc4-r-snorm";if(e===wo.BC4_UNORM)return"bc4-r-unorm";if(e===wo.BC5_SNORM)return"bc5-rg-snorm";if(e===wo.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function bu(e){if(e===Co.TEXTURE_2D)return"2d";if(e===Co.TEXTURE_CUBE_MAP)return"cube";if(e===Co.TEXTURE_2D_ARRAY)return"2d-array";if(e===Co.TEXTURE_3D)return"3d";throw new Error("whoops")}function Pu(e){if(e===yo.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===yo.REPEAT)return"repeat";if(e===yo.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function Ou(e){if(e===Eo.BILINEAR)return"linear";if(e===Eo.POINT)return"nearest";throw new Error("whoops")}function Iu(e){if(e===_o.LINEAR)return"linear";if(e===_o.NEAREST)return"nearest";if(e===_o.NO_MIP)return"nearest";throw new Error("whoops")}function Du(e){return e.gpuBuffer}function Lu(e){if(e===Io.OcclusionConservative)return"occlusion";throw new Error("whoops")}function Bu(e){switch(e){case To.TRIANGLES:return"triangle-list";case To.POINTS:return"point-list";case To.TRIANGLE_STRIP:return"triangle-strip";case To.LINES:return"line-list";case To.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function wu(e){if(e===vo.NONE)return"none";if(e===vo.FRONT)return"front";if(e===vo.BACK)return"back";throw new Error("whoops")}function Fu(e){if(e===po.CCW)return"ccw";if(e===po.CW)return"cw";throw new Error("whoops")}function Uu(e){if(e===go.ZERO)return"zero";if(e===go.ONE)return"one";if(e===go.SRC)return"src";if(e===go.ONE_MINUS_SRC)return"one-minus-src";if(e===go.DST)return"dst";if(e===go.ONE_MINUS_DST)return"one-minus-dst";if(e===go.SRC_ALPHA)return"src-alpha";if(e===go.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===go.DST_ALPHA)return"dst-alpha";if(e===go.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===go.CONST)return"constant";if(e===go.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===go.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function Gu(e){if(e===mo.ADD)return"add";if(e===mo.SUBSTRACT)return"subtract";if(e===mo.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===mo.MIN)return"min";if(e===mo.MAX)return"max";throw new Error("whoops")}function Zu(e){return{operation:Gu(e.blendMode),srcFactor:Uu(e.blendSrcFactor),dstFactor:Uu(e.blendDstFactor)}}function Vu(e){return e.blendMode===mo.ADD&&e.blendSrcFactor===go.ONE&&e.blendDstFactor===go.ZERO}function Xu(e){return Vu(e.rgbBlendState)&&Vu(e.alphaBlendState)?void 0:{color:Zu(e.rgbBlendState),alpha:Zu(e.alphaBlendState)}}function Wu(e,t){return t.attachmentsState.map((function(t,n){return function(e,t){return{format:ku(t),blend:Xu(e),writeMask:e.channelWriteMask}}(t,e[n])}))}function Hu(e){if(e===fo.NEVER)return"never";if(e===fo.LESS)return"less";if(e===fo.EQUAL)return"equal";if(e===fo.LEQUAL)return"less-equal";if(e===fo.GREATER)return"greater";if(e===fo.NOTEQUAL)return"not-equal";if(e===fo.GEQUAL)return"greater-equal";if(e===fo.ALWAYS)return"always";throw new Error("whoops")}function Yu(e){if(e===ko.KEEP)return"keep";if(e===ko.REPLACE)return"replace";if(e===ko.ZERO)return"zero";if(e===ko.DECREMENT_CLAMP)return"decrement-clamp";if(e===ko.DECREMENT_WRAP)return"decrement-wrap";if(e===ko.INCREMENT_CLAMP)return"increment-clamp";if(e===ko.INCREMENT_WRAP)return"increment-wrap";if(e===ko.INVERT)return"invert";throw new Error("whoops")}function zu(e){if(e===Ao.VERTEX)return"vertex";if(e===Ao.INSTANCE)return"instance";throw new Error("whoops")}function Ku(e){if(e===wo.U8_R)return"uint8x2";if(e===wo.U8_RG)return"uint8x2";if(e===wo.U8_RGB)return"uint8x4";if(e===wo.U8_RGBA)return"uint8x4";if(e===wo.U8_RG_NORM)return"unorm8x2";if(e===wo.U8_RGBA_NORM)return"unorm8x4";if(e===wo.S8_RGB_NORM)return"snorm8x4";if(e===wo.S8_RGBA_NORM)return"snorm8x4";if(e===wo.U16_RG_NORM)return"unorm16x2";if(e===wo.U16_RGBA_NORM)return"unorm16x4";if(e===wo.S16_RG_NORM)return"snorm16x2";if(e===wo.S16_RGBA_NORM)return"snorm16x4";if(e===wo.S16_RG)return"uint16x2";if(e===wo.F16_RG)return"float16x2";if(e===wo.F16_RGBA)return"float16x4";if(e===wo.F32_R)return"float32";if(e===wo.F32_RG)return"float32x2";if(e===wo.F32_RGB)return"float32x3";if(e===wo.F32_RGBA)return"float32x4";throw"whoops"}function ju(e,t,n,r){switch(void 0===n&&(n=!1),e){case wo.S8_R:case wo.S8_R_NORM:case wo.S8_RG_NORM:case wo.S8_RGB_NORM:case wo.S8_RGBA_NORM:var i=(ArrayBuffer,new Int8Array(t));return r&&i.set(new Int8Array(r)),i;case wo.U8_R:case wo.U8_R_NORM:case wo.U8_RG:case wo.U8_RG_NORM:case wo.U8_RGB:case wo.U8_RGB_NORM:case wo.U8_RGB_SRGB:case wo.U8_RGBA:case wo.U8_RGBA_NORM:case wo.U8_RGBA_SRGB:var a=(ArrayBuffer,new Uint8Array(t));return r&&a.set(new Uint8Array(r)),a;case wo.S16_R:case wo.S16_RG:case wo.S16_RG_NORM:case wo.S16_RGB_NORM:case wo.S16_RGBA:case wo.S16_RGBA_NORM:var o=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(n?t/2:t);return r&&o.set(new Int16Array(r)),o;case wo.U16_R:case wo.U16_RGB:case wo.U16_RGBA_5551:case wo.U16_RGBA_NORM:case wo.U16_RG_NORM:case wo.U16_R_NORM:var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(n?t/2:t);return r&&s.set(new Uint16Array(r)),s;case wo.S32_R:var l=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(n?t/4:t);return r&&l.set(new Int32Array(r)),l;case wo.U32_R:case wo.U32_RG:var u=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(n?t/4:t);return r&&u.set(new Uint32Array(r)),u;case wo.F32_R:case wo.F32_RG:case wo.F32_RGB:case wo.F32_RGBA:var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(n?t/4:t);return r&&c.set(new Float32Array(r)),c}var h=(ArrayBuffer,new Uint8Array(t));return r&&h.set(new Uint8Array(r)),h}function qu(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth16unorm":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":case"depth32float":default:return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8}}}!function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(_u||(_u={})),function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"}(Tu||(Tu={}));var Qu=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this)||this;return i.id=n,i.device=r,i}return(0,qo.__extends)(t,e),t.prototype.destroy=function(){},t}(d.Z),$u=function(e){function t(t){var n,r,i=t.id,a=t.device,o=t.descriptor,s=e.call(this,{id:i,device:a})||this;s.type=ho.Bindings;var l=o.pipeline;as(!!l);var u=o.uniformBufferBindings,c=o.storageBufferBindings,h=o.samplerBindings,d=o.storageTextureBindings;s.numUniformBuffers=(null==u?void 0:u.length)||0;var f=[[],[],[],[]],p=0;if(u&&u.length)for(var v=0;v<u.length;v++){var g=o.uniformBufferBindings[v],m=g.binding,y=g.size,E=g.offset,_={buffer:Du(g.buffer),offset:null!=E?E:0,size:y};f[0].push({binding:null!=m?m:p++,resource:_})}if(h&&h.length){p=0;for(v=0;v<h.length;v++){var T=(0,qo.__assign)((0,qo.__assign)({},h[v]),Ds),R=null!==(m=o.samplerBindings[v]).texture?m.texture:s.device.getFallbackTexture(T);T.dimension=R.dimension,T.formatKind=is(R.format);var S=R.gpuTextureView;if(f[1].push({binding:null!==(n=m.textureBinding)&&void 0!==n?n:p++,resource:S}),-1!==m.samplerBinding){var A=null!==m.sampler?m.sampler:s.device.getFallbackSampler(T),x=A.gpuSampler;f[1].push({binding:null!==(r=m.samplerBinding)&&void 0!==r?r:p++,resource:x})}}}if(c&&c.length){p=0;for(v=0;v<c.length;v++){var C=o.storageBufferBindings[v];m=C.binding,y=C.size,E=C.offset,_={buffer:Du(C.buffer),offset:null!=E?E:0,size:y};f[2].push({binding:null!=m?m:p++,resource:_})}}if(d&&d.length){p=0;for(v=0;v<d.length;v++){var M=o.storageTextureBindings[v];m=M.binding,S=(R=M.texture).gpuTextureView;f[3].push({binding:null!=m?m:p++,resource:S})}}var N=f.findLastIndex((function(e){return!!e.length}));return s.gpuBindGroup=f.map((function(e,t){return t<=N&&s.device.device.createBindGroup({layout:l.getBindGroupLayout(t),entries:e})})),s}return(0,qo.__extends)(t,e),t}(Qu),Ju=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=ho.Buffer;var o=i.usage,s=i.viewOrSize,l=!!(o&Ro.MAP_READ);a.usage=function(e){var t=0;return e&Ro.INDEX&&(t|=GPUBufferUsage.INDEX),e&Ro.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&Ro.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&Ro.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&Ro.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),e&Ro.INDIRECT&&(t|=GPUBufferUsage.INDIRECT),t|GPUBufferUsage.COPY_DST}(o),l&&(a.usage=Ro.MAP_READ|Ro.COPY_DST);var u=!(0,E.Z)(s);(a.view=(0,E.Z)(s)?null:s,a.size=(0,E.Z)(s)?Es(s,4):Es(s.byteLength,4),(0,E.Z)(s))?a.gpuBuffer=a.device.device.createBuffer({usage:a.usage,size:a.size,mappedAtCreation:!!l&&u}):(a.gpuBuffer=a.device.device.createBuffer({usage:a.usage,size:a.size,mappedAtCreation:!0}),new(s&&s.constructor||Float32Array)(a.gpuBuffer.getMappedRange()).set(s),a.gpuBuffer.unmap());return a}return(0,qo.__extends)(t,e),t.prototype.setSubData=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=this.gpuBuffer;r=r||t.byteLength,r=Math.min(r,this.size-e);var a=t.byteOffset+n,o=a+r,s=r+3&-4;if(s!==r){var l=new Uint8Array(t.buffer.slice(a,o));(t=new Uint8Array(s)).set(l),n=0,a=0,o=s,r=s}for(var u=15728640,c=0;o-(a+c)>u;)this.device.device.queue.writeBuffer(i,e+c,t.buffer,a+c,u),c+=u;this.device.device.queue.writeBuffer(i,e+c,t.buffer,a+c,r-c)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(Qu),ec=function(){function e(){this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(e,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(e,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(e,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(e.gpuBuffer,t)},e.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},e.prototype.beginComputePass=function(e){as(null===this.gpuComputePassEncoder),this.frameCommandEncoder=e,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(e){var t=os(e.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(t)},e.prototype.setBindings=function(e){var t=this,n=e;n.gpuBindGroup.forEach((function(e,r){e&&t.gpuComputePassEncoder.setBindGroup(r,n.gpuBindGroup[r])}))},e.prototype.pushDebugGroup=function(e){this.gpuComputePassEncoder.pushDebugGroup(e)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(e){this.gpuComputePassEncoder.insertDebugMarker(e)},e}(),tc=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=ho.ComputePipeline,a.gpuComputePipeline=null,a.descriptor=i;var o=i.program.computeStage;if(null===o)return a;var s={layout:"auto",compute:(0,qo.__assign)({},o)};return a.gpuComputePipeline=a.device.device.createComputePipeline(s),void 0!==a.name&&(a.gpuComputePipeline.label=a.name),a}return(0,qo.__extends)(t,e),t.prototype.getBindGroupLayout=function(e){return this.gpuComputePipeline.getBindGroupLayout(e)},t}(Qu),nc=function(e){function t(t){var n,r,i,a,o=t.id,s=t.device,l=t.descriptor,u=e.call(this,{id:o,device:s})||this;u.type=ho.InputLayout;var c=[];try{for(var h=(0,qo.__values)(l.vertexBufferDescriptors),d=h.next();!d.done;d=h.next()){var f=d.value,p=f.arrayStride,v=f.stepMode,g=f.attributes;c.push({arrayStride:p,stepMode:zu(v),attributes:[]});try{for(var m=(i=void 0,(0,qo.__values)(g)),y=m.next();!y.done;y=m.next()){var E=y.value,_=E.shaderLocation,T=E.format,R=E.offset;c[c.length-1].attributes.push({shaderLocation:_,format:Ku(T),offset:R})}}catch(e){i={error:e}}finally{try{y&&!y.done&&(a=m.return)&&a.call(m)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}return u.indexFormat=function(e){if(null!==e){if(e===wo.U16_R)return"uint16";if(e===wo.U32_R)return"uint32";throw new Error("whoops")}}(l.indexBufferFormat),u.buffers=c,u}return(0,qo.__extends)(t,e),t}(Qu),rc=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;return a.type=ho.Program,a.vertexStage=null,a.fragmentStage=null,a.computeStage=null,a.descriptor=i,i.vertex&&(a.vertexStage=a.createShaderStage(i.vertex,"vertex")),i.fragment&&(a.fragmentStage=a.createShaderStage(i.fragment,"fragment")),i.compute&&(a.computeStage=a.createShaderStage(i.compute,"compute")),a}return(0,qo.__extends)(t,e),t.prototype.setUniformsLegacy=function(e){},t.prototype.createShaderStage=function(e,t){var n,r,i=e.glsl,a=e.wgsl,o=e.entryPoint,s=e.postprocess,l=a;if(!l)try{l=this.device.glsl_compile(i,t,!1)}catch(e){throw console.error(e,i),new Error("whoops")}var u=function(e){if(!l.includes(e))return"continue";l=(l=l.replace("var T_".concat(e,": texture_2d<f32>;"),"var T_".concat(e,": texture_depth_2d;"))).replace(new RegExp("textureSample\\(T_".concat(e,"(.*)\\);$"),"gm"),(function(t,n){return"vec4<f32>(textureSample(T_".concat(e).concat(n,"), 0.0, 0.0, 0.0);")}))};try{for(var c=(0,qo.__values)(["u_TextureFramebufferDepth"]),h=c.next();!h.done;h=c.next()){u(h.value)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return s&&(l=s(l)),{module:this.device.device.createShaderModule({code:l}),entryPoint:o||"main"}},t}(Qu),ic=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=ho.QueryPool;var o=i.elemCount,s=i.type;return a.querySet=a.device.device.createQuerySet({type:Lu(s),count:o}),a.resolveBuffer=a.device.device.createBuffer({size:8*o,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),a.cpuBuffer=a.device.device.createBuffer({size:8*o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),a.results=null,a}return(0,qo.__extends)(t,e),t.prototype.queryResultOcclusion=function(e){return null===this.results?null:this.results[e]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(Qu),ac=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=ho.Readback,i}return(0,qo.__extends)(t,e),t.prototype.readTexture=function(e,t,n,r,i,a,o,s){return void 0===o&&(o=0),(0,qo.__awaiter)(this,void 0,void 0,(function(){var s,l,u,c,h,d,f;return(0,qo.__generator)(this,(function(p){return 0,l=qu((s=e).gpuTextureformat),u=Math.ceil(r/l.width)*l.length,c=256*Math.ceil(u/256),h=c*i,d=this.device.createBuffer({usage:Ro.STORAGE|Ro.MAP_READ|Ro.COPY_DST,hint:So.STATIC,viewOrSize:h}),(f=this.device.device.createCommandEncoder()).copyTextureToBuffer({texture:s.gpuTexture,mipLevel:0,origin:{x:t,y:n,z:Math.max(0,0)}},{buffer:d.gpuBuffer,offset:0,bytesPerRow:c},{width:r,height:i,depthOrArrayLayers:1}),this.device.device.queue.submit([f.finish()]),[2,this.readBuffer(d,0,a.byteLength===h?a:null,o,h,s.format,!0,!1,u,c,i)]}))}))},t.prototype.readTextureSync=function(e,t,n,r,i,a,o,s){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(e,t,n,r,i,a,o,s,l,u,c){var h=this;void 0===t&&(t=0),void 0===n&&(n=null),void 0===i&&(i=0),void 0===a&&(a=wo.U8_RGB),void 0===o&&(o=!1),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=0);var d=e,f=i||d.size,p=n||d.view,v=p&&p.constructor&&p.constructor.BYTES_PER_ELEMENT||rs(a),g=d;if(!(d.usage&Ro.MAP_READ&&d.usage&Ro.COPY_DST)){var m=this.device.device.createCommandEncoder();g=this.device.createBuffer({usage:Ro.STORAGE|Ro.MAP_READ|Ro.COPY_DST,hint:So.STATIC,viewOrSize:f}),m.copyBufferToBuffer(d.gpuBuffer,t,g.gpuBuffer,0,f),this.device.device.queue.submit([m.finish()])}return new Promise((function(e,n){g.gpuBuffer.mapAsync(Tu.READ,t,f).then((function(){var n=g.gpuBuffer.getMappedRange(t,f),r=p;if(o)r=null===r?ju(a,f,!0,n):ju(a,r.buffer,void 0,n);else if(null===r)switch(v){case 1:(r=new Uint8Array(f)).set(new Uint8Array(n));break;case 2:r=h.getHalfFloatAsFloatRGBAArrayBuffer(f/2,n);break;case 4:(r=new Float32Array(f/4)).set(new Float32Array(n))}else switch(v){case 1:(r=new Uint8Array(r.buffer)).set(new Uint8Array(n));break;case 2:r=h.getHalfFloatAsFloatRGBAArrayBuffer(f/2,n,p);break;case 4:var i=p&&p.constructor||Float32Array;(r=new i(r.buffer)).set(new i(n))}if(l!==u){1!==v||o||(l*=2,u*=2);for(var s=new Uint8Array(r.buffer),d=l,m=0,y=1;y<c;++y){m=y*u;for(var E=0;E<l;++E)s[d++]=s[m++]}r=0===v||o?new Uint8Array(s.buffer,0,d):new Float32Array(s.buffer,0,d/4)}g.gpuBuffer.unmap(),e(r)}),(function(e){return n(e)}))}))},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(e,t,n){n||(n=new Float32Array(e));for(var r,i,a,o,s=new Uint16Array(t);e--;)n[e]=(r=s[e],i=void 0,a=void 0,o=void 0,i=(32768&r)>>15,o=1023&r,0===(a=(31744&r)>>10)?(i?-1:1)*Math.pow(2,-14)*(o/Math.pow(2,10)):31==a?o?NaN:1/0*(i?-1:1):(i?-1:1)*Math.pow(2,a-15)*(1+o/Math.pow(2,10)));return n},t}(Qu),oc=function(){function e(e){this.device=e,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getEncoder=function(){var e;return(null===(e=this.renderBundle)||void 0===e?void 0:e.renderBundleEncoder)||this.gpuRenderPassEncoder},e.prototype.getTextureView=function(e,t){return as(t<e.mipLevelCount),1===e.mipLevelCount?e.gpuTextureView:e.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(e){var t,n,r,i,a,o;this.descriptor=e,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var s=e.colorAttachment.length;this.gfxColorAttachment.length=s,this.gfxColorResolveTo.length=s;for(var l=0;l<e.colorAttachment.length;l++){var u=e.colorAttachment[l],c=e.colorResolveTo[l];if(null===u&&null!==c&&(u=c,c=null),this.gfxColorAttachment[l]=u,this.gfxColorResolveTo[l]=c,this.gfxColorAttachmentLevel[l]=(null===(t=e.colorAttachmentLevel)||void 0===t?void 0:t[l])||0,this.gfxColorResolveToLevel[l]=(null===(n=e.colorResolveToLevel)||void 0===n?void 0:n[l])||0,null===u){this.gpuColorAttachments.length=l,this.gfxColorAttachment.length=l,this.gfxColorResolveTo.length=l;break}void 0===this.gpuColorAttachments[l]&&(this.gpuColorAttachments[l]={}),(d=this.gpuColorAttachments[l]).view=this.getTextureView(u,(null===(r=this.gfxColorAttachmentLevel)||void 0===r?void 0:r[l])||0);var h=null!==(a=null===(i=e.colorClearColor)||void 0===i?void 0:i[l])&&void 0!==a?a:"load";"load"===h?d.loadOp="load":(d.loadOp="clear",d.clearValue=h),d.storeOp=(null===(o=e.colorStore)||void 0===o?void 0:o[l])?"store":"discard",d.resolveTarget=void 0,null!==c&&(u.sampleCount>1?d.resolveTarget=this.getTextureView(c,this.gfxColorResolveToLevel[l]):d.storeOp="store")}if(this.gfxDepthStencilAttachment=e.depthStencilAttachment,this.gfxDepthStencilResolveTo=e.depthStencilResolveTo,e.depthStencilAttachment){var d,f=e.depthStencilAttachment;(d=this.gpuDepthStencilAttachment).view=f.gpuTextureView,!!(ts(f.format)&Bo.Depth)?("load"===e.depthClearValue?d.depthLoadOp="load":(d.depthLoadOp="clear",d.depthClearValue=e.depthClearValue),e.depthStencilStore||null!==this.gfxDepthStencilResolveTo?d.depthStoreOp="store":d.depthStoreOp="discard"):(d.depthLoadOp=void 0,d.depthStoreOp=void 0),!!(ts(f.format)&Bo.Stencil)?("load"===e.stencilClearValue?d.stencilLoadOp="load":(d.stencilLoadOp="clear",d.stencilClearValue=e.stencilClearValue),e.depthStencilStore||null!==this.gfxDepthStencilResolveTo?d.stencilStoreOp="store":d.stencilStoreOp="discard"):(d.stencilLoadOp=void 0,d.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=(0,T.Z)(e.occlusionQueryPool)?void 0:e.occlusionQueryPool.querySet},e.prototype.beginRenderPass=function(e,t){as(null===this.gpuRenderPassEncoder),this.setRenderPassDescriptor(t),this.frameCommandEncoder=e,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(e,t){return this.device.swapChainHeight-e-t},e.prototype.setViewport=function(e,t,n,r,i,a){void 0===i&&(i=0),void 0===a&&(a=1),this.gpuRenderPassEncoder.setViewport(e,this.flipY(t,r),n,r,i,a)},e.prototype.setScissorRect=function(e,t,n,r){this.gpuRenderPassEncoder.setScissorRect(e,this.flipY(t,r),n,r)},e.prototype.setPipeline=function(e){var t=os(e.gpuRenderPipeline);this.getEncoder().setPipeline(t)},e.prototype.setVertexInput=function(e,t,n){if(null!==e){var r=this.getEncoder(),i=e;null!==n&&r.setIndexBuffer(Du(n.buffer),os(i.indexFormat),n.offset);for(var a=0;a<t.length;a++){var o=t[a];null!==o&&r.setVertexBuffer(a,Du(o.buffer),o.offset)}}},e.prototype.setBindings=function(e){var t=e,n=this.getEncoder();t.gpuBindGroup.forEach((function(e,r){e&&n.setBindGroup(r,t.gpuBindGroup[r])}))},e.prototype.setStencilReference=function(e){this.gpuRenderPassEncoder.setStencilReference(e)},e.prototype.draw=function(e,t,n,r){this.getEncoder().draw(e,t,n,r)},e.prototype.drawIndexed=function(e,t,n,r,i){this.getEncoder().drawIndexed(e,t,n,r,i)},e.prototype.drawIndirect=function(e,t){this.getEncoder().drawIndirect(Du(e),t)},e.prototype.drawIndexedIndirect=function(e,t){this.getEncoder().drawIndexedIndirect(Du(e),t)},e.prototype.beginOcclusionQuery=function(e){this.gpuRenderPassEncoder.beginOcclusionQuery(e)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(e){this.gpuRenderPassEncoder.pushDebugGroup(e)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(e){this.gpuRenderPassEncoder.insertDebugMarker(e)},e.prototype.beginBundle=function(e){this.renderBundle=e},e.prototype.endBundle=function(){this.renderBundle.finish()},e.prototype.executeBundles=function(e){this.gpuRenderPassEncoder.executeBundles(e.map((function(e){return e.renderBundle})))},e.prototype.finish=function(){var e;null===(e=this.gpuRenderPassEncoder)||void 0===e||e.end(),this.gpuRenderPassEncoder=null;for(var t=0;t<this.gfxColorAttachment.length;t++){var n=this.gfxColorAttachment[t],r=this.gfxColorResolveTo[t];null!==n&&null!==r&&1===n.sampleCount&&this.copyAttachment(r,this.gfxColorAttachmentLevel[t],n,this.gfxColorResolveToLevel[t])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},e.prototype.copyAttachment=function(e,t,n,r){as(1===n.sampleCount);var i={texture:n.gpuTexture,mipLevel:r},a={texture:e.gpuTexture,mipLevel:t};as(n.width>>>r==e.width>>>t),as(n.height>>>r==e.height>>>t),as(!!(n.usage&_u.COPY_SRC)),as(!!(e.usage&_u.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(i,a,[e.width,e.height,1])},e}(),sc=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;return a.type=ho.RenderPipeline,a.isCreatingAsync=!1,a.gpuRenderPipeline=null,a.descriptor=i,a.device.createRenderPipelineInternal(a,!1),a}return(0,qo.__extends)(t,e),t.prototype.getBindGroupLayout=function(e){return this.gpuRenderPipeline.getBindGroupLayout(e)},t}(Qu),lc=function(e){function t(t){var n,r,i=t.id,a=t.device,o=t.descriptor,s=e.call(this,{id:i,device:a})||this;s.type=ho.Sampler;var l=o.lodMinClamp,u=o.mipmapFilter===_o.NO_MIP?o.lodMinClamp:o.lodMaxClamp,c=null!==(n=o.maxAnisotropy)&&void 0!==n?n:1;return c>1&&as(o.minFilter===Eo.BILINEAR&&o.magFilter===Eo.BILINEAR&&o.mipmapFilter===_o.LINEAR),s.gpuSampler=s.device.device.createSampler({addressModeU:Pu(o.addressModeU),addressModeV:Pu(o.addressModeV),addressModeW:Pu(null!==(r=o.addressModeW)&&void 0!==r?r:o.addressModeU),lodMinClamp:l,lodMaxClamp:u,minFilter:Ou(o.minFilter),magFilter:Ou(o.magFilter),mipmapFilter:Iu(o.mipmapFilter),compare:void 0!==o.compareFunction?Hu(o.compareFunction):void 0,maxAnisotropy:c}),s}return(0,qo.__extends)(t,e),t}(Qu),uc=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,a=t.skipCreate,o=t.sampleCount,s=e.call(this,{id:n,device:r})||this;s.type=ho.Texture,s.flipY=!1;var l=i.format,u=i.dimension,c=i.width,h=i.height,d=i.depthOrArrayLayers,f=i.mipLevelCount,p=i.usage,v=i.pixelStore;return s.flipY=!!(null==v?void 0:v.unpackFlipY),s.device.createTextureShared({format:l,dimension:null!=u?u:Co.TEXTURE_2D,width:c,height:h,depthOrArrayLayers:null!=d?d:1,mipLevelCount:null!=f?f:1,usage:p,sampleCount:null!=o?o:1},s,a),s}return(0,qo.__extends)(t,e),t.prototype.textureFromImageBitmapOrCanvas=function(e,t,n){for(var r=t[0].width,i=t[0].height,a={size:{width:r,height:i,depthOrArrayLayers:n},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},o=e.createTexture(a),s=0;s<t.length;s++)e.queue.copyExternalImageToTexture({source:t[s],flipY:this.flipY},{texture:o,origin:[0,0,s]},[r,i]);return[o,r,i]},t.prototype.isImageBitmapOrCanvases=function(e){var t=e[0];return t instanceof ImageBitmap||t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas},t.prototype.isVideo=function(e){return e[0]instanceof HTMLVideoElement},t.prototype.setImageData=function(e,t){var n,r,i,a,o=this,s=this.device.device;if(this.isImageBitmapOrCanvases(e))r=(n=(0,qo.__read)(this.textureFromImageBitmapOrCanvas(s,e,this.depthOrArrayLayers),3))[0],i=n[1],a=n[2];else if(this.isVideo(e))r=s.importExternalTexture({source:e[0]});else{var l=qu(this.gpuTextureformat),u=Math.ceil(this.width/l.width)*l.length;e.forEach((function(e){s.queue.writeTexture({texture:o.gpuTexture},e,{bytesPerRow:u},{width:o.width,height:o.height})}))}this.width=i,this.height=a,r&&(this.gpuTexture=r),this.gpuTextureView=this.gpuTexture.createView({dimension:bu(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(Qu),cc=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=ho.RenderBundle,i.renderBundleEncoder=i.device.device.createRenderBundleEncoder({colorFormats:[i.device.swapChainFormat]}),i}return(0,qo.__extends)(t,e),t.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},t}(Qu),hc=function(){function e(e,t,n,r,i,a){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=_u.RENDER_ATTACHMENT|_u.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=Po.UPPER_LEFT,this.clipSpaceNearZ=Oo.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=r,this.glsl_compile=i,this.WGSLComposer=a,this.fallbackTexture2D=this.createFallbackTexture(Co.TEXTURE_2D,bo.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Co.TEXTURE_2D,bo.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Co.TEXTURE_2D_ARRAY,bo.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Co.TEXTURE_3D,bo.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Co.TEXTURE_CUBE_MAP,bo.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:yo.REPEAT,addressModeV:yo.REPEAT,minFilter:Eo.POINT,magFilter:Eo.POINT,mipmapFilter:_o.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:yo.REPEAT,addressModeV:yo.REPEAT,minFilter:Eo.POINT,magFilter:Eo.POINT,mipmapFilter:_o.NEAREST,compareFunction:fo.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(e){console.error(e.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(e,t){this.swapChainWidth===e&&this.swapChainHeight===t||(this.swapChainWidth=e,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var e=this.canvasContext.getCurrentTexture(),t=e.createView(),n=new uc({id:0,device:this,descriptor:{format:wo.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Co.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=e,n.gpuTextureView=t,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){as(0===this.frameCommandEncoderPool.length)},e.prototype.endFrame=function(){as(this.frameCommandEncoderPool.every((function(e){return null!==e}))),this.device.queue.submit(this.frameCommandEncoderPool.map((function(e){return e.finish()}))),this.frameCommandEncoderPool=[]},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(e){return new Ju({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new uc({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new lc({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){var t=new uc({id:this.getNextUniqueId(),device:this,descriptor:(0,qo.__assign)((0,qo.__assign)({},e),{dimension:Co.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:Mo.RENDER_TARGET}),sampleCount:e.sampleCount});return t.depthOrArrayLayers=1,t.type=ho.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(e){var t=e,n=t.format,r=t.width,i=t.height,a=t.depthOrArrayLayers,o=t.sampleCount,s=t.mipLevelCount,l=t.gpuTexture,u=t.gpuTextureView,c=t.usage;as(!!(c&_u.RENDER_ATTACHMENT));var h=new uc({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:r,height:i,depthOrArrayLayers:a,dimension:Co.TEXTURE_2D,mipLevelCount:s,usage:c},skipCreate:!0});return h.depthOrArrayLayers=a,h.sampleCount=o,h.gpuTexture=l,h.gpuTextureView=u,h},e.prototype.createProgram=function(e){var t,n;return(null===(t=e.vertex)||void 0===t?void 0:t.glsl)&&(e.vertex.glsl=Rl(this.queryVendorInfo(),"vert",e.vertex.glsl)),(null===(n=e.fragment)||void 0===n?void 0:n.glsl)&&(e.fragment.glsl=Rl(this.queryVendorInfo(),"frag",e.fragment.glsl)),new rc({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createProgramSimple=function(e){return new rc({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTextureShared=function(e,t,n){var r={width:e.width,height:e.height,depthOrArrayLayers:e.depthOrArrayLayers},i=e.mipLevelCount,a=ku(e.format),o=function(e){if(e===Co.TEXTURE_2D)return"2d";if(e===Co.TEXTURE_CUBE_MAP)return"2d";if(e===Co.TEXTURE_2D_ARRAY)return"2d";if(e===Co.TEXTURE_3D)return"3d";throw new Error("whoops")}(e.dimension),s=function(e){var t=0;return e&Mo.SAMPLED&&(t|=_u.TEXTURE_BINDING|_u.COPY_DST|_u.COPY_SRC),e&Mo.STORAGE&&(t|=_u.TEXTURE_BINDING|_u.STORAGE_BINDING|_u.COPY_SRC|_u.COPY_DST),e&Mo.RENDER_TARGET&&(t|=_u.RENDER_ATTACHMENT|_u.TEXTURE_BINDING|_u.COPY_SRC|_u.COPY_DST),t}(e.usage);if(t.gpuTextureformat=a,t.dimension=e.dimension,t.format=e.format,t.width=e.width,t.height=e.height,t.depthOrArrayLayers=e.depthOrArrayLayers,t.mipLevelCount=i,t.usage=s,t.sampleCount=e.sampleCount,!n){var l=this.device.createTexture({size:r,mipLevelCount:i,format:a,dimension:o,sampleCount:e.sampleCount,usage:s}),u=l.createView();t.gpuTexture=l,t.gpuTextureView=u}},e.prototype.getFallbackSampler=function(e){return e.formatKind===bo.Depth&&e.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(e){var t=e.dimension,n=e.formatKind;if(t===Co.TEXTURE_2D)return n===bo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===Co.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===Co.TEXTURE_3D)return this.fallbackTexture3D;if(t===Co.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(e,t){var n=e===Co.TEXTURE_CUBE_MAP?6:1,r=t===bo.Float?wo.U8_RGBA_NORM:wo.D24;return this.createTexture({dimension:e,format:r,usage:Mo.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(e){return new $u({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new nc({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePipeline=function(e){return new tc({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new sc({id:this.getNextUniqueId(),device:this,descriptor:(0,qo.__assign)({},e)})},e.prototype.createQueryPool=function(e,t){return new ic({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(e,t){var n;if(null===e.gpuRenderPipeline){var r=e.descriptor,i=r.program,a=i.vertexStage,o=i.fragmentStage;if(null!==a&&null!==o){var s=r.megaStateDescriptor||{},l=s.stencilBack,u=s.stencilFront,c=(0,qo.__rest)(s,["stencilBack","stencilFront"]),h=Ns(bs);r.megaStateDescriptor=(0,qo.__assign)((0,qo.__assign)((0,qo.__assign)({},h),{stencilBack:(0,qo.__assign)((0,qo.__assign)({},h.stencilBack),l),stencilFront:(0,qo.__assign)((0,qo.__assign)({},h.stencilFront),u)}),c);var d=r.megaStateDescriptor.attachmentsState[0];r.colorAttachmentFormats.forEach((function(e,t){r.megaStateDescriptor.attachmentsState[t]||(r.megaStateDescriptor.attachmentsState[t]=xs(void 0,d))}));var f,p,v=(f=null!==(n=r.topology)&&void 0!==n?n:To.TRIANGLES,p=r.megaStateDescriptor,{topology:Bu(f),cullMode:wu(p.cullMode),frontFace:Fu(p.frontFace)}),g=Wu(r.colorAttachmentFormats,r.megaStateDescriptor),m=function(e,t){if(!(0,T.Z)(e))return{format:ku(e),depthWriteEnabled:!!t.depthWrite,depthCompare:Hu(t.depthCompare),depthBias:t.polygonOffset?t.polygonOffsetUnits:0,depthBiasSlopeScale:t.polygonOffset?t.polygonOffsetFactor:0,stencilFront:{compare:Hu(t.stencilFront.compare),passOp:Yu(t.stencilFront.passOp),failOp:Yu(t.stencilFront.failOp),depthFailOp:Yu(t.stencilFront.depthFailOp)},stencilBack:{compare:Hu(t.stencilBack.compare),passOp:Yu(t.stencilBack.passOp),failOp:Yu(t.stencilBack.failOp),depthFailOp:Yu(t.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}(r.depthStencilAttachmentFormat,r.megaStateDescriptor),y=void 0;null!==r.inputLayout&&(y=r.inputLayout.buffers);var E=r.sampleCount,_={layout:"auto",vertex:(0,qo.__assign)((0,qo.__assign)({},a),{buffers:y}),primitive:v,depthStencil:m,multisample:{count:E},fragment:(0,qo.__assign)((0,qo.__assign)({},o),{targets:g})};e.gpuRenderPipeline=this.device.createRenderPipeline(_)}}},e.prototype.createReadback=function(){return new ac({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderBundle=function(){return new cc({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(e){var t=this.renderPassPool.pop();void 0===t&&(t=new oc(this));var n=this.frameCommandEncoderPool.pop();return void 0===n&&(n=this.device.createCommandEncoder()),t.beginRenderPass(n,e),t},e.prototype.createComputePass=function(){var e=this.computePassPool.pop();void 0===e&&(e=new ec);var t=this.frameCommandEncoderPool.pop();return void 0===t&&(t=this.device.createCommandEncoder()),e.beginComputePass(t),e},e.prototype.submitPass=function(e){var t=e;t instanceof oc?(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.renderPassPool.push(t)):t instanceof ec&&(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.computePassPool.push(t))},e.prototype.copySubTexture2D=function(e,t,n,r,i,a,o){var s=this.device.createCommandEncoder(),l=e,u=r,c={texture:u.gpuTexture,origin:[i,a,0],mipLevel:0,aspect:"all"},h={texture:l.gpuTexture,origin:[t,n,0],mipLevel:0,aspect:"all"};as(!!(u.usage&_u.COPY_SRC)),as(!!(l.usage&_u.COPY_DST)),s.copyTextureToTexture(c,h,[u.width,u.height,o||1]),this.device.queue.submit([s.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(e,t,n){if(function(e){switch(es(e)){case Do.BC1:case Do.BC2:case Do.BC3:case Do.BC4_SNORM:case Do.BC4_UNORM:case Do.BC5_SNORM:case Do.BC5_UNORM:return!0;default:return!1}}(e)){if(!this.featureTextureCompressionBC)return!1;var r=function(e){switch(es(e)){case Do.BC1:case Do.BC2:case Do.BC3:case Do.BC4_SNORM:case Do.BC4_UNORM:case Do.BC5_SNORM:case Do.BC5_UNORM:return 4;default:return 1}}(e);return t%r==0&&n%r==0&&this.featureTextureCompressionBC}switch(e){case wo.U16_RGBA_NORM:case wo.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return e.descriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===ho.Buffer)(n=e).gpuBuffer.label=t;else if(e.type===ho.Texture){(n=e).gpuTexture.label=t,n.gpuTextureView.label=t}else if(e.type===ho.RenderTarget){(n=e).gpuTexture.label=t,n.gpuTextureView.label=t}else if(e.type===ho.Sampler){(n=e).gpuSampler.label=t}else if(e.type===ho.RenderPipeline){var n;null!==(n=e).gpuRenderPipeline&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(e,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(e){},e.prototype.pipelineQueryReady=function(e){return null!==e.gpuRenderPipeline},e.prototype.pipelineForceReady=function(e){var t=e;this.createRenderPipelineInternal(t,!1)},e}(),dc=(function(){function e(e){this.pluginOptions=e}e.prototype.createSwapChain=function(e){return(0,qo.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return(0,qo.__generator)(this,(function(l){switch(l.label){case 0:if(void 0===globalThis.navigator.gpu)return[2,null];t=null,l.label=1;case 1:return l.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=l.sent(),[3,4];case 3:return r=l.sent(),console.log(r),[3,4];case 4:return null===t?[2,null]:(i=["depth32float-stencil8","texture-compression-bc","float32-filterable"].filter((function(e){return t.features.has(e)})),[4,t.requestDevice({requiredFeatures:i})]);case 5:if((a=l.sent())&&(o=this.pluginOptions.onContextLost,a.lost.then((function(){o&&o()}))),null===a)return[2,null];if(!(s=e.getContext("webgpu")))return[2,null];l.label=6;case 6:return l.trys.push([6,8,,9]),[4,Mu(this.pluginOptions.shaderCompilerPath)];case 7:case 8:return l.sent(),[3,9];case 9:return[2,new hc(t,a,e,s,Eu,Ru&&new Ru)]}}))}))}}(),n(67120)),fc=n(20539),pc=n.n(fc),vc=(0,a.Z)((function e(){(0,o.Z)(this,e),this.drawcalls=[]}));vc.tag="c-renderable-3d";var gc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.lights=[]}),[{key:"addLight",value:function(e){this.lights.push(e),this.sortLights()}},{key:"removeLight",value:function(e){var t=this.lights.indexOf(e);this.lights.splice(t,1),this.sortLights()}},{key:"addFog",value:function(e){this.fog=e}},{key:"removeFog",value:function(e){this.fog=null}},{key:"getFog",value:function(){return this.fog}},{key:"getAllLights",value:function(){return this.lights}},{key:"getDefines",value:function(){var e={USE_LIGHT:!!this.lights.length};return this.lights.forEach((function(t){e[t.define]||(e[t.define]=0),e[t.define]++})),e}},{key:"sortLights",value:function(){this.lights.sort((function(e,t){return e.order-t.order}))}}])}(),mc=["style"],yc=function(e){function t(e){var n,r=e.style,i=(0,se.Z)(e,mc);return(0,o.Z)(this,t),(n=(0,s.Z)(this,t,[(0,u.Z)({type:ue.MESH,style:(0,u.Z)({x:"",y:"",z:"",lineWidth:0},r)},i)])).cullable.enable=!1,n.style.geometry.meshes.push(n),n.style.material.meshes.push(n),n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"destroy",value:function(){(0,X.Z)(t,"destroy",this,3)([]);var e=this.style.geometry.meshes,n=e.indexOf(this);e.splice(n,1),n=(e=this.style.material.meshes).indexOf(this),e.splice(n,1)}}])}(Za);yc.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Za.PARSED_STYLE_LIST),["x","y","z","geometry","material"]));var Ec=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e)}),[{key:"update",value:function(e){var t=e.x,n=void 0===t?0:t,r=e.y,i=void 0===r?0:r,a=e.z,o=void 0===a?0:a,s=e.geometry.computeBoundingBox();return{cx:n,cy:i,cz:o,hwidth:s.halfExtents[0],hheight:s.halfExtents[1],hdepth:s.halfExtents[2]}}}])}(),_c=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.counter=0,this.id2DisplayObjectMap={}}),[{key:"getId",value:function(e){var t=this.counter++;return this.id2DisplayObjectMap[t]=e,t}},{key:"getById",value:function(e){return this.id2DisplayObjectMap[e]}},{key:"deleteById",value:function(e){delete this.id2DisplayObjectMap[e]}},{key:"reset",value:function(){this.counter=0,this.id2DisplayObjectMap={}}},{key:"decodePickingColor",value:function(e){var t=(0,h.Z)(e,3);return t[0]+256*t[1]+65536*t[2]-1}},{key:"encodePickingColor",value:function(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}}])}(),Tc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.name="(unnamed)",this.preprocessedVert="",this.preprocessedFrag="",this.both="",this.vert="",this.frag="",this.defines={}}),[{key:"definesChanged",value:function(){this.preprocessedVert="",this.preprocessedFrag=""}},{key:"setDefineString",value:function(e,t){if(null!==t){if(this.defines[e]===t)return!1;this.defines[e]=t}else{if((0,T.Z)(this.defines[e]))return!1;delete this.defines[e]}return this.definesChanged(),!0}},{key:"setDefineBool",value:function(e,t){return this.setDefineString(e,t?"1":null)}},{key:"getDefineString",value:function(e){return ms(this.defines[e])}},{key:"getDefineBool",value:function(e){var t=this.getDefineString(e);return null!==t&&as("1"===t),null!==t}}])}(),Rc=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.currentBufferWordSize=-1,this.currentWordOffset=0,this.buffer=null,this.shadowBufferF32=null,this.shadowBufferU8=null,this.device=t;var n=t.queryLimits();this.uniformBufferWordAlignment=n.uniformBufferWordAlignment,this.uniformBufferMaxPageWordSize=n.uniformBufferMaxPageWordSize}),[{key:"isSupportedUBO",value:function(){return"WebGL1"!==this.device.queryVendorInfo().platformString}},{key:"findPageIndex",value:function(e){return e/this.uniformBufferMaxPageWordSize|0}},{key:"allocateChunk",value:function(e){as((e=_s(e,this.uniformBufferWordAlignment))<this.uniformBufferMaxPageWordSize);var t=this.currentWordOffset;return this.findPageIndex(t)!==this.findPageIndex(t+e-1)&&(t=_s(t,this.uniformBufferMaxPageWordSize)),this.currentWordOffset=t+e,this.ensureShadowBuffer(t,e),t}},{key:"ensureShadowBuffer",value:function(e,t){if(null===this.shadowBufferU8||null===this.shadowBufferF32){var n=_s(this.currentWordOffset,this.uniformBufferMaxPageWordSize);this.shadowBufferU8=new Uint8Array(4*n),this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer)}else if(e+t>=this.shadowBufferF32.length){as(e<this.currentWordOffset&&e+t<=this.currentWordOffset);var r=_s(Math.max(this.currentWordOffset,2*this.shadowBufferF32.length),this.uniformBufferMaxPageWordSize),i=new Uint8Array(4*r);if(i.set(this.shadowBufferU8,0),this.shadowBufferU8=i,this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer),!(this.currentWordOffset<=r))throw new Error("Assert fail: this.currentWordOffset [".concat(this.currentWordOffset,"] <= newWordCount [").concat(r,"]"))}}},{key:"mapBufferF32",value:function(){return os(this.shadowBufferF32)}},{key:"prepareToRender",value:function(){if(null!==this.shadowBufferF32){var e=os(this.shadowBufferF32);e.length!==this.currentBufferWordSize&&(this.currentBufferWordSize=e.length,null!==this.buffer&&this.buffer.destroy(),this.buffer=this.device.createBuffer({viewOrSize:4*this.currentBufferWordSize,usage:Ro.UNIFORM,hint:So.DYNAMIC}));var t=_s(this.currentWordOffset,this.uniformBufferMaxPageWordSize);if(!(t<=this.currentBufferWordSize))throw new Error("Assert fail: wordCount [".concat(t,"] (").concat(this.currentWordOffset," aligned ").concat(this.uniformBufferMaxPageWordSize,") <= this.currentBufferWordSize [").concat(this.currentBufferWordSize,"]"));if(this.isSupportedUBO())os(this.buffer).setSubData(0,this.shadowBufferU8,0,4*t);this.currentWordOffset=0}}},{key:"destroy",value:function(){null!==this.buffer&&this.buffer.destroy(),this.shadowBufferF32=null,this.shadowBufferU8=null}}])}();function Sc(e,t){return e+=t,e+=e<<10,(e+=e>>>6)>>>0}function Ac(e){return e+=e<<3,e^=e>>>11,(e+=e<<15)>>>0}function xc(e){return 0}var Cc=(0,a.Z)((function e(){(0,o.Z)(this,e),this.keys=[],this.values=[]})),Mc=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.buckets=new Map,this.keyEqualFunc=t,this.keyHashFunc=n}),[{key:"findBucketIndex",value:function(e,t){for(var n=0;n<e.keys.length;n++)if(this.keyEqualFunc(t,e.keys[n]))return n;return-1}},{key:"findBucket",value:function(e){var t=this.keyHashFunc(e);return this.buckets.get(t)}},{key:"get",value:function(e){var t=this.findBucket(e);if(void 0===t)return null;var n=this.findBucketIndex(t,e);return n<0?null:t.values[n]}},{key:"add",value:function(e,t){var n=this.keyHashFunc(e);void 0===this.buckets.get(n)&&this.buckets.set(n,new Cc);var r=this.buckets.get(n);r.keys.push(e),r.values.push(t)}},{key:"delete",value:function(e){var t=this.findBucket(e);if(void 0!==t){var n=this.findBucketIndex(t,e);-1!==n&&(t.keys.splice(n,1),t.values.splice(n,1))}}},{key:"clear",value:function(){this.buckets.clear()}},{key:"size",value:function(){var e,t=0,n=(0,oe.Z)(this.buckets.values());try{for(n.s();!(e=n.n()).done;){t+=e.value.values.length}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"values",value:(0,Uo.Z)().mark((function e(){var t,n,r,i,a;return(0,Uo.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,oe.Z)(this.buckets.values()),e.prev=1,t.s();case 2:if((n=t.n()).done){e.next=6;break}r=n.value,i=r.values.length-1;case 3:if(!(i>=0)){e.next=5;break}return e.next=4,r.values[i];case 4:i--,e.next=3;break;case 5:e.next=2;break;case 6:e.next=8;break;case 7:e.prev=7,a=e.catch(1),t.e(a);case 8:return e.prev=8,t.f(),e.finish(8);case 9:case"end":return e.stop()}}),e,this,[[1,7,8,9]])}))}])}();function Nc(e,t){var n=void 0!==t.defines?t.defines:null,r=void 0!==t.both?t.both+t.vert:t.vert,i=void 0!==t.both?t.both+t.frag:t.frag;return function(e,t,n,r){return void 0===r&&(r=null),{vert:t,frag:n,preprocessedVert:Rl(e,"vert",t,r),preprocessedFrag:Rl(e,"frag",n,r)}}(e.queryVendorInfo(),r,i,n)}function kc(e,t){return as(""!==e.preprocessedVert&&""!==t.preprocessedVert),as(""!==e.preprocessedFrag&&""!==t.preprocessedFrag),e.preprocessedVert===t.preprocessedVert&&e.preprocessedFrag===t.preprocessedFrag}function bc(e,t){return e=Sc(e,t.blendMode),e=Sc(e,t.blendSrcFactor),e=Sc(e,t.blendDstFactor)}function Pc(e,t){return e=bc(e,t.rgbBlendState),e=Sc(e=bc(e,t.alphaBlendState),t.channelWriteMask)}function Oc(e,t){for(var n,r,i,a,o,s,l,u,c=0;c<t.attachmentsState.length;c++)e=Pc(e,t.attachmentsState[c]);return e=function(e,t){return Sc(e,t.r<<24|t.g<<16|t.b<<8|t.a)}(e,t.blendConstant),e=Sc(e,t.depthCompare),e=Sc(e,t.depthWrite?1:0),e=Sc(e,null===(n=t.stencilFront)||void 0===n?void 0:n.compare),e=Sc(e,null===(r=t.stencilFront)||void 0===r?void 0:r.passOp),e=Sc(e,null===(i=t.stencilFront)||void 0===i?void 0:i.failOp),e=Sc(e,null===(a=t.stencilFront)||void 0===a?void 0:a.depthFailOp),e=Sc(e,null===(o=t.stencilBack)||void 0===o?void 0:o.compare),e=Sc(e,null===(s=t.stencilBack)||void 0===s?void 0:s.passOp),e=Sc(e,null===(l=t.stencilBack)||void 0===l?void 0:l.failOp),e=Sc(e,null===(u=t.stencilBack)||void 0===u?void 0:u.depthFailOp),e=Sc(e,t.stencilWrite?1:0),e=Sc(e,t.cullMode),e=Sc(e,t.frontFace?1:0),e=Sc(e,t.polygonOffset?1:0)}function Ic(e){var t=0;t=Sc(t,e.program.id),null!==e.inputLayout&&(t=Sc(t,e.inputLayout.id)),t=Oc(t,e.megaStateDescriptor);for(var n=0;n<e.colorAttachmentFormats.length;n++)t=Sc(t,e.colorAttachmentFormats[n]||0);return Ac(t=Sc(t,e.depthStencilAttachmentFormat||0))}function Dc(e){for(var t=0,n=0;n<e.samplerBindings.length;n++){var r=e.samplerBindings[n];null!==r&&null!==r.texture&&(t=Sc(t,r.texture.id))}for(var i=0;i<e.uniformBufferBindings.length;i++){var a=e.uniformBufferBindings[i];null!==a&&null!==a.buffer&&(t=Sc(t,a.buffer.id),t=Sc(t,a.binding),t=Sc(t,a.offset),t=Sc(t,a.size))}return Ac(t)}var Lc=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.bindingsCache=new Mc(Gs,Dc),this.renderPipelinesCache=new Mc(Ys,Ic),this.inputLayoutsCache=new Mc(js,xc),this.programCache=new Mc(kc,xc),this.samplerCache=new Mc(qs,xc),this.device=t}),[{key:"createBindings",value:function(e){var t,n=this.bindingsCache.get(e);if(null===n){var r={samplerBindings:(t=e).samplerBindings&&Bs(t.samplerBindings,Qs),uniformBufferBindings:t.uniformBufferBindings&&Bs(t.uniformBufferBindings,$s),storageBufferBindings:t.storageBufferBindings&&Bs(t.storageBufferBindings,$s),storageTextureBindings:t.storageTextureBindings&&Bs(t.storageTextureBindings,Js),pipeline:t.pipeline};r.uniformBufferBindings=r.uniformBufferBindings.filter((function(e){return e.size>0})),n=this.device.createBindings(r),this.bindingsCache.add(r,n)}return n}},{key:"createRenderPipeline",value:function(e){var t=this.renderPipelinesCache.get(e);if(null===t){var n=function(e){var t=e.inputLayout,n=e.program,r=e.topology;return{inputLayout:t,megaStateDescriptor:e.megaStateDescriptor&&Ns(e.megaStateDescriptor),program:n,topology:r,colorAttachmentFormats:e.colorAttachmentFormats.slice(),depthStencilAttachmentFormat:e.depthStencilAttachmentFormat,sampleCount:e.sampleCount}}(e);t=this.device.createRenderPipeline((0,u.Z)((0,u.Z)({},n),{},{colorAttachmentFormats:e.colorAttachmentFormats.filter((function(e){return e}))})),this.renderPipelinesCache.add(n,t)}return t}},{key:"createInputLayout",value:function(e){e.vertexBufferDescriptors=e.vertexBufferDescriptors.filter((function(e){return!!e}));var t,n=this.inputLayoutsCache.get(e);if(null===n){var r={vertexBufferDescriptors:Bs((t=e).vertexBufferDescriptors,tl),indexBufferFormat:t.indexBufferFormat,program:t.program};n=this.device.createInputLayout(r),this.inputLayoutsCache.add(r,n)}return n}},{key:"createProgramSimple",value:function(e){var t,n=e.vert,r=e.frag,i=e.preprocessedFrag,a=e.preprocessedVert,o=null;if(a&&i&&(o=this.programCache.get({vert:n,frag:r,preprocessedFrag:i,preprocessedVert:a})),null===o){var s=Nc(this.device,e),l=s.preprocessedVert,u=s.preprocessedFrag;e.preprocessedVert=l,e.preprocessedFrag=u;var c={preprocessedVert:(t=e).preprocessedVert,preprocessedFrag:t.preprocessedFrag,vert:t.vert,frag:t.frag};o=this.device.createProgramSimple({vertex:{glsl:l},fragment:{glsl:u}},n),this.programCache.add(c,o)}return o}},{key:"createSampler",value:function(e){var t=this.samplerCache.get(e);return null===t&&(t=this.device.createSampler(e),this.samplerCache.add(e,t)),t}},{key:"destroy",value:function(){var e,t=(0,oe.Z)(this.bindingsCache.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(e){t.e(e)}finally{t.f()}var n,r=(0,oe.Z)(this.renderPipelinesCache.values());try{for(r.s();!(n=r.n()).done;){n.value.destroy()}}catch(e){r.e(e)}finally{r.f()}var i,a=(0,oe.Z)(this.inputLayoutsCache.values());try{for(a.s();!(i=a.n()).done;){i.value.destroy()}}catch(e){a.e(e)}finally{a.f()}var o,s=(0,oe.Z)(this.programCache.values());try{for(s.s();!(o=s.n()).done;){o.value.destroy()}}catch(e){s.e(e)}finally{s.f()}var l,u=(0,oe.Z)(this.samplerCache.values());try{for(u.s();!(l=u.n()).done;){l.value.destroy()}}catch(e){u.e(e)}finally{u.f()}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear(),this.samplerCache.clear()}}])}(),Bc=function(e){return e.NONE="none",e.LINEAR="LinearToneMapping",e.REINHARD="ReinhardToneMapping",e.CINEON="OptimizedCineonToneMapping",e.ACES_FILMIC="ACESFilmicToneMapping",e.CUSTOM="CustomToneMapping",e}({}),wc=function(e){return e[e.Color0=0]="Color0",e[e.Color1=1]="Color1",e[e.Color2=2]="Color2",e[e.Color3=3]="Color3",e[e.ColorMax=3]="ColorMax",e[e.DepthStencil=4]="DepthStencil",e}({}),Fc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.renderTargetIDs=[],this.renderTargetLevels=[],this.resolveTextureOutputIDs=[],this.resolveTextureOutputExternalTextures=[],this.resolveTextureOutputExternalTextureLevel=[],this.resolveTextureInputIDs=[],this.renderTargetExtraRefs=[],this.resolveTextureInputTextures=[],this.renderTargets=[],this.descriptor={colorAttachment:[],colorAttachmentLevel:[],colorResolveTo:[],colorResolveToLevel:[],colorStore:[],depthStencilAttachment:null,depthStencilResolveTo:null,depthStencilStore:!0,colorClearColor:["load"],depthClearValue:"load",stencilClearValue:"load",occlusionQueryPool:null},this.viewportX=0,this.viewportY=0,this.viewportW=1,this.viewportH=1,this.execFunc=null,this.postFunc=null,this.debugThumbnails=[]}),[{key:"setDebugName",value:function(e){this.debugName=e}},{key:"pushDebugThumbnail",value:function(e){this.debugThumbnails[e]=!0}},{key:"setViewport",value:function(e,t,n,r){this.viewportX=e,this.viewportY=t,this.viewportW=n,this.viewportH=r}},{key:"attachRenderTargetID",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;as(void 0===this.renderTargetIDs[e]),this.renderTargetIDs[e]=t,this.renderTargetLevels[e]=n}},{key:"attachResolveTexture",value:function(e){this.resolveTextureInputIDs.push(e)}},{key:"attachOcclusionQueryPool",value:function(e){this.descriptor.occlusionQueryPool=e}},{key:"exec",value:function(e){as(null===this.execFunc),this.execFunc=e}},{key:"post",value:function(e){as(null===this.postFunc),this.postFunc=e}},{key:"addExtraRef",value:function(e){this.renderTargetExtraRefs[e]=!0}}])}(),Uc=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.dimension=Co.TEXTURE_2D,this.depthOrArrayLayers=1,this.mipLevelCount=1,this.width=0,this.height=0,this.sampleCount=0,this.usage=Mo.RENDER_TARGET,this.needsClear=!0,this.texture=null,this.age=0,this.format=n.format,this.width=n.width,this.height=n.height,this.sampleCount=n.sampleCount,as(this.sampleCount>=1),this.sampleCount>1?this.attachment=t.createRenderTarget(this):(this.texture=t.createTexture(this),this.attachment=t.createRenderTargetFromTexture(this.texture))}),[{key:"setDebugName",value:function(e,t){this.debugName=t,null!==this.texture&&e.setResourceName(this.texture,this.debugName),e.setResourceName(this.attachment,this.debugName)}},{key:"matchesDescription",value:function(e){return this.format===e.format&&this.width===e.width&&this.height===e.height&&this.sampleCount===e.sampleCount}},{key:"reset",value:function(e){as(this.matchesDescription(e)),this.age=0}},{key:"destroy",value:function(){this.attachment.destroy()}}])}(),Gc=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.dimension=Co.TEXTURE_2D,this.depthOrArrayLayers=1,this.mipLevelCount=1,this.usage=Mo.RENDER_TARGET,this.width=0,this.height=0,this.age=0,this.format=n.format,this.width=n.width,this.height=n.height,this.texture=t.createTexture(this)}),[{key:"matchesDescription",value:function(e){return this.format===e.format&&this.width===e.width&&this.height===e.height}},{key:"reset",value:function(e){as(this.matchesDescription(e)),this.age=0}},{key:"destroy",value:function(){this.texture.destroy()}}])}(),Zc=(0,a.Z)((function e(){(0,o.Z)(this,e),this.renderTargetDescriptions=[],this.resolveTextureRenderTargetIDs=[],this.passes=[],this.renderTargetDebugNames=[]})),Vc=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.currentPass=null,this.renderTargetDeadPool=[],this.singleSampledTextureDeadPool=[],this.currentGraph=null,this.renderTargetOutputCount=[],this.renderTargetResolveCount=[],this.resolveTextureUseCount=[],this.renderTargetAliveForID=[],this.singleSampledTextureForResolveTextureID=[],this.device=t}),[{key:"acquireRenderTargetForDescription",value:function(e){for(var t=0;t<this.renderTargetDeadPool.length;t++){var n=this.renderTargetDeadPool[t];if(n.matchesDescription(e))return n.reset(e),this.renderTargetDeadPool.splice(t--,1),n}return new Uc(this.device,e)}},{key:"acquireSingleSampledTextureForDescription",value:function(e){for(var t=0;t<this.singleSampledTextureDeadPool.length;t++){var n=this.singleSampledTextureDeadPool[t];if(n.matchesDescription(e))return n.reset(e),this.singleSampledTextureDeadPool.splice(t--,1),n}return new Gc(this.device,e)}},{key:"beginGraphBuilder",value:function(){as(null===this.currentGraph),this.currentGraph=new Zc}},{key:"pushPass",value:function(e){var t=new Fc;e(t),this.currentGraph.passes.push(t)}},{key:"createRenderTargetID",value:function(e,t){return this.currentGraph.renderTargetDebugNames.push(t),this.currentGraph.renderTargetDescriptions.push(e)-1}},{key:"createResolveTextureID",value:function(e){return this.currentGraph.resolveTextureRenderTargetIDs.push(e)-1}},{key:"findMostRecentPassThatAttachedRenderTarget",value:function(e){for(var t=this.currentGraph.passes.length-1;t>=0;t--){var n=this.currentGraph.passes[t];if(n.renderTargetIDs.includes(e))return n}return null}},{key:"resolveRenderTargetPassAttachmentSlot",value:function(e,t){var n=e;if(void 0===n.resolveTextureOutputIDs[t]){var r=n.renderTargetIDs[t],i=this.createResolveTextureID(r);n.resolveTextureOutputIDs[t]=i}return n.resolveTextureOutputIDs[t]}},{key:"findPassForResolveRenderTarget",value:function(e){var t=os(this.findMostRecentPassThatAttachedRenderTarget(e)),n=t.renderTargetIDs.indexOf(e);return as(void 0===t.resolveTextureOutputExternalTextures[n]),t}},{key:"resolveRenderTarget",value:function(e){var t=this.findPassForResolveRenderTarget(e),n=t.renderTargetIDs.indexOf(e);return this.resolveRenderTargetPassAttachmentSlot(t,n)}},{key:"resolveRenderTargetToExternalTexture",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.findPassForResolveRenderTarget(e),i=r.renderTargetIDs.indexOf(e);as(void 0===r.resolveTextureOutputIDs[i]),r.resolveTextureOutputExternalTextures[i]=t,r.resolveTextureOutputExternalTextureLevel[i]=n}},{key:"getRenderTargetDescription",value:function(e){return os(this.currentGraph.renderTargetDescriptions[e])}},{key:"scheduleAddUseCount",value:function(e,t){for(var n=0;n<t.renderTargetIDs.length;n++){var r=t.renderTargetIDs[n];void 0!==r&&(this.renderTargetOutputCount[r]++,t.renderTargetExtraRefs[n]&&this.renderTargetOutputCount[r]++)}for(var i=0;i<t.resolveTextureInputIDs.length;i++){var a=t.resolveTextureInputIDs[i];if(void 0!==a){this.resolveTextureUseCount[a]++;var o=e.resolveTextureRenderTargetIDs[a];this.renderTargetResolveCount[o]++}}}},{key:"acquireRenderTargetForID",value:function(e,t){if(void 0===t)return null;if(as(this.renderTargetOutputCount[t]>0),!this.renderTargetAliveForID[t]){var n=e.renderTargetDescriptions[t],r=this.acquireRenderTargetForDescription(n);r.setDebugName(this.device,e.renderTargetDebugNames[t]),this.renderTargetAliveForID[t]=r}return this.renderTargetAliveForID[t]}},{key:"releaseRenderTargetForID",value:function(e,t){if(void 0===e)return null;var n=os(this.renderTargetAliveForID[e]);return t?(as(this.renderTargetOutputCount[e]>0),this.renderTargetOutputCount[e]--):(as(this.renderTargetResolveCount[e]>0),this.renderTargetResolveCount[e]--),0===this.renderTargetOutputCount[e]&&0===this.renderTargetResolveCount[e]&&(n.needsClear=!0,this.renderTargetAliveForID[e]=void 0,this.renderTargetDeadPool.push(n)),n}},{key:"acquireResolveTextureInputTextureForID",value:function(e,t){var n=e.resolveTextureRenderTargetIDs[t];as(this.resolveTextureUseCount[t]>0),this.resolveTextureUseCount[t]--;var r=os(this.releaseRenderTargetForID(n,!1));if(void 0!==this.singleSampledTextureForResolveTextureID[t]){var i=this.singleSampledTextureForResolveTextureID[t];return 0===this.resolveTextureUseCount[t]&&this.singleSampledTextureDeadPool.push(i),i.texture}return os(r.texture)}},{key:"determineResolveParam",value:function(e,t,n){var r=t.renderTargetIDs[n],i=t.resolveTextureOutputIDs[n],a=t.resolveTextureOutputExternalTextures[n],o=void 0!==i,s=void 0!==a;as(!(o&&s));var l=null,u=!1,c=0;if(this.renderTargetOutputCount[r]>1&&(u=!0),o){as(e.resolveTextureRenderTargetIDs[i]===r),as(this.resolveTextureUseCount[i]>0),as(this.renderTargetOutputCount[r]>0);var h=os(this.renderTargetAliveForID[r]);if(null!==h.texture&&1===this.renderTargetOutputCount[r])l=null,u=!0;else{if(!this.singleSampledTextureForResolveTextureID[i]){var d=os(e.renderTargetDescriptions[r]);this.singleSampledTextureForResolveTextureID[i]=this.acquireSingleSampledTextureForDescription(d),this.device.setResourceName(this.singleSampledTextureForResolveTextureID[i].texture,"".concat(h.debugName," (Resolve ").concat(i,")"))}l=this.singleSampledTextureForResolveTextureID[i].texture}}else s?(l=a,c=t.resolveTextureOutputExternalTextureLevel[n]):l=null;return{resolveTo:l,store:u,level:c}}},{key:"schedulePass",value:function(e,t){for(var n=t.renderTargetIDs[wc.DepthStencil],r=wc.Color0;r<=wc.ColorMax;r++){var i=t.renderTargetIDs[r],a=this.acquireRenderTargetForID(e,i);t.renderTargets[r]=a,t.descriptor.colorAttachment[r]=null!==a?a.attachment:null,t.descriptor.colorAttachmentLevel[r]=t.renderTargetLevels[r];var o=this.determineResolveParam(e,t,r),s=o.resolveTo,l=o.store,u=o.level;t.descriptor.colorResolveTo[r]=s,t.descriptor.colorResolveToLevel[r]=u,t.descriptor.colorStore[r]=l,t.descriptor.colorClearColor[r]=null!==a&&a.needsClear?e.renderTargetDescriptions[i].colorClearColor:"load"}var c=this.acquireRenderTargetForID(e,n);t.renderTargets[wc.DepthStencil]=c,t.descriptor.depthStencilAttachment=null!==c?c.attachment:null;var h=this.determineResolveParam(e,t,wc.DepthStencil),d=h.resolveTo,f=h.store;t.descriptor.depthStencilResolveTo=d,t.descriptor.depthStencilStore=f,t.descriptor.depthClearValue=null!==c&&c.needsClear?e.renderTargetDescriptions[n].depthClearValue:"load",t.descriptor.stencilClearValue=null!==c&&c.needsClear?e.renderTargetDescriptions[n].stencilClearValue:"load";for(var p=0,v=0,g=0,m=0;m<t.renderTargets.length;m++){var y=t.renderTargets[m];if(y){var E=y.width>>>t.renderTargetLevels[m],_=y.height>>>t.renderTargetLevels[m];0===p&&(p=E,v=_,g=y.sampleCount),as(E===p),as(_===v),as(y.sampleCount===g),y.needsClear=!1}}p>0&&v>0&&(t.viewportX*=p,t.viewportY*=v,t.viewportW*=p,t.viewportH*=v);for(var T=0;T<t.resolveTextureInputIDs.length;T++){var R=t.resolveTextureInputIDs[T];t.resolveTextureInputTextures[T]=this.acquireResolveTextureInputTextureForID(e,R)}for(var S=0;S<t.renderTargetIDs.length;S++)this.releaseRenderTargetForID(t.renderTargetIDs[S],!0);for(var A=0;A<t.renderTargetExtraRefs.length;A++)t.renderTargetExtraRefs[A]&&this.releaseRenderTargetForID(t.renderTargetIDs[A],!0)}},{key:"scheduleGraph",value:function(e){as(0===this.renderTargetOutputCount.length),as(0===this.renderTargetResolveCount.length),as(0===this.resolveTextureUseCount.length);for(var t=0;t<this.renderTargetDeadPool.length;t++)this.renderTargetDeadPool[t].age++;for(var n=0;n<this.singleSampledTextureDeadPool.length;n++)this.singleSampledTextureDeadPool[n].age++;ys(this.renderTargetOutputCount,e.renderTargetDescriptions.length,0),ys(this.renderTargetResolveCount,e.renderTargetDescriptions.length,0),ys(this.resolveTextureUseCount,e.resolveTextureRenderTargetIDs.length,0);for(var r=0;r<e.passes.length;r++)this.scheduleAddUseCount(e,e.passes[r]);for(var i=0;i<e.passes.length;i++)this.schedulePass(e,e.passes[i]);for(var a=0;a<this.renderTargetOutputCount.length;a++)as(0===this.renderTargetOutputCount[a]);for(var o=0;o<this.renderTargetResolveCount.length;o++)as(0===this.renderTargetResolveCount[o]);for(var s=0;s<this.resolveTextureUseCount.length;s++)as(0===this.resolveTextureUseCount[s]);for(var l=0;l<this.renderTargetAliveForID.length;l++)as(void 0===this.renderTargetAliveForID[l]);for(var u=0;u<this.renderTargetDeadPool.length;u++)this.renderTargetDeadPool[u].age>=1&&(this.renderTargetDeadPool[u].destroy(),this.renderTargetDeadPool.splice(u--,1));for(var c=0;c<this.singleSampledTextureDeadPool.length;c++)this.singleSampledTextureDeadPool[c].age>=1&&(this.singleSampledTextureDeadPool[c].destroy(),this.singleSampledTextureDeadPool.splice(c--,1));this.renderTargetResolveCount.length=0,this.renderTargetOutputCount.length=0,this.resolveTextureUseCount.length=0}},{key:"execPass",value:function(e){as(null===this.currentPass),this.currentPass=e;var t=this.device.createRenderPass(e.descriptor);t.pushDebugGroup(e.debugName),t.setViewport(e.viewportX,e.viewportY,e.viewportW,e.viewportH),null!==e.execFunc&&e.execFunc(t,this),t.popDebugGroup(),this.device.submitPass(t),null!==e.postFunc&&e.postFunc(this),this.currentPass=null}},{key:"execGraph",value:function(e){var t=this;this.scheduleGraph(e),this.device.beginFrame(),e.passes.forEach((function(e){t.execPass(e)})),this.device.endFrame(),this.singleSampledTextureForResolveTextureID.length=0}},{key:"execute",value:function(){var e=os(this.currentGraph);this.execGraph(e),this.currentGraph=null}},{key:"getDebug",value:function(){return this}},{key:"getPasses",value:function(){return this.currentGraph.passes}},{key:"getPassDebugThumbnails",value:function(e){return e.debugThumbnails}},{key:"getPassRenderTargetID",value:function(e,t){return e.renderTargetIDs[t]}},{key:"getRenderTargetIDDebugName",value:function(e){return this.currentGraph.renderTargetDebugNames[e]}},{key:"getResolveTextureForID",value:function(e){var t=this.currentPass,n=t.resolveTextureInputIDs.indexOf(e);return as(n>=0),os(t.resolveTextureInputTextures[n])}},{key:"getRenderTargetAttachment",value:function(e){var t=this.currentPass.renderTargets[e];return t?t.attachment:null}},{key:"getRenderTargetTexture",value:function(e){var t=this.currentPass.renderTargets[e];return t?t.texture:null}},{key:"newGraphBuilder",value:function(){return this.beginGraphBuilder(),this}},{key:"destroy",value:function(){for(var e=0;e<this.renderTargetAliveForID.length;e++)as(void 0===this.renderTargetAliveForID[e]);for(var t=0;t<this.singleSampledTextureForResolveTextureID.length;t++)as(void 0===this.singleSampledTextureForResolveTextureID[t]);for(var n=0;n<this.renderTargetDeadPool.length;n++)this.renderTargetDeadPool[n].destroy();for(var r=0;r<this.singleSampledTextureDeadPool.length;r++)this.singleSampledTextureDeadPool[r].destroy()}}])}(),Xc=function(e){return e[e.BACKGROUND=0]="BACKGROUND",e[e.ALPHA_TEST=16]="ALPHA_TEST",e[e.OPAQUE=32]="OPAQUE",e[e.TRANSLUCENT=128]="TRANSLUCENT",e}({});function Wc(e,t){return(16777215&e|(255&t)<<24)>>>0}function Hc(e,t){return Wc(function(e,t){return e>>>31&1?e:(4278190335&e|(65535&t)<<8)>>>0}(0,t),e)}v.fromValues(1,0,0,0,0,1,0,0,0,0,2,0,0,0,-1,1);v.fromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);function Yc(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return e[t+0]=n,e[t+1]=r,e[t+2]=i,e[t+3]=a,4}var zc=function(e){return e[e.None=0]="None",e[e.Indexed=1]="Indexed",e[e.AllowSkippingIfPipelineNotReady=2]="AllowSkippingIfPipelineNotReady",e[e.Template=4]="Template",e[e.Draw=8]="Draw",e[e.InheritedFlags=3]="InheritedFlags",e}({}),Kc=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.sortKey=0,this.debug=null,this.uniforms=[],this.bindingDescriptors=Rs(1,(function(){return{bindingLayout:null,samplerBindings:[],uniformBufferBindings:[]}})),this.dynamicUniformBufferByteOffsets=Rs(4,(function(){return 0})),this.flags=0,this.vertexBuffers=null,this.indexBuffer=null,this.drawStart=0,this.drawCount=0,this.drawInstanceCount=0,this.renderPipelineDescriptor={inputLayout:null,megaStateDescriptor:Ns(bs),program:null,topology:To.TRIANGLES,colorAttachmentFormats:[],depthStencilAttachmentFormat:null,sampleCount:1},this.reset()}),[{key:"reset",value:function(){this.sortKey=0,this.flags=zc.AllowSkippingIfPipelineNotReady,this.vertexBuffers=null,this.indexBuffer=null,this.renderPipelineDescriptor.inputLayout=null}},{key:"setFromTemplate",value:function(e){var t,n;Ms(this.renderPipelineDescriptor.megaStateDescriptor,e.renderPipelineDescriptor.megaStateDescriptor),this.renderPipelineDescriptor.program=e.renderPipelineDescriptor.program,this.renderPipelineDescriptor.inputLayout=e.renderPipelineDescriptor.inputLayout,this.renderPipelineDescriptor.topology=e.renderPipelineDescriptor.topology,this.renderPipelineDescriptor.colorAttachmentFormats.length=Math.max(this.renderPipelineDescriptor.colorAttachmentFormats.length,e.renderPipelineDescriptor.colorAttachmentFormats.length);for(var r=0;r<e.renderPipelineDescriptor.colorAttachmentFormats.length;r++)this.renderPipelineDescriptor.colorAttachmentFormats[r]=e.renderPipelineDescriptor.colorAttachmentFormats[r];this.renderPipelineDescriptor.depthStencilAttachmentFormat=e.renderPipelineDescriptor.depthStencilAttachmentFormat,this.renderPipelineDescriptor.sampleCount=e.renderPipelineDescriptor.sampleCount,this.uniformBuffer=e.uniformBuffer,this.uniforms=(0,c.Z)(e.uniforms),this.drawCount=e.drawCount,this.drawStart=e.drawStart,this.drawInstanceCount=e.drawInstanceCount,this.vertexBuffers=e.vertexBuffers,this.indexBuffer=e.indexBuffer,this.flags=this.flags&~zc.InheritedFlags|e.flags&zc.InheritedFlags,this.sortKey=e.sortKey;var i=this.bindingDescriptors[0],a=e.bindingDescriptors[0];this.setBindingLayout({numSamplers:null===(t=a.samplerBindings)||void 0===t?void 0:t.length,numUniformBuffers:null===(n=a.uniformBufferBindings)||void 0===n?void 0:n.length});for(var o=0;o<Math.min(i.uniformBufferBindings.length,a.uniformBufferBindings.length);o++)i.uniformBufferBindings[o].size=e.bindingDescriptors[0].uniformBufferBindings[o].size;this.setSamplerBindingsFromTextureMappings(a.samplerBindings);for(var s=0;s<e.dynamicUniformBufferByteOffsets.length;s++)this.dynamicUniformBufferByteOffsets[s]=e.dynamicUniformBufferByteOffsets[s]}},{key:"validate",value:function(){for(var e=0;e<this.bindingDescriptors.length;e++)for(var t=this.bindingDescriptors[e],n=0;n<(null===(r=t.uniformBufferBindings)||void 0===r?void 0:r.length);n++){var r;as(t.uniformBufferBindings[n].size>0)}as(this.drawCount>0)}},{key:"setProgram",value:function(e){this.renderPipelineDescriptor.program=e}},{key:"setMegaStateFlags",value:function(e){return Ms(this.renderPipelineDescriptor.megaStateDescriptor,e),this.renderPipelineDescriptor.megaStateDescriptor}},{key:"getMegaStateFlags",value:function(){return this.renderPipelineDescriptor.megaStateDescriptor}},{key:"setVertexInput",value:function(e,t,n){this.vertexBuffers=t,this.indexBuffer=n,this.renderPipelineDescriptor.inputLayout=e}},{key:"setBindingLayout",value:function(e){as(e.numUniformBuffers<this.dynamicUniformBufferByteOffsets.length);for(var t=this.bindingDescriptors[0].uniformBufferBindings.length;t<e.numUniformBuffers;t++)this.bindingDescriptors[0].uniformBufferBindings.push({binding:t,buffer:null,size:0});for(var n=this.bindingDescriptors[0].samplerBindings.length;n<e.numSamplers;n++)this.bindingDescriptors[0].samplerBindings.push({sampler:null,texture:null})}},{key:"drawIndexes",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.flags=Ts(this.flags,zc.Indexed,!0),this.drawCount=e,this.drawStart=t,this.drawInstanceCount=1}},{key:"drawIndexesInstanced",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.flags=Ts(this.flags,zc.Indexed,!0),this.drawCount=e,this.drawStart=n,this.drawInstanceCount=t}},{key:"drawPrimitives",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.flags=Ts(this.flags,zc.Indexed,!1),this.drawCount=e,this.drawStart=t,this.drawInstanceCount=1}},{key:"setUniforms",value:function(e,t){if(0!==t.length){this.uniforms[e]=t;var n=0,r=[];t.forEach((function(e){var t=e.value;if((0,E.Z)(t)||Array.isArray(t)||t instanceof Float32Array){var i=(0,E.Z)(t)?[t]:t,a=i.length>4?4:i.length,o=4-n%4;if(4!==o)if(o>=a);else{n+=o;for(var s=0;s<o;s++)r.push(0)}n+=i.length,r.push.apply(r,(0,c.Z)(i))}}));var i=4-r.length%4;if(4!==i)for(var a=0;a<i;a++)r.push(0);for(var o=this.allocateUniformBuffer(e,r.length),s=this.mapUniformBufferF32(e),l=0;l<r.length;l+=4)o+=Yc(s,o,r[l],r[l+1],r[l+2],r[l+3])}}},{key:"setUniformBuffer",value:function(e){this.uniformBuffer=e}},{key:"allocateUniformBuffer",value:function(e,t){var n;return as((null===(n=this.bindingDescriptors[0].uniformBufferBindings)||void 0===n?void 0:n.length)<this.dynamicUniformBufferByteOffsets.length),this.dynamicUniformBufferByteOffsets[e]=this.uniformBuffer.allocateChunk(t)<<2,this.bindingDescriptors[0].uniformBufferBindings[e].size=t<<2,this.getUniformBufferOffset(e)}},{key:"getUniformBufferOffset",value:function(e){return this.dynamicUniformBufferByteOffsets[e]>>>2}},{key:"mapUniformBufferF32",value:function(e){return this.uniformBuffer.mapBufferF32()}},{key:"getUniformBuffer",value:function(){return this.uniformBuffer}},{key:"setSamplerBindingsFromTextureMappings",value:function(e){e=e.filter((function(e){return e}));for(var t=0;t<this.bindingDescriptors[0].samplerBindings.length;t++){var n=this.bindingDescriptors[0].samplerBindings[t],r=e[t];null!=r?(n.texture=r.texture,n.sampler=r.sampler):(n.texture=null,n.sampler=null)}}},{key:"setAllowSkippingIfPipelineNotReady",value:function(e){this.flags=Ts(this.flags,zc.AllowSkippingIfPipelineNotReady,e)}},{key:"setAttachmentFormatsFromRenderPass",value:function(e,t){for(var n=e.queryRenderPass(t),r=-1,i=0;i<n.colorAttachment.length;i++){var a=null!==n.colorAttachment[i]?e.queryRenderTarget(n.colorAttachment[i]):null;this.renderPipelineDescriptor.colorAttachmentFormats[i]=null!==a?a.format:null,null!==a&&(-1===r?r=a.sampleCount:as(r===a.sampleCount))}var o=null!==n.depthStencilAttachment?e.queryRenderTarget(n.depthStencilAttachment):null;this.renderPipelineDescriptor.depthStencilAttachmentFormat=null!==o?o.format:null,null!==o&&(-1===r?r=o.sampleCount:as(r===o.sampleCount)),as(r>0),this.renderPipelineDescriptor.sampleCount=r}},{key:"drawOnPass",value:function(e,t){var n=this,r=e.device;this.setAttachmentFormatsFromRenderPass(r,t);var i=e.createRenderPipeline(this.renderPipelineDescriptor);if(!r.pipelineQueryReady(i)){if(this.flags&zc.AllowSkippingIfPipelineNotReady)return!1;r.pipelineForceReady(i)}t.setPipeline(i),t.setVertexInput(this.renderPipelineDescriptor.inputLayout,this.vertexBuffers,this.indexBuffer);for(var a=0;a<this.bindingDescriptors[0].uniformBufferBindings.length;a++)this.bindingDescriptors[0].uniformBufferBindings[a].buffer=os(this.uniformBuffer.buffer),this.bindingDescriptors[0].uniformBufferBindings[a].offset=this.dynamicUniformBufferByteOffsets[a];this.renderPipelineDescriptor.program.gl_program&&this.uniforms.forEach((function(e){var t={};e.forEach((function(e){var n=e.name,r=e.value;t[n]=r})),n.renderPipelineDescriptor.program.setUniformsLegacy(t)}));var o=e.createBindings((0,u.Z)((0,u.Z)({},this.bindingDescriptors[0]),{},{pipeline:i}));return t.setBindings(o),this.flags&zc.Indexed?t.drawIndexed(this.drawCount,this.drawInstanceCount,this.drawStart,0,0):t.draw(this.drawCount,this.drawInstanceCount,this.drawStart,0),!0}}])}();function jc(e,t){return e.sortKey-t.sortKey}var qc=function(e){return e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards",e}({}),Qc=function(){return(0,a.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jc,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qc.Forwards;(0,o.Z)(this,e),this.renderInsts=[],this.usePostSort=!1,this.compareFunction=t,this.executionOrder=n}),[{key:"checkUsePostSort",value:function(){this.usePostSort=null!==this.compareFunction&&this.renderInsts.length>=500}},{key:"insertSorted",value:function(e){var t,n,r,i;null===this.compareFunction||this.usePostSort?this.renderInsts.push(e):(t=this.renderInsts,n=e,r=this.compareFunction,i=function(e,t,n){for(var r=0,i=e.length;r<i;){var a=r+(i-r>>>1);n(t,e[a])<0?i=a:r=a+1}return r}(t,n,r),t.splice(i,0,n)),this.checkUsePostSort()}},{key:"submitRenderInst",value:function(e){e.flags|=zc.Draw,this.insertSorted(e)}},{key:"ensureSorted",value:function(){this.usePostSort&&(0!==this.renderInsts.length&&this.renderInsts.sort(this.compareFunction),this.usePostSort=!1)}},{key:"drawOnPassRendererNoReset",value:function(e,t){if(this.ensureSorted(),this.executionOrder===qc.Forwards)for(var n=0;n<this.renderInsts.length;n++)this.renderInsts[n].drawOnPass(e,t);else for(var r=this.renderInsts.length-1;r>=0;r--)this.renderInsts[r].drawOnPass(e,t)}},{key:"reset",value:function(){this.renderInsts.length=0}},{key:"drawOnPassRenderer",value:function(e,t){this.drawOnPassRendererNoReset(e,t),this.reset()}}])}(),$c=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.pool=[],this.allocCount=0}),[{key:"allocRenderInstIndex",value:function(){return this.allocCount++,this.allocCount>this.pool.length&&this.pool.push(new Kc),this.allocCount-1}},{key:"popRenderInst",value:function(){this.allocCount--}},{key:"reset",value:function(){for(var e=0;e<this.pool.length;e++)this.pool[e].reset();this.allocCount=0}},{key:"destroy",value:function(){this.pool.length=0,this.allocCount=0}}])}(),Jc=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.instPool=new $c,this.templatePool=new $c,this.simpleRenderInstList=new Qc,this.currentRenderInstList=this.simpleRenderInstList,this.renderCache=t}),[{key:"newRenderInst",value:function(){var e=this.templatePool.allocCount-1,t=this.instPool.allocRenderInstIndex(),n=this.instPool.pool[t];return n.debug=null,e>=0&&n.setFromTemplate(this.templatePool.pool[e]),n}},{key:"submitRenderInst",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentRenderInstList;t.submitRenderInst(e)}},{key:"setCurrentRenderInstList",value:function(e){as(null===this.simpleRenderInstList),this.currentRenderInstList=e}},{key:"pushTemplateRenderInst",value:function(){var e=this.templatePool.allocCount-1,t=this.templatePool.allocRenderInstIndex(),n=this.templatePool.pool[t];return e>=0&&n.setFromTemplate(this.templatePool.pool[e]),n.flags|=zc.Template,n}},{key:"popTemplateRenderInst",value:function(){this.templatePool.popRenderInst()}},{key:"getTemplateRenderInst",value:function(){var e=this.templatePool.allocCount-1;return this.templatePool.pool[e]}},{key:"resetRenderInsts",value:function(){this.instPool.reset(),null!==this.simpleRenderInstList&&this.simpleRenderInstList.reset(),as(0===this.templatePool.allocCount)}},{key:"destroy",value:function(){this.instPool.destroy(),this.renderCache.destroy()}},{key:"disableSimpleMode",value:function(){this.simpleRenderInstList=null}},{key:"drawOnPassRenderer",value:function(e){os(this.simpleRenderInstList).drawOnPassRenderer(this.renderCache,e)}},{key:"drawOnPassRendererNoReset",value:function(e){os(this.simpleRenderInstList).drawOnPassRendererNoReset(this.renderCache,e)}}])}(),eh=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.parameters=t}),[{key:"getDevice",value:function(){return this.device}},{key:"setDevice",value:function(e){this.device=e,this.renderCache=new Lc(e),this.renderGraph=new Vc(this.device),this.renderInstManager=new Jc(this.renderCache),this.uniformBuffer=new Rc(this.device)}},{key:"pushTemplateRenderInst",value:function(){var e=this.renderInstManager.pushTemplateRenderInst();return e.setUniformBuffer(this.uniformBuffer),e}},{key:"prepareToRender",value:function(){this.uniformBuffer.prepareToRender()}},{key:"destroy",value:function(){this.uniformBuffer&&this.uniformBuffer.destroy(),this.renderInstManager&&this.renderInstManager.destroy(),this.renderCache&&this.renderCache.destroy(),this.renderGraph&&this.renderGraph.destroy()}},{key:"getCache",value:function(){return this.renderCache}},{key:"getDefines",value:function(){var e,t,n;return{USE_TONEMAPPING:(null===(e=this.parameters)||void 0===e?void 0:e.toneMapping)&&(null===(t=this.parameters)||void 0===t?void 0:t.toneMapping)!==Bc.NONE,toneMapping:null===(n=this.parameters)||void 0===n?void 0:n.toneMapping}}}])}(),th=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.width=0,this.height=0,this.sampleCount=0,this.colorClearColor="load",this.depthClearValue="load",this.stencilClearValue="load",this.format=t}),[{key:"setDimensions",value:function(e,t,n){this.width=e,this.height=t,this.sampleCount=n}},{key:"copyDimensions",value:function(e){this.width=e.width,this.height=e.height,this.sampleCount=e.sampleCount}}])}();function nh(e){return{colorClearColor:e,depthClearValue:1,stencilClearValue:0}}nh(cs(.88,.88,.88,1)),nh(ds);var rh=nh(ps),ih=function(e){return e[e.None=0]="None",e[e.FXAA=1]="FXAA",e[e.MSAAx4=2]="MSAAx4",e}({});function ah(e,t){var n=function(e){return e.antialiasingMode===ih.MSAAx4?4:1}(t);e.setDimensions(t.backbufferWidth,t.backbufferHeight,n)}function oh(e,t,n){var r=function(e){if(e===wc.Color0)return wo.U8_RGBA_RT;if(e===wc.DepthStencil)return wo.D24_S8;throw new Error("whoops")}(e),i=new th(r);return ah(i,t),null!==n&&(i.colorClearColor=n.colorClearColor,i.depthClearValue=n.depthClearValue,i.stencilClearValue=n.stencilClearValue),i}var sh=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.texture=null,this.sampler=null,this.width=0,this.height=0,this.lodBias=0}),[{key:"reset",value:function(){this.texture=null,this.sampler=null,this.width=0,this.height=0,this.lodBias=0}},{key:"copy",value:function(e){this.texture=e.texture,this.sampler=e.sampler,this.width=e.width,this.height=e.height,this.lodBias=e.lodBias}}])}(),lh=["style"],uh=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,se.Z)(e,lh);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:t.tag,style:(0,u.Z)({intensity:Math.PI},n)},r)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Za);uh.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Za.PARSED_STYLE_LIST),["intensity"])),uh.tag="light";var ch=["style"],hh=function(e){return e[e.NONE=0]="NONE",e[e.EXP=1]="EXP",e[e.EXP2=2]="EXP2",e[e.LINEAR=3]="LINEAR",e}({}),dh=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.style,r=(0,se.Z)(e,ch);return(0,o.Z)(this,t),(0,s.Z)(this,t,[(0,u.Z)({type:t.tag,style:(0,u.Z)({type:hh.NONE,fill:"black",start:1,end:1e3,density:0},n)},r)])}return(0,l.Z)(t,e),(0,a.Z)(t)}(Za);function fh(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:So.STATIC,i=e.createBuffer({viewOrSize:n.byteLength,usage:t,hint:r});return i.setSubData(0,new Uint8Array(n)),i}dh.PARSED_STYLE_LIST=new Set([].concat((0,c.Z)(Za.PARSED_STYLE_LIST),["type","density","start","end"])),dh.tag="fog";var ph,vh,gh=function(e){return e.CHANGED="changed",e}({}),mh=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,o.Z)(this,t),(n=(0,s.Z)(this,t)).drawMode=To.TRIANGLES,n.vertexBuffers=[],n.vertices=[],n.inputLayoutDescriptor={vertexBufferDescriptors:[],indexBufferFormat:null,program:null},n.vertexCount=0,n.instancedCount=0,n.indexStart=0,n.primitiveStart=0,n.dirty=!0,n.meshes=[],n.device=e,n.props=r,n}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"validate",value:function(e){return!0}},{key:"build",value:function(e){}},{key:"computeBoundingBox",value:function(){return new Ee}},{key:"setIndexBuffer",value:function(e){return this.indexBuffer&&this.indexBuffer.destroy(),this.indexBuffer=fh(this.device,Ro.INDEX,new Uint32Array(ArrayBuffer.isView(e)?e.buffer:e).buffer),this.indices=e,this.inputLayoutDescriptor.indexBufferFormat=wo.U32_R,this}},{key:"setVertexBuffer",value:function(e){var t=this,n=e.bufferIndex,r=e.byteStride,i=e.stepMode,a=e.attributes,o=e.data;this.inputLayoutDescriptor.vertexBufferDescriptors[n]={arrayStride:r,stepMode:i,attributes:[]},this.vertices[n]=o,a.forEach((function(e){var r=e.format,i=e.bufferByteOffset,a=e.location,o=e.divisor;e.byteStride;var s=t.inputLayoutDescriptor.vertexBufferDescriptors[n].attributes.find((function(e){return e.shaderLocation===a}));s?(s.format=r,s.offset=i,s.divisor=o):t.inputLayoutDescriptor.vertexBufferDescriptors[n].attributes.push({format:r,offset:i,shaderLocation:a,divisor:o})})),this.vertexBuffers[n]&&this.vertexBuffers[n].destroy();var s=fh(this.device,Ro.VERTEX,o.buffer,So.DYNAMIC);return this.vertexBuffers[n]=s,this}},{key:"getVertexBuffer",value:function(e){return this.vertexBuffers[e]}},{key:"updateVertexBuffer",value:function(e,t,n,r){var i=this.inputLayoutDescriptor.vertexBufferDescriptors[e];if(i){var a=i.arrayStride,o=this.inputLayoutDescriptor.vertexBufferDescriptors[e].attributes.find((function(e){return e.shaderLocation===t}));if(o){var s=n*a;this.getVertexBuffer(e).setSubData(o.offset+s,r)}this.emit(gh.CHANGED)}}},{key:"updateIndices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.indexBuffer&&this.indexBuffer.setSubData(t,new Uint8Array(ArrayBuffer.isView(e)?e:new Uint32Array(e))),this}},{key:"destroy",value:function(){this.vertexBuffers.forEach((function(e){e&&e.destroy()})),this.indexBuffer&&this.indexBuffer.destroy(),this.inputLayoutDescriptor.vertexBufferDescriptors=[],this.indexBuffer=void 0,this.vertexBuffers=[],this.indices=void 0,this.vertices=[],this.vertexCount=0,this.instancedCount=0}}])}(d.Z),yh="#define GLSLIFY 1\nlayout(location = 0) in vec2 a_Position;\n\nout vec2 v_TexCoord;\n\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}",Eh="#define GLSLIFY 1\nuniform sampler2D u_Texture;\nin vec2 v_TexCoord;\n\nout vec4 outputColor;\n\nfloat MonochromeNTSC(vec3 t_Color) {\n  // NTSC primaries.\n  return dot(t_Color.rgb, vec3(0.299, 0.587, 0.114));\n}\n\nvec4 FXAA(PD_SAMPLER_2D(t_Texture), in vec2 t_PixelCenter, in vec2 t_InvResolution) {\n  // FXAA v2, based on implementations:\n  // http://www.geeks3d.com/20110405/fxaa-fast-approximate-anti-aliasing-demo-glsl-opengl-test-radeon-geforce/\n  // https://github.com/mitsuhiko/webgl-meincraft\n\n  float lumaMM = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy).rgb);\n\n  #if 1\n    vec2 t_PixelTopLeft = t_PixelCenter.xy - t_InvResolution.xy * 0.5;\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy)             .rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(1.0, 0.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(0.0, 1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelTopLeft.xy + vec2(1.0, 1.0)).rgb);\n  #else\n    // We're at the pixel center -- pixel edges are 0.5 units away.\n    // NOTE(jstpierre): mitsuhiko's port seems to get this wrong?\n    vec2 t_PixelSize = t_InvResolution.xy * 0.5;\n\n    float lumaNW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0, -1.0)).rgb);\n    float lumaNE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0, -1.0)).rgb);\n    float lumaSW = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2(-1.0,  1.0)).rgb);\n    float lumaSE = MonochromeNTSC(texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + t_PixelSize * vec2( 1.0,  1.0)).rgb);\n  #endif\n\n  vec2 dir; \n  dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n  dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n  const float FXAA_REDUCE_MIN = 1.0/128.0;\n  const float FXAA_REDUCE_MUL = 1.0/8.0;\n  const float FXAA_SPAN_MAX = 8.0;\n\n  float dirReduce = max(\n      (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\n      FXAA_REDUCE_MIN);\n\n  float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);\n  dir = min(vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * u_InvResolution.xy;\n\n  float lumaMin = min(lumaMM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n  float lumaMax = max(lumaMM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n  vec4 rgbA = (1.0/2.0) * (\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (1.0/3.0 - 0.5)) +\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (2.0/3.0 - 0.5)));\n  vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (0.0/3.0 - 0.5)) +\n      texture(PU_SAMPLER_2D(t_Texture), t_PixelCenter.xy + dir * (3.0/3.0 - 0.5)));\n  float lumaB = MonochromeNTSC(rgbB.rgb);\n\n  vec4 rgbOutput = ((lumaB < lumaMin) || (lumaB > lumaMax)) ? rgbA : rgbB;\n  return rgbOutput;\n}\n\nvoid main() {\n  outputColor = FXAA(PP_SAMPLER_2D(u_Texture), v_TexCoord.xy, u_InvResolution.xy);\n}",_h=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).features={},e.both="\nlayout(std140) uniform ub_Params {\n    vec4 u_Misc[1];\n};\n#define u_InvResolution (u_Misc[0].xy)\n",e.vert=yh,e.frag=Eh,e}return(0,l.Z)(t,e),(0,a.Z)(t)}(Tc),Th=Rs(1,(function(){return new sh}));var Rh=function(e){return e.PROJECTION_MATRIX="u_ProjectionMatrix",e.VIEW_MATRIX="u_ViewMatrix",e.CAMERA_POSITION="u_CameraPosition",e.DEVICE_PIXEL_RATIO="u_DevicePixelRatio",e.VIEWPORT="u_Viewport",e.IS_ORTHO="u_IsOrtho",e.IS_PICKING="u_IsPicking",e}({}),Sh=function(){function e(t,n,r,i,a){(0,o.Z)(this,e),this.renderLists={leftEye:new Qc,rightEye:new Qc,picking:new Qc},this.cameras=[],this.renderHelper=t,this.lightPool=n,this.texturePool=r,this.batchManager=i,this.options=a}return(0,a.Z)(e,[{key:"getDevice",value:function(){return this.device}},{key:"getSwapChain",value:function(){return this.swapChain}},{key:"getRenderLists",value:function(){return this.renderLists}},{key:"apply",value:function(t){var n=this;this.context=t;var r=t.renderingService,i=t.renderingContext,a=t.config,o=i.root.ownerDocument.defaultView;a.disableRenderHooks=!0;var s=function(e){var t=e.target;t.nodeName!==uh.tag?t.nodeName!==dh.tag?(t.renderable3D||(t.renderable3D=new vc),n.batchManager.add(t)):n.lightPool.addFog(t):n.lightPool.addLight(t)},l=function(e){var t=e.target;if(t.nodeName!==uh.tag)if(t.nodeName!==dh.tag){if(t.nodeName===ue.MESH){var r,i;if(null!==(r=t.style.geometry)&&void 0!==r&&r.meshes){var a=t.style.geometry.meshes.indexOf(t);a>-1&&t.style.geometry.meshes.splice(a,1)}if(null!==(i=t.style.material)&&void 0!==i&&i.meshes){var o=t.style.material.meshes.indexOf(t);o>-1&&t.style.material.meshes.splice(o,1)}}n.swapChain&&n.batchManager.remove(t),delete t.renderable3D}else n.lightPool.removeFog(t);else n.lightPool.removeLight(t)},h=function(e){if(n.swapChain){var t=e.target,r=e.attrName,i=e.newValue;"zIndex"===r?t.parentNode.forEach((function(e){n.batchManager.changeRenderOrder(e,e.sortable.renderOrder)})):n.batchManager.updateAttribute(t,r,i)}},d=function(e){if(n.swapChain){var t=e.target;(t.nodeName===ue.FRAGMENT?t.childNodes:[t]).forEach((function(e){n.batchManager.updateAttribute(e,"modelMatrix",null)}))}};r.hooks.initAsync.tapPromise(e.tag,(0,Go.Z)((0,Uo.Z)().mark((function e(){var r,i,a,c;return(0,Uo.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.addEventListener(Qi.MOUNTED,s),o.addEventListener(Qi.UNMOUNTED,l),o.addEventListener(Qi.ATTR_MODIFIED,h),o.addEventListener(Qi.BOUNDS_CHANGED,d),n.context.config.renderer.getConfig().enableDirtyRectangleRendering=!1,r=n.context.contextService.getDomElement(),i=n.context.config,a=i.width,c=i.height,n.context.contextService.resize(a,c),e.next=1,n.context.deviceContribution.createSwapChain(r);case 1:n.swapChain=e.sent,n.device=n.swapChain.getDevice(),n.renderHelper.setDevice(n.device),n.renderHelper.renderInstManager.disableSimpleMode(),n.swapChain.configureSwapChain(r.width,r.height),o.addEventListener(Fo.RESIZE,(function(){n.swapChain.configureSwapChain(r.width,r.height)})),n.batchManager.attach((0,u.Z)({device:n.device},t));case 2:case"end":return e.stop()}}),e)})))),r.hooks.destroy.tap(e.tag,(function(){n.renderHelper.destroy(),n.batchManager.destroy(),n.texturePool.destroy(),o.removeEventListener(Qi.MOUNTED,s),o.removeEventListener(Qi.UNMOUNTED,l),o.removeEventListener(Qi.ATTR_MODIFIED,h),o.removeEventListener(Qi.BOUNDS_CHANGED,d),n.device.destroy(),n.device.checkForLeaks(),a.disableRenderHooks=!1})),r.hooks.beginFrame.tap(e.tag,(function(e){var t,r=null==e?void 0:e.session,i=n.context.config,a=i.width,o=i.height;if(r){var s=r.renderState.baseLayer;s||(s=r.renderState.layers[0]),n.swapChain.configureSwapChain(s.framebufferWidth,s.framebufferHeight,s.framebuffer);var l=r.referenceSpace,u=e.getViewerPose(l);u&&u.views.forEach((function(e,t){var i=r.renderState.baseLayer.getViewport(e),l=v.fromValues.apply(v,(0,c.Z)(e.transform.matrix));l[12]*=a,l[13]*=o,l[14]*=500,l[12]+=a/2,l[13]-=o/2,l[14]+=250;var u=v.fromValues.apply(v,(0,c.Z)(e.projectionMatrix)),h=v.invert(v.create(),l);v.scale(h,h,f.fromValues(1,-1,1));var d=e.transform.position,p=d.x,g=d.y,m=d.z;n.cameras[t]={viewport:{x:i.x/s.framebufferWidth,y:i.y/s.framebufferHeight,width:i.width/s.framebufferWidth,height:i.height/s.framebufferHeight},projectionMatrix:u,viewMatrix:h,cameraPosition:[p,g,m],isOrtho:!1}}))}else{var h=n.context.camera;n.cameras=[{viewport:{x:0,y:0,width:1,height:1},projectionMatrix:h.getPerspective(),viewMatrix:h.getViewTransform(),cameraPosition:h.getPosition(),isOrtho:h.isOrtho()}]}var d,p=n.swapChain.getCanvas(),g=n.renderHelper.renderInstManager;if(n.builder=n.renderHelper.renderGraph.newGraphBuilder(),"transparent"===n.context.config.background)d=hs;else{var m=_n(n.context.config.background);d=n.context.config.background?cs(Number(m.r)/255*Number(m.alpha),Number(m.g)/255*Number(m.alpha),Number(m.b)/255*Number(m.alpha),Number(m.alpha)):fs}var y={backbufferWidth:p.width,backbufferHeight:p.height,antialiasingMode:ih.None},E=oh(wc.Color0,y,nh(d)),_=oh(wc.DepthStencil,y,rh),T=n.builder.createRenderTargetID(E,"Main Color"),R=n.builder.createRenderTargetID(_,"Main Depth");n.builder.pushPass((function(e){e.setDebugName("Main Render Pass"),e.attachRenderTargetID(wc.Color0,T),e.attachRenderTargetID(wc.DepthStencil,R),e.exec((function(e,t){n.cameras.forEach((function(r,i){var a=r.viewport,o=a.x,s=a.y,l=a.width,u=a.height,c=t.currentPass,h=c.viewportW,d=c.viewportH;e.setViewport(o*h,s*d,l*h,u*d),(0===i?n.renderLists.leftEye:n.renderLists.rightEye).drawOnPassRenderer(g.renderCache,e)}))}))})),null!==(t=n.options)&&void 0!==t&&t.enableFXAA&&function(e,t,n,r){e.pushPass((function(i){i.setDebugName("FXAA"),i.attachRenderTargetID(wc.Color0,r);var a=e.resolveRenderTarget(r);i.attachResolveTexture(a);var o=t.renderInstManager.newRenderInst();o.setUniformBuffer(t.uniformBuffer),o.setAllowSkippingIfPipelineNotReady(!1),o.setMegaStateFlags(Ps),o.setBindingLayout({numUniformBuffers:1,numSamplers:1}),o.drawPrimitives(3);var s=o.allocateUniformBuffer(0,4);Yc(o.mapUniformBufferF32(0),s,1/n.backbufferWidth,1/n.backbufferHeight);var l=new _h,u=t.renderCache.createProgramSimple(l);o.setProgram(u),ph||((ph=new mh(t.getDevice())).setVertexBuffer({bufferIndex:0,byteStride:8,stepMode:Ao.VERTEX,attributes:[{format:wo.F32_RG,bufferByteOffset:0,location:0}],data:new Float32Array([1,3,-3,-1,1,-1])}),ph.vertexCount=3,vh=t.getCache().createInputLayout(ph.inputLayoutDescriptor)),i.exec((function(e,n){Th[0].texture=n.getResolveTextureForID(a),o.setSamplerBindingsFromTextureMappings(Th),o.setVertexInput(vh,ph.vertexBuffers.map((function(e){return{buffer:e,byteOffset:0}})),null),o.drawOnPass(t.renderCache,e)}))}))}(n.builder,n.renderHelper,y,T),n.builder.resolveRenderTargetToExternalTexture(T,n.swapChain.getOnscreenTexture())})),r.hooks.endFrame.tap(e.tag,(function(e){var t=n.renderHelper.renderInstManager,r=n.context.config,i=r.width,a=r.height;if(n.cameras.forEach((function(e,r){var o=e.viewport,s=e.cameraPosition,l=e.viewMatrix,u=e.projectionMatrix,c=e.isOrtho,h=o.width,d=o.height,f=n.renderHelper.pushTemplateRenderInst();f.setBindingLayout({numUniformBuffers:2,numSamplers:0}),f.setMegaStateFlags(Os({depthWrite:!0,blendConstant:hs},{rgbBlendMode:mo.ADD,alphaBlendMode:mo.ADD,rgbBlendSrcFactor:go.SRC_ALPHA,alphaBlendSrcFactor:go.ONE,rgbBlendDstFactor:go.ONE_MINUS_SRC_ALPHA,alphaBlendDstFactor:go.ONE_MINUS_SRC_ALPHA})),f.setUniforms(0,[{name:Rh.PROJECTION_MATRIX,value:u},{name:Rh.VIEW_MATRIX,value:l},{name:Rh.CAMERA_POSITION,value:s},{name:Rh.DEVICE_PIXEL_RATIO,value:n.context.contextService.getDPR()},{name:Rh.VIEWPORT,value:[i*h,a*d]},{name:Rh.IS_ORTHO,value:c?1:0},{name:Rh.IS_PICKING,value:0}]),n.batchManager.render(0===r?n.renderLists.leftEye:n.renderLists.rightEye),t.popTemplateRenderInst()})),n.renderHelper.prepareToRender(),n.renderHelper.renderGraph.execute(),t.resetRenderInsts(),n.enableCapture&&n.resolveCapturePromise){var o=n.captureOptions,s=o.type,l=o.encoderOptions,u=n.context.contextService.getDomElement().toDataURL(s,l);n.resolveCapturePromise(u),n.enableCapture=!1,n.captureOptions=void 0,n.resolveCapturePromise=void 0}}))}},{key:"loadTexture",value:function(e,t,n){return this.texturePool.getOrCreateTexture(this.device,e,t,(function(e){n&&n(e)}))}},{key:"toDataURL",value:(t=(0,Go.Z)((0,Uo.Z)().mark((function e(t){var n=this;return(0,Uo.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.enableCapture=!0,this.captureOptions=t,this.capturePromise=new Promise((function(e){n.resolveCapturePromise=function(t){e(t)}})),e.abrupt("return",this.capturePromise);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]);var t}();Sh.tag="RenderGraph";var Ah=function(){function e(t,n,r,i){(0,o.Z)(this,e),this.renderHelper=t,this.renderGraphPlugin=n,this.pickingIdGenerator=r,this.batchManager=i}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this;this.context=t;var r=t.renderingService,i=t.renderingContext.root.ownerDocument.defaultView,a=function(e){var t=e.target;t.renderable3D||(t.renderable3D=new vc);var r=t.renderable3D,i=n.pickingIdGenerator.getId(t);r.pickingId=i,r.encodedPickingColor=n.pickingIdGenerator.encodePickingColor(i)},o=function(e){var t=e.target.renderable3D;t&&n.pickingIdGenerator.deleteById(t.pickingId)};r.hooks.init.tap(e.tag,(function(){i.addEventListener(Qi.MOUNTED,a),i.addEventListener(Qi.UNMOUNTED,o)})),r.hooks.destroy.tap(e.tag,(function(){i.removeEventListener(Qi.MOUNTED,a),i.removeEventListener(Qi.UNMOUNTED,o),n.pickingIdGenerator.reset()})),r.hooks.pickSync.tap(e.tag,(function(e){return n.pick(e)})),r.hooks.pick.tapPromise(e.tag,function(){var e=(0,Go.Z)((0,Uo.Z)().mark((function e(t){return(0,Uo.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.pick(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"pick",value:function(e){var t=e.topmost,n=e.position,r=n.viewportX,i=n.viewportY,a=this.context.contextService.getDPR(),o=this.context.config.width*a,s=this.context.config.height*a,l=r*a,u=i*a;if(!this.renderHelper.renderGraph||l>o||l<0||u>s||u<0)return e.picked=[],e;var c=this.pickByRectangleInDepth(new Se((0,S.Z)(Math.round(l),0,o-1),(0,S.Z)(Math.round(u),0,s-1),1,1),t?1:100);return e.picked=c,e}},{key:"pickByRectangleInDepth",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=null,r=1,i=[];do{if(!(n=this.pickByRectangle(e,n)))break;r++,i.push(n)}while(n&&r<=t);return t>1&&this.restorePickingColor(i),i}},{key:"restorePickingColor",value:function(e){var t=this;e.forEach((function(e){t.batchManager.updateAttribute(e,"pointerEvents",!0,!0)}))}},{key:"pickByRectangle",value:function(e,t){var n,r=this,i=this.renderGraphPlugin.getDevice(),a=this.renderGraphPlugin.getRenderLists(),o=this.renderHelper.renderInstManager,s=this.renderHelper.renderGraph.newGraphBuilder(),l=hs,c=this.context.camera,h=e.x,d=e.y,f=e.width,p=e.height,v={backbufferWidth:f,backbufferHeight:p,antialiasingMode:ih.None},g=oh(wc.Color0,v,nh(l)),m=s.createRenderTargetID(g,"Picking Color"),y=oh(wc.DepthStencil,v,rh),E=s.createRenderTargetID(y,"Picking Depth"),_=(0,u.Z)({},c.getView());this.renderHelper.renderGraph.renderTargetDeadPool.forEach((function(e){e.age=-1})),s.pushPass((function(e){e.setDebugName("Picking Pass"),e.attachRenderTargetID(wc.Color0,m),e.attachRenderTargetID(wc.DepthStencil,E),e.exec((function(e){a.picking.drawOnPassRenderer(o.renderCache,e)})),e.post((function(e){var t,a=e.getRenderTargetTexture(wc.Color0),o=i.createReadback();_&&_.enabled?c.setViewOffset(_.fullWidth,_.fullHeight,_.offsetX,_.offsetY,_.width,_.height):c.clearViewOffset(),c.setEnableUpdate(!0);try{t=o.readTextureSync(a,0,0,f,p,new Uint8Array(f*p*4))}catch(e){}var s=-1;if(!t||0===t[0]&&0===t[1]&&0===t[2]||(s=r.pickingIdGenerator.decodePickingColor(t)),s>-1){var l=r.pickingIdGenerator.getById(s);l&&l.isVisible()&&l.isInteractive()&&(n=l)}o.destroy()}))}));var T=this.renderHelper.pushTemplateRenderInst();T.setBindingLayout({numUniformBuffers:2,numSamplers:0}),T.setMegaStateFlags(Os({depthWrite:!0},{rgbBlendMode:mo.ADD,rgbBlendSrcFactor:go.ONE,rgbBlendDstFactor:go.ZERO,alphaBlendMode:mo.ADD,alphaBlendSrcFactor:go.ONE,alphaBlendDstFactor:go.ZERO}));var R=this.context.config,S=R.width,A=R.height,x=this.context.contextService.getDPR();return c.setEnableUpdate(!1),c.setViewOffset(S*x,A*x,h,A*x-d,f,p),T.setUniforms(0,[{name:Rh.PROJECTION_MATRIX,value:c.getPerspective()},{name:Rh.VIEW_MATRIX,value:c.getViewTransform()},{name:Rh.CAMERA_POSITION,value:c.getPosition()},{name:Rh.DEVICE_PIXEL_RATIO,value:this.context.contextService.getDPR()},{name:Rh.VIEWPORT,value:[f,p]},{name:Rh.IS_ORTHO,value:c.isOrtho()?1:0},{name:Rh.IS_PICKING,value:1}]),t&&this.batchManager.updateAttribute(t,"pointerEvents",!1,!0),this.batchManager.render(a.picking,!0),o.popTemplateRenderInst(),this.renderHelper.prepareToRender(),this.renderHelper.renderGraph.execute(),o.resetRenderInsts(),n}}])}();Ah.tag="WebGLPicker";var xh=5e-4,Ch=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.clipPathMeshCreated=!1}),[{key:"beforeUploadUBO",value:function(e,t){}},{key:"beforeInitMesh",value:function(e){}},{key:"afterInitMesh",value:function(e){}}])}();var Mh=function(e){return e.CHANGED="changed",e}({}),Nh=function(e){function t(e,n){var r;(0,o.Z)(this,t),(r=(0,s.Z)(this,t)).props={},r.meshes=[],r.defines={},r.uniforms={},r.uboBuffer=[],r.textures={},r.samplers=[],r.programDirty=!0,r.textureDirty=!0,r.geometryDirty=!0;var i=Ns(bs),a=i.cullMode,l=i.depthCompare,c=i.depthWrite,h=i.stencilFront,d=i.stencilBack,f=i.stencilWrite,p=i.frontFace,v=i.polygonOffset,g=i.attachmentsState;return r.device=e,r.props=(0,u.Z)({cullMode:a,depthTest:!0,depthCompare:l,depthWrite:c,stencilFront:h,stencilBack:d,stencilWrite:f,frontFace:p,polygonOffset:v,attachmentsState:g,dithering:!1,wireframe:!1,wireframeColor:"black",wireframeLineWidth:1,vertexShader:"",fragmentShader:""},n),r.compile(),r}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"cullMode",get:function(){return this.props.cullMode},set:function(e){this.props.cullMode=e}},{key:"frontFace",get:function(){return this.props.frontFace},set:function(e){this.props.frontFace=e}},{key:"blendConstant",get:function(){return this.props.blendConstant},set:function(e){this.props.blendConstant=e}},{key:"blendEquation",get:function(){return this.props.blendEquation},set:function(e){this.props.blendEquation=e}},{key:"blendEquationAlpha",get:function(){return this.props.blendEquationAlpha},set:function(e){this.props.blendEquationAlpha=e}},{key:"blendSrc",get:function(){return this.props.blendSrc},set:function(e){this.props.blendSrc=e}},{key:"blendDst",get:function(){return this.props.blendDst},set:function(e){this.props.blendDst=e}},{key:"blendSrcAlpha",get:function(){return this.props.blendSrcAlpha},set:function(e){this.props.blendSrcAlpha=e}},{key:"blendDstAlpha",get:function(){return this.props.blendDstAlpha},set:function(e){this.props.blendDstAlpha=e}},{key:"depthCompare",get:function(){return this.props.depthCompare},set:function(e){this.props.depthCompare=e}},{key:"depthTest",get:function(){return this.props.depthTest},set:function(e){this.props.depthTest=e}},{key:"depthWrite",get:function(){return this.props.depthWrite},set:function(e){this.props.depthWrite=e}},{key:"stencilFront",get:function(){return this.props.stencilFront},set:function(e){this.props.stencilFront=e}},{key:"stencilBack",get:function(){return this.props.stencilBack},set:function(e){this.props.stencilBack=e}},{key:"stencilWrite",get:function(){return this.props.stencilWrite},set:function(e){this.props.stencilWrite=e}},{key:"stencilRef",get:function(){return this.props.stencilRef},set:function(e){this.props.stencilRef=e}},{key:"polygonOffset",get:function(){return this.props.polygonOffset},set:function(e){this.props.polygonOffset=e}},{key:"dithering",get:function(){return this.props.dithering},set:function(e){this.props.dithering=e}},{key:"wireframe",get:function(){return this.props.wireframe},set:function(e){this.props.wireframe!==e&&(this.geometryDirty=!0,this.programDirty=!0,this.props.wireframe=e,this.dispatchMutationEvent()),this.defines.USE_WIREFRAME=!!e}},{key:"wireframeColor",get:function(){return this.props.wireframeColor},set:function(e){this.props.wireframeColor=e}},{key:"wireframeLineWidth",get:function(){return this.props.wireframeLineWidth},set:function(e){this.props.wireframeLineWidth=e}},{key:"vertexShader",get:function(){return this.props.vertexShader},set:function(e){this.props.vertexShader!==e&&(this.programDirty=!0,this.props.vertexShader=e,this.compile())}},{key:"fragmentShader",get:function(){return this.props.fragmentShader},set:function(e){this.props.fragmentShader!==e&&(this.programDirty=!0,this.props.fragmentShader=e,this.compile())}},{key:"compile",value:function(){var e=this;this.props.fragmentShader.replace(/^\s*uniform\s*sampler2D\s*(.*)\s*;$/gm,(function(t,n){return e.samplers.push(n),""})),this.uniformNames=function(e){var t=[],n=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,(function(e,t,r){var i=[];return r.trim().replace("\r\n","\n").split("\n").forEach((function(e){var t=(0,qo.__read)(e.trim().split(/\s+/),2),n=t[0],r=t[1];i.push({type:n.trim(),name:r.replace(";","").trim()})})),n.push({type:t.trim(),uniforms:i}),""})),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,(function(e,r){return r.trim().replace("\r\n","\n").split("\n").forEach((function(e){var r=e.trim().split(" "),i=r[0]||"",a=r[1]||"",o=a.indexOf("[")>-1;if(a=a.replace(";","").replace("[","").trim(),!i.startsWith("#")){if(i){var s=n.find((function(e){return i===e.type}));if(s)if(o)for(var l=function(e){s.uniforms.forEach((function(n){t.push("".concat(a,"[").concat(e,"].").concat(n.name))}))},u=0;u<5;u++)l(u);else s.uniforms.forEach((function(e){t.push("".concat(a,".").concat(e.name))}))}a&&t.push(a)}})),""})),t}(this.props.fragmentShader)}},{key:"setUniforms",value:function(e){var t=this,n=!1;Object.keys(e).forEach((function(r){var i,a=e[r],o=t.textures[r];o&&o!==a&&(t.textureDirty=!0),(i=a)&&i.type?(t.textures[r]=a,t.textureDirty=!0,a.on(xo.LOADED,(function(){t.dispatchMutationEvent()}))):(t.uniforms[r]=a,n=!0),(0,T.Z)(e[r])&&(delete t.textures[r],delete t.uniforms[r])})),n&&this.dispatchMutationEvent()}},{key:"dispatchMutationEvent",value:function(){this.emit(Mh.CHANGED)}}])}(d.Z),kh=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t,[e,(0,u.Z)({},n)])).defines=(0,u.Z)((0,u.Z)({},r.defines),{},{USE_UV:!1,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1}),r}return(0,l.Z)(t,e),(0,a.Z)(t)}(Nh);function bh(e){var t={};return Object.keys(e).forEach((function(n){"number"==typeof e[n]&&(t[n]=e[n])})),t}var Ph=function(e){return Object.fromEntries(Object.entries(e).filter((function(e){var t=(0,h.Z)(e,2);return t[0],void 0!==t[1]})))};function Oh(e,t){return 256*(e=(0,S.Z)(Math.floor(e),0,255))+(t=(0,S.Z)(Math.floor(t),0,255))}var Ih=1,Dh="FillTextureMapping",Lh=function(e){return e[e.MODEL_MATRIX=0]="MODEL_MATRIX",e[e.PACKED_COLOR=1]="PACKED_COLOR",e[e.PACKED_STYLE=2]="PACKED_STYLE",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.POSITION=4]="POSITION",e[e.NORMAL=5]="NORMAL",e[e.UV=6]="UV",e[e.BARYCENTRIC=7]="BARYCENTRIC",e[e.MAX=8]="MAX",e}({}),Bh=function(e){return e[e.MODEL_MATRIX0=0]="MODEL_MATRIX0",e[e.MODEL_MATRIX1=1]="MODEL_MATRIX1",e[e.MODEL_MATRIX2=2]="MODEL_MATRIX2",e[e.MODEL_MATRIX3=3]="MODEL_MATRIX3",e[e.PACKED_COLOR=4]="PACKED_COLOR",e[e.PACKED_STYLE1=5]="PACKED_STYLE1",e[e.PACKED_STYLE2=6]="PACKED_STYLE2",e[e.PICKING_COLOR=7]="PICKING_COLOR",e[e.POSITION=8]="POSITION",e[e.NORMAL=9]="NORMAL",e[e.UV=10]="UV",e[e.BARYCENTRIC=11]="BARYCENTRIC",e[e.MAX=12]="MAX",e}({}),wh=function(){return(0,a.Z)((function e(t,n,r,i,a){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,l=arguments.length>6?arguments[6]:void 0;(0,o.Z)(this,e),this.id=Ih++,this.gradientAttributeName="fill",this.objects=[],this.program=new Tc,this.geometryDirty=!0,this.materialDirty=!0,this.textureMappings=[],this.divisor=1,this.mergeXYZIntoModelMatrix=!1,this.checkNodeName=!0,this.maxInstances=1/0,this.inited=!1,this.renderHelper=t,this.texturePool=n,this.lightPool=r,this.drawcallCtors=a,this.index=s,this.context=l}),[{key:"instance",get:function(){return this.objects[0]}},{key:"init",value:function(){this.inited||(this.renderer.beforeInitMesh(this),this.material=new kh(this.context.device),this.material.defines=(0,u.Z)((0,u.Z)({},bh(Bh)),this.material.defines),this.geometry=new mh(this.context.device),this.geometry.meshes=this.objects,this.material.meshes=this.objects,this.observeGeometryChanged(),this.observeMaterialChanged(),this.inited=!0,this.renderer.afterInitMesh(this))}},{key:"observeGeometryChanged",value:function(){var e=this;this.geometry.on(gh.CHANGED,(function(){e.geometry.meshes.forEach((function(e){e.renderable.dirty=!0})),e.context.renderingService.dirtify()}))}},{key:"observeMaterialChanged",value:function(){var e=this;this.material.on(Mh.CHANGED,(function(){e.material.meshes.forEach((function(e){e.renderable.dirty=!0})),e.context.renderingService.dirtify()}))}},{key:"shouldMergeColor",value:function(e,t,n){var r=e.parsedStyle[n],i=t.parsedStyle[n];return!r&&!i||(!(!En(r)||!En(i))||(!(!yn(r)||!yn(i)||r.image!==i.image)||!(!Array.isArray(r)||!Array.isArray(i)||e.style[n]!==t.style[n])))}},{key:"shouldMerge",value:function(e,t){return!this.instance||(!this.checkNodeName||this.instance.nodeName===e.nodeName)&&(!e.parsedStyle.clipPath&&!(!this.shouldMergeColor(this.instance,e,"fill")||!this.shouldMergeColor(this.instance,e,"stroke")))}},{key:"createGeometry",value:function(e){var t,n,r=this,i=v.create(),a=v.create(),o=[],s=[],l=[],u=[],h=this.divisor,d=(null===(t=e[0])||void 0===t?void 0:t.nodeName)===ue.CIRCLE||(null===(n=e[0])||void 0===n?void 0:n.nodeName)===ue.ELLIPSE?.5:0;e.forEach((function(e){var t,n=e.parsedStyle,h=n.fill,p=n.stroke,g=n.opacity,m=void 0===g?1:g,y=n.fillOpacity,E=void 0===y?1:y,_=n.strokeOpacity,T=void 0===_?1:_,R=n.lineWidth,S=void 0===R?1:R,A=n.visibility,x=n.increasedLineWidthForHitTesting,C=void 0===x?0:x,M=[0,0,0,0];En(h)&&(M=[Number(h.r),Number(h.g),Number(h.b),255*Number(h.alpha)]);var N=[0,0,0,0];En(p)&&(N=[Number(p.r),Number(p.g),Number(p.b),255*Number(p.alpha)]),v.mul(a,r.context.camera.getViewTransform(),i);var k=e.isInteractive()&&(null===(t=e.renderable3D)||void 0===t?void 0:t.encodedPickingColor)||[0,0,0];if(r.mergeXYZIntoModelMatrix){var b=e.parsedStyle,P=b.x,O=b.y,I=b.z;v.mul(i,e.getWorldTransform(),v.fromTranslation(i,f.fromValues(P,O,I)))}else v.copy(i,e.getWorldTransform());o.push.apply(o,(0,c.Z)(i)),s.push(Oh(M[0],M[1]),Oh(M[2],M[3]),Oh(N[0],N[1]),Oh(N[2],N[3])),l.push(m,E,T,S,"hidden"!==A?1:0,d,d,C),u.push.apply(u,(0,c.Z)(k).concat([e.sortable.renderOrder*xh]))})),this.geometry.instancedCount=e.length,this.geometry.setVertexBuffer({bufferIndex:Lh.MODEL_MATRIX,byteStride:64,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGBA,bufferByteOffset:0,location:Bh.MODEL_MATRIX0,divisor:h},{format:wo.F32_RGBA,bufferByteOffset:16,location:Bh.MODEL_MATRIX1,divisor:h},{format:wo.F32_RGBA,bufferByteOffset:32,location:Bh.MODEL_MATRIX2,divisor:h},{format:wo.F32_RGBA,bufferByteOffset:48,location:Bh.MODEL_MATRIX3,divisor:h}],data:new Float32Array(o)}),this.geometry.setVertexBuffer({bufferIndex:Lh.PACKED_COLOR,byteStride:16,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGBA,bufferByteOffset:0,location:Bh.PACKED_COLOR,divisor:h}],data:new Float32Array(s)}),this.geometry.setVertexBuffer({bufferIndex:Lh.PACKED_STYLE,byteStride:32,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGBA,bufferByteOffset:0,location:Bh.PACKED_STYLE1,divisor:h},{format:wo.F32_RGBA,bufferByteOffset:16,location:Bh.PACKED_STYLE2,divisor:h}],data:new Float32Array(l)}),this.geometry.setVertexBuffer({bufferIndex:Lh.PICKING_COLOR,byteStride:16,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGBA,bufferByteOffset:0,location:Bh.PICKING_COLOR,divisor:h}],data:new Float32Array(u)})}},{key:"destroy",value:function(){this.geometry&&this.geometry.destroy()}},{key:"applyRenderInst",value:function(e,t){var n=this,r=!!this.lightPool.getFog();this.clipPathTarget||this.clipPath?this.clipPathTarget?(this.material.stencilWrite=!0,this.material.depthWrite=!1,this.material.stencilFront={compare:fo.ALWAYS,passOp:ko.REPLACE},this.material.stencilBack={compare:fo.ALWAYS,passOp:ko.REPLACE}):(this.material.stencilWrite=!1,this.material.depthWrite=!0,this.material.stencilFront={compare:fo.EQUAL,passOp:ko.KEEP},this.material.stencilBack={compare:fo.EQUAL,passOp:ko.KEEP}):this.material.stencilWrite=!1,(this.materialDirty||this.material.programDirty)&&this.createMaterial(t);var i,a,o,s,l=(0,u.Z)({},this.material.defines);if(this.material.defines.USE_FOG=r,this.material.defines=(0,u.Z)((0,u.Z)((0,u.Z)({},this.lightPool.getDefines()),this.material.defines),this.renderHelper.getDefines()),this.material.textureDirty){this.textureMappings=[];var c=this.createFillGradientTextureMapping(t);c&&this.textureMappings.push(c),Object.keys(this.material.textures).sort((function(e,t){return n.material.samplers.indexOf(e)-n.material.samplers.indexOf(t)})).forEach((function(e){var t=new sh;t.name=e,t.texture=n.material.textures[e],n.context.device.setResourceName(t.texture,"Material Texture ".concat(e)),t.sampler=n.renderHelper.getCache().createSampler({addressModeU:yo.CLAMP_TO_EDGE,addressModeV:yo.CLAMP_TO_EDGE,minFilter:Eo.POINT,magFilter:Eo.BILINEAR,mipmapFilter:_o.LINEAR,lodMinClamp:0,lodMaxClamp:0}),n.textureMappings.push(t)})),this.textureMappings.length?(this.material.defines.USE_UV=!0,this.material.defines.USE_MAP=!0):(this.material.defines.USE_UV=!1,this.material.defines.USE_MAP=!1),this.material.textureDirty=!1}((i=l,a=this.material.defines,o=Object.keys(i),s=Object.keys(a),!(o.length===s.length&&o.every((function(e){return i[e]===a[e]}))))||this.material.programDirty||this.materialDirty)&&(this.material.defines=(0,u.Z)((0,u.Z)({},this.material.defines),bh(Bh)),Object.keys(this.material.defines).forEach((function(e){var t=n.material.defines[e];"boolean"==typeof t?n.program.setDefineBool(e,t):n.program.setDefineString(e,"".concat(t))})),this.program.vert=this.material.vertexShader,this.program.frag=this.material.fragmentShader,this.material.programDirty=!1,this.materialDirty=!1),this.material.geometryDirty&&(this.geometryDirty=!0,this.material.geometryDirty=!1),(this.geometryDirty||this.geometry.dirty)&&(this.geometry&&this.geometry.destroy(),this.createGeometry(t),this.material.wireframe&&this.generateWireframe(this.geometry),this.geometryDirty=!1,this.geometry.dirty=!1);var h=this.renderHelper.getCache().createProgramSimple(this.program),d=this.renderHelper.getCache().createInputLayout((0,u.Z)((0,u.Z)({},this.geometry.inputLayoutDescriptor),{},{program:h})),f=!!this.geometry.indexBuffer;e.renderPipelineDescriptor.topology=this.geometry.drawMode,e.setProgram(h),e.setVertexInput(d,this.geometry.vertexBuffers.filter((function(e){return!!e})).map((function(e){return{buffer:e,byteOffset:0}})),f?{buffer:this.geometry.indexBuffer,offset:0}:null),this.renderer.beforeUploadUBO(e,this),this.uploadUBO(e),f?e.drawIndexesInstanced(this.geometry.vertexCount,this.geometry.instancedCount,this.geometry.indexStart):e.drawPrimitives(this.geometry.vertexCount,this.geometry.primitiveStart),e.sortKey=Hc(Xc.OPAQUE,t[0].sortable.renderOrder)}},{key:"updateBatchedAttribute",value:function(e,t,n,r){var i=this;if(0!==e.length){if("fill"===n||"stroke"===n){var a=[];e.forEach((function(e){var t=e.parsedStyle,n=t.fill,r=t.stroke,i=[0,0,0,0];En(n)&&(i=[Number(n.r),Number(n.g),Number(n.b),255*Number(n.alpha)]);var o=[0,0,0,0];En(r)&&(o=[Number(r.r),Number(r.g),Number(r.b),255*Number(r.alpha)]),a.push(Oh(i[0],i[1]),Oh(i[2],i[3]),Oh(o[0],o[1]),Oh(o[2],o[3]))})),this.geometry.updateVertexBuffer(Lh.PACKED_COLOR,Bh.PACKED_COLOR,t,new Uint8Array(new Float32Array(a).buffer));var o=this.instance.parsedStyle.fill,s=this.textureMappings.findIndex((function(e){return e.name===Dh}));if(En(o))s>=0&&(this.textureMappings.splice(s,-1),this.material.textureDirty=!0);else{var l=this.createFillGradientTextureMapping([this.instance]);s>=0&&this.textureMappings.splice(s,1,l),this.material.textureDirty=!0}}else if(["opacity","fillOpacity","strokeOpacity","lineWidth","visibility","anchor","increasedLineWidthForHitTesting"].indexOf(n)>-1){var u,h,d=[],p=(null===(u=e[0])||void 0===u?void 0:u.nodeName)===ue.CIRCLE||(null===(h=e[0])||void 0===h?void 0:h.nodeName)===ue.ELLIPSE?.5:0;e.forEach((function(e){var t=e.parsedStyle,n=t.opacity,r=void 0===n?1:n,i=t.fillOpacity,a=void 0===i?1:i,o=t.strokeOpacity,s=void 0===o?1:o,l=t.lineWidth,u=void 0===l?1:l,c=t.visibility,h=t.increasedLineWidthForHitTesting,f=void 0===h?0:h;d.push(r,a,s,u,"hidden"!==c?1:0,p,p,f)})),this.geometry.updateVertexBuffer(Lh.PACKED_STYLE,Bh.PACKED_STYLE1,t,new Uint8Array(new Float32Array(d).buffer))}else if("modelMatrix"===n||this.mergeXYZIntoModelMatrix&&("x"===n||"y"===n||"z"===n)){var g=[],m=v.create();e.forEach((function(e){if(i.mergeXYZIntoModelMatrix){var t=e.parsedStyle,n=t.x,r=t.y,a=t.z;v.mul(m,e.getWorldTransform(),v.fromTranslation(m,f.fromValues(n,r,a)))}else v.copy(m,e.getWorldTransform());g.push.apply(g,(0,c.Z)(m))})),this.geometry.updateVertexBuffer(Lh.MODEL_MATRIX,Bh.MODEL_MATRIX0,t,new Uint8Array(new Float32Array(g).buffer))}else if("pointerEvents"===n){var y=[];e.forEach((function(e){var t,n=r&&e.isInteractive()&&(null===(t=e.renderable3D)||void 0===t?void 0:t.encodedPickingColor)||[0,0,0];y.push.apply(y,(0,c.Z)(n).concat([e.sortable.renderOrder*xh]))})),this.geometry.updateVertexBuffer(Lh.PICKING_COLOR,Bh.PICKING_COLOR,t,new Uint8Array(new Float32Array(y).buffer))}}}},{key:"updateAttribute",value:function(e,t,n,r){"clipPath"===n&&this.clipPath&&(this.geometryDirty=!0),!0===this.geometryDirty&&0!==this.objects.length&&(this.geometry&&this.geometry.destroy(),this.createGeometry(this.objects),this.geometryDirty=!1)}},{key:"changeRenderOrder",value:function(e,t){var n,r=this.objects.indexOf(e),i=e.isInteractive()&&(null===(n=e.renderable3D)||void 0===n?void 0:n.encodedPickingColor)||[0,0,0];this.geometry.updateVertexBuffer(Lh.PICKING_COLOR,Bh.PICKING_COLOR,r,new Uint8Array(new Float32Array([].concat((0,c.Z)(i),[t*xh])).buffer))}},{key:"generateWireframe",value:function(e){for(var t=e.indices,n=e.indices.length,r=e.vertices.map((function(e){return e.slice()})),i=Lh.PICKING_COLOR;i<e.vertexBuffers.length;i++){var a=e.inputLayoutDescriptor.vertexBufferDescriptors[i].arrayStride;e.vertices[i]=new Float32Array(a/4*n)}for(var o=0,s=new Uint32Array(n),l=0;l<n;l++){for(var u=t[l],c=1;c<e.vertices.length;c++)for(var h=e.inputLayoutDescriptor.vertexBufferDescriptors[c].arrayStride/4,d=0;d<h;d++)e.vertices[c][o*h+d]=r[c][u*h+d];s[l]=o,o++}for(var f=Lh.PICKING_COLOR+1;f<e.vertexBuffers.length;f++){var p=e.inputLayoutDescriptor.vertexBufferDescriptors[f],v=p.stepMode,g=p.arrayStride,m=e.inputLayoutDescriptor.vertexBufferDescriptors[f].attributes[0];if(m){var y=m.shaderLocation,E=m.offset,_=m.format,T=m.divisor;e.setVertexBuffer({bufferIndex:f,byteStride:g,stepMode:v,attributes:[{format:_,bufferByteOffset:E,location:y,divisor:T}],data:e.vertices[f]})}}for(var R=new Float32Array(3*n),S=0;S<n;)for(var A=0;A<3;A++){R[3*s[S++]+A]=1}e.setVertexBuffer({bufferIndex:Lh.BARYCENTRIC,byteStride:12,stepMode:Ao.VERTEX,attributes:[{format:wo.F32_RGB,bufferByteOffset:0,location:Number(Bh.BARYCENTRIC)}],data:R}),e.setIndexBuffer(s)}},{key:"beforeUploadUBO",value:function(e,t){}},{key:"uploadUBO",value:function(e){var t,n=this,r=this.material,i=this.lightPool.getAllLights(),a=this.lightPool.getFog(),o=!!a,s=null!==(t=r.defines.USE_LIGHT)&&void 0!==t?t:!!i.length,l=r.defines.USE_WIREFRAME,c=[];if(l){var h=_n(r.wireframeColor);c.push({name:"u_WireframeLineColor",value:[Number(h.r)/255,Number(h.g)/255,Number(h.b)/255]}),c.push({name:"u_WireframeLineWidth",value:r.wireframeLineWidth})}if(o&&this.uploadFog(c,a),this.uploadMaterial(c,r),s){var d={};i.forEach((function(e){d[e.define]||(d[e.define]=-1),d[e.define]++,e.uploadUBO(c,d[e.define])}))}c.sort((function(e,t){return n.material.uniformNames.indexOf(e.name)-n.material.uniformNames.indexOf(t.name)})),e.setUniforms(1,c);var f=r.depthCompare,p=r.depthWrite,v=r.stencilFront,g=r.stencilBack,m=r.stencilWrite,y=r.stencilRef,E=r.cullMode,_=r.frontFace,T=r.polygonOffset,R=r.blendConstant,S=r.blendEquation,A=r.blendEquationAlpha,x=r.blendSrc,C=r.blendDst,M=r.blendSrcAlpha,N=r.blendDstAlpha,k=Ph({blendConstant:R,depthCompare:f,depthWrite:p,stencilFront:v,stencilBack:g,stencilWrite:m,stencilRef:y,cullMode:E,frontFace:_,polygonOffset:T}),b=e.getMegaStateFlags().attachmentsState[0];e.setMegaStateFlags((0,u.Z)({attachmentsState:[{channelWriteMask:this.material.stencilWrite?No.NONE:No.ALL,rgbBlendState:(0,u.Z)((0,u.Z)({},b.rgbBlendState),Ph({blendMode:S,blendSrcFactor:x,blendDstFactor:C})),alphaBlendState:(0,u.Z)((0,u.Z)({},b.alphaBlendState),Ph({blendMode:A,blendSrcFactor:M,blendDstFactor:N}))}]},k)),e.setBindingLayout({numUniformBuffers:1,numSamplers:this.textureMappings.length}),e.setSamplerBindingsFromTextureMappings(this.textureMappings)}},{key:"uploadFog",value:function(e,t){var n=t.parsedStyle,r=n.type,i=n.fill,a=n.start,o=n.end,s=n.density;if(En(i)){var l=[Number(i.r)/255,Number(i.g)/255,Number(i.b)/255,Number(i.alpha)];e.push({name:"u_FogInfos",value:[r,a,o,s]}),e.push({name:"u_FogColor",value:l})}}},{key:"uploadMaterial",value:function(e,t){var n=Object.keys(t.uniforms).map((function(e){return{name:e,value:t.uniforms[e]}}));e.push.apply(e,(0,c.Z)(n))}},{key:"createFillGradientTextureMapping",value:function(e){var t,n=this,r=e[0],i=r.parsedStyle[this.gradientAttributeName];if(i&&(yn(i)||Array.isArray(i))){Array.isArray(i)?(this.program.setDefineBool("USE_PATTERN",!1),this.texturePool.getOrCreateGradient({gradients:i,width:128,height:128,instance:r})):yn(i)&&(this.program.setDefineBool("USE_PATTERN",!0),this.texturePool.getOrCreatePattern(i,r,(function(){e.forEach((function(e){e.renderable.dirty=!0})),n.material.textureDirty=!0}))),t=this.texturePool.getOrCreateCanvas();var a=this.texturePool.getOrCreateTexture(this.context.device,t,Qo(wo.U8_RGBA_NORM,1,1,1));if(a){var o=new sh;return o.name=Dh,o.texture=a,o.texture.on("loaded",(function(){e.forEach((function(e){e.renderable.dirty=!0})),n.material.textureDirty=!0})),this.context.device.setResourceName(o.texture,"Fill Texture".concat(this.id)),o.sampler=this.renderHelper.getCache().createSampler({addressModeU:yo.CLAMP_TO_EDGE,addressModeV:yo.CLAMP_TO_EDGE,minFilter:Eo.POINT,magFilter:Eo.BILINEAR,mipmapFilter:_o.LINEAR,lodMinClamp:0,lodMaxClamp:0}),o}}return null}}])}(),Fh=function(e){return e[e.PACKED_STYLE=Lh.POSITION+1]="PACKED_STYLE",e}(Fh||{}),Uh=function(e){return e[e.PACKED_STYLE3=Bh.MAX]="PACKED_STYLE3",e[e.EXTRUDE=1+e.PACKED_STYLE3]="EXTRUDE",e[e.SIZE=1+e.EXTRUDE]="SIZE",e}(Uh||{}),Gh=[ue.CIRCLE,ue.ELLIPSE,ue.RECT],Zh=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"shouldMerge",value:function(e,n){var r=(0,X.Z)(t,"shouldMerge",this,3)([e,n]);return!!r}},{key:"createMaterial",value:function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = EXTRUDE) in vec2 a_Extrude;\n// shape, radius, omitStroke, isBillboard\nlayout(location = PACKED_STYLE3) in vec3 a_StylePacked3;\nlayout(location = SIZE) in vec4 a_Size;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nout vec2 v_Data;\nout vec2 v_Radius;\nout vec3 v_StylePacked3;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  float strokeWidth;\n  if (u_IsPicking > 0.5) {\n    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    strokeWidth = u_StrokeWidth;\n  }\n\n  bool omitStroke = a_StylePacked3.z == 1.0;\n  vec2 radius = a_Size.xy + vec2(omitStroke ? 0.0 : strokeWidth / 2.0);\n  vec2 offset = (a_Extrude + vec2(1.0) - 2.0 * u_Anchor.xy) * a_Size.xy + a_Extrude * vec2(omitStroke ? 0.0 : strokeWidth / 2.0);\n\n  bool isBillboard = a_Size.z > 0.5;\n  if (isBillboard) {\n    float rotation = 0.0;\n    bool isSizeAttenuation = a_Size.w > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, a_Position);\n  } else {\n    gl_Position = project(vec4(a_Position.xy + offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n  \n  v_Radius = radius;\n  v_Data = vec2(a_Extrude * radius / radius.y);\n  v_StylePacked3 = a_StylePacked3;\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec2 v_Data;\nin vec2 v_Radius;\nin vec3 v_StylePacked3;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\n/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\n// @see http://www.iquilezles.org/www/articles/ellipsoids/ellipsoids.htm\nfloat sdEllipsoidApproximated(vec2 p, vec2 r) {\n  float k0 = length(p / r);\n  float k1 = length(p / (r * r));\n  return k0 * (k0 - 1.0) / k1;\n}\n\n// @see https://www.shadertoy.com/view/4llXD7\nfloat sdRoundedBox(vec2 p, vec2 b, float r) {\n  p = abs(p) - b + r;\n  return length(max(p, 0.0)) + min(max(p.x, p.y), 0.0) - r;\n}\n\nvoid main() {\n  int shape = int(floor(v_StylePacked3.x + 0.5));\n\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  bool omitStroke = v_StylePacked3.z == 1.0;\n\n  vec2 r = (v_Radius - (omitStroke ? 0.0 : u_StrokeWidth)) / v_Radius.y;\n  float wh = v_Radius.x / v_Radius.y;\n\n  float dist = length(v_Data);\n  float antialiased_blur = -fwidth(dist);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'ellipse', 'rect'\n  if (shape == 0) {\n    outer_df = sdCircle(v_Data, 1.0);\n    inner_df = sdCircle(v_Data, r.x);\n  } else if (shape == 1) {\n    outer_df = sdEllipsoidApproximated(v_Data, vec2(wh, 1.0));\n    inner_df = sdEllipsoidApproximated(v_Data, r);\n  } else if (shape == 2) {\n    bool useRadius = v_StylePacked3.y > epsilon;\n    outer_df = sdRoundedBox(v_Data, vec2(wh, 1.0), useRadius ? (v_StylePacked3.y + u_StrokeWidth / 2.0) / v_Radius.y : 0.0);\n    inner_df = sdRoundedBox(v_Data, r, useRadius ? (v_StylePacked3.y - u_StrokeWidth / 2.0) / v_Radius.y : 0.0);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n\n  float color_t = u_StrokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n\n  vec4 diffuseColor;\n  vec4 strokeColor;\n  if (u_IsPicking > 0.5) {\n    diffuseColor = vec4(u_PickingColor, 1.0);\n    strokeColor = vec4(u_PickingColor, 1.0);\n  } else {\n    diffuseColor = u_Color;\n    strokeColor = (u_StrokeColor == vec4(0) || omitStroke) ? vec4(0.0) : u_StrokeColor;\n  }\n\n  outputColor = mix(vec4(diffuseColor.rgb, diffuseColor.a * u_FillOpacity), strokeColor * u_StrokeOpacity, color_t);\n  outputColor.a = outputColor.a * u_Opacity * opacity_t;\n\n  if (outputColor.a < epsilon)\n    discard;\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n  }\n}",this.material.defines=(0,u.Z)((0,u.Z)({},this.material.defines),bh(Uh))}},{key:"createGeometry",value:function(e){var n=this;(0,X.Z)(t,"createGeometry",this,3)([e]);var r=[],i=[];e.forEach((function(e,t){var a=e,o=a.parsedStyle.radius,s=n.shouldOmitStroke(a.parsedStyle),l=n.getSize(e.parsedStyle,a.nodeName),u=n.getPosition(e.parsedStyle,a.nodeName);r.push.apply(r,(0,c.Z)(l).concat([a.parsedStyle.isBillboard?1:0,a.parsedStyle.isSizeAttenuation?1:0,Gh.indexOf(a.nodeName),o&&o[0]||0,s?1:0])),i.push.apply(i,(0,c.Z)(u))})),this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2])),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:Lh.UV,byteStride:16,stepMode:Ao.VERTEX,attributes:[{format:wo.F32_RG,bufferByteOffset:0,location:Uh.EXTRUDE},{format:wo.F32_RG,bufferByteOffset:8,location:Bh.UV}],data:new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1])}),this.geometry.setVertexBuffer({bufferIndex:Lh.POSITION,byteStride:12,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGB,bufferByteOffset:0,location:Bh.POSITION}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:Fh.PACKED_STYLE,byteStride:28,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGBA,bufferByteOffset:0,location:Uh.SIZE,divisor:1},{format:wo.F32_RGB,bufferByteOffset:16,location:Uh.PACKED_STYLE3,divisor:1}],data:new Float32Array(r)})}},{key:"updateAttribute",value:function(e,n,r,i){var a=this;if(0!==e.length)if((0,X.Z)(t,"updateAttribute",this,3)([e,n,r,i]),this.updateBatchedAttribute(e,n,r,i),"r"===r||"rx"===r||"ry"===r||"width"===r||"height"===r||"lineWidth"===r||"stroke"===r||"lineDash"===r||"strokeOpacity"===r||"radius"===r||"isBillboard"===r||"isSizeAttenuation"===r){var o=[];e.forEach((function(e){var t=e,n=a.shouldOmitStroke(t.parsedStyle),r=a.getSize(e.parsedStyle,e.nodeName),i=(0,h.Z)(r,2),s=[i[0],i[1]];o.push.apply(o,s.concat([t.parsedStyle.isBillboard?1:0,t.parsedStyle.isSizeAttenuation?1:0,Gh.indexOf(e.nodeName),e.parsedStyle.radius&&e.parsedStyle.radius[0]||0,n?1:0]))})),this.geometry.updateVertexBuffer(Fh.PACKED_STYLE,Uh.SIZE,n,new Uint8Array(new Float32Array(o).buffer))}else if("cx"===r||"cy"===r||"x"===r||"y"===r){var s=[];e.forEach((function(e){var t=a.getPosition(e.parsedStyle,e.nodeName),n=(0,h.Z)(t,2),r=n[0],i=n[1];s.push(r,i)})),this.geometry.updateVertexBuffer(Lh.POSITION,Bh.POSITION,n,new Uint8Array(new Float32Array(s).buffer))}}},{key:"getPosition",value:function(e,t){var n=[0,0,0];if(t===ue.CIRCLE||t===ue.ELLIPSE){var r=e,i=r.cx,a=void 0===i?0:i,o=r.cy,s=void 0===o?0:o,l=r.cz;n=[a,s,void 0===l?0:l]}else if(t===ue.RECT){var u=e,c=u.x,h=void 0===c?0:c,d=u.y,f=void 0===d?0:d,p=u.z;n=[h,f,void 0===p?0:p]}return n}},{key:"getSize",value:function(e,t){var n=[0,0];if(t===ue.CIRCLE){var r=e.r;n=[r,r]}else if(t===ue.ELLIPSE){var i=e;n=[i.rx,i.ry]}else if(t===ue.RECT){var a=e;n=[a.width/2,a.height/2]}return n}},{key:"shouldOmitStroke",value:function(e){var t=e.lineDash,n=e.stroke,r=e.strokeOpacity,i=n&&!n.isNone,a=t&&t.length&&t.every((function(e){return 0!==e}));return!i||i&&(a||r<1)}}])}(wh);function Vh(e,t,n,r,i,a){for(var o=i[i.length-3],s=i[i.length-2],l=null!=a?a:(0,S.Z)(ie(o,s,e,t,n,r,3)/10,8,100),u=0,c=0,h=1;h<=l;++h){var d=h/l;u=o+(e-o)*d,c=s+(t-s)*d,i.push(u+(e+(n-e)*d-u)*d,c+(t+(r-t)*d-c)*d,0)}}function Xh(e,t,n,r,i,a,o,s){var l=o[o.length-3],u=o[o.length-2];o.length-=3;var c=null!=s?s:(0,S.Z)(J(l,u,e,t,n,r,i,a,3)/10,8,100),h=0,d=0,f=0,p=0,v=0;o.push(l,u,0);for(var g=1,m=0;g<=c;++g)f=(d=(h=1-(m=g/c))*h)*h,v=(p=m*m)*m,o.push(f*l+3*d*m*e+3*h*p*n+v*i,f*u+3*d*m*t+3*h*p*r+v*a,0)}var Wh=1e20,Hh=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e);var r=t.fontSize,i=void 0===r?24:r,a=t.buffer,s=void 0===a?3:a,l=t.radius,u=void 0===l?8:l,c=t.cutoff,h=void 0===c?.25:c,d=t.fontFamily,f=void 0===d?"sans-serif":d,p=t.fontWeight,v=void 0===p?"normal":p,g=t.fontStyle,m=void 0===g?"normal":g,y=t.canvas;this.buffer=s,this.cutoff=h,this.radius=u;var E=this.size=i+4*s,_=n.offscreenCanvasCreator.getOrCreateCanvas(y);_.width=E,_.height=E;var T=n.offscreenCanvasCreator.getOrCreateContext(y,{willReadFrequently:!0});this.ctx=T,T.font="".concat(m," ").concat(v," ").concat(i,"px ").concat(f),T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}),[{key:"draw",value:function(e){var t=this.ctx.measureText(e),n=t.width,r=t.actualBoundingBoxAscent,i=t.actualBoundingBoxDescent,a=t.actualBoundingBoxLeft,o=t.actualBoundingBoxRight,s=Math.ceil(r),l=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-a))),u=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=l+2*this.buffer,h=u+2*this.buffer,d=Math.max(c*h,0),f=new Uint8ClampedArray(d),p={data:f,width:c,height:h,glyphWidth:l,glyphHeight:u,glyphTop:s,glyphLeft:0,glyphAdvance:n};if(0===l||0===u)return p;var v=this.ctx,g=this.buffer,m=this.gridInner,y=this.gridOuter;v.clearRect(g,g,l,u),v.fillText(e,g,g+s);var E=v.getImageData(g,g,l,u);y.fill(Wh,0,d),m.fill(0,0,d);for(var _=0;_<u;_++)for(var T=0;T<l;T++){var R=E.data[4*(_*l+T)+3]/255;if(0!==R){var S=(_+g)*c+T+g;if(1===R)y[S]=0,m[S]=Wh;else{var A=.5-R;y[S]=A>0?A*A:0,m[S]=A<0?A*A:0}}}Yh(y,0,0,c,h,c,this.f,this.v,this.z),Yh(m,g,g,l,u,c,this.f,this.v,this.z);for(var x=0;x<d;x++){var C=Math.sqrt(y[x])-Math.sqrt(m[x]);f[x]=Math.round(255-255*(C/this.radius+this.cutoff))}return p}}])}();function Yh(e,t,n,r,i,a,o,s,l){for(var u=t;u<t+r;u++)zh(e,n*a+u,a,i,o,s,l);for(var c=n;c<n+i;c++)zh(e,c*a+t,1,r,o,s,l)}function zh(e,t,n,r,i,a,o){a[0]=0,o[0]=-Wh,o[1]=Wh,i[0]=e[t];for(var s=1,l=0,u=0;s<r;s++){i[s]=e[t+s*n];var c=s*s;do{var h=a[l];u=(i[s]-i[h]+c-h*h)/(s-h)/2}while(u<=o[l]&&--l>-1);a[++l]=s,o[l]=u,o[l+1]=Wh}for(var d=0,f=0;d<r;d++){for(;o[f+1]<d;)f++;var p=a[f],v=d-p;e[t+d*n]=i[p]+v*v}}var Kh=function(e){return e[e.PACKED=Lh.POSITION+1]="PACKED",e[e.VERTEX_NUM=1+e.PACKED]="VERTEX_NUM",e[e.TRAVEL=1+e.VERTEX_NUM]="TRAVEL",e[e.DASH=1+e.TRAVEL]="DASH",e}(Kh||{}),jh=function(e){return e[e.PREV=Bh.POSITION]="PREV",e[e.POINT1=1+e.PREV]="POINT1",e[e.POINT2=1+e.POINT1]="POINT2",e[e.NEXT=1+e.POINT2]="NEXT",e[e.VERTEX_JOINT=1+e.NEXT]="VERTEX_JOINT",e[e.VERTEX_NUM=1+e.VERTEX_JOINT]="VERTEX_NUM",e[e.TRAVEL=1+e.VERTEX_NUM]="TRAVEL",e[e.DASH=1+e.TRAVEL]="DASH",e}(jh||{});function qh(e,t,n){return 4*(e?1:0)+2*(t?1:0)+(n?1:0)}function Qh(e){if(!(e.nodeName===ue.POLYLINE))return!1;var t=e.parsedStyle.points.points;return t.length&&!(0,T.Z)(t[0][2])}var $h=function(e){function t(e,n,r,i,a,l,u){var c;return(0,o.Z)(this,t),(c=(0,s.Z)(this,t,[e,n,r,i,a,l,u])).segmentNum=-1,c.renderHelper=e,c.texturePool=n,c.lightPool=r,c.segmentNum=c.calcSegmentNum(i),c.gradientAttributeName="stroke",c}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"calcSegmentNum",value:function(e){return ed(e,!1,12,this.calcSubpathIndex(e)).instancedCount}},{key:"calcSubpathIndex",value:function(e){if(e.nodeName===ue.PATH){var t=this.drawcallCtors.filter((function(e){return e===od})).length;return this.index-t}return 0}},{key:"shouldMerge",value:function(e,n){var r=(0,X.Z)(t,"shouldMerge",this,3)([e,n]);if(!r)return!1;if(this.index!==n)return!1;var i=this.calcSegmentNum(e);return this.segmentNum===i}},{key:"createMaterial",value:function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = PREV) in vec3 a_Prev;\nlayout(location = POINT1) in vec3 a_Point1;\nlayout(location = POINT2) in vec3 a_Point2;\nlayout(location = NEXT) in vec3 a_Next;\nlayout(location = VERTEX_JOINT) in float a_VertexJoint;\nlayout(location = VERTEX_NUM) in float a_VertexNum;\nlayout(location = TRAVEL) in float a_Travel;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\nlayout(location = DASH) in vec4 a_Dash;\nout vec4 v_Dash;\n\nconst float FILL = 1.0;\nconst float BEVEL = 4.0;\nconst float MITER = 8.0;\nconst float ROUND = 12.0;\nconst float JOINT_CAP_BUTT = 16.0;\nconst float JOINT_CAP_SQUARE = 18.0;\nconst float JOINT_CAP_ROUND = 20.0;\nconst float FILL_EXPAND = 24.0;\nconst float CAP_BUTT = 1.0;\nconst float CAP_SQUARE = 2.0;\nconst float CAP_ROUND = 3.0;\nconst float CAP_BUTT2 = 4.0;\n\nconst float u_Expand = 1.0;\nconst float u_MiterLimit = 5.0;\nconst float u_ScaleMode = 1.0;\nconst float u_Alignment = 0.5;\n\nout vec4 v_Distance;\nout vec4 v_Arc;\nout float v_Type;\nout float v_Travel;\nout float v_ScalingFactor;\n\nvec2 doBisect(\n  vec2 norm, float len, vec2 norm2, float len2, float dy, float inner\n) {\n  vec2 bisect = (norm + norm2) / 2.0;\n  bisect /= dot(norm, bisect);\n  vec2 shift = dy * bisect;\n  if (inner > 0.5) {\n    if (len < len2) {\n      if (abs(dy * (bisect.x * norm.y - bisect.y * norm.x)) > len) {\n        return dy * norm;\n      }\n    } else {\n      if (abs(dy * (bisect.x * norm2.y - bisect.y * norm2.x)) > len2) {\n        return dy * norm;\n      }\n    }\n  }\n  return dy * bisect;\n}\n\nvec2 clip2ScreenSpace(vec4 clip) {\n  return u_Viewport * (0.5 * clip.xy / clip.w + 0.5);\n}\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  v_Dash = a_Dash;\n\n  vec2 pointA;\n  vec2 pointB;\n  vec4 clip0;\n  vec4 clip1;\n\n  float compressed = a_Dash.w;\n  float is_billboard = floor(compressed / 4.0);\n  compressed -= is_billboard * 4.0;\n  float is_size_attenuation = floor(compressed / 2.0);\n  compressed -= is_size_attenuation * 2.0;\n  float is_3d_polyline = compressed;\n\n  bool isBillboard = is_billboard > 0.5;\n  bool isSizeAttenuation = is_size_attenuation > 0.5;\n  bool is3DPolyline = is_3d_polyline > 0.5;\n  if (isBillboard) {\n    clip0 = billboard(a_Point1.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0));\n    clip1 = billboard(a_Point2.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0));\n  } else if (is3DPolyline) {\n    clip0 = project(vec4(a_Point1, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    clip1 = project(vec4(a_Point2, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  if (isBillboard || is3DPolyline) {\n    pointA = clip2ScreenSpace(clip0);\n    pointB = clip2ScreenSpace(clip1);\n  } else {\n    pointA = (u_ModelMatrix * vec4(a_Point1, 1.0)).xy;\n    pointB = (u_ModelMatrix * vec4(a_Point2, 1.0)).xy;\n  }\n\n  vec2 xBasis = pointB - pointA;\n  float len = length(xBasis);\n  vec2 forward = xBasis / len;\n  vec2 norm = vec2(forward.y, -forward.x);\n\n  float type = a_VertexJoint;\n\n  float lineWidth;\n  if (u_IsPicking > 0.5) {\n    lineWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    lineWidth = u_StrokeWidth;\n  }\n\n  if (u_ScaleMode > 2.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(1.0, 0.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 1.5) {\n    lineWidth *= length(u_ModelMatrix * vec4(0.0, 1.0, 0.0, 0.0));\n  } else if (u_ScaleMode > 0.5) {\n    vec2 avgDiag = (u_ModelMatrix * vec4(1.0, 1.0, 0.0, 0.0)).xy;\n    lineWidth *= sqrt(dot(avgDiag, avgDiag) * 0.5);\n  }\n  float capType = floor(type / 32.0);\n  type -= capType * 32.0;\n  v_Arc = vec4(0.0);\n  lineWidth *= 0.5;\n  float lineAlignment = 2.0 * u_Alignment - 1.0;\n\n  vec2 pos;\n\n  if (capType == CAP_ROUND) {\n    if (a_VertexNum < 3.5) {\n      gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n      return;\n    }\n    type = JOINT_CAP_ROUND;\n    capType = 0.0;\n  }\n\n  if (type >= BEVEL) {\n    float dy = lineWidth + u_Expand;\n    float inner = 0.0;\n    if (a_VertexNum >= 1.5) {\n      dy = -dy;\n      inner = 1.0;\n    }\n\n    vec2 base, next, xBasis2, bisect;\n    float flag = 0.0;\n    float sign2 = 1.0;\n    if (a_VertexNum < 0.5 || a_VertexNum > 2.5 && a_VertexNum < 3.5) {\n      if (isBillboard) {\n        next = clip2ScreenSpace(billboard(a_Prev.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0)));\n      } else if (is3DPolyline) {\n        next = clip2ScreenSpace(project(vec4(a_Prev, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix));\n      } else {\n        next = (u_ModelMatrix * vec4(a_Prev, 1.0)).xy;\n      }\n\n      base = pointA;\n      flag = type - floor(type / 2.0) * 2.0;\n      sign2 = -1.0;\n    } else {\n      if (isBillboard) {\n        next = clip2ScreenSpace(billboard(a_Next.xy, 0.0, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0)));\n      } else if (is3DPolyline) {\n        next = clip2ScreenSpace(project(vec4(a_Next, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix));\n      } else {\n        next = (u_ModelMatrix * vec4(a_Next, 1.0)).xy;\n      }\n      \n      base = pointB;\n      if (type >= MITER && type < MITER + 3.5) {\n        flag = step(MITER + 1.5, type);\n        // check miter limit here?\n      }\n    }\n    xBasis2 = next - base;\n    float len2 = length(xBasis2);\n    vec2 norm2 = vec2(xBasis2.y, -xBasis2.x) / len2;\n    float D = norm.x * norm2.y - norm.y * norm2.x;\n    if (D < 0.0) {\n      inner = 1.0 - inner;\n    }\n    norm2 *= sign2;\n\n    if (abs(lineAlignment) > 0.01) {\n      float shift = lineWidth * lineAlignment;\n      pointA += norm * shift;\n      pointB += norm * shift;\n      if (abs(D) < 0.01) {\n        base += norm * shift;\n      } else {\n        base += doBisect(norm, len, norm2, len2, shift, 0.0);\n      }\n    }\n\n    float collinear = step(0.0, dot(norm, norm2));\n    v_Type = 0.0;\n    float dy2 = -1000.0;\n    float dy3 = -1000.0;\n    if (abs(D) < 0.01 && collinear < 0.5) {\n      if (type >= ROUND && type < ROUND + 1.5) {\n        type = JOINT_CAP_ROUND;\n      }\n      // TODO: BUTT here too\n    }\n\n    if (a_VertexNum < 3.5) {\n      if (abs(D) < 0.01) {\n        pos = dy * norm;\n      } else {\n        if (flag < 0.5 && inner < 0.5) {\n          pos = dy * norm;\n        } else {\n          pos = doBisect(norm, len, norm2, len2, dy, inner);\n        }\n      }\n      if (capType >= CAP_BUTT && capType < CAP_ROUND) {\n        float extra = step(CAP_SQUARE, capType) * lineWidth;\n        vec2 back = -forward;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          pos += back * (u_Expand + extra);\n          dy2 = u_Expand;\n        } else {\n          dy2 = dot(pos + base - pointA, back) - extra;\n        }\n      }\n      if (type >= JOINT_CAP_BUTT && type < JOINT_CAP_SQUARE + 0.5) {\n        float extra = step(JOINT_CAP_SQUARE, type) * lineWidth;\n        if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {\n          dy3 = dot(pos + base - pointB, forward) - extra;\n        } else {\n          pos += forward * (u_Expand + extra);\n          dy3 = u_Expand;\n          if (capType >= CAP_BUTT) {\n            dy2 -= u_Expand + extra;\n          }\n        }\n      }\n    } else if (type >= JOINT_CAP_ROUND && type < JOINT_CAP_ROUND + 1.5) {\n      if (inner > 0.5) {\n        dy = -dy;\n        inner = 0.0;\n      }\n      vec2 d2 = abs(dy) * forward;\n      if (a_VertexNum < 4.5) {\n        dy = -dy;\n        pos = dy * norm;\n      } else if (a_VertexNum < 5.5) {\n        pos = dy * norm;\n      } else if (a_VertexNum < 6.5) {\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n      } else {\n        dy = -dy;\n        pos = dy * norm + d2;\n        v_Arc.x = abs(dy);\n      }\n      dy2 = 0.0;\n      v_Arc.y = dy;\n      v_Arc.z = 0.0;\n      v_Arc.w = lineWidth;\n      v_Type = 3.0;\n    } else if (abs(D) < 0.01) {\n      pos = dy * norm;\n    } else {\n      if (type >= ROUND && type < ROUND + 1.5) {\n        if (inner > 0.5) {\n          dy = -dy;\n          inner = 0.0;\n        }\n        if (a_VertexNum < 4.5) {\n          pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n        } else if (a_VertexNum < 5.5) {\n          pos = dy * norm;\n        } else if (a_VertexNum > 7.5) {\n          pos = dy * norm2;\n        } else {\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          float d2 = abs(dy);\n          if (length(pos) > abs(dy) * 1.5) {\n            if (a_VertexNum < 6.5) {\n              pos.x = dy * norm.x - d2 * norm.y;\n              pos.y = dy * norm.y + d2 * norm.x;\n            } else {\n              pos.x = dy * norm2.x + d2 * norm2.y;\n              pos.y = dy * norm2.y - d2 * norm2.x;\n            }\n          }\n        }\n        vec2 norm3 = normalize(norm + norm2);\n        float sign = step(0.0, dy) * 2.0 - 1.0;\n        v_Arc.x = sign * dot(pos, norm3);\n        v_Arc.y = pos.x * norm3.y - pos.y * norm3.x;\n        v_Arc.z = dot(norm, norm3) * lineWidth;\n        v_Arc.w = lineWidth;\n        dy = -sign * dot(pos, norm);\n        dy2 = -sign * dot(pos, norm2);\n        dy3 = v_Arc.z - v_Arc.x;\n        v_Type = 3.0;\n      } else {\n        float hit = 0.0;\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (dot(norm, norm2) > 0.0) {\n            type = MITER;\n          }\n        }\n        if (type >= MITER && type < MITER + 3.5) {\n          if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n          }\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          pos = doBisect(norm, len, norm2, len2, dy, 0.0);\n          if (length(pos) > abs(dy) * u_MiterLimit) {\n            type = BEVEL;\n          } else {\n            if (a_VertexNum < 4.5) {\n              dy = -dy;\n              pos = doBisect(norm, len, norm2, len2, dy, 1.0);\n            } else if (a_VertexNum < 5.5) {\n              pos = dy * norm;\n            } else if (a_VertexNum > 6.5) {\n              pos = dy * norm2;\n            }\n            v_Type = 1.0;\n            dy = -sign * dot(pos, norm);\n            dy2 = -sign * dot(pos, norm2);\n            hit = 1.0;\n          }\n        }\n        if (type >= BEVEL && type < BEVEL + 1.5) {\n          if (inner > 0.5) {\n            dy = -dy;\n            inner = 0.0;\n          }\n          float d2 = abs(dy);\n          vec2 pos3 = vec2(dy * norm.x - d2 * norm.y, dy * norm.y + d2 * norm.x);\n          vec2 pos4 = vec2(dy * norm2.x + d2 * norm2.y, dy * norm2.y - d2 * norm2.x);\n          if (a_VertexNum < 4.5) {\n            pos = doBisect(norm, len, norm2, len2, -dy, 1.0);\n          } else if (a_VertexNum < 5.5) {\n            pos = dy * norm;\n          } else if (a_VertexNum > 7.5) {\n            pos = dy * norm2;\n          } else {\n            if (a_VertexNum < 6.5) {\n              pos = pos3;\n            } else {\n              pos = pos4;\n            }\n          }\n          vec2 norm3 = normalize(norm + norm2);\n          float sign = step(0.0, dy) * 2.0 - 1.0;\n          dy = -sign * dot(pos, norm);\n          dy2 = -sign * dot(pos, norm2);\n          dy3 = (-sign * dot(pos, norm3)) + lineWidth;\n          v_Type = 4.0;\n          hit = 1.0;\n        }\n        if (hit < 0.5) {\n          gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n          return;\n        }\n      }\n    }\n    pos += base;\n    v_Distance = vec4(dy, dy2, dy3, lineWidth) * u_DevicePixelRatio;\n    v_Arc = v_Arc * u_DevicePixelRatio;\n    v_Travel = a_Travel + dot(pos - pointA, vec2(-norm.y, norm.x));\n  }\n\n  v_ScalingFactor = sqrt(u_ModelMatrix[0][0] * u_ModelMatrix[0][0] + u_ModelMatrix[0][1] * u_ModelMatrix[0][1] + u_ModelMatrix[0][2] * u_ModelMatrix[0][2]);\n\n  if (isBillboard || is3DPolyline) {\n    vec4 clip = mix(clip0, clip1, 0.5);\n    gl_Position = vec4(clip.w * (2.0 * pos / u_Viewport - 1.0), clip.z, clip.w);\n  } else {\n    gl_Position = u_ProjectionMatrix * u_ViewMatrix * vec4(pos, u_ZIndex, 1.0);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Dash;\n\nin vec4 v_Distance;\nin vec4 v_Arc;\nin float v_Type;\nin float v_Travel;\nin float v_ScalingFactor;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main(){\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  float alpha = 1.0;\n  float lineWidth = v_Distance.w;\n  if (v_Type < 0.5) {\n    float left = max(v_Distance.x - 0.5, -v_Distance.w);\n    float right = min(v_Distance.x + 0.5, v_Distance.w);\n    float near = v_Distance.y - 0.5;\n    float far = min(v_Distance.y + 0.5, 0.0);\n    float top = v_Distance.z - 0.5;\n    float bottom = min(v_Distance.z + 0.5, 0.0);\n    alpha = max(right - left, 0.0) * max(bottom - top, 0.0) * max(far - near, 0.0);\n  } else if (v_Type < 1.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n  } else if (v_Type < 2.5) {\n    alpha *= max(min(v_Distance.x + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.y + 0.5, 1.0), 0.0);\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  } else if (v_Type < 3.5) {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    float alpha_miter = a2 * b2 - a1 * b1;\n    float alpha_plane = max(min(v_Distance.z + 0.5, 1.0), 0.0);\n    float d = length(v_Arc.xy);\n    float circle_hor = max(min(v_Arc.w, d + 0.5) - max(-v_Arc.w, d - 0.5), 0.0);\n    float circle_vert = min(v_Arc.w * 2.0, 1.0);\n    float alpha_circle = circle_hor * circle_vert;\n    alpha = min(alpha_miter, max(alpha_circle, alpha_plane));\n  } else {\n    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);\n    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);\n    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);\n    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);\n    alpha = a2 * b2 - a1 * b1;\n    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);\n  }\n\n  float u_Dash = v_Dash.x;\n  float u_Gap = v_Dash.y;\n  float u_DashOffset = v_Dash.z;\n  if (u_Dash + u_Gap > 1.0) {\n    float travel = mod(v_Travel + u_Gap * v_ScalingFactor * 0.5 + u_DashOffset, u_Dash * v_ScalingFactor + u_Gap * v_ScalingFactor) - (u_Gap * v_ScalingFactor * 0.5);\n    float left = max(travel - 0.5, -0.5);\n    float right = min(travel + 0.5, u_Gap * v_ScalingFactor + 0.5);\n    alpha *= max(0.0, right - left);\n  }\n\n  if (u_IsPicking > 0.5) {\n    vec3 pickingColor = u_PickingColor;\n    if (pickingColor.x == 0.0 && pickingColor.y == 0.0 && pickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(pickingColor, 1.0);\n  } else {\n    outputColor = u_StrokeColor;\n    #ifdef USE_MAP\n      outputColor = u_Color;\n    #endif\n\n    outputColor.a *= alpha * u_Opacity * u_StrokeOpacity;\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}",this.material.defines=(0,u.Z)((0,u.Z)({},this.material.defines),bh(jh))}},{key:"createGeometry",value:function(e){var n=this,r=[],i=[],a=[],o=[],s=0,l=0;e.forEach((function(e){var t=ed(e,!1,12,n.calcSubpathIndex(e)),u=t.pointsBuffer,h=t.travelBuffer,d=t.instancedCount,f=e.parsedStyle,p=f.lineDash,v=f.lineDashOffset,g=f.isBillboard,m=f.isSizeAttenuation;o.push(p&&p[0]||0,p&&p[1]||0,v||0,qh(g,m,Qh(e))),s+=d;for(var y=0;y<u.length-12;y+=4)i.push(u[y],u[y+1],u[y+2],u[y+3],u[y+4],u[y+5],u[y+6],u[y+7],u[y+8],u[y+9],u[y+10],u[y+11],u[y+12],u[y+13],u[y+14],u[y+15]);a.push.apply(a,(0,c.Z)(h)),r.push(0+l,2+l,1+l,0+l,3+l,2+l,4+l,6+l,5+l,4+l,7+l,6+l,4+l,7+l,8+l),l+=9})),i.length&&(this.geometry.setVertexBuffer({bufferIndex:Kh.PACKED,byteStride:64,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGB,bufferByteOffset:0,location:jh.PREV,divisor:1},{format:wo.F32_RGB,bufferByteOffset:16,location:jh.POINT1,divisor:1},{format:wo.F32_R,bufferByteOffset:28,location:jh.VERTEX_JOINT,divisor:1},{format:wo.F32_RGB,bufferByteOffset:32,location:jh.POINT2,divisor:1},{format:wo.F32_RGB,bufferByteOffset:48,location:jh.NEXT,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:Kh.VERTEX_NUM,byteStride:4,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_R,bufferByteOffset:0,byteStride:4,location:jh.VERTEX_NUM,divisor:0}],data:new Float32Array([0,1,2,3,4,5,6,7,8])}),this.geometry.setVertexBuffer({bufferIndex:Kh.TRAVEL,byteStride:4,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_R,bufferByteOffset:0,byteStride:4,location:jh.TRAVEL,divisor:1}],data:new Float32Array(a)}),this.divisor=s/e.length,this.geometry.setVertexBuffer({bufferIndex:Kh.DASH,byteStride:16,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGBA,bufferByteOffset:0,location:jh.DASH,divisor:this.divisor}],data:new Float32Array(o)}),(0,X.Z)(t,"createGeometry",this,3)([e]),this.geometry.vertexCount=15,this.geometry.instancedCount=s,this.geometry.setIndexBuffer(new Uint32Array(r)))}},{key:"updateAttribute",value:function(e,n,r,i){var a=this;if(0!==e.length)if((0,X.Z)(t,"updateAttribute",this,3)([e,n,r,i]),this.updateBatchedAttribute(e,n,r,i),"r"===r||"rx"===r||"ry"===r||"width"===r||"height"===r||"radius"===r||"x1"===r||"y1"===r||"x2"===r||"y2"===r||"points"===r||"path"===r||"d"===r||"lineJoin"===r||"lineCap"===r||"markerStartOffset"===r||"markerEndOffset"===r||"markerStart"===r||"markerEnd"===r){var o=[],s=[],l=0;e.forEach((function(e){var t=ed(e,!1,12,a.calcSubpathIndex(e)),n=t.pointsBuffer,r=t.travelBuffer,i=t.instancedCount;l=i;for(var u=0;u<n.length-12;u+=4)o.push(n[u],n[u+1],n[u+2],n[u+3],n[u+4],n[u+5],n[u+6],n[u+7],n[u+8],n[u+9],n[u+10],n[u+11],n[u+12],n[u+13],n[u+14],n[u+15]);s.push.apply(s,(0,c.Z)(r))})),this.geometry.updateVertexBuffer(Kh.PACKED,jh.PREV,n*l,new Uint8Array(new Float32Array(o).buffer)),this.geometry.updateVertexBuffer(Kh.TRAVEL,jh.TRAVEL,n,new Uint8Array(new Float32Array(s).buffer))}else if("lineDashOffset"===r||"lineDash"===r||"isBillboard"===r||"isSizeAttenuation"===r){var u=[];e.forEach((function(e){var t=e.parsedStyle,n=t.lineDash,r=t.lineDashOffset,i=t.isBillboard,a=t.isSizeAttenuation;u.push(n&&n[0]||0,n&&n[1]||0,r||0,qh(i,a,Qh(e)))})),this.geometry.updateVertexBuffer(Kh.DASH,jh.DASH,n,new Uint8Array(new Float32Array(u).buffer))}}}],[{key:"calcSubpathNum",value:function(e){return e.nodeName===ue.PATH?e.parsedStyle.d.absolutePath.filter((function(e){return"M"===e[0]})).length:1}}])}(wh),Jh=function(e){return e[e.NONE=0]="NONE",e[e.FILL=1]="FILL",e[e.JOINT_BEVEL=4]="JOINT_BEVEL",e[e.JOINT_MITER=8]="JOINT_MITER",e[e.JOINT_ROUND=12]="JOINT_ROUND",e[e.JOINT_CAP_BUTT=16]="JOINT_CAP_BUTT",e[e.JOINT_CAP_SQUARE=18]="JOINT_CAP_SQUARE",e[e.JOINT_CAP_ROUND=20]="JOINT_CAP_ROUND",e[e.FILL_EXPAND=24]="FILL_EXPAND",e[e.CAP_BUTT=32]="CAP_BUTT",e[e.CAP_SQUARE=64]="CAP_SQUARE",e[e.CAP_ROUND=96]="CAP_ROUND",e[e.CAP_BUTT2=128]="CAP_BUTT2",e}({});function ed(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=e.parsedStyle,a=i.lineCap,o=i.lineJoin,s=e.sortable.renderOrder*xh,l=0,u=0,d=e.parsedStyle,f=d.markerStart,p=d.markerEnd,g=d.markerStartOffset,m=d.markerEndOffset,y=[],E=[];if(e.nodeName===ue.POLYLINE||e.nodeName===ue.POLYGON){var _,T,R=e.parsedStyle.points.points,S=R.length,A=0,x=0,C=0,M=0,N=0;f&&Ba(f)&&g&&(_=R[1][0]-R[0][0],T=R[1][1]-R[0][1],N=Math.atan2(T,_),A=Math.cos(N)*(g||0),x=Math.sin(N)*(g||0)),p&&Ba(p)&&m&&(_=R[S-2][0]-R[S-1][0],T=R[S-2][1]-R[S-1][1],N=Math.atan2(T,_),C=Math.cos(N)*(m||0),M=Math.sin(N)*(m||0));var k=e.nodeName===ue.POLYLINE;if(y[0]=R.reduce((function(e,t,n){var r=0,i=0;return 0===n?(r=A,i=x):n===S-1&&(r=C,i=M),e.push(t[0]+r,t[1]+i,k?t[2]||0:s),e}),[]),e.nodeName===ue.POLYGON){var b;if(t)return E=pc()(y[0],[],3),{pointsBuffer:y[0],travelBuffer:[],triangles:E,instancedCount:Math.round(y[0].length/3)};y[0].push(y[0][0],y[0][1],y[0][2]||s),(b=y[0]).push.apply(b,(0,c.Z)(rd(y[0][0],y[0][1],y[0][2]||s,y[0][3],y[0][4],y[0][5]||s)))}}else if(e.nodeName===ue.PATH||e.nodeName===ue.CIRCLE||e.nodeName===ue.ELLIPSE||e.nodeName===ue.RECT){var P;if(e.nodeName!==ue.PATH){if(P=lr(ar(e,v.identity(v.create()))),e.nodeName===ue.RECT){var O=e.parsedStyle,I=O.width,D=O.height;I<0&&(l+=P.rect.width),D<0&&(u+=P.rect.height)}}else P=e.parsedStyle.d;var L,B,w=P,F=w.absolutePath,U=w.segments,G=0,Z=0,V=0,X=0,W=0;if(f&&f.parentNode&&Ba(f)&&g){var H=f.parentNode.getStartTangent(),Y=(0,h.Z)(H,2),z=Y[0],K=Y[1];L=z[0]-K[0],B=z[1]-K[1],W=Math.atan2(B,L),G=Math.cos(W)*(g||0),Z=Math.sin(W)*(g||0)}if(p&&p.parentNode&&Ba(p)&&m){var j=p.parentNode.getEndTangent(),q=(0,h.Z)(j,2),Q=q[0],$=q[1];L=Q[0]-$[0],B=Q[1]-$[1],W=Math.atan2(B,L),V=Math.cos(W)*(m||0),X=Math.sin(W)*(m||0)}var J=-1,ee=-1;if(F.forEach((function(t,r){var i=(0,dc.Z)(t),a=i[0],o=i.slice(1),d=F[r+1],f=0===r&&(0!==G||0!==Z),p=(r===F.length-1||d&&("M"===d[0]||"Z"===d[0]))&&0!==V&&0!==X;if("M"===a)ee++,y[ee]=[],J=y[ee].length,f?y[ee].push(o[0]-l+G,o[1]-u+Z,s,o[0]-l,o[1]-u,s):y[ee].push(o[0]-l,o[1]-u,s);else if("L"===a)p?y[ee].push(o[0]-l+V,o[1]-u+X,s):y[ee].push(o[0]-l,o[1]-u,s);else if("Q"===a)Vh(o[0]-l,o[1]-u,o[2]-l,o[3]-u,y[ee],n),p&&y[ee].push(o[2]-l+V,o[3]-u+X,s);else if("A"===a){for(var v=(0,h.Z)(U[r].prePoint,2),g=v[0],m=v[1],E=(0,Zo.W)(g,m,o[0],o[1],o[2],o[3],o[4],o[5],o[6],void 0),_=0;_<E.length;_+=6)Xh(E[_]-l,E[_+1]-u,E[_+2]-l,E[_+3]-u,E[_+4]-l,E[_+5]-u,y[ee],n);p&&y[ee].push(o[5]-l+V,o[6]-u+X,s)}else if("C"===a)Xh(o[0]-l,o[1]-u,o[2]-l,o[3]-u,o[4]-l,o[5]-u,y[ee],n),p&&y[ee].push(o[4]-l+V,o[5]-u+X,s);else if("Z"===a&&(e.nodeName===ue.PATH||e.nodeName===ue.RECT)){var T,R=1e-4;(Math.abs(y[ee][y[ee].length-2]-y[ee][J])>R||Math.abs(y[ee][y[ee].length-1]-y[ee][J+1])>R)&&y[ee].push(y[ee][J],y[ee][J+1],s),(T=y[ee]).push.apply(T,(0,c.Z)(rd(y[ee][J],y[ee][J+1],y[ee][J+2],y[ee][J+3],y[ee][J+4],y[ee][J+5])))}})),t){var te=y[r];return{pointsBuffer:te,travelBuffer:[],triangles:E=pc()(te,[],3),instancedCount:Math.round(te.length/3)}}}var ne=td(o),re=nd(a),ie=re;re===Jh.CAP_ROUND&&(ie=Jh.JOINT_CAP_ROUND),re===Jh.CAP_BUTT&&(ie=Jh.JOINT_CAP_BUTT),re===Jh.CAP_SQUARE&&(ie=Jh.JOINT_CAP_SQUARE);for(var ae=y[r],oe=ae,se=4*(Math.round(0)+2),le=0,ce=[],he=[],de=0;de<oe.length;de+=3)de>1&&(le+=Math.sqrt(Math.pow(oe[de]-oe[de-3],2)+Math.pow(oe[de+1]-oe[de+1-3],2)+Math.pow(oe[de+2]-oe[de+2-3],2))),he.push(le),ce[se++]=oe[de],ce[se++]=oe[de+1],ce[se++]=oe[de+2]||0,ce[se]=ne,0===de&&re!==Jh.CAP_ROUND&&(ce[se]+=re),de+6>=oe.length?ce[se]+=ie-ne:de+3>=oe.length&&(ce[se]=0),se++;ce[se++]=oe[oe.length-6],ce[se++]=oe[oe.length-5],ce[se++]=oe[oe.length-4]||s,ce[se++]=0,ce[0]=oe[0],ce[1]=oe[1],ce[2]=oe[2]||s,ce[3]=0,ce[4]=oe[3],ce[5]=oe[4],ce[6]=oe[5]||s,ce[7]=re===Jh.CAP_ROUND?re:0;var fe=Math.round(oe.length/3);return{pointsBuffer:ce,travelBuffer:he,triangles:E,instancedCount:fe}}function td(e){var t;switch(e){case"bevel":t=Jh.JOINT_BEVEL;break;case"round":t=Jh.JOINT_ROUND;break;default:t=Jh.JOINT_MITER}return t}function nd(e){var t;switch(e){case"square":t=Jh.CAP_SQUARE;break;case"round":t=Jh.CAP_ROUND;break;default:t=Jh.CAP_BUTT}return t}function rd(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n,o=[r-e,i-t,a-n],s=.01;return[e+o[0]*s,t+o[1]*s,n+o[2]*s]}var id=function(e){return e[e.PACKED_STYLE=Lh.POSITION+1]="PACKED_STYLE",e}(id||{}),ad=function(e){return e[e.PACKED_STYLE3=Bh.MAX]="PACKED_STYLE3",e}(ad||{}),od=function(e){function t(e,n,r,i,a,l,u){var c;return(0,o.Z)(this,t),(c=(0,s.Z)(this,t,[e,n,r,i,a,l,u])).trianglesHash=[[],[]],c.renderHelper=e,c.texturePool=n,c.lightPool=r,c.trianglesHash=c.calcSegmentNum(i),c}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"calcSegmentNum",value:function(e){var t=ed(e,!0,12,this.calcSubpathIndex(e));return[t.triangles,t.pointsBuffer]}},{key:"calcSubpathIndex",value:function(e){return e.nodeName===ue.PATH?this.index:0}},{key:"compareTrianglesHash",value:function(e){var t=(0,h.Z)(this.trianglesHash,2),n=t[0],r=t[1],i=(0,h.Z)(e,2),a=i[0],o=i[1];return n.length===a.length&&r.length===o.length&&(!n.some((function(e,t){return e!==a[t]}))&&!r.some((function(e,t){return e!==o[t]})))}},{key:"shouldMerge",value:function(e,n){var r=(0,X.Z)(t,"shouldMerge",this,3)([e,n]);if(!r)return!1;if(this.index!==n)return!1;var i=this.calcSegmentNum(e);return this.compareTrianglesHash(i)}},{key:"createGeometry",value:function(e){var n=this,r=[],i=[],a=[],o=0;if(e.forEach((function(e,t){var s=ed(e,!0,12,n.calcSubpathIndex(e)),l=s.triangles,u=s.pointsBuffer;if(l.length){var h=e.getGeometryBounds().halfExtents,d=[];u.forEach((function(e,t){t%3!=2&&d.push(e/h[t%3]/2)})),o+=i.length/3,i.push.apply(i,(0,c.Z)(u)),a.push.apply(a,d),r.push.apply(r,(0,c.Z)(l.map((function(e){return e+o}))))}})),i.length){(0,X.Z)(t,"createGeometry",this,3)([e]);var s=[];e.forEach((function(e){var t=e.parsedStyle,n=t.isBillboard,r=t.billboardRotation,i=t.isSizeAttenuation;s.push(n?1:0,null!=r?r:0,i?1:0,0)})),this.geometry.setVertexBuffer({bufferIndex:Lh.POSITION,byteStride:12,stepMode:Ao.VERTEX,attributes:[{format:wo.F32_RGB,bufferByteOffset:0,location:Bh.POSITION}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:id.PACKED_STYLE,byteStride:16,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGBA,bufferByteOffset:0,location:ad.PACKED_STYLE3,divisor:1}],data:new Float32Array(s)}),this.geometry.setVertexBuffer({bufferIndex:Lh.UV,byteStride:8,stepMode:Ao.VERTEX,attributes:[{format:wo.F32_RG,bufferByteOffset:0,location:Bh.UV}],data:new Float32Array(a)}),this.geometry.vertexCount=r.length/e.length,this.geometry.setIndexBuffer(new Uint32Array(r))}}},{key:"createMaterial",value:function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = PACKED_STYLE3) in vec4 a_StylePacked3;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  bool isBillboard = a_StylePacked3.x > 0.5;\n  if (isBillboard) {\n    float rotation = a_StylePacked3.y;\n    bool isSizeAttenuation = a_StylePacked3.z > 0.5;\n    gl_Position = billboard(a_Position.xy, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, vec3(0.0));\n  } else {\n    gl_Position = project(vec4(a_Position.xy, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nout vec4 outputColor;\n\nvoid main(){\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n\n    outputColor.a = outputColor.a * u_Opacity * u_FillOpacity;\n  }\n}",this.material.defines=(0,u.Z)((0,u.Z)((0,u.Z)({},this.material.defines),bh(ad)),{},{INSTANCED:!0})}},{key:"updateAttribute",value:function(e,n,r,i){if(0!==e.length&&((0,X.Z)(t,"updateAttribute",this,3)([e,n,r,i]),this.updateBatchedAttribute(e,n,r,i),"isBillboard"===r||"billboardRotation"===r||"isSizeAttenuation"===r)){var a=[];e.forEach((function(e){var t=e.parsedStyle,n=t.isBillboard,r=t.billboardRotation,i=t.isSizeAttenuation;a.push(n?1:0,null!=r?r:0,i?1:0,0)})),this.geometry.updateVertexBuffer(id.PACKED_STYLE,ad.PACKED_STYLE3,n,new Uint8Array(new Float32Array(a).buffer))}}}])}(wh),sd=[0,-.5,0,0,0,1,-.5,1,1,0,1,.5,1,1,1,0,.5,0,0,1],ld=function(e){return e[e.POINT=Lh.POSITION+1]="POINT",e[e.CAP=1+e.POINT]="CAP",e[e.DASH=1+e.CAP]="DASH",e}(ld||{}),ud=function(e){return e[e.POSITION=Bh.POSITION]="POSITION",e[e.UV=Bh.UV]="UV",e[e.POINTA=Bh.NORMAL]="POINTA",e[e.POINTB=Bh.BARYCENTRIC]="POINTB",e[e.CAP=Bh.MAX]="CAP",e[e.DASH=Bh.MAX+1]="DASH",e}(ud||{}),cd={butt:1,round:2,square:3},hd=function(e){function t(e,n,r,i,a,l,u){var c;return(0,o.Z)(this,t),(c=(0,s.Z)(this,t,[e,n,r,i,a,l,u])).renderHelper=e,c.texturePool=n,c.lightPool=r,c.gradientAttributeName="stroke",c}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"shouldMerge",value:function(e,n){var r=(0,X.Z)(t,"shouldMerge",this,3)([e,n]);return!!r}},{key:"createMaterial",value:function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = POINTA) in vec3 a_PointA;\nlayout(location = POINTB) in vec3 a_PointB;\nlayout(location = CAP) in float a_Cap;\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\nlayout(location = DASH) in vec4 a_Dash;\n\nout vec4 v_Dash;\nout vec2 v_Distance;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n  float strokeWidth;\n  if (u_IsPicking > 0.5) {\n    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;\n  } else {\n    strokeWidth = u_StrokeWidth;\n  }\n  float clampedStrokeWidth = max(strokeWidth, 1.0);\n\n  bool isSizeAttenuation = a_Dash.w > 0.5;\n  if (isSizeAttenuation) {\n    vec4 clip0 = project(vec4(a_PointA, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    vec4 clip1 = project(vec4(a_PointB, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n    // screen space\n    vec2 screen0 = u_Viewport * (0.5 * clip0.xy / clip0.w + 0.5);\n    vec2 screen1 = u_Viewport * (0.5 * clip1.xy / clip1.w + 0.5);\n    vec2 xBasis = normalize(screen1 - screen0);\n    vec2 yBasis = vec2(-xBasis.y, xBasis.x);\n    vec2 pt0 = screen0 + clampedStrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt1 = screen1 + clampedStrokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);\n    vec2 pt = mix(pt0, pt1, a_Position.z);\n    vec4 clip = mix(clip0, clip1, a_Position.z);\n    gl_Position = vec4(clip.w * (2.0 * pt / u_Viewport - 1.0), clip.z, clip.w);\n  } else {\n    vec2 xBasis = a_PointB.xy - a_PointA.xy;\n    vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n\n    vec2 point = a_PointA.xy + xBasis * a_Position.x + yBasis * clampedStrokeWidth * a_Position.y;\n    point = point - u_Anchor.xy * abs(xBasis);\n\n    // round & square\n    if (a_Cap > 1.0) {\n      point += sign(a_Position.x - 0.5) * normalize(xBasis) * vec2(clampedStrokeWidth / 2.0);\n    }\n    gl_Position = project(vec4(point, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  float antialiasblur = 1.0 / strokeWidth;\n  v_Distance = vec2(a_Position.y * 2.0, antialiasblur);\n  v_Dash = vec4(a_Position.x, a_Dash.xyz);\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nin vec4 v_Dash;\nin vec2 v_Distance;\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_StrokeColor;\n    #ifdef USE_MAP\n      outputColor = u_Color;\n    #endif\n\n    float blur;\n    if (v_Distance.y < 1.0) {\n      blur = smoothstep(0.0, v_Distance.y, 1.0 - abs(v_Distance.x));\n    } else {\n      blur = 1.0 / v_Distance.y;\n    }\n    float u_dash_offset = v_Dash.y;\n    float u_dash_array = v_Dash.z;\n    float u_dash_ratio = v_Dash.w;\n\n    outputColor.a = outputColor.a\n      * max(blur, 0.5)\n      * u_Opacity * u_StrokeOpacity\n      * (u_dash_array < 1.0 ? (ceil((u_dash_array * u_dash_ratio) - mod(v_Dash.x + u_dash_offset, u_dash_array))) : 1.0);\n\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}",this.material.defines=(0,u.Z)((0,u.Z)({},this.material.defines),bh(ud))}},{key:"calcSubpathIndex",value:function(e){if(e.nodeName===ue.PATH){var t=this.drawcallCtors.filter((function(e){return e===od})).length;return this.index-t}return 0}},{key:"createGeometry",value:function(e){var n=this;(0,X.Z)(t,"createGeometry",this,3)([e]);var r=[],i=[],a=[],o=[],s=0;e.forEach((function(e){var t,l;if(e.nodeName===ue.LINE)t=e.parsedStyle,l=e.getTotalLength();else if(e.nodeName===ue.POLYLINE){var u=e.parsedStyle,c=u.points.points,h=u.lineCap,d=u.lineDash,f=u.lineDashOffset,p=u.markerStart,v=u.markerEnd,g=u.markerStartOffset,m=u.markerEndOffset,y=u.isBillboard,E=u.isSizeAttenuation;t={x1:c[0][0],y1:c[0][1],x2:c[c.length-1][0],y2:c[c.length-1][1],z1:0,z2:0,lineCap:h,lineDash:d,lineDashOffset:f,isBillboard:y,isSizeAttenuation:E,markerStart:p,markerEnd:v,markerStartOffset:g,markerEndOffset:m},l=e.getTotalLength()}else if(e.nodeName===ue.PATH){for(var _=e.parsedStyle,T=_.d.absolutePath,R=_.lineCap,S=_.lineDash,A=_.lineDashOffset,x=_.markerStart,C=_.markerEnd,M=_.markerStartOffset,N=_.markerEndOffset,k=_.isBillboard,b=_.isSizeAttenuation,P=0,O=0,I=n.calcSubpathIndex(e),D=0;D<T.length;D++){if("M"===T[D][0]){if(P===I){O=D;break}P++}}t={x1:T[O][1],y1:T[O][2],x2:T[O+1][1],y2:T[O+1][2],z1:0,z2:0,lineCap:R,lineDash:S,lineDashOffset:A,isBillboard:k,isSizeAttenuation:b,markerStart:x,markerEnd:C,markerStartOffset:M,markerEndOffset:N},l=e.getTotalLength()}var L=t,B=L.x1,w=L.y1,F=L.x2,U=L.y2,G=L.z1,Z=L.z2,V=L.lineCap,X=L.isBillboard,W=L.isSizeAttenuation,H=n.calcOffset(t),Y=H.startOffsetX,z=H.startOffsetY,K=H.endOffsetX,j=H.endOffsetY,q=n.calcDash(t,l),Q=q.dashOffset,$=q.dashSegmentPercent,J=q.dashRatioInEachSegment;i.push(cd[V]),a.push(Q,$,J,X||W?1:0),r.push(B+Y,w+z,G,F+K,U+j,Z),o.push(0+s,2+s,1+s,0+s,3+s,2+s),s+=4})),this.geometry.setIndexBuffer(new Uint32Array(o)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:Lh.POSITION,byteStride:20,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGB,bufferByteOffset:0,location:ud.POSITION,divisor:0},{format:wo.F32_RG,bufferByteOffset:12,location:ud.UV,divisor:0}],data:new Float32Array(sd)}),this.geometry.setVertexBuffer({bufferIndex:ld.POINT,byteStride:24,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGB,bufferByteOffset:0,location:ud.POINTA,divisor:1},{format:wo.F32_RGB,bufferByteOffset:12,location:ud.POINTB,divisor:1}],data:new Float32Array(r)}),this.geometry.setVertexBuffer({bufferIndex:ld.CAP,byteStride:4,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_R,bufferByteOffset:0,location:ud.CAP,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:ld.DASH,byteStride:16,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGBA,bufferByteOffset:0,location:ud.DASH,divisor:1}],data:new Float32Array(a)})}},{key:"updateAttribute",value:function(e,n,r,i){var a=this;if(0!==e.length)if((0,X.Z)(t,"updateAttribute",this,3)([e,n,r,i]),this.updateBatchedAttribute(e,n,r,i),"x1"===r||"y1"===r||"x2"===r||"y2"===r||"z1"===r||"z2"===r||"markerStartOffset"===r||"markerEndOffset"===r||"markerStart"===r||"markerEnd"===r||"points"===r||"d"===r){var o=[];e.forEach((function(e){var t;if(e.nodeName===ue.LINE)t=e.parsedStyle;else if(e.nodeName===ue.POLYLINE){var n=e.parsedStyle,r=n.points.points,i=n.lineCap,s=n.markerStart,l=n.markerEnd,u=n.markerStartOffset,c=n.markerEndOffset,h=n.isBillboard,d=n.isSizeAttenuation;t={x1:r[0][0],y1:r[0][1],x2:r[r.length-1][0],y2:r[r.length-1][1],z1:0,z2:0,lineCap:i,isSizeAttenuation:d,isBillboard:h,markerStart:s,markerEnd:l,markerStartOffset:u,markerEndOffset:c}}else if(e.nodeName===ue.PATH){var f=e.parsedStyle,p=f.d.absolutePath,v=f.lineCap,g=f.markerStart,m=f.markerEnd,y=f.markerStartOffset,E=f.markerEndOffset,_=f.isBillboard,T=f.isSizeAttenuation;t={x1:p[0][1],y1:p[0][2],x2:p[1][1],y2:p[1][2],z1:0,z2:0,lineCap:v,isBillboard:_,isSizeAttenuation:T,markerStart:g,markerEnd:m,markerStartOffset:y,markerEndOffset:E}}var R=t,S=R.x1,A=R.y1,x=R.x2,C=R.y2,M=R.z1,N=R.z2,k=a.calcOffset(t),b=k.startOffsetX,P=k.startOffsetY,O=k.endOffsetX,I=k.endOffsetY;o.push(S+b,A+P,M,x+O,C+I,N)})),this.geometry.updateVertexBuffer(ld.POINT,ud.POINTA,n,new Uint8Array(new Float32Array(o).buffer))}else if("lineDashOffset"===r||"lineDash"===r||"isSizeAttenuation"===r||"isBillboard"===r){var s=[];e.forEach((function(e){var t=e.getTotalLength(),n=a.calcDash(e.parsedStyle,t),r=n.dashOffset,i=n.dashSegmentPercent,o=n.dashRatioInEachSegment;s.push(r,i,o,e.parsedStyle.isBillboard||e.parsedStyle.isSizeAttenuation?1:0)})),this.geometry.updateVertexBuffer(ld.DASH,ud.DASH,n,new Uint8Array(new Float32Array(s).buffer))}else if("lineCap"===r){var l=[];e.forEach((function(e){var t=e.parsedStyle.lineCap;l.push(cd[t])})),this.geometry.updateVertexBuffer(ld.CAP,ud.CAP,n,new Uint8Array(new Float32Array(l).buffer))}}},{key:"calcOffset",value:function(e){var t,n,r=e.x1,i=e.y1,a=e.x2,o=e.y2,s=e.markerStart,l=e.markerEnd,u=e.markerStartOffset,c=e.markerEndOffset,h=0,d=0,f=0,p=0,v=0;return s&&Ba(s)&&u&&(t=a-r,n=o-i,v=Math.atan2(n,t),h=Math.cos(v)*(u||0),d=Math.sin(v)*(u||0)),l&&Ba(l)&&c&&(t=r-a,n=i-o,v=Math.atan2(n,t),f=Math.cos(v)*(c||0),p=Math.sin(v)*(c||0)),{startOffsetX:h,startOffsetY:d,endOffsetX:f,endOffsetY:p}}},{key:"calcDash",value:function(e,t){var n=e.lineDash,r=e.lineDashOffset,i=0,a=1,o=0;if(n&&n.length){i=(r||0)/t;var s=n.reduce((function(e,t){return e+t}),0);0===s?(a=1,o=0):(a=s/t,o=n[1]/s)}return{dashOffset:i,dashSegmentPercent:a,dashRatioInEachSegment:o}}}],[{key:"isLine",value:function(e,t){if(e.nodeName===ue.PATH){for(var n=e.parsedStyle.d.absolutePath,r=0,i=0,a=0;a<n.length;a++){if("M"===n[a][0]){if(r===t){i=a;break}r++}}if("M"===n[i][0]&&"L"===n[i+1][0]&&(void 0===n[i+2]||"M"===n[i+2][0]))return!0}else if(e.nodeName===ue.POLYLINE){for(var o=e.parsedStyle.points.points,s=(o[1][0]-o[1][1])/(o[0][0]-o[0][1]),l=1;l<o.length-1;l++)if((o[l+1][0]-o[l+1][1])/(o[l][0]-o[l][1])!==s)return!1;return!0}return!1}}])}(wh),dd=function(e){return e[e.PACKED_STYLE=Lh.POSITION+1]="PACKED_STYLE",e[e.SIZE=Lh.MAX]="SIZE",e}(dd||{}),fd=function(e){return e[e.PACKED_STYLE3=Bh.MAX]="PACKED_STYLE3",e[e.SIZE=1+e.PACKED_STYLE3]="SIZE",e}(fd||{}),pd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"shouldMerge",value:function(e,n){var r=(0,X.Z)(t,"shouldMerge",this,3)([e,n]);return!!r&&this.instance.parsedStyle.src===e.parsedStyle.src}},{key:"createMaterial",value:function(e){var t=e[0].parsedStyle.src;this.material.defines=(0,u.Z)((0,u.Z)({},this.material.defines),bh(fd)),this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = SIZE) in vec2 a_Size;\nlayout(location = PACKED_STYLE3) in vec4 a_StylePacked3;\n\n#ifdef USE_UV\n  layout(location = UV) in vec2 a_Uv;\n  out vec2 v_Uv;\n#endif\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  vec2 offset = (a_Uv - u_Anchor.xy) * a_Size;\n\n  bool isBillboard = a_StylePacked3.x > 0.5;\n  if (isBillboard) {\n    float rotation = a_StylePacked3.y;\n    bool isSizeAttenuation = a_StylePacked3.z > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, a_Position);\n  } else {\n    gl_Position = project(vec4(a_Position.xy + offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n\n  #ifdef USE_UV\n  v_Uv = a_Uv;\n#endif\n\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\n\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n#ifdef USE_MAP\n  uniform sampler2D u_Map;\n#endif\n\nout vec4 outputColor;\n\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n  #ifdef USE_MAP\n  #ifdef USE_PATTERN\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #else\n    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);\n    u_Color = texelColor;\n  #endif\n#endif\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n\n    // TODO: pointer-events: non-transparent-pixel\n    // if (u_Color.x == 0.0 && u_Color.y == 0.0 && u_Color.z == 0.0) {\n    //   discard;\n    // }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n    outputColor = u_Color;\n    outputColor.a = outputColor.a * u_Opacity;\n\n    if (outputColor.a < epsilon) {\n      discard;\n    }\n  }\n}";var n=this.texturePool.getOrCreateTexture(this.context.device,t,void 0);this.material.setUniforms({u_Map:n})}},{key:"createGeometry",value:function(e){(0,X.Z)(t,"createGeometry",this,3)([e]);var n=[],r=[],i=[];e.forEach((function(e,t){var a=e.parsedStyle,o=a.x,s=void 0===o?0:o,l=a.y,u=void 0===l?0:l,c=a.z,h=void 0===c?0:c,d=a.width,f=a.height,p=a.isBillboard,v=a.billboardRotation,g=a.isSizeAttenuation;n.push(s,u,h),r.push(d,f),i.push(p?1:0,null!=v?v:0,g?1:0,0)})),this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2])),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:Lh.POSITION,byteStride:12,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGB,bufferByteOffset:0,location:Bh.POSITION}],data:new Float32Array(n)}),this.geometry.setVertexBuffer({bufferIndex:dd.SIZE,byteStride:8,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RG,bufferByteOffset:0,location:fd.SIZE}],data:new Float32Array(r)}),this.geometry.setVertexBuffer({bufferIndex:dd.PACKED_STYLE,byteStride:16,stepMode:Ao.INSTANCE,attributes:[{format:wo.F32_RGBA,bufferByteOffset:0,location:fd.PACKED_STYLE3,divisor:1}],data:new Float32Array(i)}),this.geometry.setVertexBuffer({bufferIndex:Lh.UV,byteStride:8,stepMode:Ao.VERTEX,attributes:[{format:wo.F32_RG,bufferByteOffset:0,location:Bh.UV}],data:new Float32Array([0,0,1,0,1,1,0,1])})}},{key:"updateAttribute",value:function(e,n,r,i){if(0!==e.length)if((0,X.Z)(t,"updateAttribute",this,3)([e,n,r,i]),this.updateBatchedAttribute(e,n,r,i),"x"===r||"y"===r||"z"===r){var a=[];e.forEach((function(e){var t=e.parsedStyle,n=t.x,r=void 0===n?0:n,i=t.y,o=void 0===i?0:i,s=t.z,l=void 0===s?0:s;a.push(r,o,l)})),this.geometry.updateVertexBuffer(Lh.POSITION,Bh.POSITION,n,new Uint8Array(new Float32Array(a).buffer))}else if("width"===r||"height"===r){var o=[];e.forEach((function(e){var t=e.parsedStyle,n=t.width,r=t.height;o.push(n,r)})),this.geometry.updateVertexBuffer(dd.SIZE,fd.SIZE,n,new Uint8Array(new Float32Array(o).buffer))}else if("isBillboard"===r||"billboardRotation"===r||"isSizeAttenuation"===r){var s=[];e.forEach((function(e){var t=e.parsedStyle,n=t.isBillboard,r=t.billboardRotation,i=t.isSizeAttenuation;s.push(n?1:0,null!=r?r:0,i?1:0,0)})),this.geometry.updateVertexBuffer(dd.PACKED_STYLE,fd.PACKED_STYLE3,n,new Uint8Array(new Float32Array(s).buffer))}else if("src"===r){var l=this.texturePool.getOrCreateTexture(this.context.device,i);this.material.setUniforms({u_Map:l})}}}])}(wh);function vd(e,t,n,r){var i=t.width,a=t.height;if(r){if(r.length!==i*a*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*a*n);return e.width=i,e.height=a,e.data=r,e}function gd(e,t,n,r,i,a){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=e.data,s=t.data,l=0;l<i.height;l++)for(var u=((n.y+l)*e.width+n.x)*a,c=((r.y+l)*t.width+r.x)*a,h=0;h<i.width*a;h++)s[c+h]=o[u+h];return t}var md=function(){function e(t,n){(0,o.Z)(this,e),vd(this,t,1,n)}return(0,a.Z)(e,[{key:"resize",value:function(e){!function(e,t,n){var r=t.width,i=t.height;if(r!==e.width||i!==e.height){var a=vd({},{width:r,height:i},n);gd(e,a,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,i)},n),e.width=r,e.height=i,e.data=a.data}}(this,e,1)}},{key:"clone",value:function(){return new e({width:this.width,height:this.height},new Uint8Array(this.data))}}],[{key:"copy",value:function(e,t,n,r,i){gd(e,t,n,r,i,1)}}])}();var yd=(0,a.Z)((function e(t){(0,o.Z)(this,e);var n={},r=[];for(var i in t){var a=t[i],s=n[i]={};for(var l in a){var u=a[+l];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var c={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};r.push(c),s[l]={rect:c,metrics:u.metrics}}}}var h=function(e){var t,n=0,r=0,i=(0,oe.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;n+=a.w*a.h,r=Math.max(r,a.w)}}catch(e){i.e(e)}finally{i.f()}e.sort((function(e,t){return t.h-e.h}));var o,s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),r),h:1/0}],l=0,u=0,c=(0,oe.Z)(e);try{for(c.s();!(o=c.n()).done;)for(var h=o.value,d=s.length-1;d>=0;d--){var f=s[d];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),l=Math.max(l,h.x+h.w),h.w===f.w&&h.h===f.h){var p=s.pop();d<s.length&&(s[d]=p)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):h.w===f.w?(f.y+=h.h,f.h-=h.h):(s.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}}catch(e){c.e(e)}finally{c.f()}return{w:l,h:u,fill:n/(l*u)||0}}(r),d=h.w,f=h.h,p=new md({width:d||1,height:f||1});for(var v in t){var g=t[v];for(var m in g){var y=g[+m];if(y&&0!==y.bitmap.width&&0!==y.bitmap.height){var E=n[v][m].rect;md.copy(y.bitmap,p,{x:0,y:0},{x:E.x+1,y:E.y+1},y.bitmap)}}}this.image=p,this.positions=n}));function Ed(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}var _d=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.sdfGeneratorCache={},this.textMetricsCache={},this.glyphMap={},this.runtime=t}),[{key:"destroy",value:function(){this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy()}},{key:"getMap",value:function(){return this.glyphMap}},{key:"getAtlas",value:function(){return this.glyphAtlas}},{key:"getAtlasTexture",value:function(){return this.glyphAtlasTexture}},{key:"layout",value:function(e,t,n,r,i,a,o){var s=this,l=[],u=a,c=o,h="right"===r||"end"===r?1:"left"===r||"start"===r?0:.5;return e.forEach((function(e){var r=l.length;Array.from(e).forEach((function(e){var n=s.glyphMap[t],r=e.charCodeAt(0),a=n&&n[r];a&&(l.push({glyph:r,x:u,y:c,scale:1,fontStack:t}),u+=a.metrics.advance+i)}));for(var a=u-i,o=r;o<l.length;o++)l[o].x-=h*a;u=0,c+=n})),l}},{key:"generateAtlas",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,l=[];this.glyphMap[n]||(l=Ed());var c=Object.keys(this.glyphMap[n]||{});if(Array.from(new Set(o.split(""))).forEach((function(e){-1===c.indexOf(e.charCodeAt(0).toString())&&l.push(e)})),l.length){var h=l.map((function(o){return t.generateSDF(e,n,r,i,a,o)})).reduce((function(e,t){return e[t.id]=t,e}),{});this.glyphMap[n]=(0,u.Z)((0,u.Z)({},this.glyphMap[n]),h),this.glyphAtlas=new yd(this.glyphMap);var d=this.glyphAtlas.image,f=d.width,p=d.height,v=d.data;this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.glyphAtlasTexture=s.createTexture((0,u.Z)((0,u.Z)({},Qo(wo.ALPHA,f,p,1)),{},{pixelStore:{unpackFlipY:!1,unpackAlignment:1}})),this.glyphAtlasTexture.setImageData([v])}}},{key:"generateSDF",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=a.charCodeAt(0),s=this.sdfGeneratorCache[t];s||(s=this.sdfGeneratorCache[t]=new Hh({canvas:e,fontSize:24,fontFamily:n,fontWeight:r,fontStyle:i,buffer:3,radius:8,cutoff:.25},this.runtime)),this.textMetricsCache[t]||(this.textMetricsCache[t]={}),this.textMetricsCache[t][a]||(this.textMetricsCache[t][a]=s.ctx.measureText(a).width);var l=s.draw(a),u=l.data,c=l.width,h=l.height,d=l.glyphWidth,f=l.glyphHeight,p=l.glyphLeft,v=l.glyphTop,g=l.glyphAdvance;return{id:o,bitmap:new md({width:c,height:h},u),metrics:{width:d,height:f,left:p,top:v-24+3,advance:g}}}}])}();var Td=function(e){return e[e.INSTANCED=Lh.POSITION+1]="INSTANCED",e[e.TEX=1+e.INSTANCED]="TEX",e}(Td||{}),Rd=function(e){return e[e.TEX=Bh.MAX]="TEX",e[e.OFFSET=1+e.TEX]="OFFSET",e}(Rd||{}),Sd=function(e){return e.SDF_MAP="u_SDFMap",e.SDF_MAP_SIZE="u_SDFMapSize",e.FONT_SIZE="u_FontSize",e.GAMMA_SCALE="u_GammaScale",e.STROKE_BLUR="u_StrokeBlur",e.HAS_STROKE="u_HasStroke",e}({}),Ad=function(e){function t(e,n,r,i,a,l,u){var c;return(0,o.Z)(this,t),(c=(0,s.Z)(this,t,[e,n,r,i,a,l,u])).packedBufferObjectMap=new WeakMap,c.tmpMat4=v.create(),c.renderHelper=e,c.texturePool=n,c.lightPool=r,c.fontHash=c.calcFontHash(i),c.glyphManager=new _d(c.context),c}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"calcFontHash",value:function(e){e.getBounds();return e.parsedStyle.metrics.font+["fontSize","fontFamily","fontWeight","textBaseline","letterSpacing"].reduce((function(t,n){return t+e.parsedStyle[n]}),"")}},{key:"shouldMerge",value:function(e,n){var r=(0,X.Z)(t,"shouldMerge",this,3)([e,n]);return!!r&&(this.index===n&&this.fontHash===this.calcFontHash(e))}},{key:"createGeometry",value:function(e){var t=this,n=this.instance,r=n.parsedStyle,i=r.fontSize,a=void 0===i?16:i,o=r.letterSpacing,s=void 0===o?0:o,l=n.parsedStyle.textBaseline,u=void 0===l?"alphabetic":l,h=24/a,d=[],f=[],p=[],v=[],g=0;e.forEach((function(e){var n=e.parsedStyle,r=n.metrics,i=n.dx,a=void 0===i?0:i,o=n.dy,l=void 0===o?0:o,m=r.font,y=r.lines,E=r.height,_=r.lineHeight,T=a,R=l;"alphabetic"===u&&(u="bottom");var S=0;"middle"===u?S+=-E/2:"bottom"===u?S+=-E:"top"===u||"hanging"===u?S+=0:"ideographic"===u&&(S+=-E);var A=t.glyphManager.getAtlas(),x=t.buildTextBuffers({object:e,lines:y,fontStack:m,lineHeight:h*_,offsetX:h*T,offsetY:h*(S+R),letterSpacing:h*s,glyphAtlas:A,indicesOffset:g}),C=x.indicesOffset,M=x.indexBuffer,N=x.charUVOffsetBuffer,k=x.charPositionsBuffer,b=x.charPackedBuffer;g=C;var P=v.length;v.push.apply(v,(0,c.Z)(b));var O=v.length;t.packedBufferObjectMap.set(e,[P,O]),p.push.apply(p,(0,c.Z)(N)),f.push.apply(f,(0,c.Z)(k)),d.push.apply(d,(0,c.Z)(M))})),this.geometry.vertexCount=d.length,this.geometry.setIndexBuffer(new Uint32Array(d)),this.geometry.setVertexBuffer({bufferIndex:Td.INSTANCED,byteStride:128,stepMode:Ao.VERTEX,attributes:[{format:wo.F32_RGBA,bufferByteOffset:0,location:Bh.MODEL_MATRIX0},{format:wo.F32_RGBA,bufferByteOffset:16,location:Bh.MODEL_MATRIX1},{format:wo.F32_RGBA,bufferByteOffset:32,location:Bh.MODEL_MATRIX2},{format:wo.F32_RGBA,bufferByteOffset:48,location:Bh.MODEL_MATRIX3},{format:wo.F32_RGBA,bufferByteOffset:64,location:Bh.PACKED_COLOR},{format:wo.F32_RGBA,bufferByteOffset:80,location:Bh.PACKED_STYLE1},{format:wo.F32_RGBA,bufferByteOffset:96,location:Bh.PACKED_STYLE2},{format:wo.F32_RGBA,bufferByteOffset:112,location:Bh.PICKING_COLOR}],data:new Float32Array(v)}),this.geometry.setVertexBuffer({bufferIndex:Lh.POSITION,byteStride:12,stepMode:Ao.VERTEX,attributes:[{format:wo.F32_RGB,bufferByteOffset:0,location:Bh.POSITION}],data:new Float32Array(f)}),this.geometry.setVertexBuffer({bufferIndex:Td.TEX,byteStride:16,stepMode:Ao.VERTEX,attributes:[{format:wo.F32_RG,bufferByteOffset:0,location:Rd.TEX},{format:wo.F32_RG,bufferByteOffset:8,location:Rd.OFFSET}],data:new Float32Array(p)})}},{key:"createMaterial",value:function(e){this.material.vertexShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nlayout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;\nlayout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;\nlayout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;\nlayout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;\nlayout(location = PACKED_COLOR) in vec4 a_PackedColor;\nlayout(location = PACKED_STYLE1) in vec4 a_StylePacked1;\nlayout(location = PACKED_STYLE2) in vec4 a_StylePacked2;\nlayout(location = PICKING_COLOR) in vec4 a_PickingColor;\n\nout vec4 v_PickingResult;\nout vec4 v_Color;\nout vec4 v_StrokeColor;\nout vec4 v_StylePacked1;\nout vec4 v_StylePacked2;\n\n#define COLOR_SCALE 1. / 255.\nvoid setPickingColor(vec3 pickingColor) {\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\nvec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {\n  return pm * vm * mm * pos;\n}\n\nbool isPerspectiveMatrix(mat4 m) {\n  return m[2][3] == -1.0;\n}\n\nvec4 billboard(vec2 offset, float rotation, bool isSizeAttenuation, mat4 pm, mat4 vm, mat4 mm, vec3 position) {\n  vec4 mvPosition = vm * mm * vec4(position, 1.0);\n  vec2 scale;\n  scale.x = length(vec3(mm[0][0], mm[0][1], mm[0][2]));\n  scale.y = length(vec3(mm[1][0], mm[1][1], mm[1][2]));\n\n  if (isSizeAttenuation) {\n    bool isPerspective = isPerspectiveMatrix(pm);\n    if (isPerspective) {\n      scale *= -mvPosition.z / 250.0;\n    }\n  }\n\n  vec2 alignedPosition = offset * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n  rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n  mvPosition.xy += rotatedPosition;\n  return pm * mvPosition;\n}\n\nlayout(location = POSITION) in vec3 a_Position;\nlayout(location = TEX) in vec2 a_Tex;\nlayout(location = OFFSET) in vec2 a_Offset;\n\nout vec2 v_Uv;\n\nvoid main() {\n  vec4 a_Color = decode_color(a_PackedColor.xy);\nvec4 a_StrokeColor = decode_color(a_PackedColor.zw);\n\nmat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\nvec4 u_StrokeColor = a_StrokeColor;\nfloat u_Opacity = a_StylePacked1.x;\nfloat u_FillOpacity = a_StylePacked1.y;\nfloat u_StrokeOpacity = a_StylePacked1.z;\nfloat u_StrokeWidth = a_StylePacked1.w;\nfloat u_ZIndex = a_PickingColor.w;\nvec2 u_Anchor = a_StylePacked2.yz;\nfloat u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;\n\nsetPickingColor(a_PickingColor.xyz);\n\nv_Color = a_Color;\nv_StrokeColor = a_StrokeColor;\nv_StylePacked1 = a_StylePacked1;\nv_StylePacked2 = a_StylePacked2;\n\n// #ifdef CLIPSPACE_NEAR_ZERO\n//     gl_Position.z = (gl_Position.z + gl_Position.w) * 0.5;\n// #endif\n\n  v_Uv = a_Tex / u_SDFMapSize;\n  float fontScale = u_FontSize / 24.;\n\n  vec2 bufferOffset = vec2(0.7, 2.0);\n  vec2 offset = a_Offset * fontScale + + bufferOffset;\n\n  bool isBillboard = a_StylePacked2.y > 0.5;\n  if (isBillboard) {\n    float rotation =  a_StylePacked2.w;\n    bool isSizeAttenuation = a_StylePacked2.z > 0.5;\n    gl_Position = billboard(offset, rotation, isSizeAttenuation, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix, a_Position );\n  } else {\n    gl_Position = project(vec4(a_Position.xy + offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);\n  }\n}",this.material.fragmentShader="#define GLSLIFY 1\nlayout(std140) uniform ub_SceneParams {\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewMatrix;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_Viewport;\n  float u_IsOrtho;\n  float u_IsPicking;\n};\nin vec4 v_PickingResult;\nin vec4 v_Color;\nin vec4 v_StrokeColor;\nin vec4 v_StylePacked1;\nin vec4 v_StylePacked2;\nlayout(std140) uniform ub_ObjectParams {\n  vec2 u_SDFMapSize;\n  float u_FontSize;\n  float u_GammaScale;\n  float u_StrokeBlur;\n  float u_HasStroke;\n};\n#ifdef USE_UV\n  in vec2 v_Uv;\n#endif\n\nuniform sampler2D u_SDFMap;\n\n#define SDF_PX 8.0\n\nout vec4 outputColor;\nfloat epsilon = 0.000001;\n\nvoid main() {\n  vec4 u_Color = v_Color;\nvec4 u_StrokeColor = v_StrokeColor;\nfloat u_Opacity = v_StylePacked1.x;\nfloat u_FillOpacity = v_StylePacked1.y;\nfloat u_StrokeOpacity = v_StylePacked1.z;\nfloat u_StrokeWidth = v_StylePacked1.w;\nfloat u_Visible = v_StylePacked2.x;\nvec3 u_PickingColor = v_PickingResult.xyz;\n\nif (u_Visible < 0.5) {\n    discard;\n}\n\n  float dist = texture(SAMPLER_2D(u_SDFMap), v_Uv).a;\n\n  float fontScale = u_FontSize / 24.0;\n  lowp vec4 color = u_Color;\n  lowp float buff = (256.0 - 64.0) / 256.0;\n  float opacity = u_FillOpacity;\n  if (u_HasStroke > 0.5 && u_StrokeWidth > 0.0) {\n    color = u_StrokeColor;\n    buff = (6.0 - u_StrokeWidth / fontScale / 2.0) / SDF_PX;\n    opacity = u_StrokeOpacity;\n  }\n\n  highp float gamma_scaled = fwidth(dist);\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  opacity *= alpha * u_Opacity;\n\n  if (u_IsPicking > 0.5) {\n    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {\n      discard;\n    }\n    outputColor = vec4(u_PickingColor, 1.0);\n  } else {\n\n    if (opacity < epsilon) {\n      discard;\n    }\n\n    outputColor = color;\n    outputColor.a *= opacity;\n  }\n}",this.material.cullMode=vo.BACK,this.material.defines=(0,u.Z)((0,u.Z)({},this.material.defines),bh(Rd));var t=this.instance.parsedStyle,n=t.fontSize,r=void 0===n?16:n,i=t.fontFamily,a=void 0===i?"sans-serif":i,o=t.fontWeight,s=void 0===o?"normal":o,l=t.fontStyle,c=void 0===l?"normal":l,h=t.metrics.font,d=e.map((function(e){return e.parsedStyle.text})).join("");this.glyphManager.generateAtlas(this.texturePool.context.config.offscreenCanvas,h,a,s.toString(),c,d,this.context.device);var f=this.glyphManager.getAtlasTexture(),p=this.glyphManager.getAtlas();this.context.device.setResourceName(f,"TextSDF Texture");var v=p.image,g=v.width,m=v.height;this.material.setUniforms((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)({},Sd.SDF_MAP,f),Sd.SDF_MAP_SIZE,[g,m]),Sd.FONT_SIZE,r),Sd.GAMMA_SCALE,1),Sd.STROKE_BLUR,.2),Sd.HAS_STROKE,this.index))}},{key:"changeRenderOrder",value:function(e,t){for(var n=this.geometry.vertices[Td.INSTANCED],r=this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[Td.INSTANCED].arrayStride/4,i=this.packedBufferObjectMap.get(e),a=(0,h.Z)(i,2),o=a[0],s=a[1],l=n.slice(o,s),u=0;u<s-o;u+=r)l[u+r-1]=t*xh;this.geometry.updateVertexBuffer(Td.INSTANCED,Bh.MODEL_MATRIX0,o/r,new Uint8Array(l.buffer))}},{key:"updateAttribute",value:function(e,n,r,i){var a=this;if(0!==e.length)if((0,X.Z)(t,"updateAttribute",this,3)([e,n,r,i]),"text"===r||"fontFamily"===r||"fontSize"===r||"fontWeight"===r||"fontStyle"===r||"fontVariant"===r||"textBaseline"===r||"letterSpacing"===r||"wordWrapWidth"===r||"lineHeight"===r||"wordWrap"===r||"textAlign"===r||"x"===r||"y"===r||"dx"===r||"dy"===r)this.material.programDirty=!0,this.material.geometryDirty=!0,this.material.textureDirty=!0;else if("modelMatrix"===r||"fill"===r||"fillOpacity"===r||"stroke"===r||"strokeOpacity"===r||"opacity"===r||"lineWidth"===r||"visibility"===r||"pointerEvents"===r||"isBillboard"===r||"billboardRotation"===r||"isSizeAttenuation"===r){var o=this.geometry.vertices[Td.INSTANCED],s=this.geometry.inputLayoutDescriptor.vertexBufferDescriptors[Td.INSTANCED].arrayStride/4;e.forEach((function(e){var t,n=e.parsedStyle,r=n.fill,i=n.stroke,l=n.opacity,u=void 0===l?1:l,c=n.fillOpacity,d=void 0===c?1:c,f=n.strokeOpacity,p=void 0===f?1:f,g=n.lineWidth,m=void 0===g?1:g,y=n.visibility,E=n.isBillboard,_=n.billboardRotation,T=n.isSizeAttenuation,R=[0,0,0,0];En(r)&&(R=[Number(r.r),Number(r.g),Number(r.b),255*Number(r.alpha)]);var S=[0,0,0,0];En(i)&&(S=[Number(i.r),Number(i.g),Number(i.b),255*Number(i.alpha)]);for(var A=e.isInteractive()&&(null===(t=e.renderable3D)||void 0===t?void 0:t.encodedPickingColor)||[0,0,0],x=v.copy(a.tmpMat4,e.getWorldTransform()),C=a.packedBufferObjectMap.get(e),M=(0,h.Z)(C,2),N=M[0],k=M[1],b=o.slice(N,k),P=0;P<k-N;P+=s)b[P+0]=x[0],b[P+1]=x[1],b[P+2]=x[2],b[P+3]=x[3],b[P+4]=x[4],b[P+5]=x[5],b[P+6]=x[6],b[P+7]=x[7],b[P+8]=x[8],b[P+9]=x[9],b[P+10]=x[10],b[P+11]=x[11],b[P+12]=x[12],b[P+13]=x[13],b[P+14]=x[14],b[P+15]=x[15],b[P+16]=Oh(R[0],R[1]),b[P+17]=Oh(R[2],R[3]),b[P+18]=Oh(S[0],S[1]),b[P+19]=Oh(S[2],S[3]),b[P+20]=u,b[P+21]=d,b[P+22]=p,b[P+23]=m,b[P+24]="hidden"!==y?1:0,b[P+25]=E?1:0,b[P+26]=T?1:0,b[P+27]=null!=_?_:0,b[P+28]=A[0],b[P+29]=A[1],b[P+30]=A[2];a.geometry.updateVertexBuffer(Td.INSTANCED,Bh.MODEL_MATRIX0,N/s,new Uint8Array(b.buffer))}))}}},{key:"buildTextBuffers",value:function(e){var t,n=e.object,r=e.lines,i=e.fontStack,a=e.lineHeight,o=e.letterSpacing,s=e.offsetX,l=e.offsetY,u=e.glyphAtlas,h=e.indicesOffset,d=n.parsedStyle,f=d.textAlign,p=void 0===f?"start":f,g=d.fill,m=d.stroke,y=d.opacity,E=void 0===y?1:y,_=d.fillOpacity,T=void 0===_?1:_,R=d.strokeOpacity,S=void 0===R?1:R,A=d.lineWidth,x=void 0===A?1:A,C=d.visibility,M=d.isBillboard,N=d.billboardRotation,k=d.isSizeAttenuation,b=d.x,P=void 0===b?0:b,O=d.y,I=void 0===O?0:O,D=d.z,L=void 0===D?0:D,B=[0,0,0,0];En(g)&&(B=[Number(g.r),Number(g.g),Number(g.b),255*Number(g.alpha)]);var w=[0,0,0,0];En(m)&&(w=[Number(m.r),Number(m.g),Number(m.b),255*Number(m.alpha)]);var F=n.isInteractive()&&(null===(t=n.renderable3D)||void 0===t?void 0:t.encodedPickingColor)||[0,0,0],U=v.copy(this.tmpMat4,n.getWorldTransform()),G=[],Z=[],V=[],X=[],W=h,H=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r],a=t[i.fontStack],o=a&&a[i.glyph];if(o){var s=o.rect;if(s){var l=o.metrics.advance*i.scale/2,u=[i.x+l,i.y],c=(o.metrics.left-4)*i.scale-l+u[0],h=(-o.metrics.top-4)*i.scale+u[1],d=c+s.w*i.scale,f=h+s.h*i.scale,p={x:c,y:h},v={x:d,y:h},g={x:c,y:f},m={x:d,y:f};n.push({tl:p,tr:v,bl:g,br:m,tex:s,glyphOffset:[0,0]})}}}return n}(this.glyphManager.layout(r,i,a,p,o,s,l),u.positions);return H.forEach((function(e){var t=[];t.push.apply(t,(0,c.Z)(U));var r=[].concat(t,[Oh(B[0],B[1]),Oh(B[2],B[3]),Oh(w[0],w[1]),Oh(w[2],w[3]),E,T,S,x,"hidden"!==C?1:0,M?1:0,k?1:0,null!=N?N:0],(0,c.Z)(F),[n.sortable.renderOrder*xh]);G.push.apply(G,(0,c.Z)(r).concat((0,c.Z)(r),(0,c.Z)(r),(0,c.Z)(r))),Z.push(e.tex.x,e.tex.y,e.tl.x,e.tl.y),Z.push(e.tex.x+e.tex.w,e.tex.y,e.tr.x,e.tr.y),Z.push(e.tex.x+e.tex.w,e.tex.y+e.tex.h,e.br.x,e.br.y),Z.push(e.tex.x,e.tex.y+e.tex.h,e.bl.x,e.bl.y),V.push(P,I,L,P,I,L,P,I,L,P,I,L),X.push(0+W,2+W,1+W),X.push(2+W,0+W,3+W),W+=4})),{indexBuffer:X,charUVOffsetBuffer:Z,charPositionsBuffer:V,charPackedBuffer:G,indicesOffset:W}}},{key:"destroy",value:function(){(0,X.Z)(t,"destroy",this,3)([]),this.glyphManager.destroy()}}])}(wh),xd=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).mergeXYZIntoModelMatrix=!1,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"shouldMerge",value:function(e,n){var r=(0,X.Z)(t,"shouldMerge",this,3)([e,n]);return!!r&&(this.instance.nodeName!==ue.MESH||this.instance.parsedStyle.material===e.parsedStyle.material&&this.instance.parsedStyle.geometry===e.parsedStyle.geometry)}},{key:"updateAttribute",value:function(e,n,r,i){0!==e.length&&((0,X.Z)(t,"updateAttribute",this,3)([e,n,r,i]),this.updateBatchedAttribute(e,n,r,i))}},{key:"createMaterial",value:function(e){var t=this.instance.parsedStyle.material;this.material=t,this.observeMaterialChanged()}},{key:"createGeometry",value:function(e){var n=this.instance.parsedStyle.geometry;this.geometry=n,(0,X.Z)(t,"createGeometry",this,3)([e]),this.geometry.build(e),this.observeGeometryChanged()}}])}(wh),Cd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(e){var t=[],n=e.parsedStyle.fill;return n&&!n.isNone&&t.push(Zh),this.needDrawStrokeSeparately(e)&&t.push($h),t}},{key:"needDrawStrokeSeparately",value:function(e){var t=e.parsedStyle,n=t.fill,r=t.stroke,i=t.lineDash,a=t.lineWidth,o=t.strokeOpacity,s=n&&!n.isNone,l=r&&!r.isNone,u=i&&i.length&&i.every((function(e){return 0!==e}));return!s||l&&a>0&&(o<1||u)}}])}(Ch),Md=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(e){var t=e.parsedStyle,n=t.fill,r=t.stroke,i=t.opacity,a=t.strokeOpacity,o=t.lineWidth,s=r&&!r.isNone,l=$h.calcSubpathNum(e),u=[];if(!(e.nodeName===ue.POLYLINE||null!=n&&n.isNone))for(var c=0;c<l;c++)u.push(od);for(var h=0;h<l;h++){if(0!==a&&0!==i&&0!==o&&s)hd.isLine(e,h)?u.push(hd):u.push($h)}return u}}])}(Ch),Nd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(){return[pd]}}])}(Ch),kd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(e){var t=[],n=e.parsedStyle,r=n.stroke,i=n.lineWidth,a=void 0===i?1:i;return!(!r||r.isNone||!a)&&t.push(Ad),t.push(Ad),t}},{key:"beforeUploadUBO",value:function(e,t){var n=t.instance.renderable3D.drawcalls.length;t.material.setUniforms((0,V.Z)({},Sd.HAS_STROKE,1===n?0:1-t.index))}}])}(Ch),bd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(){return[hd]}}])}(Ch),Pd=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(){return[xd]}}])}(Ch),Od=function(e){function t(){return(0,o.Z)(this,t),(0,s.Z)(this,t,arguments)}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"getDrawcallCtors",value:function(e){var t=[],n=e.parsedStyle,r=n.fill,i=n.radius,a=i&&i.length&&i.some((function(e){return e!==i[0]}));return null!=r&&r.isNone||a||t.push(Zh),a&&t.push(od),(a||this.needDrawStrokeSeparately(e))&&t.push($h),t}},{key:"needDrawStrokeSeparately",value:function(e){var t=e.parsedStyle,n=t.fill,r=t.stroke,i=t.lineDash,a=t.lineWidth,o=t.strokeOpacity,s=n&&!n.isNone,l=r&&!r.isNone,u=i&&i.length&&i.every((function(e){return 0!==e}));return!s||l&&a>0&&(o<1||u)}}])}(Ch),Id=1,Dd=function(){return(0,a.Z)((function e(t,n,r,i){(0,o.Z)(this,e),this.drawcalls=[],this.pendingUpdatePatches={},this.stencilRefCache={},this.renderHelper=t,this.rendererFactory=n,this.texturePool=r,this.lightPool=i}),[{key:"destroy",value:function(){this.drawcalls.forEach((function(e){e.destroy()})),this.drawcalls=[],this.pendingUpdatePatches={}}},{key:"render",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n||this.updatePendingPatches(),this.drawcalls.forEach((function(r){r.init();var i=r.objects;r.clipPathTarget&&(i=[r.clipPath]);var a=t.renderHelper.renderInstManager.newRenderInst();a.setAllowSkippingIfPipelineNotReady(!1),r.applyRenderInst(a,i),t.renderHelper.renderInstManager.submitRenderInst(a,e),n||r.objects.forEach((function(e){e.renderable.dirty=!1}))}))}},{key:"attach",value:function(e){this.context=e}},{key:"add",value:function(e){var t=this,n=e.renderable3D;if(n&&!n.drawcalls.length){var r=this.rendererFactory[e.nodeName];r&&r.getDrawcallCtors(e).forEach((function(i,a,o){var s=t.drawcalls.find((function(t){return i===t.constructor&&t.index===a&&t.objects.length<t.maxInstances&&t.shouldMerge(e,a)}));s&&s.key===e.parsedStyle.batchKey||((s=new i(t.renderHelper,t.texturePool,t.lightPool,e,o,a,t.context)).renderer=r,t.drawcalls.push(s),e.parsedStyle.batchKey&&(s.key=e.parsedStyle.batchKey)),s&&(s.objects.push(e),n.drawcalls[a]=s,s.geometryDirty=!0)}))}}},{key:"remove",value:function(e){var t=this,n=e.renderable3D;n&&(n.drawcalls.forEach((function(n){if(n){var r=n.objects.indexOf(e);if(r>-1&&(n.objects.splice(r,1),n.geometryDirty=!0),0===n.objects.length)t.drawcalls.splice(t.drawcalls.indexOf(n),1).forEach((function(e){e.destroy()}))}})),n.drawcalls=[])}},{key:"updateAttribute",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.renderable3D,o=this.rendererFactory[e.nodeName];if(o){var s=o.getDrawcallCtors(e);if(s.forEach((function(s,l,u){var c=a.drawcalls.find((function(e){return e&&e.index===l&&e.constructor===s}));if(c||((c=a.drawcalls[l])&&(c.objects.splice(c.objects.indexOf(e),1),c.geometryDirty=!0,0===c.objects.length&&r.drawcalls.splice(r.drawcalls.indexOf(c),1),a.drawcalls[a.drawcalls.indexOf(c)]=void 0),(c=r.drawcalls.find((function(t){return s===t.constructor&&t.index===l&&t.objects.length<t.maxInstances&&t.shouldMerge(e,l)})))?c.geometryDirty=!0:((c=new s(r.renderHelper,r.texturePool,r.lightPool,e,u,l,r.context)).renderer=o,c.init(),r.drawcalls.push(c)),c.objects.push(e),a.drawcalls[l]=c),c.inited&&!c.geometryDirty)if(c.shouldMerge(e,l)){var h=c.objects.indexOf(e);if(i)e.parsedStyle[t]=n,c.updateAttribute([e],h,t,n);else{var d=c.id+t;r.pendingUpdatePatches[d]||(r.pendingUpdatePatches[d]={instance:c,objectIndices:[],name:t,value:n}),-1===r.pendingUpdatePatches[d].objectIndices.indexOf(h)&&r.pendingUpdatePatches[d].objectIndices.push(h)}}else r.remove(e),r.add(e);else r.remove(e),r.add(e)})),a.drawcalls.length>s.length)for(var l=a.drawcalls.length,u=l-1;u>=s.length;u--){var c=a.drawcalls[u];c.objects.splice(c.objects.indexOf(e),1),c.geometryDirty=!0,0===c.objects.length&&this.drawcalls.splice(this.drawcalls.indexOf(c),1),a.drawcalls.pop()}}}},{key:"changeRenderOrder",value:function(e,t){var n=e.renderable3D;n&&n.drawcalls.length&&n.drawcalls.forEach((function(n){n&&n.inited&&!n.geometryDirty&&n.inited&&n.changeRenderOrder(e,t)}))}},{key:"getStencilRef",value:function(e){return this.stencilRefCache[e.entity]||(this.stencilRefCache[e.entity]=Id++),this.stencilRefCache[e.entity]}},{key:"updatePendingPatches",value:function(){var e=this;Object.keys(this.pendingUpdatePatches).forEach((function(t){var n=e.pendingUpdatePatches[t],r=n.instance,i=n.objectIndices,a=n.name,o=n.value;i.sort((function(e,t){return e-t}));var s=[];i.forEach((function(e){var t=s[s.length-1];t&&e===t[t.length-1]+1?t.push(e):s.push([e])})),s.forEach((function(e){r.updateAttribute(r.objects.slice(e[0],e[0]+e.length),e[0],a,o)}))})),this.pendingUpdatePatches={}}}])}(),Ld=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.textureCache={},this.context=t,this.runtime=n}),[{key:"getOrCreateTexture",value:function(e,t,n,r){var i,a=this,o="string"==typeof t?t:t.src||"";if(o&&this.textureCache[o])(i=this.textureCache[o]).emit(xo.LOADED);else if(i=e.createTexture((0,u.Z)({format:wo.U8_RGBA_NORM,width:1,height:1,depthOrArrayLayers:1,mipLevelCount:1,dimension:Co.TEXTURE_2D,usage:Mo.SAMPLED,pixelStore:{unpackFlipY:!1}},n)),o&&(this.textureCache[o]=i),(0,R.Z)(t)){var s=this.context.config.createImage();s&&(s.onload=function(){var e=function(e){a.textureCache[o].setImageData([e]),a.textureCache[o].emit(xo.LOADED),a.context.renderingService.dirtify(),r&&r(a.textureCache[o],e)};a.runtime.globalThis.createImageBitmap?a.runtime.globalThis.createImageBitmap(s).then((function(t){return e(t)})).catch((function(){e(s)})):e(s)},s.onerror=function(){},s.crossOrigin="Anonymous",s.src=t)}else i.setImageData([t]),i.emit(xo.LOADED),this.context.renderingService.dirtify();return i}},{key:"getOrCreateCanvas",value:function(){return this.runtime.offscreenCanvasCreator.getOrCreateCanvas(this.context.config.offscreenCanvas)}},{key:"getOrCreateGradient",value:function(e){var t=e.instance,n=e.gradients,r=t.getGeometryBounds().halfExtents,i=2*r[0]||1,a=2*r[1]||1,o=this.context.config.offscreenCanvas,s=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(o),l=this.runtime.offscreenCanvasCreator.getOrCreateContext(o);s.width=i,s.height=a;var c=this.context.imagePool;n.forEach((function(e){var t=c.getOrCreateGradient((0,u.Z)((0,u.Z)({type:e.type},e.value),{},{width:i,height:a,min:[0,0]}),l);l.fillStyle=t,l.fillRect(0,0,i,a)}))}},{key:"getOrCreatePattern",value:function(e,t,n){var r,i=e.image,a=e.repetition,o=e.transform,s=t.getGeometryBounds().halfExtents,l=2*s[0]||1,u=2*s[1]||1,c=this.context.config.offscreenCanvas,h=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(c),d=this.runtime.offscreenCanvasCreator.getOrCreateContext(c);if(h.width=l,h.height=u,(0,R.Z)(i)){var f=this.context.imagePool.getImageSync(i,t,n);r=null==f?void 0:f.img}else r=i;var p=r&&d.createPattern(r,a);if(o){var v=Mi(yr(o),new Za({}));p.setTransform({a:v[0],b:v[1],c:v[4],d:v[5],e:v[12],f:v[13]})}d.fillStyle=p,d.fillRect(0,0,l,u)}},{key:"destroy",value:function(){for(var e in this.textureCache)this.textureCache[e].destroy();this.textureCache={}}}])}(),Bd=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(e=(0,s.Z)(this,t)).name="device-renderer",e.parameters={toneMapping:Bc.NONE,toneMappingExposure:1},e.options=n,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(e){var t;e.geometryUpdaterFactory[ue.MESH]=new Ec;var n=new eh(this.parameters),r=new gc,i=new Ld(this.context,e),a=new _c,o=new Cd,s=new Md,l=(t={},(0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)((0,V.Z)(t,ue.CIRCLE,o),ue.ELLIPSE,o),ue.POLYLINE,s),ue.PATH,s),ue.POLYGON,s),ue.RECT,new Od),ue.IMAGE,new Nd),ue.LINE,new bd),ue.TEXT,new kd),ue.MESH,new Pd),(0,V.Z)((0,V.Z)(t,ue.GROUP,void 0),ue.HTML,void 0)),u=new Dd(n,l,i,r),c=new Sh(n,r,i,u,this.options);this.addRenderingPlugin(c),this.addRenderingPlugin(new Ah(n,c,a,u))}},{key:"destroy",value:function(e){delete e.geometryUpdaterFactory[ue.MESH]}},{key:"getRenderGraphPlugin",value:function(){return this.plugins[0]}},{key:"getDevice",value:function(){return this.getRenderGraphPlugin().getDevice()}},{key:"getSwapChain",value:function(){return this.getRenderGraphPlugin().getSwapChain()}},{key:"loadTexture",value:function(e,t,n){return this.getRenderGraphPlugin().loadTexture(e,t,n)}},{key:"toDataURL",value:function(e){return this.getRenderGraphPlugin().toDataURL(e)}},{key:"setParameters",value:function(e){this.parameters=(0,u.Z)((0,u.Z)({},this.parameters),e)}}])}(he),wd=function(){function e(t){(0,o.Z)(this,e),this.dragndropPluginOptions=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this,r=t.renderingService,i=t.renderingContext.root.ownerDocument,a=i.defaultView,o=function(e){var t=e.target,r=t===i,o=r&&n.dragndropPluginOptions.isDocumentDraggable?i:t.closest&&t.closest("[draggable=true]");if(o){var s=!1,l=e.timeStamp,u=[e.clientX,e.clientY],c=null,h=[e.clientX,e.clientY],d=function(){var e=(0,Go.Z)((0,Uo.Z)().mark((function e(a){var d,f,p,v,g,m;return(0,Uo.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}if(d=a.timeStamp-l,f=(0,_.y)([a.clientX,a.clientY],u),!(d<=n.dragndropPluginOptions.dragstartTimeThreshold||f<=n.dragndropPluginOptions.dragstartDistanceThreshold)){e.next=1;break}return e.abrupt("return");case 1:a.type="dragstart",o.dispatchEvent(a),s=!0;case 2:if(a.type="drag",a.dx=a.clientX-h[0],a.dy=a.clientY-h[1],o.dispatchEvent(a),h=[a.clientX,a.clientY],r){e.next=4;break}return p="pointer"===n.dragndropPluginOptions.overlap?[a.canvasX,a.canvasY]:t.getBounds().center,e.next=3,i.elementsFromPoint(p[0],p[1]);case 3:v=e.sent,g=v[v.indexOf(t)+1],m=(null==g?void 0:g.closest("[droppable=true]"))||(n.dragndropPluginOptions.isDocumentDroppable?i:null),c!==m&&(c&&(a.type="dragleave",a.target=c,c.dispatchEvent(a)),m&&(a.type="dragenter",a.target=m,m.dispatchEvent(a)),(c=m)&&(a.type="dragover",a.target=c,c.dispatchEvent(a)));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();a.addEventListener("pointermove",d);var f=function(e){if(s){e.detail={preventClick:!0};var t=e.clone();c&&(t.type="drop",t.target=c,c.dispatchEvent(t)),t.type="dragend",o.dispatchEvent(t),s=!1}a.removeEventListener("pointermove",d)};t.addEventListener("pointerup",f,{once:!0}),t.addEventListener("pointerupoutside",f,{once:!0})}};r.hooks.init.tap(e.tag,(function(){a.addEventListener("pointerdown",o)})),r.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("pointerdown",o)}))}}])}();wd.tag="Dragndrop";var Fd=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(e=(0,s.Z)(this,t)).name="dragndrop",e.options=n,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new wd((0,u.Z)({overlap:"pointer",isDocumentDraggable:!1,isDocumentDroppable:!1,dragstartDistanceThreshold:0,dragstartTimeThreshold:0},this.options)))}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}},{key:"setOptions",value:function(e){Object.assign(this.plugins[0].dragndropPluginOptions,e)}}])}(he),Ud=function(){function e(){(0,o.Z)(this,e),this.displayObjectHTMLElementMap=new WeakMap}return(0,a.Z)(e,[{key:"joinTransformMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return"matrix(".concat([e[0],e[1],e[4],e[5],e[12]+t[0],e[13]+t[1]].join(","),")")}},{key:"apply",value:function(t,n){var r=this,i=t.camera,a=t.renderingContext,o=t.renderingService;this.context=t;var s=a.root.ownerDocument.defaultView,l=s.context.eventService.nativeHTMLMap,u=function(e,t){t.style.transform=r.joinTransformMatrix(e.getWorldTransform(),e.getOrigin())},c=function(e){var t=e.target;if(t.nodeName===ue.HTML){r.$camera||(r.$camera=r.createCamera(i));var n=r.getOrCreateEl(t);r.$camera.appendChild(n),Object.keys(t.attributes).forEach((function(e){r.updateAttribute(e,t)})),u(t,n),l.set(n,t)}},h=function(e){var t=e.target;if(t.nodeName===ue.HTML&&r.$camera){var n=r.getOrCreateEl(t);n&&(n.remove(),l.delete(n))}},d=function(e){var t=e.target;if(t.nodeName===ue.HTML){var n=e.attrName;r.updateAttribute(n,t)}},f=function(e){var t=e.target;(t.nodeName===ue.FRAGMENT?t.childNodes:[t]).forEach((function(e){if(e.nodeName===ue.HTML){var t=r.getOrCreateEl(e);u(e,t)}}))},p=function(){if(r.$camera){var e=r.context.config,t=e.width,n=e.height;r.$camera.parentElement.style.width="".concat(t||0,"px"),r.$camera.parentElement.style.height="".concat(n||0,"px")}};o.hooks.init.tap(e.tag,(function(){s.addEventListener(Fo.RESIZE,p),s.addEventListener(Qi.MOUNTED,c),s.addEventListener(Qi.UNMOUNTED,h),s.addEventListener(Qi.ATTR_MODIFIED,d),s.addEventListener(Qi.BOUNDS_CHANGED,f)})),o.hooks.endFrame.tap(e.tag,(function(){r.$camera&&a.renderReasons.has(Ki.CAMERA_CHANGED)&&(r.$camera.style.transform=r.joinTransformMatrix(i.getOrthoMatrix()))})),o.hooks.destroy.tap(e.tag,(function(){r.$camera&&r.$camera.remove(),s.removeEventListener(Fo.RESIZE,p),s.removeEventListener(Qi.MOUNTED,c),s.removeEventListener(Qi.UNMOUNTED,h),s.removeEventListener(Qi.ATTR_MODIFIED,d),s.removeEventListener(Qi.BOUNDS_CHANGED,f)}))}},{key:"createCamera",value:function(e){var t=this.context.config,n=t.document,r=t.width,i=t.height,a=this.context.contextService.getDomElement(),o=a.parentNode;if(o){var s="g-canvas-camera",l=o.querySelector("#".concat(s));if(!l){var u=(n||document).createElement("div");u.style.overflow="hidden",u.style.pointerEvents="none",u.style.position="absolute",u.style.left="0px",u.style.top="0px",u.style.width="".concat(r||0,"px"),u.style.height="".concat(i||0,"px");var c=(n||document).createElement("div");l=c,c.id=s,c.style.position="absolute",c.style.left="".concat(a.offsetLeft||0,"px"),c.style.top="".concat(a.offsetTop||0,"px"),c.style.transformOrigin="left top",c.style.transform=this.joinTransformMatrix(e.getOrthoMatrix()),c.style.pointerEvents="none",c.style.width="100%",c.style.height="100%",u.appendChild(c),o.appendChild(u)}return l}return null}},{key:"getOrCreateEl",value:function(e){var t=this.context.config.document,n=this.displayObjectHTMLElementMap.get(e);return n||(n=(t||document).createElement("div"),e.parsedStyle.$el=n,this.displayObjectHTMLElementMap.set(e,n),e.id&&(n.id=e.id),e.name&&n.setAttribute("name",e.name),e.className&&(n.className=e.className),n.style.position="absolute",n.style["will-change"]="transform",n.style.transform=this.joinTransformMatrix(e.getWorldTransform(),e.getOrigin())),n}},{key:"updateAttribute",value:function(e,t){var n=this.getOrCreateEl(t);switch(e){case"innerHTML":var r=t.parsedStyle.innerHTML;(0,R.Z)(r)?n.innerHTML=r:(n.innerHTML="",n.appendChild(r));break;case"x":n.style.left="".concat(t.parsedStyle.x,"px");break;case"y":n.style.top="".concat(t.parsedStyle.y,"px");break;case"transformOrigin":var i=t.parsedStyle.transformOrigin;n.style["transform-origin"]="".concat(i[0].buildCSSText(null,null,"")," ").concat(i[1].buildCSSText(null,null,""));break;case"width":var a=t.parsedStyle.width;n.style.width=(0,E.Z)(a)?"".concat(a,"px"):a.toString();break;case"height":var o=t.parsedStyle.height;n.style.height=(0,E.Z)(o)?"".concat(o,"px"):o.toString();break;case"zIndex":var s=t.parsedStyle.zIndex;n.style["z-index"]="".concat(s);break;case"visibility":var l=t.parsedStyle.visibility;n.style.visibility=l;break;case"pointerEvents":var u=t.parsedStyle.pointerEvents,c=void 0===u?"auto":u;n.style.pointerEvents=c;break;case"opacity":var h=t.parsedStyle.opacity;n.style.opacity="".concat(h);break;case"fill":var d=t.parsedStyle.fill,f="";En(d)?f=d.isNone?"transparent":t.getAttribute("fill"):Array.isArray(d)?f=t.getAttribute("fill"):yn(d),n.style.background=f;break;case"stroke":var p=t.parsedStyle.stroke,v="";En(p)?v=p.isNone?"transparent":t.getAttribute("stroke"):Array.isArray(p)?v=t.getAttribute("stroke"):yn(p),n.style["border-color"]=v,n.style["border-style"]="solid";break;case"lineWidth":var g=t.parsedStyle.lineWidth;n.style["border-width"]="".concat(g||0,"px");break;case"lineDash":n.style["border-style"]="dashed";break;case"filter":var m=t.style.filter;n.style.filter=m;break;default:(0,T.Z)(t.style[e])||""===t.style[e]||(n.style[e]=t.style[e])}}}])}();Ud.tag="HTMLRendering";var Gd=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="html-renderer",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new Ud)}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(he),Zd=function(){return(0,a.Z)((function e(){(0,o.Z)(this,e),this.cacheStore=new Map}),[{key:"onRefAdded",value:function(e){}},{key:"has",value:function(e){return this.cacheStore.has(e)}},{key:"put",value:function(e,t,n){return!this.cacheStore.has(e)&&(this.cacheStore.set(e,{value:t,counter:new Set([n.entity])}),this.onRefAdded(n),!0)}},{key:"get",value:function(e,t){var n=this.cacheStore.get(e);return n?(n.counter.has(t.entity)||(n.counter.add(t.entity),this.onRefAdded(t)),n.value):null}},{key:"update",value:function(e,t,n){var r=this.cacheStore.get(e);return!!r&&(r.value=(0,u.Z)((0,u.Z)({},r.value),t),r.counter.has(n.entity)||(r.counter.add(n.entity),this.onRefAdded(n)),!0)}},{key:"release",value:function(e,t){var n=this.cacheStore.get(e);return!!n&&(n.counter.delete(t.entity),n.counter.size<=0&&this.cacheStore.delete(e),!0)}},{key:"releaseRef",value:function(e){var t=this;Array.from(this.cacheStore.keys()).forEach((function(n){t.release(n,e)}))}},{key:"getSize",value:function(){return this.cacheStore.size}},{key:"clear",value:function(){this.cacheStore.clear()}}])}(),Vd=[],Xd=[],Wd=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,null,[{key:"stop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.api;e.rafId&&(t.cancelAnimationFrame(e.rafId),e.rafId=null)}},{key:"executeTask",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.api;Vd.length<=0&&Xd.length<=0||(Xd.forEach((function(e){return e()})),Xd=Vd.splice(0,e.TASK_NUM_PER_FRAME),e.rafId=t.requestAnimationFrame((function(){e.executeTask(t)})))}},{key:"sliceImage",value:function(t,n,r,i){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.api,s=t.naturalWidth||t.width,l=t.naturalHeight||t.height,u=n-a,c=r-a,h=Math.ceil(s/u),d=Math.ceil(l/c),f={tileSize:[n,r],gridSize:[d,h],tiles:Array(d).fill(null).map((function(){return Array(h).fill(null)}))},p=function(e){for(var a=function(a){Vd.push((function(){var h=a*u,d=e*c,p=[Math.min(n,s-h),Math.min(r,l-d)],v=p[0],g=p[1],m=o.createCanvas();m.width=n,m.height=r,m.getContext("2d").drawImage(t,h,d,v,g,0,0,v,g),f.tiles[e][a]={x:h,y:d,tileX:a,tileY:e,data:m},i()}))},d=0;d<h;d++)a(d)},v=0;v<d;v++)p(v);return e.stop(),e.executeTask(),f}}])}();Wd.TASK_NUM_PER_FRAME=10;var Hd=new Zd;Hd.onRefAdded=function(e){var t=this;e.addEventListener(Qi.DESTROY,(function(){t.releaseRef(e)}),{once:!0})};var Yd=function(){return(0,a.Z)((function e(t,n){(0,o.Z)(this,e),this.gradientCache={},this.patternCache={},this.context=t,this.runtime=n}),[{key:"getImageSync",value:function(e,t,n){var r=(0,R.Z)(e)?e:e.src;if(Hd.has(r)){var i=Hd.get(r,t);if(i.img.complete)return null==n||n(i),i}return this.getOrCreateImage(e,t).then((function(e){null==n||n(e)})).catch((function(e){console.error(e)})),null}},{key:"getOrCreateImage",value:function(e,t){var n=this,r=(0,R.Z)(e)?e:e.src;if(!(0,R.Z)(e)&&!Hd.has(r)){var i={img:e,size:[e.naturalWidth||e.width,e.naturalHeight||e.height],tileSize:zd(e)};Hd.put(r,i,t)}if(Hd.has(r)){var a=Hd.get(r,t);return a.img.complete?Promise.resolve(a):new Promise((function(e,t){a.img.addEventListener("load",(function(){a.size=[a.img.naturalWidth||a.img.width,a.img.naturalHeight||a.img.height],a.tileSize=zd(a.img),e(a)})),a.img.addEventListener("error",(function(e){t(e)}))}))}return new Promise((function(e,i){var a=n.context.config.createImage();if(a){var o={img:a,size:[0,0],tileSize:zd(a)};Hd.put(r,o,t),a.onload=function(){o.size=[a.naturalWidth||a.width,a.naturalHeight||a.height],o.tileSize=zd(o.img),e(o)},a.onerror=function(e){i(e)},a.crossOrigin="Anonymous",a.src=r}}))}},{key:"createDownSampledImage",value:(t=(0,Go.Z)((0,Uo.Z)().mark((function e(t,n){var r,i,a,o,s,l,c,d,f,p,v,g,m,y;return(0,Uo.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.getOrCreateImage(t,n);case 1:if(void 0===(r=e.sent).downSamplingRate){e.next=2;break}return e.abrupt("return",r);case 2:if(i=this.context.config.enableLargeImageOptimization,o=(a="boolean"==typeof i?{}:i).maxDownSampledImageSize,s=void 0===o?2048:o,l=a.downSamplingRateThreshold,c=void 0===l?.5:l,d=this.runtime.globalThis.createImageBitmap,f=(0,h.Z)(r.size,2),p=f[0],v=f[1],g=r.img,m=Math.min((s+s)/(p+v),Math.max(.01,Math.min(c,.5))),y=(0,u.Z)((0,u.Z)({},r),{},{downSamplingRate:m}),Hd.update(r.img.src,y,n),!d){e.next=7;break}return e.prev=3,e.next=4,d(r.img,{resizeWidth:p*m,resizeHeight:v*m});case 4:g=e.sent,e.next=6;break;case 5:e.prev=5,e.catch(3),m=1;case 6:e.next=8;break;case 7:m=1;case 8:return y=(0,u.Z)((0,u.Z)({},this.getImageSync(t,n)),{},{downSampled:g,downSamplingRate:m}),Hd.update(r.img.src,y,n),e.abrupt("return",y);case 9:case"end":return e.stop()}}),e,this,[[3,5]])}))),function(e,n){return t.apply(this,arguments)})},{key:"createImageTiles",value:(e=(0,Go.Z)((0,Uo.Z)().mark((function e(t,n,r,i){var a,o,s,l,c;return(0,Uo.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.getOrCreateImage(t,i);case 1:return a=e.sent,o=i.ownerDocument.defaultView,s=o.requestAnimationFrame,l=o.cancelAnimationFrame,Wd.api={requestAnimationFrame:s,cancelAnimationFrame:l,createCanvas:function(){return zi.createCanvas()}},c=(0,u.Z)((0,u.Z)({},a),Wd.sliceImage(a.img,a.tileSize[0],a.tileSize[0],r)),Hd.update(a.img.src,c,i),e.abrupt("return",c);case 2:case"end":return e.stop()}}),e,this)}))),function(t,n,r,i){return e.apply(this,arguments)})},{key:"releaseImage",value:function(e,t){Hd.release((0,R.Z)(e)?e:e.src,t)}},{key:"releaseImageRef",value:function(e){Hd.releaseRef(e)}},{key:"getOrCreatePatternSync",value:function(e,t,n,r,i,a,o){var s=this.generatePatternKey(t);if(s&&this.patternCache[s])return this.patternCache[s];var l,u=t.image,c=t.repetition,h=t.transform,d=!1;if((0,R.Z)(u)){var f=this.getImageSync(u,e,o);l=null==f?void 0:f.img}else r?(l=r,d=!0):l=u;var p,g=l&&n.createPattern(l,c);g&&(p=h?Mi(yr(h),new Za({})):v.identity(v.create()),d&&v.scale(p,p,[1/i,1/i,1]),g.setTransform({a:p[0],b:p[1],c:p[4],d:p[5],e:p[12]+a[0],f:p[13]+a[1]}));return s&&g&&(this.patternCache[s]=g),g}},{key:"getOrCreateGradient",value:function(e,t){var n=this.generateGradientKey(e),r=e.type,i=e.steps,a=e.min,o=e.width,s=e.height,l=e.angle,u=e.cx,c=e.cy,h=e.size;if(this.gradientCache[n])return this.gradientCache[n];var d=null;if(r===zt.LinearGradient){var f=function(e,t,n,r){var i=ke(r.value),a=0+t/2,o=0+n/2,s=Math.abs(t*Math.cos(i))+Math.abs(n*Math.sin(i));return{x1:e[0]+a-Math.cos(i)*s/2,y1:e[1]+o-Math.sin(i)*s/2,x2:e[0]+a+Math.cos(i)*s/2,y2:e[1]+o+Math.sin(i)*s/2}}(a,o,s,l),p=f.x1,v=f.y1,g=f.x2,m=f.y2;d=t.createLinearGradient(p,v,g,m)}else if(r===zt.RadialGradient){var y=function(e,t,n,r,i,a){var o=r.value,s=i.value;r.unit===Bt.kPercentage&&(o=r.value/100*t),i.unit===Bt.kPercentage&&(s=i.value/100*n);var l=Math.max((0,_.y)([0,0],[o,s]),(0,_.y)([0,n],[o,s]),(0,_.y)([t,n],[o,s]),(0,_.y)([t,0],[o,s]));return a&&(a instanceof Qt?l=a.value:a instanceof jt&&("closest-side"===a.value?l=Math.min(o,t-o,s,n-s):"farthest-side"===a.value?l=Math.max(o,t-o,s,n-s):"closest-corner"===a.value&&(l=Math.min((0,_.y)([0,0],[o,s]),(0,_.y)([0,n],[o,s]),(0,_.y)([t,n],[o,s]),(0,_.y)([t,0],[o,s]))))),{x:o+e[0],y:s+e[1],r:l}}(a,o,s,u,c,h),E=y.x,T=y.y,R=y.r;d=t.createRadialGradient(E,T,0,E,T,R)}return d&&(i.forEach((function(e){var t,n=e.offset,r=e.color;n.unit===Bt.kPercentage&&(null===(t=d)||void 0===t||t.addColorStop(n.value/100,r.toString()))})),this.gradientCache[n]=d),this.gradientCache[n]}},{key:"generateGradientKey",value:function(e){var t=e.type,n=e.min,r=e.width,i=e.height,a=e.steps,o=e.angle,s=e.cx,l=e.cy,u=e.size;return"gradient-".concat(t,"-").concat((null==o?void 0:o.toString())||0,"-").concat((null==s?void 0:s.toString())||0,"-").concat((null==l?void 0:l.toString())||0,"-").concat((null==u?void 0:u.toString())||0,"-").concat(n[0],"-").concat(n[1],"-").concat(r,"-").concat(i,"-").concat(a.map((function(e){var t=e.offset,n=e.color;return"".concat(t).concat(n)})).join("-"))}},{key:"generatePatternKey",value:function(e){var t=e.image,n=e.repetition;return(0,R.Z)(t)?"pattern-".concat(t,"-").concat(n):"rect"===t.nodeName?"pattern-".concat(t.entity,"-").concat(n):void 0}}]);var e,t}();function zd(e){if(!e.complete)return[0,0];var t=e.naturalWidth||e.width,n=e.naturalHeight||e.height,r=256;return[256,512].forEach((function(e){Math.ceil(n/e)*Math.ceil(t/e)<1e3&&(r=e)})),[r,r]}Yd.isSupportTile=!!zi.createCanvas();var Kd=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.renderingService,r=t.renderingContext,i=t.imagePool,a=r.root.ownerDocument.defaultView,o=function(e,t,n){var r=e.parsedStyle,i=r.width,a=r.height;i&&!a?e.setAttribute("height",n/t*i):!i&&a&&e.setAttribute("width",t/n*a)},s=function(e){var t=e.target,r=t.nodeName,a=t.attributes;if(r===ue.IMAGE){var s=a.src,l=a.keepAspectRatio;i.getImageSync(s,t,(function(e){var r=e.img,i=r.width,a=r.height;l&&o(t,i,a),t.renderable.dirty=!0,n.dirtify()}))}},l=function(e){var t=e.target,r=e.attrName,a=e.prevValue,s=e.newValue;t.nodeName===ue.IMAGE&&"src"===r&&(a!==s&&i.releaseImage(a,t),(0,R.Z)(s)&&i.getOrCreateImage(s,t).then((function(e){var r=e.img,i=r.width,a=r.height;t.attributes.keepAspectRatio&&o(t,i,a),t.renderable.dirty=!0,n.dirtify()})).catch((function(){})))};n.hooks.init.tap(e.tag,(function(){a.addEventListener(Qi.MOUNTED,s),a.addEventListener(Qi.ATTR_MODIFIED,l)})),n.hooks.destroy.tap(e.tag,(function(){a.removeEventListener(Qi.MOUNTED,s),a.removeEventListener(Qi.ATTR_MODIFIED,l)}))}}])}();Kd.tag="LoadImage";var jd=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="image-loader",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(e){this.context.imagePool=new Yd(this.context,e),this.addRenderingPlugin(new Kd)}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(he),qd=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=t.renderingService,r=t.contextService,i=t.config,a=r.getDomElement(),o=function(e){n.hooks.pointerDown.call(e)},s=function(e){n.hooks.pointerUp.call(e)},l=function(e){n.hooks.pointerMove.call(e)},u=function(e){n.hooks.pointerOver.call(e)},c=function(e){n.hooks.pointerOut.call(e)},h=function(e){n.hooks.click.call(e)},d=function(e){n.hooks.pointerCancel.call(e)};n.hooks.init.tap(e.tag,(function(){a.addEventListener("touchstart",o,!0),a.addEventListener("touchend",s,!0),a.addEventListener("touchmove",l,!0),a.addEventListener("touchcancel",d,!0),a.addEventListener("mouseout",c,!0),a.addEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.addEventListener("click",h,!0)})),n.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("touchstart",o,!0),a.removeEventListener("touchend",s,!0),a.removeEventListener("touchmove",l,!0),a.removeEventListener("touchcancel",d,!0),a.removeEventListener("mouseout",c,!0),a.removeEventListener("mouseover",u,!0),i.useNativeClickEvent&&a.removeEventListener("click",h,!0)}))}}])}();qd.tag="MobileInteraction";var Qd=function(e){function t(){var e;(0,o.Z)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=(0,s.Z)(this,t,[].concat(r))).name="mobile-interaction",e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new qd)}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(he),$d="object"===("undefined"==typeof performance?"undefined":i()(performance))&&performance.now?performance:Date,Jd=function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.abs(n)>Math.abs(r)?n>0?"right":"left":r>0?"down":"up"},ef=function(e,t){var n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return Math.sqrt(n*n+r*r)},tf=function(){function e(t){var n=this;(0,o.Z)(this,e),this.evCache=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this._start=function(e,t){n.reset(),n.startTime=$d.now();var r=n.evCache,i=n.startPoints;if(e){var a,o=e.pointerId,s=e.x,l=e.y,u=r.findIndex((function(e){return o===e.pointerId}));-1!==u&&r.splice(u,1),r.push({pointerId:o,x:s,y:l,ev:e});for(var h=(0,c.Z)((null===(a=e.nativeEvent)||void 0===a?void 0:a.touches)||[]),d=function(e){if(h.find((function(t){return r[e].pointerId===t.identifier})))return 1;r.splice(e,1)},f=r.length-1;f>-1;f--)d(f)}i.length=r.length;for(var p=0;p<r.length;p++){var v=r[p],g={x:v.x,y:v.y};i[p]=g}if(1!==i.length){var m,y;n.startDistance=ef(i[0],i[1]),n.center=(m=i[0],y=i[1],{x:m.x+(y.x-m.x)/2,y:m.y+(y.y-m.y)/2})}else{var E=r[0].ev;n.pressTimeout=setTimeout((function(){var e="press",r="none";E.direction=r,E.deltaX=0,E.deltaY=0,E.points=i,n.emitStart(e,E,t),E.type=e,t.dispatchEvent(E),n.eventType=e,n.direction=r,n.movingTarget=t}),250)}},this._move=function(e,t){n.clearPressTimeout();var r=n.startPoints,i=n.evCache;if(r.length){for(var a=e.x,o=e.y,s=e.pointerId,l=0,u=i.length;l<u;l++)if(s===i[l].pointerId){i[l]={pointerId:s,x:a,y:o,ev:e};break}var c={x:a,y:o},h=i.map((function(e){return{x:e.x,y:e.y}})),d=$d.now();if(n.prevMoveTime=n.lastMoveTime,n.prevMovePoint=n.lastMovePoint,n.lastMoveTime=d,n.lastMovePoint=c,1===r.length){var f=r[0],p=a-f.x,v=o-f.y,g=n.direction||Jd(f,c);n.direction=g;var m=n.getEventType(c,t,e);return e.direction=g,e.deltaX=p,e.deltaY=v,e.points=h,n.emitStart(m,e,t),e.type=m,void n.refreshAndGetTarget(t).dispatchEvent(e)}var y=n.startDistance,E=ef(h[0],h[1]);e.zoom=E/y,e.center=n.center,e.points=h,n.emitStart("pinch",e,t),n._throttleEmit("pinch",e,t)}},this._end=function(e,t){var r=n.evCache,i=n.startPoints,a=r.map((function(e){return{x:e.x,y:e.y}}));if(e.points=a,n.emitEnd(e,n.refreshAndGetTarget(t)),1===r.length){var o=$d.now(),s=n.lastMoveTime;if(o-s<100){var l=s-(n.prevMoveTime||n.startTime);if(l>0){var u=n.prevMovePoint||i[0],c=n.lastMovePoint||i[0],h=ef(u,c)/l;h>.3&&(e.velocity=h,e.direction=Jd(u,c),e.type="swipe",t.dispatchEvent(e))}}}for(var d=0,f=r.length;d<f;d++)if(r[d].pointerId===e.pointerId){r.splice(d,1),i.splice(d,1);break}n.reset(),r.length>0&&n._start(void 0,t)},this._cancel=function(e,t){var r=n.evCache.map((function(e){return{x:e.x,y:e.y}}));e.points=r,n.emitEnd(e,n.refreshAndGetTarget(t)),n.evCache=[],n.reset()},this.options=t}return(0,a.Z)(e,[{key:"apply",value:function(t){var n=this,r=t.renderingService,i=t.renderingContext.root.ownerDocument,a=i.defaultView;this.canvas=a;var o=function(e){return e===i&&n.options.isDocumentGestureEnabled?i:e},s=function(e){var t=o(e.target);t&&n._move(e,t)},l=function(e){var t=o(e.target);t&&n._start(e,t)},u=function(e){var t=o(e.target);t&&n._end(e,t)},c=function(e){var t=o(e.target);t&&n._cancel(e,t)},h=function(e){var t=o(e.target);t&&n._end(e,t)};r.hooks.init.tap(e.tag,(function(){a.addEventListener("pointermove",s),a.addEventListener("pointerdown",l),a.addEventListener("pointerup",u),a.addEventListener("pointercancel",c),a.addEventListener("pointerupoutside",h)})),r.hooks.destroy.tap(e.tag,(function(){a.removeEventListener("pointermove",s),a.removeEventListener("pointerdown",l),a.removeEventListener("pointerup",u),a.removeEventListener("pointercancel",c),a.removeEventListener("pointerupoutside",h)}))}},{key:"getEventType",value:function(e,t,n){var r,i=this.eventType,a=this.startTime,o=this.startPoints;if(i)return i;(this.movingTarget=t,this.isPanListenerInPath=n.path.some((function(e){var t;return!(null===(t=e.emitter)||void 0===t||null===(t=t.eventNames())||void 0===t||!t.includes("pan"))})),this.isPanListenerInPath)?r=$d.now()-a>250&&ef(o[0],e)<10?"press":"pan":r="press";return this.eventType=r,r}},{key:"enable",value:function(e){this.processEvent[e]=!0}},{key:"isProcess",value:function(e){return this.processEvent[e]}},{key:"emitStart",value:function(e,t,n){this.isProcess(e)||(this.enable(e),t.type="".concat(e,"start"),n.dispatchEvent(t))}},{key:"_throttleEmit",value:function(e,t,n){var r=this;this.pushEvent(e,t);var i=this.throttleTimer,a=this.emitThrottles,o=this.processEvent;i||(this.throttleTimer=this.canvas.requestAnimationFrame((function(){for(var e=0,t=a.length;e<t;e++){var i=a[e],s=i.type,l=i.ev;o[s]&&(l.type=s,n.dispatchEvent(l))}r.throttleTimer=0,r.emitThrottles.length=0})))}},{key:"emitEnd",value:function(e,t){var n=this.processEvent;Object.keys(n).forEach((function(r){e.type="".concat(r,"end"),t.dispatchEvent(e),delete n[r]}))}},{key:"pushEvent",value:function(e,t){for(var n=this.emitThrottles,r={type:e,ev:t},i=0,a=n.length;i<a;i++)if(n[i].type===e)return void n.splice(i,1,r);n.push(r)}},{key:"clearPressTimeout",value:function(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}},{key:"refreshAndGetTarget",value:function(e){return this.movingTarget?(this.movingTarget&&!this.movingTarget.isConnected&&(this.movingTarget=e),this.movingTarget):e}},{key:"reset",value:function(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null,this.movingTarget=null,this.isPanListenerInPath=null}}])}();tf.tag="Gesture";var nf=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,t),(e=(0,s.Z)(this,t)).name="gesture",e.options=n,e}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.addRenderingPlugin(new tf((0,u.Z)({isDocumentGestureEnabled:!1},this.options)))}},{key:"destroy",value:function(){this.removeAllRenderingPlugins()}}])}(he);var rf=function(){return(0,a.Z)((function e(t){(0,o.Z)(this,e),this.canvasConfig=t.config,this.deviceRendererPlugin=t.deviceRendererPlugin}),[{key:"init",value:(t=(0,Go.Z)((0,Uo.Z)().mark((function e(){var t,n,r,i;return(0,Uo.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.canvasConfig,n=t.canvas,r=t.devicePixelRatio,this.$canvas=n,this.context=this.$canvas.getContext("webgl"),i=(i=r||1)>=1?Math.ceil(i):1,this.dpr=i,this.resize(this.canvasConfig.width,this.canvasConfig.height);case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getContext",value:function(){return this.context}},{key:"getDomElement",value:function(){return this.$canvas}},{key:"getDPR",value:function(){return this.dpr}},{key:"getBoundingClientRect",value:function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()}},{key:"destroy",value:function(){this.context=null,this.$canvas=null}},{key:"resize",value:function(e,t){var n,r=devicePixelRatio,a=this.$canvas;a.style&&(a.style.width="".concat(e,"px"),a.style.height="".concat(t,"px")),(n=a)&&"object"===i()(n)&&(1===n.nodeType&&n.nodeName||n.isCanvasElement)&&(a.width=e*r,a.height=t*r)}},{key:"applyCursorStyle",value:function(e){}},{key:"toDataURL",value:(e=(0,Go.Z)((0,Uo.Z)().mark((function e(t){return(0,Uo.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deviceRendererPlugin.toDataURL(t));case 1:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})}]);var e,t}(),af=function(e){function t(e,n){var r;return(0,o.Z)(this,t),(r=(0,s.Z)(this,t)).name="mobile-webgl-context-register",r.rendererPlugin=e,r.config=n,r}return(0,l.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){this.context.ContextService=rf,this.context.deviceRendererPlugin=this.rendererPlugin;var e=this.config;this.context.deviceContribution=new iu((0,u.Z)({},null!=e&&e.targets?{targets:e.targets}:{targets:["webgl2","webgl1"]}))}},{key:"destroy",value:function(){delete this.context.ContextService}}])}(he),of=function(e){function t(e){var n;(0,o.Z)(this,t),n=(0,s.Z)(this,t,[e]);var r=new Bd;return n.registerPlugin(new af(r,e)),n.registerPlugin(new jd),n.registerPlugin(r),n.registerPlugin(new Qd),n.registerPlugin(new Gd),n.registerPlugin(new Fd({isDocumentDraggable:!!(0,T.Z)(null==e?void 0:e.isDocumentDraggable)||e.isDocumentDraggable,isDocumentDroppable:!!(0,T.Z)(null==e?void 0:e.isDocumentDroppable)||e.isDocumentDroppable,dragstartDistanceThreshold:(0,T.Z)(null==e?void 0:e.dragstartDistanceThreshold)?10:e.dragstartDistanceThreshold,dragstartTimeThreshold:(0,T.Z)(null==e?void 0:e.dragstartTimeThreshold)?50:e.dragstartTimeThreshold})),n.registerPlugin(new nf({isDocumentGestureEnabled:!0})),n}return(0,l.Z)(t,e),(0,a.Z)(t)}(de)},20539:function(e){function t(e,t,r){r=r||2;var a,o,s,l,h,d,p,v=t&&t.length,g=v?t[0]*r:e.length,m=n(e,0,g,r,!0),y=[];if(!m||m.next===m.prev)return y;if(v&&(m=function(e,t,r,i){var a,o,s,l=[];for(a=0,o=t.length;a<o;a++)(s=n(e,t[a]*i,a<o-1?t[a+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),l.push(f(s));for(l.sort(u),a=0;a<l.length;a++)r=c(l[a],r);return r}(e,t,m,r)),e.length>80*r){a=s=e[0],o=l=e[1];for(var E=r;E<g;E+=r)(h=e[E])<a&&(a=h),(d=e[E+1])<o&&(o=d),h>s&&(s=h),d>l&&(l=d);p=0!==(p=Math.max(s-a,l-o))?32767/p:0}return i(m,y,r,a,o,p,0),y}function n(e,t,n,r,i){var a,o;if(i===C(e,t,n,r)>0)for(a=t;a<n;a+=r)o=S(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=S(a,e[a],e[a+1],o);return o&&m(o,o.next)&&(A(o),o=o.next),o}function r(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(A(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,u,c,h,f){if(e){!f&&h&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=d(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,l,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,u*=2}while(o>1)}(i)}(e,u,c,h);for(var p,v,g=e;e.prev!==e.next;)if(p=e.prev,v=e.next,h?o(e,u,c,h):a(e))t.push(p.i/n|0),t.push(e.i/n|0),t.push(v.i/n|0),A(e),e=v.next,g=v.next;else if((e=v)===g){f?1===f?i(e=s(r(e),t,n),t,n,u,c,h,2):2===f&&l(e,t,n,u,c,h):i(r(e),t,n,u,c,h,1);break}}}function a(e){var t=e.prev,n=e,r=e.next;if(g(t,n,r)>=0)return!1;for(var i=t.x,a=n.x,o=r.x,s=t.y,l=n.y,u=r.y,c=i<a?i<o?i:o:a<o?a:o,h=s<l?s<u?s:u:l<u?l:u,d=i>a?i>o?i:o:a>o?a:o,f=s>l?s>u?s:u:l>u?l:u,v=r.next;v!==t;){if(v.x>=c&&v.x<=d&&v.y>=h&&v.y<=f&&p(i,s,a,l,o,u,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function o(e,t,n,r){var i=e.prev,a=e,o=e.next;if(g(i,a,o)>=0)return!1;for(var s=i.x,l=a.x,u=o.x,c=i.y,h=a.y,f=o.y,v=s<l?s<u?s:u:l<u?l:u,m=c<h?c<f?c:f:h<f?h:f,y=s>l?s>u?s:u:l>u?l:u,E=c>h?c>f?c:f:h>f?h:f,_=d(v,m,t,n,r),T=d(y,E,t,n,r),R=e.prevZ,S=e.nextZ;R&&R.z>=_&&S&&S.z<=T;){if(R.x>=v&&R.x<=y&&R.y>=m&&R.y<=E&&R!==i&&R!==o&&p(s,c,l,h,u,f,R.x,R.y)&&g(R.prev,R,R.next)>=0)return!1;if(R=R.prevZ,S.x>=v&&S.x<=y&&S.y>=m&&S.y<=E&&S!==i&&S!==o&&p(s,c,l,h,u,f,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.nextZ}for(;R&&R.z>=_;){if(R.x>=v&&R.x<=y&&R.y>=m&&R.y<=E&&R!==i&&R!==o&&p(s,c,l,h,u,f,R.x,R.y)&&g(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;S&&S.z<=T;){if(S.x>=v&&S.x<=y&&S.y>=m&&S.y<=E&&S!==i&&S!==o&&p(s,c,l,h,u,f,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function s(e,t,n){var i=e;do{var a=i.prev,o=i.next.next;!m(a,o)&&y(a,i,i.next,o)&&T(a,o)&&T(o,a)&&(t.push(a.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),A(i),A(i.next),i=e=o),i=i.next}while(i!==e);return r(i)}function l(e,t,n,a,o,s){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&v(l,u)){var c=R(l,u);return l=r(l,l.next),c=r(c,c.next),i(l,t,n,a,o,s,0),void i(c,t,n,a,o,s,0)}u=u.next}l=l.next}while(l!==e)}function u(e,t){return e.x-t.x}function c(e,t){var n=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o&&(o=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==t);if(!n)return null;var l,u=n,c=n.x,d=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&p(a<d?i:o,a,c,d,a<d?o:i,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(i-r.x),T(r,e)&&(l<f||l===f&&(r.x>n.x||r.x===n.x&&h(n,r)))&&(n=r,f=l)),r=r.next}while(r!==u);return n}(e,t);if(!n)return t;var i=R(n,e);return r(i,i.next),r(n,n.next)}function h(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function d(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function p(e,t,n,r,i,a,o,s){return(i-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(r-s)>=(n-o)*(t-s)&&(n-o)*(a-s)>=(i-o)*(r-s)}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(T(e,t)&&T(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||m(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,r){var i=_(g(e,t,n)),a=_(g(e,t,r)),o=_(g(n,r,e)),s=_(g(n,r,t));return i!==a&&o!==s||(!(0!==i||!E(e,n,t))||(!(0!==a||!E(e,r,t))||(!(0!==o||!E(n,e,r))||!(0!==s||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function _(e){return e>0?1:e<0?-1:0}function T(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function R(e,t){var n=new x(e.i,e.x,e.y),r=new x(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function S(e,t,n,r){var i=new x(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function x(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,r){var i=t&&t.length,a=i?t[0]*n:e.length,o=Math.abs(C(e,0,a,n));if(i)for(var s=0,l=t.length;s<l;s++){var u=t[s]*n,c=s<l-1?t[s+1]*n:e.length;o-=Math.abs(C(e,u,c,n))}var h=0;for(s=0;s<r.length;s+=3){var d=r[s]*n,f=r[s+1]*n,p=r[s+2]*n;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[i][a][o]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},85545:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(9370),i=n(71360),a=n(41295);function o(e,t,n){return t=(0,r.Z)(t),(0,a.Z)(e,(0,i.Z)()?Reflect.construct(t,n||[],(0,r.Z)(e).constructor):t.apply(e,n))}},67505:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(9370);function i(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=(0,r.Z)(e)););return e}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=i(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},a.apply(null,arguments)}function o(e,t,n,i){var o=a((0,r.Z)(1&i?e.prototype:e),t,n);return 2&i&&"function"==typeof o?function(e){return o.apply(n,e)}:o}}}]);